e862b0c259 Code clean-up - Fix missing Javadoc tags - Correct indent - Consistent use of file() - Add {} to improve readability
25c931efa3 Update Eclipse settings to Oxygen (it has been a while)
f406b21795 Try and avoid shutdown exceptions
050353fdbe Prevent exceptions being thrown during normal shutdown of NIO connections. This enables TLS connections to close cleanly.
bdfc5986d9 Remove unnecessary code. Method implementation is identical to over-ridden super class method.
fb48853a49 Fix a couple of minor FindBugs warnings
3267805ff4 Fix build
37badaa816 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57767 Add support to the WebSocket client for following redirects when attempting to establish a WebSocket connection. Patch provided by J Fernandez.
807859d76f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61086 Merged revision(s) 1803618 from tomcat/tc8.0.x/trunk: Merged revision(s) 1803616 from tomcat/trunk: Ensure to explicitly signal an empty request body for HTTP 205 responses. Additional fix to r1795278. Based on a patch provided by Alexandr Saperov.
8e8f676efd Follow-up to r1803505 Restore required imports
e9e25cf2cd Avoid Javadoc nags in IDE
4b107991e0 Revert fix for bug 49464 as it was causing too many regressions in later branches.
9ffcee48f3 Fix some scary but low confidence Findbug warnings (and other warnings in those files)
30023a4907 Refactor to simplify code and to remove a FindBugs warning
4c35f93232 Fix clone issues
82bee2b653 Fix bit sign checks warnings, no functional change
db647a9d6f Add additional logging to record problems that occur while waiting for the NIO pollers to stop during the Connector stop process.
49c4feb9c5 Follow-up to r1802831 Ensure the docBase is absolute
12c4063e56 Fix a possible conflict when running multiple instances of the Tomcat unit tests on the same server.
db2c2d093f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61313 Make the read timeout configurable in the JNDIRealm and ensure that a read timeout will result in an attempt to fail over to the alternateURL. Based on patches by Peter Maloney and Felix Schumacher.
d7d47038e2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61322 Correct two regressions caused by the fix for bug 60319 when using BIO with an external Executor. Firstly, use the maxThreads setting from the Executor as the default for maxConnections if none is specified. Secondly, use maxThreads from the Executor when calculating the point at which to disable keep-alive.
95c4c6dc41 Markdown markup files are text. Set svn:eol-style=native on and add them to "text.files" in build.xml.
a9826d8bd3 UTF-8 file. Set properties accordingly. Should be OK, even with a BOM present
6ccbb16a17 Correct a further regression in the fix for bug 49464 that could cause an byte order mark character to appear at the start of content included by the DefaultServlet.
b6234ce721 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61253
67dbcc84df Exclude developer local files from license header checks
9cb268a492 Porting r1631406 to tomcat7: Use UTF-8 to fix ASCII art in Javadoc. How ironic.
948b7d92f1 Porting r1631350 to tomcat7: Fix Java8 Javadoc errors in the javax.servlet.jsp package
2cc8c6544a Porting r1631705 to tomcat7: Switch to inline styles to silence the Java 8 Javadoc warnings for the JSP API
442acd04bb Porting r1631157 to tomcat7: Some Javadoc fixes for Java 8 <br/> -> <br>
ea983adb05 Fix IDE nag
d2e71326f0 Better wording that doesn't run the risk of suggesting nested
07705dda7c Correct the contributor name
9f1cdcb736 java.nio.charset.StandardCharsets is not available in Java 6
bb94032b84 Enable checkstyle's license header check for properties files.
33b6334585 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61232 When log rotation is disabled only one separator will be used when generating the log file name. Patch provided by Katya Todorova via GitHub.
07c16103fa Add missing file
8ad183768c Further 49464 fixes Update unit tests to avoid conversion Also fix Javadoc warnings
29ea6566b7 Correct a regression in the fix for bug 49464 that could cause an incorrect Content-Length header to be sent by the DefaultServlet if the encoding of a static is not consistent with the encoding of the response.
94dc308767 Follow-up to r1801151 There is a setResources() method in this class and the super class. The patch needed to make sure the right setResources() was called.
a956c3c4e4 FindBugs: Make use of SimpleDateFormat instances thread-safe.
b47c2f67c7 Fix one FindBugs and one Javadoc warning
3c017bc4bd Move exclusions for test code to the correct section
349ed4f683 FindBugs: false positives
bee4a22e3f Remove code. It isn't necessary and FindBugs doesn't like it.
5c81d29f2f Refactor to silence some FindBugs warnings
32e29b7869 Simplify and silence a FindBugs report (Note: there would not have been a problem if an increment has been lost)
950e564538 FindBugs: Thread-safe update
24886a3c26 Fix a FindBugs warning (increment of volatile not atomic)
81bc3a3fbf Remove unused code reported by FindBugs
99a3897337 Remove unused code identified by FindBugs
c0e0f2d268 FindBugs: Simplify locking code Mark remaining issues as false positives
dcdfacb015 FindBugs: Sync mis-match Reduce size of sync block and make current volatile so updates are seen consistently
d738a22575 Fix FindBugs warnings in test code
ee8ca1b30b Fix FindBugs warnings. Sync only on setter. Use ReadWriteLock instead.
a4be67af2c Findbugs: Remove pointless null check. Refactor.
08e7f90202 FindBugs: Remove unnecessary null check
30f1efd4b4 FindBugs: Fix possible NPE Correct method name
3b8b4868b0 FindBugs: Fix possible NPE
8b4655580d Remove naked notify (resolving a FindBugs issue) as I can't find any locations where wait() is called with the Poller as the monitor.
ff92f24590 Fix FindBugs warning: Incorrect lazy initialization of static field
af93e60a42 Clean-up: FindBugs warnings - use of Arrays.toString()
bc97252207 FindBugs: More false positives
5aef14e1e7 Fix some warnings: - Findbugs - not serializable
c80b503fde Fix some Eclipse / Javadoc warnings
b4f8a22d42 Reformat to clear a couple of FindBugs warnings
a4d9e9793c Clean-up  - fix indentation  - silence a handful of fairly pointless FindBugs warnings
e8f7f8c529 Fix broken merge
9da020d820 Re-organise to silence some FindBugs warnings
d5d984be23 Silence a findbugs warning
7515c7f019 Fix Find Bugs warnings - thread safety of data formatting
bc4748343b FindBugs: More false positives
408614577a FindBugs: Fix unused code by implementing the TODO associated with it
33ceaf006e Refactor to avoid FindBugs NPE warning
df5d596e7d Fix FindBugs NPE warning
713487dbce Add some issues deprecated code to the exclusions
593da5cf2d Fix error handling (non IOException were swallowed) Identified by FindBugs
f87e6b4826 Fix NPE reported by FindBugs
cd82840d87 Refactor test to stop IDE and FindBugs complaining about possible NPEs. Also requires slightly less code.
44d93a06cb Fix warnings in IntrospectionUtils. One functional change to replace a debug message and a subsequent NPE with an IAE
a016dcfcec Clean-up - fix false positive NPE warnings by removing redundant code and suppressing remaining warning
f6015371f8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56784 Fix a couple of rare but theoretically possible atomicity bugs. Also fixes a FindBugs warning
08a6fdf0d7 Remove unnecessary syncs identified by FindBugs
3c97e8a26b Compare integers as integers not Dates. Fixes warning reported by FindBugs
cf2bff5048 Replicate the equals() and hashCode() strategy from MessageBytes to silence some FindBugs warnings
bb5151e1b9 Use correct syntax
38dfefebff git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1801019 13f79535-47bb-0310-9956-ffa450edef68
db4218633b Fix NPE and dead store warnings. Reported by FindBugs.
49182469b2 Fix possible name confusion. Reported by FindBugs.
664dbeff3f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=53031 Add support for the fork option when compiling JSPs with the Jasper Ant task and javac.
d2b7657ea7 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=52791 Add the ability to set the defaults used by the Windows installer from a configuration file. Patch provided by Sandra Madden.
2f143e749f Update the release date for 7.0.79
ea2ba60c7c Only attempt to convert character encoding for text resources
76f5abd4a3 Fix CI failures
9c1ef85147 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=49464 Improve the Default Servlet's handling of static files when the file encoding is not compatible with the required response encoding.
b06b172fb1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61229 Correct a regression in 7.0.78 that broke WebDAV handling for resources with names that included a '&' character.
5ad33a3fd6 Name the thread that cleans the log files and mark it as a daemon thread. Additional permission for deleting files is granted to JULI as it is required by FileHandler when running under a Security Manager.
74420a2031 Increment version for next dev cycle
70e547234b Avoid NPE during non-container thread error handling
079fe25764 Make asynchronous error handling more robust. In particular ensure that onError() is called for any registered AsyncListeners after an I/O error on a non-container thread.
8fdfd7a480 Refactor to reduce code duplication.
71b984b7ff Correctly define addConnectorPort and invalidAuthenticationWhenDeny in the mbean-descriptors.xml file for the org.apache.catalina.valves package so that the attributes are accessible via JMX.
7b2b453f5b Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61201 Ensure that the SCRIPT_NAME environment variable for CGI executables is populated in a consistent way regardless of how the CGI servlet is mapped to a request.
f44cfca5b4 Get test working on Windows that doesn't like ':' in file names.
d5ad041f20 Add links to the corresponding documents.
589f75a7d6 Add README and CONTRIBUTING documents to help users that are utilizing the github mirror rather than SVN.
7a4da1e4f9 Correct back-port of fix for BZ 61183
cdb2918cc4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61183 Correct a regression in the previous fix for BZ 58624 that could trigger a deadlock depending on the locking strategy employed by the client code.
de0310ebb2 Fix the build - java.nio.file is not available in Java 6
4ca18d4f60 Improve thread-safety of Futures used to report the result of sending WebSocket messages.
839423b575 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61105 Add a new JULI FileHandler configuration for specifying the maximum number of days to keep the log files.
ec49511c3b Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61180 Log a warning message rather than an information message if it takes more than 100ms to initialised a SecureRandom instance for a web application to use to generate session identifiers. Patch provided by Piotr Chlebda.
a82405d46c Clean-up. No functional change
6f5ad32b8e Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61185 When an asynchronous request is dispatched via AsyncContext.dispatch() ensure that getRequestURI() for the dispatched request matches that of the original request.
17bd0e71f4 Format the code. No functional changes.
be98de0294 Collections.emptyEnumeration() does not exist in java 6, use alternative.
1211be95b9 When using EasyMock for mocking classes, one needs cglib and objenesis in the class path.
97aa6665ef Fix the build
6a2140a268 A new configuration property 'crawlerIps' is added to the 'o.a.catalina.valves.CrawlerSessionManagerValve'. Using this property one can specify a regular expression that will be used to identify crawlers based on their IP address. Based on a patch provided by Tetradeus.
5495fcd031 Format the code. No functional changes.
f5a702584e Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61173 Polish the javadoc for o.a.catalina.startup.Tomcat. Patch provided by peterhansson_se.
24e72e871f Fix typos
b83d3037fc Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61150 Configure the Manager and Host-Manager web applications to permit serialization and deserialization of CRSFPreventionFilter related session objects to avoid warning messages and/or stack traces on web application stop and/or start.
050bd20cb6 Fix copy/paste error
81f772e656 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61154 Introduce a new custom permission, DeployXmlPermisasion, that allows a web application running under a security manager to use a META-INF/context.xml even when Host.deployXML is false.
32be162092 Correct typo in Context Container Configuration Reference. Patch provided by Katya Todorova.
0a64d96e65 Revert a change introduced in the fix for bug 60718 that changed the status code recorded in the access log when the client dropped the connection from 200 to 500.
1d28a3a40e Better document the meaning of the trimSpaces option for Jasper.
e14e11f4ae Tweak comment
fe7bfb725d Improve the <code>SSLValve</code> so it is able to handle client certificate headers from Nginx. Note that Java 7 isn't quite as tolerant as Java 8. Based on a patch by Lucas Ventura Carro.
3ebe1d90a6 Enable TesterLogValidationFilter to test log levels and throwables as well as messages.
7a095b22b1 Extract log message validation filter to a separate class where it can be used by any unit test.
28843fc08c Correct the log message when a MessageHandler for PongMessage does not implement MessageHandler.Whole.
726534111d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61146 Add missing lookup() method to @EJB annotation in the annotations API. Patch provided by Katya Todorova.
fd16c28051 Correct import order
bcbdbe234f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61145 Add missing @Documented annotation to annotations in the annotations API. Patch provided by Katya Todorova.
bf48dc981e Spellcheck (merge r1796906 from /tomcat/tc8.0.x/trunk)
b42f9953a3 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=45879 Add the RELEASE-NOTES file to the root of the installation created by the Tomcat installer for Windows to make it easier for users to identify the installed Tomcat version.
199b9ab4dd Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=45832 Add HTTP DIGEST support
31ae5df909 Remove unused i18n string
33fdbe819a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=44787 Improve error message when JSP compiler configuration options are not valid.
013894bac5 Fix typo
52382ebfbc BZ61101: CORS filter should set Vary header in response. Submitted by Rick Riemer.
94f558c4ca Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61076 Document the altDDName attribute.
db5d6cee02 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61086 Explicitly signal am empty request body for HTTP 205 responses.
de4eff73f5 Update the release date for 7.0.78
e17350764d Increment version for next dev cycle
f65a628b50 Correct javadoc. Patch provided by John Andrew (XUZHOUWANG).
47cbfa4f79 61072: Respect what the doc says about using the platform default secure random.
5b24fb2c57 Correct the logic that selects the encoding to use to decode the query string in the SSIServletExternalResolver so that the useBodyEncodingForURI attribute of the Connector is correctly taken into account.
39676b1a6b Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61003 Ensure the flags for reading/writing are correctly reset even if some exceptions occurred during processing.
cf6952a809 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=61047 Add MIME mapping for woff2 fonts in the default web.xml. Patch provided by Justin Williamson.
29189e5a15 When the WebDAV servlet is configured and an error dispatch is made to a custom error page located below WEB-INF, ensure that the target error page is displayed rather than a 404 response.
e558103b27 Refactor
1a8e13a639 If a static custom error page is specified that does not exist or cannot be read, ensure that the intended error status is returned rather than a 404.
58b32048ce Ensure that when the Default or WebDAV servlets process an error dispatch that the error resource is processed via the doGet() method irrespective of the method used for the original request that triggered the error.
3bfe9fb886 Use a more reliable mechanism for the DefaultServlet when determining if the current request is for custom error page or not.
c1a62522e9 Fix test broken by update to encoding. Generally, it is far too difficult to re-encode characters that were encoded in the original URKL when they didn't need to be.
c5886a8304 Review those places where Tomcat re-encodes a URI or URI component and ensure that that correct encoding (path differs from query string) is applied and that the encoding is applied consistently.
0ff06268bd Add documents for maxIdleTime attribute to Channel Receiver docs.
7128573456 WS police.
e73c199b32 Move new changelog entry into correct subsection.
dfd1cda229 Document the property test.excludePerformance in BUILDING.txt (plus slightly reduce unneeded delta to TC8.0.x).
0ccc0cadb4 Apache Ant 1.8.2 was already rquired further up in this document.
8889b8b0d6 Allow to exclude JUnit test classes using the build property "test.exclude" and document the property in BUILDING.txt.
4fcf30f592 Pre-load the ExceptionUtils class. Since the class is used extensively in error handling, it is prudent to pre-load it to avoid any failure to load this class masking the true problem during error handling.
2b27d439c0 In StatementFacade, the method call on the statements that have been closed throw SQLException rather than NullPointerException.
81a20d7a2f Update the release date for 7.0.77
27c3090ad5 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60932 Correctly escape single quotes when used in i18n messages. Based on a patch by Michael Osipov.
dbc7afbe52 Refactor the creating a constructor for a proxy class to reduce duplicate code.
896ec55590 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60925 Improve the handling of access to properties defined by interfaces when a BeanELResolver is used under a SecurityManager
32c460c078 Fix Java8 detection by testing for class java.util.Optional (Java8+) instead of class javax.net.ssl.SSLParameters (Java6+). Patch provided by fibbers via Github.
4d65706463 javax.net.ssl.SSLParameters exists since Java 6, but the method setUseCipherSuitesOrder exists since Java 8. Make this clear in the comments. Patch provided by fibbers via Github.
6f3cfc77c1 Use Boolean#getBoolean when reading the system property.
06e7544244 Increment version for next dev cycle
82baa92879 Fix javadoc
3d79a6cad6 Follow-up to r1788999 Need to add socket/processor to connection cache so pipe-lined request is processed
8a9c09aee6 A "space" in the property name is used in order to keep the "Property" column at some specified width.
a4efd3ca1c Improve sendfile handling when requests are pipelined.
3443b1de82 Add 500 ISE to the most common reason phrases that can happen.
c1eff903da Call to #toString() is not needed.
0c8634c8bf Fix typos
85d129d67d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60911 Ensure NPE will not be thrown when looking for SSL session ID. Based on a patch by Didier Gutacker.
dd4ea0fd4e Fix typos
178fde637a Fix JavaDoc.
c316f60953 Remove unnecessary ;
f675b42e52 Credit
dcc54ded8c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60844 Correctly handle the error when fewer parameter values than required by the method are used to invoke an EL method expression.
ca6397c15b Updating my uid in changelog entry for consistency
16527e2324 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60852 Correct spelling of compressible Based on a patch by Michael Osipov
4a5a12f2de Add docs of useStatementFacade attribute.
c46518890b Fix auto-boxing
e97a773fda Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60764 Implement equals() and hashCode() in the StatementFacade in order to enable these methods to be called on the closed statements if any statement proxy is set. This behavior can be changed with useStatementFacade attribute.
845c8c6458 Trivial commit to test CI system. Experimenting with automatic formatting. No functional change.
179786ff49 Improve the error handling for simple tags to ensure that the tag is released and destroyed once used (v2 with Violeta).
4ff7c43556 Trivial commit to test CI system. Experimenting with automatic formatting. No functional change.
52efc25ff4 Move the changelog for r1781602 to the correct Tomcat version.
4dc3600e62 Add release date for 7.0.76
328719bcce svn:eol-style=native
200d32d1f7 Fix copy-and-paste error in changelog. Move entry from the "Tribes" section to the correct "Catalina" section.
cdbc0c9872 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=54618 Add support to the HttpHeaderSecurityFilter for the HSTS preload parameter.
ccbdc292c2 Moving two changelog entries from incorrect the section (Web Applications) to the correct section (Catalina) so that the changelog correctly reflects the updates.
16d63d3d5d Correct minimum Java version incorrectly changed in r1786149
b6007e93e3 Increment version for next dev cycle
3df88a57ef Re-work NSIS build so NSIS 2.x can be used easily (3.x remains the default)
82802318d8 Fix i18n related warnings that are reported with NSIS 3.0. (The problem existed with 2.x but no warning was generated.)
a1e5f1a541 Update NSIS installer to 3.01
ecfc42a8ae Fix failing test
6bb36dfdf6 Ensure request and response facades are used when firing application listeners.
f41c9f32d5 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60824 Correctly cache the Subject in the session - if there is a session - when running under a SecurityManager. Patch provided by Jan Engehausen.
49cb04f926 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60808 Ensure that the Map returned by ServletRequest.getParameterMap() is fully immutable. Based on a patch provided by woosan.
00abaf4490 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60806 To avoid ClassNotFoundException, make sure that the web application class loader is passed to ReplicatedContext.
8d58480880 Update all unit tests that test the HTTP status line to check for the required space after the status code. Patch provided by Michael Osipov.
be1bbaa529 Exclude PEM files from checkstyle format checks.
5cec730d33 Update expired certs and test keys
606bc7c246 Update expired test keys and certs
d36cd442f7 Remove duplicated code
62e85ec226 Update the packaged version of the Tomcat Native Library to 1.2.12 to pick up the latest Windows binaries built with OpenSSL 1.0.2k.
ceaf3696f2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60722 Take account of the dispatchersUseEncodedPaths setting on the current Context when generating paths for dispatches triggered by AsyncContext.dispatch()
8a4b1d1f90 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60718 Improve error handling for asynchronous processing and correct a number of cases where the <requestDestroyed() event was not being fired and an entry wasn't being made in the access logs.
9bdcbbcbf8 Revert the fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=60632 The proposed fix didn't work and there is a better solution available.
cec568ed99 Correct OPTIONS response for WebDAV so TRACE is not included when it is disabled
5c257340b3 Correct Javadoc
6530d8b9a3 ws police
4c2ee7fd4d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60688 Java 9 support for annotation scanning Based on: http://cr.openjdk.java.net/~mr/jigsaw/spec/lang-vm.html#jigsaw-2.6
8684ffcf6a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60674 Remove final marker to enable sub-classing.
2640516752 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60632 Add support for the CATALINA_EXIT_DELAY environment variable that can be used to work around a known systemd bug. Based on a patch by Jeff Turner.
15fed8e9bb Fix some IDE/checkstyle nags
54a392c6d9 Followup commit for r1782037, adding warnings and StringManager
d91a358ab0 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60594 Adding implementation of whitelist patch
b0e35f94f5 Ensure that executor thread pools used with connectors pre-start the configured minimum number of idle threads.
4585bffc68 Refactor generated JSP code so tags require less code
ee7e3f796c 60683: Preload converters to avoid security failures on some JVMs.
504b7d4fce Ensure that NoRpcChannelReply messages are not received on RpcCallback.
64c540d227 Make the accessTimeout configurable in ClusterSingleSignOn.
50bdf632c5 Reduce the contention in the default InstanceManager implementation when multiple threads are managing objects and need to reference the annotation cache. Prior to this patch, TestDefaultInstanceManager#testConcurrency() showed a roughly linear increase in execution time as the thread count increased. With this patch applied, the test shows broadly no change in execution time as the thread count is increased from 1 to 8 on a machine with 8 cores available.
01ff6e45de Correct changelog sections
1ca5b86da2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60617 Correctly create a CONNECT request when establishing a WebSocket connection via a proxy. Patch provided by Svetlin Zarev.
fc948423bd Update the release date for 7.0.75
c011e10f2d Make it easier for sub-classes of Tomcat to modify the default web.xml settings by over-riding getDefaultWebXmlListener(). Patch provided by Aaron Anderson.
f3e221f174 For https://bz.apache.org/bugzilla/show_bug.cgi?id=60620 Followup to r1778068: Update include/exclude patterns in Eclipse projects, so that compilation of SafeForkJoinWorkerThreadFactory class is skipped in main tomcat-7.0.x project that is built with java 6.
22f06c947d Code clean-up Remove unnecessary check. The DefaultServlet checks this already.
1bab8ba23a Prep for next version
6053f8ea1d 7.0.74 did not pass the vote
a8a44d94e5 Ensure the ASF logo image is correctly displayed in docs and host-manager applications.
6905810764 Make the accessTimeout configurable in BackupManager. The accessTimeout is used as a timeout period for PING in replication map.
98958874a0 Prep for next version
f6f193ed15 -Add log message that PING message has received beyond the timeout period. -When a PING message that beyond the time-out period has been received, make sure that valid member is added to the map membership.
0f7a058ab9 Update changelog
d50b05c74d Spelling fixes. Patch provided by Josh Soref.
1ec9c55e94 Spelling fixes. Patch provided by Josh Soref.
0768e4a8a7 Spelling fixes. Patch provided by Josh Soref.
80a92206a6 Spelling fixes. Patch provided by Josh Soref.
343cd8e067 Enable reset the statistics without restarting the pool.
c790c92e87 Add memory protection for ForkJoinPool.commonPool() related memory leaks. The 7.0.x fix is a little more involved since the ThreadFactory required can only be compiled with Java 7 onwards.
39d642a1de  Revert try/finally for simple tags.
c51e3a3ae9 60497: Follow up fix using a better variable name for the tag reuse flag.
52bc892052 Simplify
143bb466cf Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60409 When unable to complete sendfile request, ensure the Processor will be added to the cache only once.
bb5f92c8d5 ws fixes
713d1fac8b ws police
62c04aed92 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=53602 Add HTTP status code 451 (RFC 7725) to the list of HTTP status codes recognised by Tomcat.
d7717d926c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60344 Documentation component of fix. Document reasoning behind line-ending configuration.
f62c96d32f iHappy New Year 2017
977dc2b9bd 60513: Fix thread safety issue with RMI cleanup code.
4484d65c9b Fix typos
6db11d6668 60497: Restore previous tag reuse behavior following the use of try/finally.\n Improve the error handling for simple tags to ensure that the tag is released and destroyed once used.
cedd874446 Expand a little on JMX in the security considerations page
506bd38604 Add a changelog entry for logo updates
d04d899942 Use the Tomcat logo rather than the ASF logo as the logo shown throughout the install. This is the Apache *Tomcat* installer after all.
bcdd99d402 Remove the old ASF feather from side image. I tried added the new feather but it looked awful and I lack the skills/tools to make it look decent.
04a2a609ed Remove unused file
79a9b1bd28 Update to new ASF logo Use consistent version of Tomcat logo in each format
40c3b99ca0 Exclude svg files from validation
a959492ce5 Be explicit that clustering requires a secure network
a9d18d4749 Fix unlock delay on OSX if airdrop is enabled.
3fc636588b ea-b148 requires new syntax
956be518e3 ThreadLocal leak detection is now hitting Java 9 module issues. Catch the error and provide a useful error message if this happens.
d312229824 Update changelog
2efddaa602 Merged revision 1773527 from tomcat/tc8.0.x/trunk: Prevent read time out when the file is deleted while serving the response. The issue was observed only with APR Connector and sendfile enabled.
999baced6d Add LocalStrings entry endpoint.apr.noSendfileWithSSL. This is in addition to r1773519.
a4de6c8625 Merged revision 1773521 from tomcat/tc8.0.x/trunk: The test finishes with "SocketTimeoutException: Read timed out" when APR is used. Mark with @Ignore while investigating.
96abc0100f Merged revisions 1530269, 1531659 from tomcat/tc8.0.x/trunk: - Ensure sendfile is enabled by default for APR. - Enabling/disabling sendfile should occur during bind not during start. Add a warning message if the user tries to explicitly enable sendfile with SSL.
2907474368 Unit test that reproduces the exceptions reported with bug 60409.
5a7314db69 Format the code
d684d02990 Update attribution to use Ben Wolfe's full name.
d419f61b2e Fix typo
b1b6a317e7 Remove extra space between import groups identified by Gump when running with latest Checkstyle HEAD
01292e421e Fix warning logged during tests
e84c4a0f18 Fix broken test - += is not valid UEL syntx in 2.2 - functions need to be defined in TLD
48975aae26 Update changelog and split entry into 2
b7f6f5f179 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60431 Improve handling of varargs in UEL expressions. Based on a patch by Ben.
3769abdd8a 60437: Use a more sensible default buffer size value for the handshake dummy buffer (hopefully avoid resize).
6c47d1ccde Refactor to remove duplicated code
2b839b27ff fix format
c3cfe85f02 whitespace
11f825dc03 Ensure that the endpoint is able to unlock the acceptor thread during shutdown if the endpoint is configured to listen to any local address of a specific type such as "0.0.0.0" or "::".
ee5654a034 Add the statistics for released connection by an idle check and removeAbandoned.
330923f48e Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60395 Log when an Authenticator passes an incomplete GSSContext to a Realm since it indicates a bug in the Authenticator. Patch provided by Michael Osipov.
d460e5b895 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60356 Fix pre-compilation of JSPs that depend on nested tag files packaged in a JAR.
8a1bba45d7 Whitespace. No functional change.
f025169685 Update BUILDING.txt with information for the new property test.verbose
9de476395c New property is added test.verbose in order to control whether the output of the tests is displayed on the console or not. Patch provided by Emmanuel Bourg. (violetagg)
ff46d18122 Add the statistics for reconnect connection.
42df03ae70 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60398 Fix testcase of TestSlowQueryReport.
04331665e8 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60380 Ensure that a call to HttpServletRequest#logout() triggers a call to TomcatPrincipal#logout(). Based on a patch by Michael Osipov.
9eaa8b0cee Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60379 Dispose of the GSS credential once it is no longer required. Patch provided by Michael Osipov.
58bc3b1dbe Remove unnecessary code
64ac149aab Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60393 Use consistent parameter naming in implementations of Realm#authenticate(GSSContext, boolean)
a61a0afcc9 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58816 Implement the statistics of jdbc-pool. The stats infos are borrowedCount, returnedCount, createdCount and releasedCount.
67bc3ade67 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58816 Implement the statistics of jdbc-pool. The stats infos are borrowedCount, returnedCount, createdCount and releasedCount.
cfe0e257c0 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60366 Change catalina.bat to use directly LOGGING_MANAGER and LOGGING_CONFIG variables in order to configure logging, instead of modifying JAVA_OPTS. Patch provided by Petter Isberg.
e5f0fbc6f6 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60387 Correct the javadoc for o.a.catalina.AccessLog.setRequestAttributesEnabled
932255287e Correct a typo in Host Configuration Reference. Issue reported via comments.apache.org.
3db94dcbc2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60194 If validationQuery is not specified, connection validation is done by calling the isValid() method.
1e7f6fbb09 Update the release date for 7.0.73
59cd09e479 Take account of the Host's contextClass attribute when embedding
abe686125e Reduce the warning logs for a message received from a different domain in order to avoid excessive log outputs.
b5b78a3cfe Prep for next version
7e3a037055 Explicitly configure allowed credential types
cdc0a935c2 Add additional checks for valid characters to the HTTP request line parsing so invalid request lines are rejected sooner.
be6b5a8be3 Improve detection of I/O errors during async processing on non-container threads and trigger async error handling when they are detected.
2020cd4c71 If an I/O error occurs during async processing on a non-container thread, ensure that the onError() event is triggered.
5b6efb27ef Correct a typo in HTTP Connector How-To. Issue reported via comments.apache.org.
b0b62ee318 When the proxy node sends a backup retrieve message, ensure that using the channelSendOptions that has been set rather than the default channelSendOptions.
92f5a70460 Fix default value of validationInterval attribute in jdbc-pool.
45377cd8c3 Remove unnecessary wrong comment.
3540a349fe Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60306 Improve Javadoc
7fef043666 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60319 When using an Executor, disconnect it from the Connector attributes maxThreads minSpareThreads and threadPriority to enable the configuration settings to be consistently reported. These Connector attributes will be reported as -1 when an Executor is in use. The values used by the executor may be set and obtained via the Executor.
3708f028c3 Move changelog entries: - ResourceLink change to Catalina - native update to Other
6962459041 Correct the order of the sections
ba06d0e676 Fix typo
aa3858c905 Sync with 8.0.x
0cab53d0e3 Remove trailing whitespace for simpler diffs with later versions
fc88bf4340 Remove extra trailing space
7f894d297a DEL (127) is not a token character
a3d7be9e35 DEL is not valid in a token. Refactor with a view to re-using this code more widely in the Tomcat codebase.
147460e8d4 Update command line parameter
50ce9bca22 Fix backport
713eba5a22 Update Tomcat Native to 1.2.10
5c44be0e23 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60199 Log a warning if deserialization issues prevent a session attribute from being loaded.
eb031ab679 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60192 Correct a typo in the status output of the Manager application. Patch provided by  Radhakrishna Pemmasani.
1d69a4ddb3 Improve the access checks for linked global resources to handle the case where the current class loader is a child of the web application class loader.
d066392927 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60188 Add an example of using the classesToInitialize attribute of the JreMemoryLeakPreventionListener to the documentation web application. Based on a patch by Cris Berneburg.
7b6b9e639c Back-port r1762710 to add startup script documentation clarifying the (non) use of enviroment variables when Tomcat is launched as a Windows Service. [DOC: CTR]
23a86d2fd7 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60174 Log instances of HeadersTooLargeException during request processing.
4a79958cc8 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60167 Handle blank lines by ignoring them Simplify code
afe6e67298 Use finally and log exceptions
8570d8b9c9 Clean-up / formatting No functional change.
94e5dfa697 Add some annotation checks to checkstyle and fix the handful of issues reported.
f0a9a595f6 Even more duplicated words.
9f0dbea2e6 Correct typo.
62b132f26a Review of https://bz.apache.org/bugzilla/show_bug.cgi?id=60151 Improve the exception error messages when a ResourceLink fails to specify the type, specifies an unknown type or specifies the wrong type.
d031c6035d Remove extra spaces
4638a39209 Remove extra trailing spaces
477f439f66 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60123 Avoid potential threading issues that could cause excessively large vales to be returned for the processing time of a current request.
d36d9f24cd Update the release date for 7.0.72
4215e5374f Add Deprecated.
abedbfb131 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60099 Ensure that use all method arguments as a cache key when using StatementCache.
0bd181890e Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60117 Ensure that the name of LogLevel is localized when using OneLineFormatter. Patch provided by Tatsuya Bessho.
7a303a05aa Add Bugzilla Id.
6ce51fa8c5 Correct Javadocs for PoolConfiguration.getValidationInterval and setValidationInterval. Reported by Phillip Webb.
0e0e4eb284 Prep for next version
fe80f4070b Ensure Digester.useContextClassLoader is considered in case the class loader is used.
cd286831a3 Merge r1681703: Merge docs about new DH and EC ephemeral key handling in tcnative 1.1.34.
3bd6e94272 Ensure that the POOL_EMPTY notification has been added to the jmx notification types.
c33116107e Tomcat 7.0.71 did not pass the vote
bc6df47f1a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60101 Remove preloading of the class that was deleted
d5065d0811 Notify jmx when returning the connection that has been marked suspect.
e155a5df77 Prep for next version
7c4058219a Fix javadoc
5f6a7ae362 Refactor the code that implements the requirement that a call to complete() or dispatch() made from a non-container thread before the container initiated thread that called startAsync() completes must be delayed until the container initiated thread has completed. Rather than implementing this by blocking the non-container thread, extend the internal state machine to track this. This removes the possibility that blocking the non-container thread could trigger a deadlock.
fac0b84f3f Objenesis binary was moved to another download location.
91e9a3b91c Fix the creation of the file in the test. The test was failing when there is a space in the path.
1be734bcf5 Correct Javadoc for ConnectionPool.suspect(). Based on a patch by Yahya Cahyadi.
78398565fc Fixed StringIndexOutOfBoundsException when trying to get the first char of an empty string. String.substring methods always return an object. Based on a patch provided by wuwen via Github.
628e0b6c20 Additional fix for BZ60043. Add log message of when returning the connection that has been marked suspect.
970e615c7a Make timing attacks against the Realm implementations harder. (schultz)
ffa0346fba Ignore some JSP options when running under a SecurityManager
a46f8435ad Clean-up. Use longer lines.
24a97990f7 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60043 Ensure that the suspectTimeout works without removing connection when the removeAbandoned is disabled.
5cd6ea0864 Back-port r1757997 to align authenticate() code across realm implementations.
3fe24dd31f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60041 Better error message if a JAR is deleted while a web application is running. Note: Deleting a JAR while the application is running is not supported and errors are expected. Based on a patch by gehui.
491958d878 Fix a file descriptor leak when reading the global web.xml.
430d4d77d8 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60034 Fix typo
d873917640 Improve handling of exceptions during a Lifecycle events triggered by a state transition. The exception is now caught and the component is now placed into the FAILED state.
e4f4fce79e Fix typo
54879c156f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=60008 When processing CORs requests, treat any origin with a URI scheme of file as a valid origin.
1cc5a607cc Import order Missing header
5ce47795f6 Correct comment
b3406e6c31 When adding and removing ResourceLinks dynamically, ensure that the global resource is only visible via the ResourceLinkFactory when it is meant to be.
ddfdc5ed59 Update the internal fork of Commons FileUpload to afdedc9. This pulls in: - a fix to improve the performance with large multipart boundaries - Javadoc improvements - code clean-up - aligns 7.0.x with 8.5.x where possible
5320bc244e Update the internal fork of Commons Codec to r1757174. Code formatting changes only.
70457c760a Updating Tomcat's copy of BCEL as far as HEAD (including 6.0 and some post 6.0 fixes that are NO-OPs for our fork)
880250877b Add a new initialisation parameter, envHttpHeaders, to the CGI Servlet to mitigate httpoxy (CVE-2016-5388) by default and to provide a mechanism that can be used to mitigate any future, similar issues.
5b64ae6b0e Convert a 7.0.x specific log statement
8c2bd333bf Fix lack of System.lineSeparator() in Java 6 Align 7.0.x with 8.0.x
00a62b85d0 Switch the CGI servlet to the standard logging mechanism and remove support for the debug attribute.
300b8b4ea9 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59966 Fail Context if error page configuration in web.xml is broken.
fc58c88e98 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59904 Add a limit (default 200) for the number of cookies allowed per request. Based on a patch by gehui.
c957e58448 Correct import
aeec1c6111 Correct javadoc. Update Connectors configuration page.
89427550ac Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59908 Ensure that a reason phrase is included in the close message if a session is closed due to a timeout.
727eb571b0 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59912 Fix an edge case in input stream handling where an IOException could be thrown when reading a POST body.
73eaac0533 MBeans Descriptors How-To is moved to mbeans-descriptors-howto.html. Patch provided by Radoslav Husar. This solves Github PR#33
79dff301a3 Update changelog
a17b526304 Fixed typos in mbeans-descriptors.xml files.
874276e7eb Correct name
4f99397d28 Ensure that the ResultSet is returned as Proxy object when enabling the StatementDecoratorInterceptor.
d647806100 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59923 Reduce the default value of validationInterval in order to avoid the potential issue that continues to return an invalid connection after database restart.
adc499f31c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59868 Clarify which host name and IP address are shown in the server section.
bc751f50fd Two additional headers that should use the client's locale for i18n rather than the server's.
cab141aaab Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59866 Don't scan WEB-INF/classes/META-INF/resources unnecessarily.
bef9d0c8db Move ExceptionUtils so it is visible to the runtime classes when running under a security manager.
890a2f681e Remove unnecessary code
1491e480cb Clean-up Clarify / correct Javadoc Remove a possible FIXME. Since the webapp name is used in isWriteable(), it is better that this is in a final variable rather than in the environment where it could be modified.
94814cd033 Fix typo
9b46504eb5 When retrieving an object via a ResourceLink, ensure that the object obtained is of the expected type. This addresses a long standing FIXME
1c9441187e Revert r1750434. This feature has not been backported yet.
d594a67187 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59866 Partial fix for issue 2. This only applies to 7.0.x. Don't waste cycles trying to load classes from alternate locations since they can only contain static resources.
0b41766456 Provide a mechanism that enables the container to check if a component (typically a web application) has been granted a given permission when running under a SecurityManager without the current execution stack having to have passed through the component. Use this new mechanism to extend SecurityManager protection to the system property replacement feature of the digester.
3fcd0ca643 Fix Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59839 Apply roleSearchAsUser to all nested searches in JNDIRealm.
f3d8801ef5 Remove test I opted to host elsewhere
be895e53ff Decode the path provided to the request dispatcher by default. The reasoning is: - the servlet spec is clear (see 9.1.1) that path can include a query string; - the query string is delimited by '?'; - '?' is a valid character in the path (if it is encoded); - users may want to use '?'in the path; - therefore users need to be able to provide an encoded path; - therefore the RequestDispatcher needs to decode the path.
fb93a09f35 Add an encoding parameter to URLEncoder.encode() and be explicit about the encoding wherever Tomcat uses this method.
d9761d9be4 Improve the error handling for custom tags to ensure that the tag is returned to the pool or released and destroyed once used.
9955aa3bcf Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59849 Ensure that the connection verification is executed by initSQL (if required) if the borrowing PooledConnection has not been initialized.
5bb46195c4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59850 Ensure that the ResultSet is closed when enabling the StatementCache interceptor.
ef1f5198df In order to avoid the unintended skip of PoolCleaner, remove the check code of the execution interval in the task that has been scheduled.
7b395f63ea Fix problem with JMX triggered parallel application init reported on users list
9f7c171c4c Update the packaged version of the Tomcat Native Library to 1.2.8 to pick up the latest fixes and make 1.2.8 the minimum recommended version.
752a0ac789 Use the mirror network rather than the ASF master site to download the current ASF dependencies.
d106a3e113 Review of all calls to user code prior to calling InstanceManager.destroy()
d1e2f56ae7 Catch and log any Exceptions during calls to Servlet.destroy() when destroying the Servlet associated with a JSP page.
59fde45c5c Ensure that do not remove the abandoned connection that has been already released.
ff87f290f8 Fix the description of maxAge attribute in jdbc-pool doc. This attribute works both when a connection is returned and when a connection is borrowed.
370bec4a67 Remove duplicate code. There is no need to release the connection here because the connection is released in subsequent process.
9c28c0c304 No-functional change. Remove comment. Null can be returned.
b9061419a2 Follow-up to BZ 59399. Document NullRealm and transportGuaranteeRedirectStatus for all Realms.
009b8be074 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59642 Mention the localDataSource in the DataSourceRealm section of the Realm How-To.
99a447d385 Fix typos
79efe32bea Reduce the noise in the logs by filtering out common, expected errors.
0c7d2963b6 Fix typo
3d5cd3a590 If the ping message has been received at the AbstractReplicatedMap#leftOver method, ensure that notify the member is alive than ignore it.
cb67e08ea1 Add log message when the ping has timed-out.
c5dcd79707 Revert unintended change included in r1749377
e025d1aed9 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59708 Modify the lock out logic. Valid authentication attempts during the lock out period will no longer reset the lock out timer to zero.
2db9b6c3b9 Change the default for Context.sessionCookiePathUsesTrailingSlash from true to false.
8b9cc8e19a Update the release date for 7.0.70
8e0ca2cd70 No-functional change. Fix code format.
dec5a1c172 Remove unused debug code.
7ef3b49306 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57705 Add debug logging for requests denied by the remote host and remote address valves and filters. Based on a patch by Graham Leggett.
7a91f4e626 Prep for next version
1e42eb285d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59399 Add a new option to the Realm implementations that ship with Tomcat that allows the HTTP status code used for HTTP -> HTTPS redirects to be controlled per Realm.
21d214bcf2 Follow-up to r1746735 r1746735 triggered the call to Processor.endRequest() in the correct location but failed to remove the call that was in the wrong location. This meant it could be called twice leading to request corruption.
a8a6edea72 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59654 Enforce the requirements of section 7.3.1 of the JSP specification regarding the permitted locations for TLD files. Patch provided by Huxing Zhang.
883c1f5bd4 Fix error message when failed to register MBean.
a3e8af25de Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58626 Add support for a new environment variable (USE_NOHUP) that causes nohup to be used when starting Tomcat. It is disabled by default except on HP-UX where it is enabled by default since it is required when starting Tomcat at boot on HP-UX.
4c222c47b7 Merged revision 1746750 from tomcat/tc8.0.x/trunk: Tab police.
8e8cfc40d1 If an async dispatch results in the completion of request processing, ensure that any remaining request body is swallowed before starting the processing of the next request else the remaining body may be read as the start of the next request leading to a 400 response.
01b5adc43b Within the web application class loader, always use path as the key for the resource cache to improve the hit ration. This also fixes a problem exposed by the fix for bug 56777 that enabled file based configuration resources to be loaded from the class path.
64d6a32bf2 Make resourceEntries a ConcurrentHashMap else there is a risk of a threading issues when different threads read and write at the same time.
e92b193c30 Merged revision 1745337 from tomcat/trunk: Checkstyle.
8218ca8cea Remove unused property
3ef43c21a3 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58891 Update the SSL how-to. Based on a suggestion by Alexander Kjäll.
8e01752512 Deprecate clearReferencesStatic
1c0163eac6 Fix a memory leak with the pool cleaner thread that retained a reference to the web application class loader for the first web application to use a connection pool.
b7e319e997 Correct location in changelog
49c16faa03 Fix an EL memory leak. Note: This fix requires changing generated code. A bug has been raised with JavaCC: https://java.net/jira/browse/JAVACC-293
47f4bc4034 Make checking for RMI Target memory leaks optional and log a warning if running on Java 9 without the necessary command line options
2272823be8 Increase maximum memory for Javadoc process after an OOME during the 8.0.35 release process.
13b17d891e Ensure Javadoc failures cause build failures.
6d96e3149d Back-port Java 9 support to compatibility util class
d773fb62bb RMI Target related memory leaks are avoidable which makes them an application bug that needs to be fixed rather than a JRE bug to work around. Therefore, start logging RMI Target related memory leaks on web application stop.
f8ef387fdc Fix typo
235baf7ded No functional change. Update comments with latest understanding of the problem.
bc2403b2c9 Update merge info (no relevant changes in Commons Codec since last merge)
8999f82431 Update internal fork of Commons File Upload
7fdd76b8ce Update merge info (no relevant changes in Commons BCEL since last merge)
acacad26bf When an asynchronous request is processed by the AJP connector, ensure that request processing has fully completed before starting the next request.
9705348e46 Stricter validation of HTTP method names
21642cd7d0 Add information on which Java versions require this option
0e5b4ac801 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59449 Ensure that the process to remove a child container is the reverse of the process to add one. Patch provided by Huxing Zhang.
54d2f8b125 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1743121 13f79535-47bb-0310-9956-ffa450edef68
995b43eab5 Merged revision 1742975 from tomcat/trunk: Fix typo
ca6c1edab5 Merged revision 1742919 from tomcat/trunk: Ensure that the value for the header X-Frame-Options is constructed correctly according to the spec when ALLOW-FROM option is used: X-Frame-Options = "DENY"                    / "SAMEORIGIN"                    / ( "ALLOW-FROM" RWS SERIALIZED-ORIGIN )
2aef6872a5 Fix a checkstyle nag
965ad6ace0 Update build to use Tomcat-Native 1.2.7
901d1c4b64 In ping processing in the replication map, send not the INIT message but the newly introduced PING message.
4e234e7fee Implement map state in the replication map. Ensure that the ping is not executed during the start/stop of the replication map.
0f4b17aac1 Update docs since most users won't need to enable this option.
2243fbe94f Back-port test configuration option to relax timing constraints (required for Gump tests)
0df32a2dbf Fix copy/paste error and throw correct exception
2453931996 Merged revision 1742090 from tomcat/trunk: Correct a typo in SSL/TLS Configuration How-To. Issue reported via comments.apache.org.
fa5b7a8126 Fix another root cause of this test failing (primarily on Gump). If the server is really slow (and Gump is) the session might not have been opened by the time the test checked to see if it had been closed. This led to a failure since the server code was still processing when the test ended.
495d195dc4 Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation.
e26eaab862 Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation.
410ca96f11 Make final
d27b22a2b3 Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation.
0a23f65e68 Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation.
8ac33c2361 Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation.
a18625f5dc Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation. Also: - Use final
10539818e7 Review of Map / ConcurrentMap / ConcurrentHashMap attributes is non-final so it can be replaced. Define the field as ConcurrentMap to ensure that thread-safety is maintained if this happens.
09d094bc61 Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation. Also: - Use final
6323284db2 Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation. Also: - Reduce visibility of field
33e777eb4b Review of Map / ConcurrentMap / ConcurrentHashMap Declare field using interface rather than implementation. Expected to be safe since previous, more significant refactorings, have not caused issues.
77c87b1d07 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59317 After a dispatch (async and non-async) ensure that getRequestURI() returns an encoded URI.
a724a8c421 Align test implementation more closely with 8.0.x to try and reduce instances of Gump CI failures.
4a421c31f0 Extend wait period to try and reduce instances of Gump CI failures.
dfb4498b81 Add a wait for the session to close on the server. Some failures were observed on Gump when this hadn't happened by the time the test ended. Add a check that no errors occurred on the server.
7cbd9a2ece Correct typo in text class name
8216a9e6db Third pass at fixing https://bz.apache.org/bugzilla/show_bug.cgi?id=59219 Includes a test case based on a patch by Abdessamed MANSOURI.
bbbc6fd065 Ensure clean-up runs
7295b552cb Expand checks for proper WebSocket shutdown
707919f45a Fix regression between first and second parts of fix for BZ 59219
f9cbe1d0f4 59365: Avoid basing the test on the only portion of the output that is internationalized. (part 2)
4e89e3ccb9 59365: Avoid basing the test on the only portion of the output that is internationalized.
144c580e55 Remove TODO
3442a55967 Revert r1740047.
fd87367d89 Ensure that clear the channel instance from channel services when stopping channel.
0d4d1e88c3 Change timing of add the channel instance to the interceptors. Add the channel instance to the interceptors when starting the channel.
90ca468fc6 When normalizing paths, improve the handling when paths end with'/.' or '/..' and ensure that input and output are consistent with respect to whether or not they end with '/'.
a5e9d04a42 Change the channel field to protected.
05257328ff Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59220 Ensure that AsyncListener.onComplete() is called if the async request times out and the response is already committed.
997211a3a2 Add the channel name to the thread which is invoked by channel services in order to identify the associated channel.
6b7644293f Add name to channel in order to identify channels. In tomcat cluster environment, it is set the cluster name + "-Channel" as default value.
8bf6f162e3 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59219 Ensure AsyncListener.onError() is called if an Exception is thrown during async processing.
93e6dd7327 Fix back-port
1c091b1435 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59310 Do not add a "Content-Length: 0" header for custom responses to HEAD requests that do not set a Content-Length value.
cc7d6d7012 Set the channel instance before starting channel services.
96153de5e6 Add get/set method for the channel that is related to each Channel services.
d83c9f408e Trivial fix of cluster-interceptor document.
452f8598e2 Fix possible cause of CI failure
5567b2023a Fix one cause of failing tests observed locally and on CI systems.
84dfb87e44 Merged revisions 1713397,1713446,1715168 from tomcat/trunk: Drop Windows Itanium support for native components
e3dc71492c Update to Tomcat Native Library 1.2.5
76b5d85a42 No-functional change. Remove unneeded package.
df774ae66c Update the release date for 7.0.69
505bfd1a20 Make WebSocket client more robust when handling errors during the close of a WebSocket session.
1fd2c7ab02 Fix likely cause of occasional CI failure
5caa0fe0a6 Client disconnect is an error. Report it as such. It should be up to applications to choose to ignore it or not.
3c080ac0af Fix test that fails with additional BackgroundProcessManager checks
d421b1088e Add the expanded check that the BackgroundProcessManager has correctly shut down at the end of the test to more WebSocket tests.
2889798438 Fix indent
acdaa1b18b Make test more robust. Allow more time for completion and test latch result. Prompted by FindBugs.
110c64f958 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59261 ServletRequest.getAsyncContext() now throws an IllegalStateException as required by the Servlet specification if the request is not in asynchronous mode when called.
2782775458 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58970 Fix a connection counting bug in the NIO connector that meant some dropped connections were not removed from the current connection count.
ee8432b473 Multi-catch not available
a7b378b0f2 Sync failing (with APR on Gump) test with trunk to add possible work-around
d95a11e15c Fix LocalMember attributes and sample config in interceptor documnent.
32a1faaf76 As with the multicast cluster environment, in the static cluster environment, the local member inherits properties from the cluster receiver.
782ddc545d Add get/set method for the channel that is related to ChannelInterceptorBase.
8779d9ac6c Fix potential NPE that depends on the setting order of attributes of static member when using the static cluster.
bc493b867e Fix Gump failure. Patch by Huxing Zhang.
a526211da0 59289: Avoid placing an updgraded processor in the recycle list
a72d868fa9 Prep for next version
96d25782b7 Revert r1738248
af0f7a87ec Update Tomcat Native library version to 1.1.34. Tomcat Native library binaries 1.1.33 are no more available on the download area.
b870f4dbf9 Fix typos in changelog.xml, sort by bug number.
a02b7b612f 59247: Preload ResourceEntry.
07ad5e89df Investigating BZ 59261 An error page has to be able to call complete(). That means it needs to be able to call getAsycnContext() which means isStarted needs to be true for the ERROR state. That implies that isStarted needs to be true for the TIMING_OUT state as well. This also implies that a transition form DISPATCHED to ERROR is not legal since that would mean moving from a state where isStarted==false to isStarted==true
ce1a0abee0 Improve test for whether or not current request is async
c4c198a84e Avoid NPE
b065b63bfb Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59269 Correct the implementation of PersistentManagerBase so that minIdleSwap functions as designed and sessions are swapped out to keep the active session count below maxActiveSessions
5b261fc7b4 Refactor ready for testing the session managers
cb3f722ad2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59280 Update to NSIS 2.51
f2ba4f572b Merged revision 1737959 from tomcat/trunk: Clarify in the documentation that calls to ServletContext.log(String, Throwable) or GenericServlet.log(String, Throwable) are logged at the SEVERE level. Issue reported via comments.apache.org.
e228b867ee Add the flag indicating that member is a localMember.
eae9e5e15a Merged revision 1737715 from tomcat/trunk: Update in the documentation the link to the maven repository where Tomcat snapshot artifacts are deployed.
b7a9863d5c Merged revision 1737664 from tomcat/trunk: Ensure the exceptions caused by Valves/Authenticators will be available in the log files so that they can be evaluated when o.a.catalina.valves.ErrorReportValve.showReport=false. Patch is provided by Svetlin Zarev via mailing list http://marc.info/?l=tomcat-user&m=145951730303576&w=2
c49b5f9c34 Merged revision 1737632 from tomcat/trunk: Clarify in the log message that specifying both urlPatterns and value attributes in WebServlet and WebFilter annotations is not allowed.
8f9ecc1701 Better default ciphers for APR/OpenSSL
695593a547 TLS improvements - enable stronger ephemeral DH keys by default - filter out known weak ciphers from default list
60bbb0d4a7 59247: Add loader package access permission to JULI. Based on a patch submitted by Coty Sutherland.
164d41c19a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59229 Fix regression in r1704287 Align/improve row titles
343cdbf94c Clarify which Java based connector will be used.
b969bb380a Fix import order
caf6a03323 Document doUpgrade() so it is not accidentally removed
39678324d0 Merged revision 1736646 from tomcat/trunk: Ensure that ServletRequest and ServletResponse provided during AsyncListener registration are made available via AsyncEvent.getSuppliedRequest and AsyncEvent.getSuppliedResponse
538fb0d000 59213: Async dispatches should use a wrapped request rather than the base one.
e73b0dac1c Merged revision 1736286 from tomcat/tc8.0.x/trunk: Fix typo
d1662d1c3c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59217 Merged revision 1736280 from tomcat/trunk: Remove duplication in the recycling of the path. Patch is provided by Kyohei Nakamura.
c2883460c8 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59206 Merged revision 1736209 from tomcat/trunk: Ensure NPE will not be thrown by when catalina.base is not specified.
dd7f6ba39a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59211 Merged revision 1736162 from tomcat/trunk: Add hamcrest to Eclipse classpath. Patch is provided by Huxing Zhang.
27d9edde80 No-functional change. Remove TODO.
e1a0313eeb Add log of when received an unexpected messages.
969008d3b9 Avoid NPE when a proxy node failed to retrieve a backup entry.
f6d638f459 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59189 Explicitly release the native memory held by the Inflater and Deflater when using PerMessageDeflate and the WebSocket session ends. Based on a patch by Henrik Olsson.
15483234a8 Fixed NPE introduced with r1734262 and reported by GUMP. In Tomcat 7 o.a.catalina.connector.Request.getContext() returns the "context" field, it is not obtained from MappingData.
fb1cb756db Fix potential indefinite wait. Reported by Coverity Scan
01594b4bec Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59145 Don't log an invalid warning when a user logs out of a session associated with SSO.
1e2a033d4e If promoting a proxy node to a primary node when getting a session, notify the change of the new primary node to the original backup node.
dc25143f99 Add Deprecated to maxInactiveInterval attribute of ClusterManager document.
a0ec6348bc Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59151 Fix a regression in the fix for  BZ 56917 that added additional (and arguably unnecessary) validation to the provided redirect location.
1cad3ad729 Merged revision 1734192 from tomcat/trunk: Correct the description of the ServletRequest.getServerPort() in Proxy How-To. Issue reported via comments.apache.org.
a25b4d1892 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59138 Correct a false positive warning for ThreadLocal related memory leaks when the key class but not the value class has been loaded by the web application class loader.
8ce4b97e32 Make it harder for users to configure the entries intended for use with the examples web application for the Manager application.
f6160da049 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59134 Correct client connect logic for secure connections made through a proxy.
be38cd05ea Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59123 Close NamingEnumeration objects used by the JNDIRealm once they are no longer required.
9811dfd61a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59119 Correct read logic
f1c95d4bad Remove parentheses, since return is not a function.
f01dff1128 Update filename processing after review of RFC 6266
314ef4e90a Correct regex. The actual regex is "\\" and since '\' needs to be escaped the code needs to use "\\\\"
46689a73a1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59915 When using the Servlet 3.0 file upload, the submitted file name may be provided as a token or a quoted-string. If a quoted-string, unquote the string before returning it to the user.
d1d01c2f9b When a Host is configured with an appBase that does not exist, create the appBase before trying to expand an external WAR file into it.
ad15450e93 Correct back-port of fix for BZ 59001 in r1733184. Restore paths to files in JARs when constructing URLs.
91a9f24f73 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59001 Correctly handle the case when Tomcat is installed on a path where one of the segments ends in an exclamation mark, a caret or an asterisk.
bee0d3dd0b Extend the WebSocket programmatic echo endpoint provided in the examples to handle binary messages and also partial messages. This aligns the code with Tomcat 8 and makes it easier to run the Autobahn testsuite against the WebSocket implementation.
f694fdbd2c Correctly handle compression of partial messages when the final message fragment has a zero length payload. Problem identified by Autobahn test suite.
0824dcc443 Correct a regression introduced in 7.0.68 where the deprecated Manager.getMaxInactiveInterval() method returned the current default session timeout in minutes rather than seconds.
ddc09a8cc1 Log a warning message if a user tries to configure the default session timeout via the deprecated (and ignored) Manager.setMaxInactiveInterval() method.
95e3d929bf Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59043 Avoid warning while expiring sessions associated with a single sign on if HttpServletRequest.logout() is used.
3169aa77dd Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59031 NSIS follows symbolic links so the recursive deletes which are part of the uninstall were removing the contents of any symlinked directories located under the Tomcat installation directory. This commit modifies the uninstaller so it first removes all symlinks from the Tomcat installation directory and any sub-directories before it does the recursive deletes.
37a3dbae45 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58351 Make the server build date and server version number accessible via JMX. Patch provided by  Huxing Zhang.
ab73f00fe0 Better language
fb2f9ffc1b Follow-up to r1731956
0588daecb2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58283 Change the default download location for libraries during the build process from /usr/share/java to ${user.home}/temp Patch provided by Ahmed Hosni.
5478a626e6 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59015 Fix potential cause of endless APR Poller loop during shutdown if the Poller experiences an error during the shutdown process.
25e06cf82d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59054 Ensure that using the CrawlerSessionManagerValve in a distributed environment does not trigger an error when the Valve registers itself in the session.
262569a921 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=59014 Fix problem that meant close messages could not be sent because the session was already marked as closed.
8c5d061f52 Back-port the send file unit test
d6a8d190c7 Follow-up to r1731119 There are three possible return values rather than two for processSendFile()
bc93703f04 Correct a problem with sendfile that resulted in a Processor being added to the cache twice leading to broken responses.
113cab4b6f Clarify javadoc.
95f2118f2a Fix the type of InstanceManager attribute of mbean definition of StandardContext.
df21e9aadf Update the release date for 7.0.68
2ca43be257 Additional excludes suggested by infra
c8d377628d Add missing exclude spotted by BuildBot
255967268d Fix typo in changelog.
04aba40cee Prep for next version
63dba15b2d Log the unexpected class rather than the expected one. It makes debugging that little bit easier when you don't need a crystal ball.
10b28cc493 Check was wrong way around. Fix it.
cbf0e56cc4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58935 Remove incorrect references in the documentation to using "jar:file:" URLs with the Manager application.
7143ef7f1a Correct an error in the documentation of the expected behaviour for automatic deployment. If a WAR is updated and an expanded directory is present, the directory will always be deleted and recreated by expanding the WAR if unpackWARs is true.
85001650b1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58905 Ensure that <code>Tomcat.silence()</code> silences the correct logger and respects the current setting.
883770fb84 Fix missing closing tag
7e0dfe5301 Fix a timing issue which is one cause of intermittent unit test failures for WebSocket.
25b5e38e78 Back-port test fixes from 8.0.x
7aab153ab7 Clean-up. Reduce IDE warnings
012e5e8ca6 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58946 Ensure that the request parameter map remains immutable when processing via a RequestDispatcher.
194c343d9e Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58768 Log a warning if a redirect fails because of an invalid location.
551808e379 Avoid NPE when clustering
054bb11655 Fix indent
a8287e81bc Fix typo
e089c8f58a Follow-up to r1726922. Add missed check that the Manager is NEW when the context is set.
82c3977cd7 Followup to r1726631. Correct default value typo and amend a bit.
ff1b659dc3 When using the new sessionAttributeValueClassNameFilter, apply the filter earlier rather than loading the class and then deciding to filter it out. When a SecurityManager is used, enable filtering by default.
8b035e74f4 Ensure that when sessions are loaded from the Store that the correct class loader is used. In most cases it was already set but some code paths from early in the processing chain (e.g. the Adaptor) could trigger the loading of a session without setting the TCCL.
46569c25b2 Add configuration attribute "ajpFlush" for the AJP connectors to disable the sending of AJP flush packets.
3cad823a5f Remove unused import.
3bdbc920c8 Remove unused import.
a648d2044f Deprecate Manager.distributable and Manager.maxInactiveInterval since they exist in both the Context and the Manager and the Context values always take precedence.
79e8ad0340 Expand the session attribute filtering options - new option to filter based on implementation class of value - new option to log a warning message if an attribute is filtered out - always log a message at at least debug level if an attribute is filtered out
07cb67a1a6 Clarify behaviour of Manager.context
aeec633b6c Deprecate lifecycle states that were never used and could never be used. Add new Lifecycle.SingleUse marker interface as a replacement for MUST_DESTROY Document how to use FAILED as a work-around for MUST_STOP Code clean-up
f43df41527 Make clear that the PersistenceManager is the better option if you actually *need* to persist session data across restarts.
c538e8daa8 Pull up the sessionAttributeFilter option from the cluster managers, rename it to sessionAttributeNameFilter and make it available in all Manager implementations.
7321e43728 Review Javadoc for Manager hierarchy. Remove unnecessary duplication.
631a7d8e05 Refactoring Make the session attribute distribution / filtering more consistent across the various Manager and Session implementation. Differentiate between - whether or not it is possible for an attribute to be distributed - Session.isAttributeDistributable() - whether or not the Manager wants and attribute to be distributed - Manager.willAttributeDistribute
bffc624231 Backport StringManager clean-up and improvements, particularly the ability to obtain a StringManager using a class object.
f028d5b7d8 Store.load() implementations assume (in places) that getManager().getContext() always returns a non-null and we haven't had reports of NPEs so make the assumption consistently throughout the method. Add a local reference to the Context's logger to shorten some of the logging lines
3b5858d989 Clean-up
27ed438f78 Refactor to always use the CustomObjectInputStream
bf4bb4bf2d No functional change Port clean-up (to make merging simpler) prior to back-porting functional changes
868eb471e0 Allow to configure multiple JUnit test class patterns with the build property "test.name" and document the property in BUILDING.txt.
835e82ab47 Remove odd subversion properties from directories.
c08641da04 Protect initialization of ResourceLinkFactory when running with a SecurityManager.
e4619a896b Fix typo
8cd0172c97 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58900 Delete WARs symlinked into the appBase and context.xml files symlinked into the configBase during undeploy
0edeb6926c Back-port r1725851 to fix a potential resource leak.
99aa8b1b7f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=56785 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58766#c4 1) Slightly improve performance of scanning a directory: check the file name first, as file.canRead() is an I/O operation.
a40d60adb4 Reorder according to BZ issue number.
a060ca0b4e Followup to r1725155. Move digester.reset() call even earlier, before closing the streams. Streams are local, digester is a shared instance.
4de0c0b067 Small code improvements in HostConfig class:
8f8bd2bc9a Simplify code by importing a more popular class. No functional change. javax.naming.Context vs. org.apache.catalina.Context The first is used only twice, the second is used a dozen of times.
a045c9f4a4 Simplify diagnostics by showing response text in Assert message. These tests depend on examples app being built and may fail when run from Eclipse IDE.
4f4aee8734 For https://bz.apache.org/bugzilla/show_bug.cgi?id=57154 Review of r1681953 In EmptyDirContext.java: - Remove @author tag from new code. The author is credited in the changelog. - Use ImmutableNameNotFoundException as the cached exception instance. Caching a plain NameNotFoundException is wrong, as it has a stacktrace. Such pattern is a known source of PermGen memory leak, as staktrace keeps classes and their classloaders in memory (see https://bz.apache.org/bugzilla/show_bug.cgi?id=50460 )
45b8e3296f Update comment, removing an old XXX
1771521baa For https://bz.apache.org/bugzilla/show_bug.cgi?id=58836 Optimize mergeValues(). The method arguments are known to be String[], so do that branch first. No functional change.
622be84899 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58836 Followup. One needs to call queryMB.setCharset() to set encoding for the query string during parameter merging.
cfd756152a Follow up to r1724435 Need to copy the character set when duplicating the MessageBytes.
4c01820bc5 Fix typo
b2db4b5234 Review of r1724435 by kkolinko. Back-port required setCharset() changes.
583d037172 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58836 Correctly merge query string parameters when processing a forwarded request where the target includes a query string that contains a parameter with no value.
1146b76d2c No functional change. Remove package. It already has been imported.
fd64c487e6 No functional change. Use the backup members value from a local variable.
a3286508d1 Ensure that asynchronous session replication thread is a daemon thread.
7508faa110 Fix typo in "ide-eclipse", "ide-eclipse-websocket" targets of build.xml (Eclipse workplace -> Eclipse workspace)
9ccb3390fc Fix definition of localPort attribute of CoyoteConnector mbean. It is read-only, Connector class has no setter for this property. For https://issues.apache.org/bugzilla/show_bug.cgi?id=52028  (Review of r1207695)
3823d02f27 Merged revision 1723484 from tomcat/trunk: Corrected the log message
d312d2601c Simplify: Do not call a getter twice, use the value from a local variable. No functional change. (Review of r1207695) For https://issues.apache.org/bugzilla/show_bug.cgi?id=52028
1b7d506ecb Merged revision 1723155 from tomcat/trunk: Update findbugs false positive - reliance on default encoding
82161a1087 Fix a failing tribes test by aligning test expectations with the actual observed behaviour. Notes: 1. This test is excluded when running tests via build.xml. 2. Duration of the test: 54 seconds. It can be reduced by reducing msgCount variable. 3. This test creates random messages, half of those are failing at receiver side by an explicit "throw new IllegalStateException()".
3600d2df7a Merged revision 1723068 from tomcat/trunk: Ensure that the proper file encoding if specified will be used when a readme file is served by DefaultServlet. Update findbugs false positives.
ce0ea91bf7 Mark ReadWriteLock in modeler classes as final. (In review of r1722660/r1722661/r1722663 of Tomcat 7).
8b0b8dbff5 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58751 Correctly handle the case where an AsyncListener dispatches to a Servlet on an asynchronous timeout and the Servlet uses <code>sendError()</code> to trigger an error page. Test case based on code provided by Andy Wilkinson.
a8580230d8 Simplify code and fix messages in org.apache.catalina.core.DefaultInstanceManager class.
3a212642bf Add the StatusManagerServlet to the list of Servlets that can only be loaded by privileged applications.
abc85597af Fix a FindBugs issue (incorrect synchronization)
26c3488153 Merged revision 1410732 from tomcat/trunk: Fix a FindBugs issue (incorrect synchronization)
01bd0e64a3 Merged revision 1410740 from tomcat/trunk: Fix a FindBugs issue (incorrect synchronization)
49190798cf Variable cannot be null
b99d4c191d Use monitor object for synchronization
ca9d97bf21 The class should implement Serializable
a65490597d Merged revision 1493615 from tomcat/trunk: Fix FindBugs warning - better debug message
01b8323562 Variable cannot be null
f57367af01 Simplify the code
59ac6962b5 Merged revision 1722585 from tomcat/trunk: the check for null has been done already
f071d8e0c9 Merged revision 1722583 from tomcat/trunk: the array that is returned cannot be null but with length 0
bd27bb9999 Merged revision 1722574 from tomcat/trunk: The variable cannot be null but empty string
8e33a45451 Merged revision 1722548 from tomcat/trunk: Variable cannot be null
4002669a46 list with sessions cannot be null
51d5fcf3d3 Happy New Year 2016
cf2ee78b48 Refactor the processing / simplify the code - Only check that the response is an HTTP response once and cast once - Check if the response is committed after we know it is an HTTP response
2a63fd55f4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58735 Add support for the X-XSS-Protection header to the HttpHeaderSecurityFilter. Patch provided by Jacopo Cappellato.
3ed642a67a Merged revision 1722399 from tomcat/trunk: Findbugs - false positives - known null value
a54663c448 Backport Findbugs false positives
d5be7392cd Merged revision 1719278 from tomcat/trunk: Fix some FindBugs false positives
9c683ef666 Merged revision 1722292 from tomcat/trunk: Findbugs - filter false positives
d1426f4aa7 Merged revision 1722205 from tomcat/trunk: Close streams
19f1d433c9 Fix test broken by default change in r1721883
26bad61bae Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58765 Change default for mapperContextRootRedirectEnabled to true since this is required for correct session management because of the default for sessionCookiePathUsesTrailingSlash.
6010e396f5 Minor improvements in review of r1720769/r1720776/r1720783/r1720788 append(String) -> append(char) No functional change.
2417a6b462 Correct a pair of typos in documentation (reviewing r1720815/r1720816/r1720817)
68c1769065 Review of r1721303/r1721305/r1721306: Simplify.
f063525c5f Add changelog entry for r1721528/r1721530/r1721532 I think it is a fix for an issue that can be visible by users, thus I am adding a changelog entry.
ef672fde34 Update to NSIS 2.50
9b2fc1491a Merged revision 1721539 from tomcat/trunk: Findbugs - filter false positives
740c3b0665 Merged revision 1721528 from tomcat/trunk: java.util.ResourceBundle.getString does not return null when there is no object for a given key. The method will throw MissingResourceException.
4c1da49d00 Merged revision 1721447 from tomcat/trunk: Variable cannot be null
07dd5b6208 Merged revisions 1721311, 1721314 from tomcat/trunk: Close streams
25d5c1a850 Merged revision 1721307 from tomcat/trunk: Update changelog
351d478a6c Merged revision 1721303 from tomcat/trunk: MBeanUtils.createMBean cannot return NULL. The method will throw exception if the mbean cannot be created or registered.
66ac8d459e Add support for the shutdown notification of local members in the static cluster.
d2d17cd65d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58723 Clarify documentation and error messages for the text interface of the manager to make clear that version must be used with path when referencing contexts deployed using parallel deployment.
122344c2ea Merged revision 1720804 from tomcat/trunk: Fixed findbugs issues - Comparison of String parameter using == or !=. Update false positives filter.
51a6540701 Comet processing in 7.0.x is a little messier than in 8.0.x. Refactor the BZ 58702 patch to take account of that.
d5f20cc4f2 Merged revisions 1720769, 1720776 from tomcat/trunk: Fixed findbugs issues: - Concatenates strings using + in a loop - Useless condition
8062d9c7c1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58702 Ensure an access log entry is generated if the client aborts the connection.
afa1a54323 Don't create sessions unnecessarily in the Host Manager application.
e5138c8692 Avoid a few more sessions and the whitespace these directives generate.
422cb0843d Don't create sessions unnecessarily in the Manager application.
71870aca99 Close streams. This is not needed for later versions as there these issues are fixed.
46d90e7784 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57906 Suppress log messages when running with a security manager on Java 6, caused by java.beans.Introspector.findExplicitBeanInfo() calls during evaluation of EL expressions.
a9911b2bb7 Merged revision 1720506 from tomcat/trunk: Fixed findbugs issues: - Do not invoke toString() method on a String - Do not invoke inefficient Boolean constructor; use Boolean.valueOf(...) instead - Close Stream in try with resources
c34bf25d88 Add CVE-2014-7810 to changelog of released 7.0.58.
474d87c2ad Update to NSIS 2.49
55b16eeea8 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58692 Make StandardJarScanner more robust. Log a warning if a class path entry cannot be scanned rather than triggering the failure of the web application.
ed767857c6 Add path parameter handling to HttpServletRequest.getContextPath(). This is a follow-up to the fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57215
07bbb5be22 Fix typos in the JNDI example Found while investigating BZ 58691
1ccdb8237a Remove unnecessary code. Headers names do not have leading or trailing whitespace.
c03c25801b Ignore the unnecessary member remove operation from different domain.
1f5fb26aad In order to avoid that the heartbeat thread and the background thread to run Channel.heartbeat simultaneously, if heartbeatBackgroundEnabled of SimpleTcpCluster set to true, ensure that the heartbeat thread does not start.
4b317c8296 Update NSIS to 2.47
efadd16a7d No-functional change. Use import.
355fa2e446 Add support for the startup notification of local members in the static cluster.
8a47607367 Fix one of the failing WebSocket close tests
e82b568122 Fix compilation failure in tests when Java 6 + Java 7 is used when configured as JAVA_HOME=Java6 in system properties, java.7.home=Java7 in build.properties file
7113cdc9f5 Simplify and fix compilation issue. Binary number (0bNN) is not supported in Java 6. Replace it with hexadecimal one.
2402016b32 Can't use Java 7 syntax in Tomcat 7
6ea9ce0f46 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57489 Ensure onClose() is called when a WebSocket connection is closed even if the sending of the close message fails. Includes test cases by Barry Coughlan.
84c5087b8f Update the release date for 7.0.67
713a0d58ae Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58701 Reset the instanceInitialized field in StandardWrapper when unloading a Servlet so that a new instance may be correctly initialized.
e73bde461a Reduce risk of race condition with unload once BZ 58701 is fixed.
84d38fee16 Clean-up. No functional change.
fc90c89266 newInstance needs to be set unconditionally if a newInstance is created else the logic later in the method won't work as intended.
25c8b9e9f9 Follow-up to r1713623. - clean up comment - remove line that always restored requested session ID
ed75324d81 Merged revision 1718523 from tomcat/trunk: Classes are final but declare protected fields. Reported by Findbugs.
9c654cd963 Prep for next version
8624f3a1e7 Merged revision 1718308 from tomcat/trunk: Fixed some finbugs issues. Mark others as false positive.
bcbda2cd16 Fix potential NPE in AbstractReplicatedMap.breakdown().
61d6e136f4 Add a description of the default value of heartbeatSleeptime attribute and optionCheck attribute in the cluster channel docs.
754b8d4a73 Merged revision 1718022 from tomcat/trunk: Stream may not be closed in all branches. Findbugs report.
706d6180b7 Attempt to fix a Gump issue
c4ff01af83 Review comments from kkolinko for useRelativeRedirects implementation
661a5942d7 Additional fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=56917 Make relative redirects configurable
538983c1a1 Merged revision 1717385 from tomcat/trunk: Fixed findbugs issues
0b9499044c Fix import for moved Tester class
cba86353eb Java 6, not Java 7.
7ff218204e Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58655 Fix an IllegalStateException when calling HttpServletResponse.sendRedirect() with the RemoteIpFilter. This was caused by trying to correctly generate the absolute URI for the redirect. With the fix for 56917, redirects may now be relative making the sendRedirect() implementation for the RemoteIpFilter much simpler. This also addresses issues where the redirect may not have behaved as expected when redirecting from http to https to from https to http.
16259fd0db Update changelog
381d8e5311 Fix test broken by test refactoring in r1717278
717ccd89ff Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=56917 Allow relative URIs to be used with sendRedirect()
4838294f0b Back-port some refactoring that simplifies the code and is required for some unit tests planned for back-porting.
dcf0e5f72e Merged revision 1717264 from tomcat/trunk: Fixed potential NPE in HostConfig while deploying an application. Issue reported by coverity scan.
5f80e9e2cf Move the TesterServletContext since it is used by multiple tests
c2984295b4 Correct changelog
7288bc70a1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58660 With mapperContextRootRedirectEnabled ste to false, the redirect needs to be handled elsewhere. - Ensure the Mapper does not add the '/' handling the redirect - Handle the redirect in the DefaultServlet - Add a redirect to FORM auth if auth is occurring at the context root else the login page could be submitted to the wrong web application
fb08113b8c Refactoring prior to fixing https://bz.apache.org/bugzilla/show_bug.cgi?id=58660 No functional change
c0a77b90e7 Merged revision 1716644 from tomcat/trunk: Filter out a false positive
e74650ee78 Merged revision 1716640 from tomcat/trunk: Fix potential NPE reported by FindBugs
ffbb2b71a0 Tomcat 7.0.66 does not pass the vote
a2816a3612 Merged revision 1717085 from tomcat/trunk: Fixed javadoc
3f234e417a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58658 Correct a regression in 7.0.66 that prevented Tomcat from starting on Java 6 unless the WebSocket JARs (that require Java 7) were removed.
58c09b6217 Fix the issue that meant the work-around for BZ 58660 would not work.
d619b2966f Prep for next version
e338c10f9f Merged revision 1716543 from tomcat/trunk: checkstyle police
d99f55e262 Merged revision 1716511 from tomcat/trunk: Fixed typo
e650809b6d Don't swallow the stack trace. It is likely to contain useful information.
b4a66970ce Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58635 Enable break points to be set within agent code when running Tomcat with a Java agent. Based on a patch by Huxing Zhang.
772922bb63 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57136#c25 Change default value of quoteAttributeEL setting in Jasper to be true for better compatibility with other implementations and older versions of Tomcat. Add command line option -no-quoteAttributeEL in JspC.
50f98c914a Make the test play nicely with Java 6.
70021f3d9a Further work on https://bz.apache.org/bugzilla/show_bug.cgi?id=57136 Add a configuration option that allows EL expressions in attribute values to use JSP attribute quoting or not. The default is not to.
f6153afc1d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58650 Use class level @Ignore if all tests are to be ignored to avoid generation of directory named '${catalina.base}'
e40d20faae Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58624 Correct a thread safety issue that meant that blocking message writes could block indefinitely if the WebSocket connection was closed while a message write was in progress.
4bb724a0cc Add log message when map member added.
93f2fe23d0 Add null check for mapMember.
ec843edaef When using a static cluster, add the members that have been cached in the membership service to the map members list in order to ensure that the map member is a static member.
857ffc8a15 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58631 Correct continuation character for Windows Align docs with 8.0.x version
8954816782 -Ensure that the static member is registered to the add suspect list even If the static member that is registered to the remove suspect list has disappeared. -Correct the warnnig log of when the member that is not registered in the membership is detected.
f51ba6c151 Classes that require Java 7 can use Java 7 features.
b08b085688 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=55006 Add ProxySelector support to the WebSocket client Based on a patch by Niki Dokovski.
7d462af748 Correct markup of changelog.xml. Followup to r1715685.
fe60923f09 Add changelog entries for integer overflow fixes.
58e95119b4 Fix potential integer overflow. Reported by coverity scan.
b72c9ec9e3 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=34319
94ef804589 Move comment about protected methods to start of protected methods
3eefb4168e Remove parentheses around return values
51f4728268 Javadoc changes. Markup changes and addition of return annotations.
4cef9023c2 Remove parentheses around return values.
a1cdb2e78d javadoc changes. Markup changes and addition of return annotations.
2155b2256f return is not a function call, so don't use parentheses around return values.
72fd4803f5 Javadoc changes. Markup changes and addition of return annotations
7a2121b3b6 Don't add ":" to cookie name. It is illegal in newer jre.
45b828e9be Don't add ":" to cookie name. It is illegal in newer jre.
a273b5f45c Move the functionality that provides redirects for context roots and directories where a trailing <code>/</code> is added from the Mapper to the DefaultServlet. This enables such requests to be processed by any configured Valves and Filters before the redirect is made. This behaviour is configurable via the mapperContextRootRedirectEnabled and mapperDirectoryRedirectEnabled attributes of the Context which may be used to restore the previous behaviour.
74b3895d23 Fix document. The domain attribute of StaticMember is not required but optional.
2d2bd2659f Enable an explicit configuration of local member in the static cluster membership.
3071b68844 Add changelog entry for r1714185 and correct a typo.
652273bc9c Fix changelog entry for BZ 58596
ec2a5e0e4d Merged revision 1714521 from tomcat/trunk: Use Map<String, Logger> structure for Tomcat.pinnedLoggers. Feedback provided by kkolinko.
4df3550a2d Merged revision 1714019 from tomcat/trunk: whitespace
52988de6c6 Fix typo in comment: No Sety@HOME.
67c203985c Merged revision 1659184 from tomcat/trunk: Fix FindBugs warnings re possible Logger configuration loss
cb2f82c758 Merged revision 1713362 from tomcat/trunk: Fix Findbugs warnings. Remove code that will never execute because the condition it depends on can never be met.
0af4182f15 Merged revision 1713931 from tomcat/trunk: FindBugs fixes
f8c124d18a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58603 Need to override getRequestURl so the values set by the filter are used.
ae0ec83640 Add EasyMock to 7.0.x for the unit tests
49a2161bb8 Add note abour CGI debug page
fa50814a87 Correct back-port of unit test. Tomcat 7.0.x does not use CredentialHandler.
0017c95387 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1714005 13f79535-47bb-0310-9956-ffa450edef68
afcd2fd482 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57741 Enable the debug servlet to use the standard error page mechanism
57f3944669 Add support for DIGEST authentication to the JNDIRealm Based on a patch by Alexis Hassler
4b55fe853e Document validateClientProvidedNewSessionId
6261dbe363 Fixed checkstyle - Disallowed import
1a23a1fcd1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58596 Clarify how environment variables are used.
22b76d7606 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=56777 Allow file based configuration resources (user database, certificate revocation lists, keystores and trust stores) to be configured using URLs as well as files. Back-port provided by Huxing Zhang.
bfa5ab6381 Add a new Context option, enabled by default, that enables an additional check that a client provided session ID is in use in at least one other web application before allowing it to be used as the ID for a new session in the current web application.
6946c3a922 Revert 1713288 A better solution is available
884a0c1522 Add the ability to validate client provided session IDs and implement basic validation for the Standard session ID generator.
759ccbce3e Mark unused constant as unused and deprecate it.
6287be37d8 Handle the unlikely case where different versions of a web application are deployed with different session settings
6b3c788bc2 Merged revision 1713129 from tomcat/trunk: Add generated code to the findbugs exclusions.
4ac2eb8dbd For https://bz.apache.org/bugzilla/show_bug.cgi?id=58541 String.lastIndexOf(String) -> String.lastIndexOf(char) where possible
b405f50cc0 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58581 If custom error page fails, fall back to standard error page rather than throwing an NPE. Based on a patch by Huxing Zhang.
cee87e4662 For https://bz.apache.org/bugzilla/show_bug.cgi?id=58541 Revert one unneeded change from r1712227 It is indexOf(concatenated string) there, not indexOf(char).
dd5812c7ca For https://bz.apache.org/bugzilla/show_bug.cgi?id=58547 Several remaining replacements of X.valueOf(String).xValue() with simple x.parseX().
09a4b1c950 Port test "fix" for websockets.
9fc6786d1f Port r1712575: Use InstanceManager for server endpoint instances.
642cd4879a Correct double "the"s in the documentation.
f728738995 Remove svn:mergeinfo property from files.
16b3ee830d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58582 Perform background-processing on sub-realms.
0f7c4c07d6 Document java.net.preferIPv4Stack option, in followup to r1712493, r1712451, r1360433 Merged r1712649 from tomcat/tc8.0.x/trunk.
5a6f84e577 Align with 8.0.x
9859720252 Add an option the build to set java.net.preferIPv4Stack=true when running tests. This appears to be required on OSX El Capitan for multicast to work with the current tests
80024479b9 Fix incorrect skipping of test identified by kkolinko during Tomcat Native 1.2.1 testing
98284c55a6 Add a note to maxPostSize suggested by Christopher Simons
cbbdcd66ce Fix search/replace error in r1712227
a6a51721a1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58539 Logical rather than bitwise AND is required here
8c3c8bf2b0 String.indexOf(String) -> String.indexOf(char) where possible More general fix for an issue identified in https://bz.apache.org/bugzilla/show_bug.cgi?id=58541
15f4106e6d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58568 Deprecate unused code.
51ebafbe70 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1712038 13f79535-47bb-0310-9956-ffa450edef68
2d7963d034 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58058 Fix thread safety. Align with 8.0.x
a60cf2959c Merged revision 1710945 from tomcat/trunk: For https://bz.apache.org/bugzilla/show_bug.cgi?id=58547 Replace Integer.valueOf(String).intValue() with simple parseInt(), and similar methods.
b254f03add Merged revision 1710933 from tomcat/trunk: Replace Boolean.valueOf(String).booleanValue()  with Boolean.parseBoolean().
4d45c2c549 Merged revision 1710930 from tomcat/trunk: For https://bz.apache.org/bugzilla/show_bug.cgi?id=58547 (reviewing r1710760) Replace X.valueOf(String).xValue() with simple x.parseX().
37070cb642 Merged revision 1709960 from tomcat/trunk: Remove extra white spaces
85a1429ff0 Merged revision 1709895 from tomcat/trunk: Documentation for RestCsrfPreventionFilter
3dec0c4ae9 Merged revision 1709375 from tomcat/trunk: More tests for CSRF Rest protection.
b9023766d8 Merged revision 1709295 from tomcat/trunk: There are use cases when a nonce information cannot be provided via header. This commit introduces a mechanism to provide it via request parameters. If there is a X-CSRF-Token header, it will be taken with preference over any parameter with the same name in the request. Request parameters cannot be used to fetch new nonce, only header. Only configured paths can accept such request parameters with nonce information.
fbd146e0a9 No-functional changes. Remove TODO.
f23dd69c27 When creating a QueryStats object, ensure that maxQueries is checked. If maxQueries is a value less than or equal to 0, QueryStats are never created.
f5f3e1c7ab Fixed checkstyle violation
df31ccc54f Merged revision 1709120 from tomcat/trunk: Basic implementation for CSRF protection for REST. Documentation will follow.
e632cdb2a6 Merged revision 1708957 from tomcat/trunk: Extract common functionality from CsrfPreventionFilter to CsrfPreventionFilterBase
dc85afd16a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58535 Merged revision 1711006 from tomcat/trunk: Use Collections.reverseOrder instead of home made org.apache.catalina.manager.util.ReverseComparator
4da2e885f2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58534 Merged revision 1710779 from tomcat/trunk: Removed repeated conditional test. Patch provided by Anthony Whitford.
fc38c765ff Merged revision 1710754 from tomcat/trunk: Add findbugs exception for generated code
da14d18782 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58547 Merged revision 1710753 from tomcat/trunk: Use static valueOf instead of inefficient Number constructor. Based on a patch provided by Anthony Whitford.
46ab8d0026 When starting the StaticMembershipInterceptor, StaticMembershipInterceptor checks the required Interceptors. If the required Interceptor does not exist, it issues warning logs.
1dd8be2058 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58541 58544 Merged revision 1710689 from tomcat/trunk: Use Integer.toString(int) instead of Integer.valueOf(int).toString() when only a string representation of a primitive is needed. Based on a patch provided by Anthony Whitford.
d93ca84d10 Merged revision 1710676 from tomcat/trunk: Some of the inner classes are made static.
4022df47f7 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58545 Merged revision 1710632 from tomcat/trunk: Use entrySet() instead of keySet() when one need to obtain the value for a corresponding key. Based on a patch provided by Anthony Whitford.
67419e4437 For https://bz.apache.org/bugzilla/show_bug.cgi?id=58489 Simplify implementation to avoid unnecessary boxing/unboxing and align with Tomcat 8. Backport of r1710578 from tomcat/tc8.0.x/trunk.
80e009b005 Fix broken test. Merged r1710574 from tomcat/tc8.0.x/trunk.
6cfba8dd79 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58540 Merged revision 1710523 from tomcat/trunk: Remove unused code. Patch provided by Anthony Whitford.
629c86e287 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58537 Merged revision 1710517 from tomcat/trunk: ExtendedAccessLogValve inner AccessLogElement classes are made static. Patch provided by Anthony Whitford.
513ead38b3 Fix missing " (quote) in a configuration example. Reported via a documentation comment. Merged r1710490 from tomcat/tc8.0.x/trunk.
1ce115de25 Simplify. Followup to r1688909.
368a072871 Amend changelog for 7.0.62. Mention that the PRESERVE_COOKIE_HEADER setting added by r1675821 is also controlled by STRICT_SERVLET_COMPLIANCE property.
6325129d56 Remove empty directory added in r1704294
b9bd61a789 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58497 Make AbstractHttp11Processor easy to extend
14f205be98 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58486 Protect against two further possible memory leaks associated with XML parsing
46fe265083 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58508 Quote role names when used in MBean names since they may contain characters that require quoting.
0091545b4b Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58522 Fixed concurrency issue when iterating web application's resources.
95a16c5917 Merged revision 1710070 from tomcat/trunk: Spotted problems in the text messages while debugging bug 58490
bbfe79de5d Update the release date for 7.0.65
19726aa750 Distinguish the handling of the shutdown payload and member verification clearly. When handling shutdown payload, verification completion message is not required.
40f44b3305 Another followup to r1708687. QueryStats which have never been updated, should be sorted as newest ones. Thanks for kfujino for pointing it out.
f11b166b08 Optimize the session lock range in DeltaManager.requestCompleted.
b7e9dc6c42 Followup to r1708780. As kkolinko noted, tomcat 7 needs to be built with java 6.
30d9e1995f Correct a typo s/should only an escape/should only be an escape/
18d1479d75 svn:eol-style = native
0f85c628fa Add missing / to end tag
11a1897934 Add changelog entry for fix for 58489 (QueryStatsComparator)
f06fc1bfeb Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58489
4cfa0bcef9 Prep for next version
eaa75ef36c Improve Javadoc This closes #6 Based on a pull request by theau-aurelien
dc0144543d Ensure LogFactoryImpl is excluded from adapters jar. Reported by Benjamin Gandon on the dev list
867a78cb6b Java6 uses SSLv2Hello which Tomcat has disabled by default. Use a custom SSLSocketFactory to disable SSLv2Hello (and SSLv2) on the client side.
d48ab62c3f Fix an Eclipse nag, primarily to trigger a new CI build
3b9d45ddc2 Fix test broken during refactoring to add support for parallel class loading
2aad82c459 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58444 Can't use _jsp_init() for initialising the InstanceManager or ExpressionFactory because custom JSP base classes will never call _jsp_init(). Refactor the init of these variable so that JSPs use lazy init. Tag files continue to use init before first use.
bb74488a9d Fix an edge case parser bug found while investigating BZ 57136
89b4f73f9b Correct regression in previous fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57136 \$ should be an escape for $ in JSP. \${ should be an escape for ${ only in EL. EL rules only apply within an EL expression. The JSP rules apply everywhere else up to and including the ${...} surrounding the expression.
a89756fc55 Fix test compile.
8b1b51976a Port additional improvement for 57799, to also remove the sendfile flag. It is used to ensure expand capability on the buffer, but expand can only happen in rare cases during handshake so the check is not useful.
8011c4a103 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58284 Correctly implement session serialization so non-serializable attributes are skipped with a warning. Patch provided by Andrew Shore.
952b2a5f24 Add unit tests for session serialization
6ed8e56e95 Rename to make way for a genuine unit test
7c5b92bdcd Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58436 Ensure all access to the classloader<->Loggers Map is thread-safe
b0b4cfff18 Clean-up inspired by bug 58430
9de124a50c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58416 Correctly detect when a forced stop fails to stop Tomcat because the Tomcat process is waiting on some system call or is UNINTERRUPTIBLE.
e97b2251b4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58414 Don't try and compress zero length messages Add a unit test to cover this case
58607fbc9b Fix a TODO in passing
da280ffe49 Correct spelling of LocalStrings property combinedRealm.authFail(ed).
4ac72794f4 Correct spelling of webXml in LocalStrings property webXml.unrecognisedPublicId
ca4528f1c6 Re-add LocalStrings entry coyoteAdapter.service, which was removed too early with r1150864
8a289a65b6 Re-add LocalStrings entry contextConfig.invalidSciHandlesTypes, which was mistakenly removed with r1345367.
e1427d341d Use LocalStrings entry wsWebSocketContainer.invalidSubProtocol added in r1446694.
2b704c1c21 Use LocalStrings key endpoint.timeout.err instead of the missing entry endpoint.timeout.error
6b84b9922d Re-add LocalStrings entry endpoint.launch.fail (removed in r1594393) as it is still used in JIoEndpoint
277b618075 Change standardService.connector.destroyfailed to ...destroyFailed.
4b8f49ae1c Add LocalStrings entry standardContext.resourcesStop and change usage of key standardContext.resources.started (which is missing in LocalStrings)
b220fdbf08 Add LocalStrings entry for coyoteConnector.protocolHandlerStopFailed, which was added with r992890
c94370cff8 Use LocalStrings entry endpoint.apr.pollError instead of string 'Unexpected poller error'. That entry seems to match quite well and has the two needed placeholders. The string was added with r1433976
41883daed8 Javadoc changes. Use {@code ...} instead of <tt>...</t>. That way &lt; and &gt; can be directly written as '<' and '>'. Use <pre> to keep the formatting of xml fragments and split a few lines to make the param-values clearer.
2999d8af0f Add LocalStrings entries for a few log-messages, that came with the original patch in r964219. Added positional parameters to the placeholder.
349da8b02c Re-Add LocalStrings entry for property contextConfig.jarFile. The entry was removed with r887929, as some log statements were changed to contextConfig.jndiUrl, but not all.
7924cd1c5b Add LocalStrings entry applicationContext.addListener.iae.init which was introduced in r905910. We could probably use ...iae.wrongType instead.
1504f4e5a2 Correct property name jdbcAccessLogValve.close.
6411579bce Correct name of property singleSignOn.debug.associateFail introduced with r1646723
a04c60295b Correct spelling of property upgrade.sos.canWrite.ise introduced probably by r1413239
739e9d03fc Correct spelling of property introduced with r1454125
a9a43fe8fd Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58357 In circumstances not currently understood, APR+OpenSSL returns an error code when there does not appear to be anything wrong. Treating this as EAGAIN worked for HTTP upgrade so apply the same approach for HTTP.
1028e8ce05 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58640 Improve error reporting for tag files packaged in JARs.
9601639bc5 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58342 Always trigger a thread dump if Tomcat fails to stop gracefully even if using -force. Patch provided by  Alexandre Garnier.
d771a87922 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58342 Fix copy paste error that meant MessageHandler removal could fail for binary and pong MessageHandlers. Patch provided by DJ.
24b029f2fc Fix escaping in error message
7f61aaf68c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57681 Add a web application class loader implementation that supports the parallel loading of web application classes. Use of this feature requires a Java 7 or later JRE. Based on a patch by Huxing Zhang.
b23a12e4d5 More preparation for implementing parallel class loading. Make WebappClassLoaderBase parallel capable when running on a Java 7+ JRE
a4c05c976f More preparation for implementing parallel class loading. Use an explicit synchronized block in loadClass
f86f9f0dbf More preparation for implementing parallel class loading. Extract what will be the common class loader code into WebappClassLoaderBase and make WebappClassLoader a sub-class of this.
0d7863af14 More preparation for implementing parallel class loading. Replace the use of the (non-parallel capable) StandardClassLoader with the (parallel capable if using the right JRE) URLClassLoader.
7923b1d4a4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58187 When deploying applications via the Manager, skip the unnecessary test of file modification time that delayed deployment until the next automatic deployment check ran.
70ffb93878 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58275 Add a special case for IBM since it accepts cipher names in two forms (TLS_XXX and SSL_XXX) but only lists one form (SSL_XXX) when asked which ciphers it supports.
c6c47ca2dd Make the vendor constants accessible to Coyote in preparation for the fix for BZ 58275.
aec8ead7a5 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58296 Fix memory leak in JSP unloading
a1bb57256a Fix JavaDoc.
4294f80b07 Correct log messages in case of using BackupManager.
33c4b745e1 Fix a default clusterListeners in SimpleTcpCluster. The optimal default value is different for each session manager. ClusterSessionListener is never used in BackupManager.
eabbb8fd05 Add method to determine if JRE 7 features are available. (Prep for https://bz.apache.org/bugzilla/show_bug.cgi?id=57681)
842c546271 No <> in Java 6
214b504005 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58320 In async requests multiple threads can access the request attribute map at the same time.
576587d5e7 Follow-up to https://bz.apache.org/bugzilla/show_bug.cgi?id=58313 Fix concurrent access of encoders map when clearing encoders prior to switch to async.
f27350d3d8 Testing access log entries may be accessed concurrently so ensure that access is thread safe.
5ea5171b73 More normalization edge cases
45c9eb80e6 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58313 Fix concurrent access of encoders map when clearing encoders prior to switch to async.
fc7ae35287 Fix typo
8c34fb26a0 Correct log messages in case of using ReplicatedMap.
b743e91955 No-functional changes. Remove TODO.
39030dfaef Add support for configurations of ChannelListener and MembershipListener in server.xml.
6ff4dfa679 Update the release date for 7.0.64
4033a84763 Correct documentation for cluster-howto.
9f7644f3b9 Make sure the pool has been properly configured when attributes that related to the pool size are changed via JMX.
769d62acc1 No-functional change. Remove TODO.
9b950d528b Prep for next version
7b871782c4 Remove doubled words and one s/by/but/
f250f36d96 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58255 Document the Semaphore valve. Patch provided by Kyohei Nakamura.
e1bbd13d39 Fix Javadoc Separate test cases into separate test methods and add some additional tests. Clean up the code and fix a couple of edge cases
b7e4ed1717 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58157 Ensure that the handling of async timeouts does not result in an unnecessary dispatch to a container thread that could result in the current socket being added to the Poller multiple times and multiple attempts to process the same event for the same socket.
838bea7dc5 Align NIO and APR and reset the socket timeout before the socket is added to the Poller. May help with the fix for bug 58157.
c9c0f36354 Backport a change that may contribute to the fix for 58157
372a1bb1ab Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58232 Merged revision 1695778 from tomcat/trunk: Add PojoMethodMapping to the user properties only if there are annotated methods
a2c70faa95 Do not use try-with-resources
42e93b45f5 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58232 Merged revision 1695706 from tomcat/trunk: When ServerEndpointConfig is added programatically and the endpoint class that it provides is annotated, NPE is thrown while initializing HTTP upgrade handler. Based on a patch provided by bastian at diqube dot org
c6c387bbcc Fix possible cause of intermittent CI failures and bug 58157
fe0d71e5f1 Spellchecking
a68e1164d0 Spelcheck "availble"
1578cc2918 Correct double "the"s in the documentation.
7881a77e3a Spellchecking initiated by bug 58222 (kesystore -> keystore).
6491e2e771 Add missing license headers
2d6779877a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58178 EL in a tag file should use the Tag file's page context rather than that of the containing page.
3a1fd9b169 No need for a wrapper as fucntionMap extends java.el.FunctionMapper
ba3ed1d155 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58031 Make the (first) reason parameter parsing failed available as a request attribute and then use it to provide a better status code via the FailedRequstFilter (if configured).
95545f4d13 Differentiate between failure modes. Handling is currently identical but it won't be once BZ 58031 is addressed.
cb8375d0af git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1694293 13f79535-47bb-0310-9956-ffa450edef68
bf1a436b17 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58192 Fix a regression in the fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=58023. Ensure that classes are associated with their manifest even if the class file is first read (and cached) without the manifest.
e40b5891c1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58166 Allow applications to send application specific close codes.
b24ea9315a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58116 Fix a regression in the fix for bug 57281  that broke Comet support when running under a security manager. Based on a patch provided by Johno Crawford.
90bc76bd89 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58112 Update docs for importing Ant tasks
2205a5d05a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58103 When pipelining requests, and the previous request was an async request, ensure that the socket is removed from the waiting requests so that the async timeout thread doesn't process it during the next request.
28aaefda5a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58179 Fix atomicity violation (concurrent requests could both see null as the old value)
04e9d42e82 Eliminate the dependence on maxActive of busy queues and idle queue in order to enable the expansion of the pool size via JMX.
054ab67cb3 If the timeBetweenEvictionRunsMillis attribute is changed via jmx, it should restart the pool cleaner because this attribute affects the execution interval of the pool cleaner.
dbadbb02c2 The fairness attribute and ignoreExceptionOnPreLoad attribute do not allow a change via JMX.
b1aef14a9e Add support for stopping the pool cleaner via JMX.
f78f74416f Fixed the tests compilation. Applied feedback by kkolinko.
d85137f44a Fix potential NPE in QueryTimeoutInterceptor.
817ed2dcd9 Correct the incorrect document of QueryTimeoutInterceptor. The setting value is not in milliseconds but in seconds.
c6ba171c48 Update Eclipse configuration to exclude test/webapp* and similar paths from compiler sourcepath This is a follow-up to introduction of a testcase for BZ 58096, see "Re: r1689346" on dev mailing list
81f68e485c Correct changelog typos
2ae5522dde Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=55317 Merged revisions 1526730, 1538833, 1539180, 1691487 from tomcat/trunk: - Facilitate weaving by allowing ClassFileTransformer to be added to WebppClassLoader. Patch be Nick Williams - Rename. Loader is a poor choice as there is a separate Loader component - Review of r1539036 by Nick Williams. copyWithoutTransformers(), as defined in the interface InstrumentableClassLoader, returns a ClassLoader. The start() method is not defined in ClassLoader, it is specific to WebappClassLoader. Furthermore, code calling copyWithoutTransformers() won't have access to WebappClassLoader to call start() reflectively if a SecurityManager is enabled. So, the copyWithoutTransformers() method needs to call start() before it returns the copied class loader. Otherwise, it will be useless to JPA providers and the like. - Corrected the Tomcat 7 version where this interface was introduced for the first time
1b4b83109a Merged revision 1691134 from tomcat/trunk: Add text/javascript and application/javascript to the default for compressableMimeType
349dc6c929 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58119 Merged revision 1690209 from tomcat/trunk: When tags are compiled they must be placed in the org\apache\jsp\tag\web directory. Fixed a regression made with r1297213.
5e4c3cda1f Merged revisions 1690080 from tomcat/trunk: Apply feedback provided by kkolinko
0b21cc40f7 Merged revision 1690054 from tomcat/trunk: Fix GUMP build
96041037d0 Merged revisions 1690011, 1690021 from tomcat/trunk: Fix possible resource leaks by closing streams properly. Issues reported by Coverity Scan.
9b4508a3b5 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58086 Merged revision 1689825 from tomcat/trunk: Rework the change made with r1688563. When the war location points to a local path the FileInputStream will be used otherwise URLConnection will be used.
540c0db958 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58110 Like scriptlet sections, declaration sections of JSP pages have a one-to-one mapping of lines to the generated .java file. Use this information to provide more accurate error messages if a compilation error occurs in a declaration section.
55f8c00754 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58096 Ensure that the correct codeBase is returned for classes loaded from WEB-INF/classes
b320ae7edf Remove unnecessary code
b192337efb Update the release date for 7.0.63
d3680d9007 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1688911 13f79535-47bb-0310-9956-ffa450edef68
7a87d235bb Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57943 Prevent the same socket being added to the cache twice. Patch based on analysis by Ian Luo / Sun Qi
21737f440f Back-port an adaptation of r1688885 to fix Javadoc typo for date/time format specifiers.
cbb613bf2b 58094: Fix error log when attempting to register a non existing resource cache for non cached resources (unregistration doesn't log anything).
ca9a8ffd1a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58086 Merged revision 1688563 from tomcat/trunk: Fixed wrong if clause that causes FileNotFoundException. Based on a patch provided by Lukasz Jader.
d0aa45f3c5 Prep for next version
48001621f5 Add description of validatorClassName attribute to testXXXX attributes in jdbc-pool docs.
3da33fdab6 Add document of testOnConnect attribute in jdbc-pool doc.
ee9b783e5e Port r1607309 and followups to add header configuration for the SSLValve.
076b5cbc27 Fix NPE
b11190e052 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1687342 13f79535-47bb-0310-9956-ffa450edef68
6aee2e5b8c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57700 Merged revision 1687268 from tomcat/trunk: ADD_CHILD_EVENT must be sent even when there are failures during child's start, thus MapperListener will be added as Container/Lifecycle Listener and will be able to receive events related to the corresponding Container.
f0af8e4746 Add changelog entry.
98ccf54282 Avoid NPE if connection has been abandoned.
276dfa1f55 Refactoring of the removeOldest method in SlowQueryReport to behave as expected.
ff0b58b306 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57530 Reimplement TestAbstractHttp11Processor.testNon2xxResponseWithExpectation test using SimpleHttpClient instead of Java 6
4e64152573 When failed to replication, rather than all member is handled as a failed member, exclude the failure members from backup members.
9a1eeabe08 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=58023 Fix potentially excessive memory usage due to unnecessary caching of JAR manifests.
81dc03124f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57971 Correct the documentation for the cluster configuration setting recoverySleepTime
e4bc4fa43c Fix test broken by fix for BZ57938
26a05bcfef Correctly handle empty fields when: - Connector.maxPostSize="-1" - Context.allowCasualMultipartParsing="true"
434b42e7fb Fix nag
2c749768d8 Port r1685562 57974: Key the open session map on the endpoint instance rather than endpoint class.
e65cf5b82d Mention configuration attribute name for BZ 55988
a7d2e8a2d4 Allow Gump to use the newer version of checkstyle
f50b11f35b Fix indent. - no functional change.
d233645ad7 Do not set the nodes that failed to replication to the backup nodes. Ensure that the nodes that the data has been successfully replicated are set to the backup node.
86533854fa Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57977 Ensure web application class loader is unbound. Includes: - only bind/unbind if the valve is attached to a Host or Engine - narrow scope of binding to where it is required Address a async TODO
3312763dc2 Additional fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57265
9bfdf4b42c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57969 Merged revision 1684172 from tomcat/trunk: Provide path params to POJO via WsPerSessionServerEndpointConfig instead of the 'global' ServerEndpointConfig.
8285b15b45 Merged revision 1642327 from tomcat/trunk: Make use of the new case-insensitive map implementation.
feb130fbeb Merged revisions 1630208-1630209 from tomcat/trunk: - Fix an i18n TODO - Address a TODO
695800a4e5 Merged revision 1630203 from tomcat/trunk: Add debug logging for IOEs while reading data from server
def8500ce4 Merged revisions 1630210, 1630375 from tomcat/trunk: - Correct logic (error detected by Autobahn test suite) - Window size validation needs to vary for client vs server as well
a26bbbbde5 Merged revisions 1630065, 1630092  from tomcat/trunk: - Extend support for permessage-deflate to the WebSocket client implementation. - Correct type as spotted by Martin Grigorov
bf5a694e2e Use the correct constant.
0147c68795 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57676 Merged revision 1665292 from tomcat/trunk: Improve error message when multiple Websocket endpoints are bound to the same path.
396045da95 Merged revision 1629906 from tomcat/trunk: Use constants
02a4e54a9f Merged revision 1630194 from tomcat/trunk: Fix an i18n TODO
5b60582534 Merged revision 1630199 from tomcat/tc8.0.x/trunk: NPE protection. Note NPE only possible with test code.
5a0c9e2460 Merged revision 1669370 from tomcat/trunk: Use constants for constant byte arrays.
15859d60f8 Merged revision 1682386 from tomcat/tc8.0.x/trunk: Fix typos
e2de6d2c17 Update fork of Apache Commons codec from r1609340 to r1682326. Javadoc fixes only. No functional change.
dcc94b670e Update fork of Commons FileUpload from r1596086 to r1682322 to pick the 1.3.1 release and subsequent fixes.
044c1d5e3e Merge BCEL changes from r1614166 to r1682271 The changes consist of: - code clean-up - Javadoc tweaks - some renaming There are no functional changes
30bbc11707 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57959 Partially merged revision 1582064 from tomcat/tc8.0.x/trunk: Fixed deadlock in org.apache.juli.FileHandler when log is rotated.
850fb71738 Allow TestSsl unit test to succeed even when tcnative was build with an old OpenSSL (0.9.8 or 1.0.0) which we still support.
388ce9eedc Fix merge error.
21f51b580f Supporting "+" and "-" syntax in SSLProtocol configuration (OpenSSL).
e2ef8c6d26 Use constants for SSL/TLS protocol names to reduce chances of fatal consequences of string typos.
50b571ed9a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57154 Support a null docBase
05ecdd368b Fix deprecation warning
67e4ca9fc4 Eclipse says this is no longer required
75fb4af6f5 Fix Eclipse nag
fd0f204290 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57282 Updated request processing sequence diagrams by Stephen Chen.
775fd9b021 Fix an important difference
fc4873ba4c Update startup description. Written with Tomcat 9 in mind but better than the old one based on Tomcat 5.
ad6e3912bc Be more specific about the Eclipse Compiler we depend on
008e7de82b Fix 1000 second timeout observed by rjung in unit tests.
e9fab6e24a svn:eol-style = native
70d6820b6c Deprecate tcnative function removed from trunk in r1681181.
5c60a2b95e Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57943 Catch the ConcurrentModificationException so the Poller thread does not stop.
2cbcba5336 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57931 Ensure that the TLS connection is closed cleanly so that the client receives the appropriate error code when the connection is terminated due to invalid / missing client cert (or any other reason during the handshake)
368df1df55 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=54618 Add a new HttpHeaderSecurityFilter that adds the Strict-Transport-Security, X-Frame-Options and X-Content-Type-Options HTTP headers to the response
f5514ca34d Fix typos in changelog
95618f075d Fix a problem with SPNEGO auth and Java 8 update 40 onwards.
83a9711bdd Update the release date for 7.0.62
39aef98b44 Ensure that the state transfer flag is updated to true only when the map states have been transferred correctly from existing map members.
ce2b8535cc Make sure that stream is closed after using it in DeltaSession.applyDiff().
4f444936e5 Add reference to CVE-2014-0230
6f39481424 Prep for next version
40f83ec7f7 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57896 Document org.apache.tomcat.util.http.ServerCookie.PRESERVE_COOKIE_HEADER option that was introduced in r1675821
adac01c0bf Revert r1677971.
f98e103efd Use the truststoreProvider rather than the keystoreProvider for the trust manager
1b390d8039 Use a new object every time for security. Review by schultz.
1e2960d02b Partial fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=56438 Add logging for unnecessary TLD scans in JARs
9e722186bb Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57864 Make it clearer that hex values are not valid for cluster send options Based on a patch by Kyohei Nakamura
fcb958ee71 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57837 Add text/css to the default for compressableMimeType
c4cfd8b8b3 Add some comments to clarify behaviour. Review by schultz re object allocation
705cb470c1 Fix IDE warning
268db61daf Follow-up to r1676372 Slightly different set-up needed to unit test in 7.0.x
a660a28930 Further fix for https://bz.apache.org/bugzilla/show_bug.cgi?id=57855 Follow-up to r1676234 Handle case where null is passed to a method with a single varargs parameter
0aafd8c661 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57856 Ensure that any scheme/port changes implemented by the RemoteIpFilter also affect HttpServletResponse.sendRedirect()
598df6588c Implement a few more methods (will be required by some new tests for the RemoteIpFilter)
1558504f66 Use getter to access coyoteResponse to make it easier to sub-class.
cf485fc16f Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57855 Explicitly handle the case where a MethodExpression is invoked with null or the wrong number of parameters. Rather than failing with ArrayIndexOutOfBoundsException or NullPointerException throw an IllegalArgumentException with a useful error message.
2078616541 Address TheadLocal leak test failures.
a35cd9d8a7 Provide option to preserve "cookie" request header values when parsing cookies.
690261656f Drop unused (because it is buggy and fixing the bugs makes it non-fast) class
9791054994 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57845 Ensure that when an updated class file is detected that the JspLoader that loaded the old class file is cleared so a new JspLoader can load the new version of the class
9fa79df5b6 Backport r1653423, r1660266, r1671471. - Clarify the handling of Copy message and Copy nodes. - Make sure that add to the backup node of the map entry when map member has been added to ReplicatedMap. - Avoid unnecessary call of DeltaRequest#addSessionListener in non-primary nodes.
a824aba4e0 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57841 Improve error logging during context start
7744ff3770 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57833 Need to ensure key aliases are converted to lower case for JKS key stores. Based on a patch provided by Santosh Giri Govind M.
cc03850f40 Update changelog
bfe65345fa Review back-port of BZ 57338 fixes Add missing patches Align 7.0.x and 8.0.x for easier checking
a0790565b4 kfujino review of  BZ 57338 fix. Add configuration options for mapSendOptions and terminateOnStartFailure. Document the configuration options.
14f24f80fc Clean-up back-port
2e04932a86 Debug logging improvements
e7f0023337 Refactor to replace reverse map with dedicated session listener that contains a reference to the SSO ID. This refactoring is in support of the fix for BZ 57338.
46f7ad3802 Calls to associate need to trigger a Map update as well
199a3d85b2 Should use containerLog rather than own log
358fd1e8c1 Comment typo
a3128f14ee SSO now retains just the session ID rather than the actual session object so there is no need to remove sessions that have been passivated.
954ccc74ed Remove unused code
822641ff79 Avoid unnecessary object creation
d392be166d kfujino review of  BZ 57338 fix.
1224d56cd3 Remove unused method spotted by kfujino
cf60f06a49 Clean up
c2ef546ef1 First pass at fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=57338 so SSO entries are kept in sync across the cluster as nodes are added and removed.
b14d3b495f Remove final so sub-classes can replace these.
5143d837fb Refactor the sync to simply synchronize the method
afcbeb1f4d No longer need a separate lookup() method
7ab3a40831 Switch to ConcurrentHashMap and remove syncs
02618ea929 Whitespace clean-up
70856d2778 Allow this to compile with Java 6
6a923064f4 Remove unused pathname attribute in mbean definition of BackupManager.
67c08265f6 Fix a concurrency issue when a backup message that has all session data and a backup message that has diff data are processing at the same time.
c07580005b Correct list markup (list elements are <li>, not <ol>)
f3f502b79f Remove trailing whitespace.
a27020a946 Merged revision 1650365 from tomcat/trunk: Fix issue reported during 8.0.16 release testing that requestDestroyed was not called for a non-async page when the ErrorReportingValve would be handling the error reporting.
30083b2a6c Provide class name to error message
c3e24103fe Merge r1672628 57788: Avoid NPE if nothing is found after going through the whole class hierarchy.
4bb0f7fc43 Add mbean definition of recordAllActions.
de7641b92d Add new attribute that send all actions for session across Tomcat cluster nodes.
ab1382bb9d Added the release date for Tomcat 7.0.61
b9c7f40765 More hints about process using the PID.
564c885e4b BZ57801: Give a hint on what to do.
1d13d689ed Follow-up to r1671865. Java 6 compatibility. Need to catch Throwable to catch the UnsatisifiedLinkError
dac9b088c4 Java 6 compatibility
53f5e82b93 Align with 8.0.x - Javadoc fixes
68e402b258 Align implementation with 8.0.x (use final, add some new constants, throw Exception rather than Throwable)
be8c5b1d33 Add new classes available in tomcat-native 1.1.x
0861992945 Add issue number for r1668200 and earlier
0af9c295a7 Fix log name typo in WsRemoteEndpointImplServer class, caused by a copy-paste.
e94fbb72d1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57772 When reloading an application and a DIR representing an expanded WAR needs to be deleted ensure that the DIR is deleted after the context has been stopped rather than before.
01b678c964 Really make sure that HostConfig thinks the files have been modified.
6b7ec2f866 Follow-up to 1670437. If auto-deploy is not enabled, skip the last modified resolution check since checkResources() will have been explicitly called after the resource has been updated.
61f98d25ad Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57779 Dispatch to another thread for error handling is only intended to be used during Servlet 3+ async processing. Don't dispatch if the user is doing their own, custom form of async.
b3ca4bc125 Update changelog
9fbac59c09 Update unit tests to account for file modification resolution changes in HostConfig. Generally: - make sure modification times change by more than FILE_MODIFICATION_RESOLUTION_MS - make sure file modification times are always in the past
f76e0fe736 Align redeploy resource modification checking with reload modification checking so that now, in both cases, a change in modification time rather than an increase in modification time is used to determine if the resource has changed.
edc164efb7 Use a constant (that can be re-used by the unit tests) for the file modification resolution.
fc256093c7 Merged revision 1670610 from tomcat/trunk: Removed debug messages as they do not give any valuable information and floods the log files with empty rows. Patch provided by Polina Genova. Mail thread http://marc.info/?l=tomcat-user&m=142788443729890&w=2
acaa4e4279 Docs typos. Backport of r1670591 from trunk resp. r1670592 from tc8.
ca04f492e1 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57765 File.lastModified() has a resolution of 1s (1000ms). The last modified time has to be more than 1000ms ago to ensure that modifications that take place in the same second are not missed.
68e2cb87af Revert r1663326. The fix for the errors running the Autobahn test suite with perMessageDeflate was incorrect. The bug was only in trunk in the new handling for blocking writes. r1663326 broke non-blocking writes.
53ed26b76d Fix typo
466cbb4715 Add new %{xxx}p with xxx==local or xxx===remote to allow logging remote and/or local port in the access log.
5875cb432a No functional change: - move enum to top (more enum coming soon) - rename var "header" to "name", because the   concept is more general
3cc1c46dd2 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57762 Dropped connections are reported as a success with EOF rather than as a failure.
7f42f201d6 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57759 Add information to the keyAlias documentation to make clear that the order keys are read from the keystore is implementation dependent.
bf9b932cdb Prep for next version
b7f6221bfb When creating adding a context docBase cannot be null.
b1782a2769 Ensure that SSL parameters are provided to SSLServerSocket and SSLEngine. Patch provided by Ognjen Blagojevic.
7da5d20fe4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57761 Avoid using an empty path in the HTTP request when the websocket client connects to a server root.
3e05037281 7.0.60 marked as 'not released'
3fe179b6f5 Correct the check used for Java 8 JSSE server-preferred TLS cipher suite ordering. Patch provided by Ognjen Blagojevic.
e74cdfac89 Prep for next version
1767cc25e3 Fix typos in changelog
af82d2f696 Update tc-native to 1.1.33 and make this the minimum recommended version due to the potential crash on OS X, FreeBSD and possibly other platforms.
e9b83b1958 Merged revision 1668596 from tomcat/trunk: When searching for SCIs use Context.getParentClassLoader instead of ClassLoader.getParent. Thus one can provide the correct parent class loader when running embedded Tomcat in other environments such as OSGi.
beb730c3a8 Add issue number for r1662179 for better reference. BZ 57645 was filed later than the fix was committed.
f85adb821d Correct the documentation for deployOnStartup to make clear that if a WAR file is updated while Tomcat is stopped and unpackWARs is true, Tomcat will not detect the changed WAR file when it starts and will not replace the unpacked WAR file with the contents of the updated WAR.
e4177b7d8e Merge http://svn.apache.org/r1668193 Update examples to use Apache Standard Taglib 1.2.5.
df907937c0 Fix async + HTTP pipe-lining bug identified by Gump
6dbc563c0c Make ThreadLocal static (as it would normally be). This might - but probably won't - reduce the test failures for this test on Gump
bccc85d474 Add an option (needed for Gump) to exclude performance related tests on systems that are known to have poor performance (or fail for other reasons).
85b89393a7 Prevent threads from being renewed if a leak is detected. This might be why the memory leak tests sometimes fail on Gump.
cc1841d195 Trivial change to trigger CI build to test CI system
5fb6d8fd68 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57723 Ensure that the Context name and path remain consistent when adding a web application to an embedded Tomcat instance via Tomcat.addWebapp(Host,String,String,String)
7d561aabe9 Trivial Javadoc fix (mainly to test CI system)
7b68d3229d Fix broken unit test. Restore saving of Principal for non-login case.
ad9b3712d9 Fix NPE
03ebeb7240 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57708 Implement a new feature for AJP connectors - Tomcat Authorization If configured (it is disabled by default) Tomcat will take an authenticated user name from the AJP protocol and use the appropriate Realm for the request to authorize (i.e. add roles) to that user. Based on a patch by Graham Leggett.
1c4dd3b8e0 Pull out connector authentication calls into a separate method.
6fe99b6bca Refactor the non-login authenticator to align it with the other authenticators. There is never any need to create a session and set a Principal for this authenticator. Either the user principal has been set before this authenticator is called (in which case no need to set the Principal in the session) or it can't be set by this authenticator (since it doesn't do authentication).
0fe88056e3 Pull up common code from the authenticate() method to reduce duplication.
c3a40dc549 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57724 Handle the case where the UA provides an Origin header for a non-CORS request.
1175f74f55 Hopefully fixed timing issue in TestStuckThreadDetectionValve when the test is run on ASF buildbot...
3eb4ecb1d3 Add support for LAST_ACCESS_AT_START system property to SingleSignOn.
789c7db9de Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57703 Update http-method definition as per Servlet 2.5 MR6
7a9ec08a16 Use the correct capitalisation.
fb97367b90 Follow up to r1664875. Don't depend on class in option WebSocket module for unit tests.
b44295fd7b Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57377 Remove the restriction that prevented the use of SSL when specifying a bind address. Enable SSL to be configured for the registry as well as the server.
4ef2a10412 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57704 Merged revision 1666649 from tomcat/trunk: Access instanceManager via get/set methods. Fix potential NPEs. In web app start if a problem occur prior to instanceManager initialization then: - SCI.onStart will fail if it tries to use instanceManager - During web app stop, StandardContext.listenerStop will fail if it tries to use instanceManager
320e571b98 Merged revision 1666637 from tomcat/trunk: Unused type parameter T
d192115d5c Fix trailing space in comment lines in *.pem files, to align with Tomcat 8 and make checkstyle happy. Followup to r1666508.
364599aaf4 Use the right variable for null check; the method variable, that is.
f7d50456c4 Defer the initialization of StartTLS settings to the startInternal stage. That way logging is possible and errors in tls/ssl will lead to stopping the context.
50d98b48a0 No Diamonds in java 6.
3cd86984d9 Update link to SPNEGO documentation in Apache Geronimo wiki The old link went 404, as reported by André Warnier on the users@ list.
0d924b8284 Treat *.pem files (used in Tomcat test cases) as text. I set svn:eol-style and update "text.files" patterns in build.xml.
b2f8befea6 Fix Java 6 compatibility
a53730ed0c Make processing of trailer headers for chunked input optional. Trailer headers to process must be added to the allowedTrailerHeader list or they will be ignored
b9060848a6 Remove unused message.
87dc261fbe Remove unnecessary method that always returns true. The domain filtering works on DomainFilterInterceptor.
b46be55827 Make sure that refuse the messages from a different domain in DomainFilterInterceptor.
1626d20e69 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57683 An aborted request (the only way for the client to disconnect) should not stop the example from working for future requests.
1bc512a9ab Merged revision 1665779 from tomcat/trunk: %s/comma/semicolon. Issue reported via comments at apache org.
97a944d463 Follow-up to r1665297 Correct output loop. Forgot to increment offset for subsequent writes.
3d1b3857bd Follow up to r1665062 Callers assume that output() will fully write the data that is passed to it. Ensure that this is the case when the AJP message size is larger than the output buffer.
2f219551a3 Fix back-port error in unit test
9b3232f96e Try to fix gump build:
46ac31686d Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57643 Use new File(URI) to correctly convert between a file:// URL and an absolute path. Fixes JspC when getResource() returns an encoded URL.
1b0385294c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57675 Correctly quote strings when using the extended access log.
d7185f8ac8 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57674 Avoid a BufferOverflowException when an AJP response body chunk larger than the socket write buffer is being written. This typically requires a larger than default AJP packetSize.
a4abe82189 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57638 Avoid an IllegalArgumentException when an AJP request body chunk larger than the socket read buffer is being read. This typically requires a larger than default AJP packetSize.
276185ea65 Correct back-port and fix test failure
691ece0d30 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=56608 When deploying an external WAR, add watched resources in the expanded directory based on whether the expanded directory is expected to exist rather than if it does exist. When triggering a reload due to a modified watched resource, ensure that multiple changed watched resources only trigger one reload rather than a series of reloads.
183665ee79 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57662 Merged revision 1664317 from tomcat/trunk: Update to Eclipse ECJ 4.4.2
1030b788c5 Follow-up to r1664001. kkolino review Add another link. Fix a typo.
91428683d4 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=56058 Add some links to the AccessLogValve to pages on how to configure Tomcat / reverse proxies to log the desired information in the access log.
8456acf2a9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57123 Update all ECJ references to 4.4.1 Thanks to Ralph Schaer for uploading the JAR to Maven central.
7eb2174554 Only use the context.xml from an unpacked directory for a WAR if unpackWARs is true
8492b4a596 No diamonds here.
fe0822f34a Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57621 When an async request completes, need to ensure that any unread input is swallowed.
8d03370c51 Remove note that is no longer correct
b73a990d33 Make sure that unpackWAR attribute of Context is handled correctly in HostConfig.
dc805f4a7d When an uncompressed part results in multiple compressed parts, ensure that the OpCodes are correctly set.
fa66012c7c Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57602 Ensure HEAD requests return the correct content length (i.e. the same as for a GET) when the requested resource includes a resource served by a servlet that extends HttpServlet.
d27a71d250 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57601 Ensure HEAD requests return the correct content length (i.e. the same as for a GET) when the requested resource includes a resource served by the Default servlet. Patch by jboynes
5ad5e42df2 Remove dependency on SSLServerSocket.getSSLParameters() which is only available from Java 7 onwards.
be6f921ef7 Fix https://bz.apache.org/bugzilla/show_bug.cgi?id=56848 Use Locale.forLanguageTag to process Locale headers when running on Java 7 or later
62c62d907d Formatting
dca9024847 Provide a common method for making optional use of features available in JRE versions later than the minimum on which Tomcat is required to run.
6383f90de5 Backport of r1662985 from trunk resp. r1662986 from TC 8:
e8a43bef41 Fix JSTL related test (already in skip list).
a1f6bac487 Backport r1662736 to fix #57644 Update examples to use Apache Taglibs 1.2.3 Exclude taglibs-standard-spec API jar from TLD scanning
361ca9948e Back-port r1662627 and r1662632 to fix https://bz.apache.org/bugzilla/show_bug.cgi?id=55988 Respect TLS server cipher ordering in JSSE-based connectors. Based upon patches provided by Ognjen Blagojevic.
6a584d1416 Correct typo
91eacf7da4 Correct sentence in TODO
405ed01733 Don't create a session, if none is needed when using PersistentValve.
2c0094d396 Relax the restriction added in r1645015. Expand the unit tests. While the Javadoc for getContext(String) could be clearer, the intended behaviour appears to mapping rather than an exact match because: - there is no way with an excat match to obtain the ROOT context - "Returns a ServletContext object that corresponds to a specified URL on the server."
949830eeb6 For https://bz.apache.org/bugzilla/show_bug.cgi?id=57611 Update bugtraq:logregex property to work with both old and new server names and escape dot characters.
34cbeb53e5 Update BZ URL in properties
9cfde03b36 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57611 issues.a.o -> bz.a.o
fc8d5cb59d -When docBase refers internal war and unpackWARs is set to false, avoid registration of the invalid redeploy resource that has been added ".war" extension in duplicate. -If WAR exists, it is not necessary to trigger a reload when adding a Directory.
8c67bf6ec3 Enable StartTLS connections for JNDIRealm. Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49785.
01e65d9f88 Move changelog section to correct position.
cfa6268443 Back-port r1660953 from Tomcat 8 to fix https://bz.apache.org/bugzilla/show_bug.cgi?id=57540 Export TLS/SSL protocol version in a request attribute.
9fae5a0d65 - test "error" ist indicated by "Caused an ERROR", not   "FAILED".
f9ee6220f5 Listing names of testsuites that have failed or skipped tests: Reorder, to make sure that tail output (in Gump) does not miss the failed test names. Fix slitting a ';'-separated string of test names.
dcb6ad1bbe List names of testsuites that have failed or skipped tests It searches the test report files and lists their names.
55a4fc7b43 Fix a concurrency issue in the APR Poller that meant it was possible under low load for a socket queued to be added to the Poller not to be added for 10 seconds.
31e40812ff These classes have been removed.
4eb5bd3cea Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57581 Change internal byte counter in Coyote Request to be long instead of int. The public API via RequestInfo.getRequestBytesReceived() already declares it as long.
b61925e796 Correct typos. Some were reported via comments.a.o for Tomcat 7. Merged r1659517 from tomcat/tc8.0.x/trunk.
935f4e18c3 Mention the unit size for upgradeAsyncWriteBufferSize, as was asked via comments.a.o for Tomcat 7
4f9776ec44 Prevent multiple async timeouts on slow running / heavily loaded systems
e9de102ea0 Add CVE-2014-0227 to changelog
f0c2b8ef2a Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=57021 Log debug and error messages immediately and add stacktraces to them.
3d88ee0608 For https://issues.apache.org/bugzilla/show_bug.cgi?id=57021 Fix compilation errors with Java 6
1f55aa5ec3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57021 Improve logging in AprLifecycleListener and jni.Library when Tomcat-Native DLL fails to load. Based on a patch by Pravallika Peddi.
3086947c5d Clean-up
6290eddcbc Simplify code. Merged r1659308 from tomcat/tc8.0.x/trunk.
bd08721054 Suppress deprecation warnings.
812088583d Delay closing the connection until maxSwallowSize bytes have been read. This gives the client a chance to read the response. See http://httpd.apache.org/docs/2.0/misc/fin_wait_2.html#appendix
8891eee700 Use an explicit Locale when converting to upper case. - followup to r1659193 Merged r1659266 from tomcat/tc8.0.x/trunk.
6cd2329768 Use an explicit Locale when converting to lower case.
5ebf1d1412 Make OS user name case insensitive (as documented) and explicitly do conversion to lower case with the system's default Locale.
4d5900b9ed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57534 CORS Filter should only look at media type component of content type
3b3e355c7f Follow-up to r1658351. Back-port additional patch required to complete this fix.
44bd64bfc1 Add link from class-loader-howto.xml to config/loader.html. Without this the document does not mention how a classloader can be configured.
3857a55441 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57558 Add missing JAR in Ant task definition required by the validate task.
a0f5c2a12f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57546 Ensure that a dropped connection does not leave references to the UpgradeProcessor
212617a80b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57148 When coercing an object to a given type and a PropertyEditor has been registered for the type correctly coerce the empty string to null if the PropertyEditor throws an exception. Patch by kkolinko Unit tests by markt
f6c5120c84 Ensure only \${ and \#{ are treated as escapes for ${ and #{ rather than \$ and \# being treated as escapes for $ and # when processing literal expressions in expression language.
4f1d424da6 Follow-up to r1657910 Always reset pos to zero before next request.
4b64c775bf Fix one more typo in the changelog
dd11ec1184 Fix typo in Changelog.
6bd022b904 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57544 Fix potential infinite loop if pos == 0 Only need to update lastValid & pos if bytes have been moved.
461231b2c2 Guard the digester with its own lock object. Otherwise two threads could create two digester instances, lock on them and then use still the same one at the same time. Issue reported by Coverity Scan.
218ce545a9 We know, that we only store String[] instances as values in parameters-map, so no need to check for other types.
98c8f73e68 Warn about a problematic appBase setting on StandardHost.
520fcbdf42 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57509 Improve length check in OutputBuffer.write() to account for 4 extra bytes that are needed to terminates the headers.
61257d28fe Record +1 from Filip via BZ
8bd65446e9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57180 Additional fix. Do not attempt to enumerate valid HTTP methods.
d5343bfad7 Update the release date.
3b9e2af1d0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57503 Make clear that log4j 1.2.x is required
d013cf51c2 Close input and output streams in expandCGIScript to avoid resource leaks. Issue reported by Coverity Scan.
15cd8c4afc Close the inputstream that was used to get the content of the readme file. Issue reported by Coverity Scan.
049766b0d0 Close the socket that was used to determine the ssl capabilities. Issue reported by Coverity Scan.
b4633a194d Close input stream for including jsp. Issue reported by Coverity Scan.
1d3dae8ad4 Remove volatile from variables, as it is misleading. All variables, that are mutable and read/written from different threads are only modified/read within a synchronized block. All other variables are immutable and are now declared final. Issue identified by Coverity Scan.
e0f0cf5b3f Fix TestAbstractAjpProcessor test failures on Windows.
99c327cb8a svn:eol-style=native
eddaef127d Enhance our naming BeanFactory.
be14de5b86 Prep for next version
5ef9e5e1cb Move the changelog to the correct section
927cee5994 Update changelog
1463163d12 Mark 7.0.58 as "not released"
60acbd0bc8 Fix a possible deadlock when receiver thread invokes mapMemberAdded() while ping thread invokes memberAlive().
3042d90635 Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=57504 Initialize tldLocationsCache when creating the ServletContext
ac24d76c62 Prep for next version
2b7b62875a Add some debug logging to the WebSocket session to track creation and closure
f03a65c67e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57490 Make it possible to use Tomcat's WebSocket client within a web application when running under a SecurityManager. Based on a patch by Mikael Sterner.
9a2d902e0e Clarify behaviour of useBodyEncodingForURI attribute and its relation to URIEncoding.
381959562c Make checkstyle happy and remove forbidden import.
05c9b475b9 Allow to log the system properties with VersionLoggerListener. This feature is off by default.
acfb89ba2b Merged revision 1654123 from tomcat/trunk: Try to make checkstyle happy by removing spaces and ordering import statements
8402b19703 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57420 Make UEncoder a local variable in DirContextURLConnection to make it threadsafe. Based on ideas from kkolinko and violetagg.
0cd94ac3f7 Enable UEncoder instances to share safeChars BitSet while ensuring that the shared BitSet is immutable to be threadsafe.
969f951c69 Better fix for BZ 57476
8e1ceaf64f Merged revision 1653815 from tomcat/trunk: When closing the stream for the host's web.xml if an exception occur then hostTimeStamp must be set to -1 and not the globalTimeStamp. Issue reported by Coverity Scan.
3720668f0d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57476 As per section 9.4 of the Servlet spec, ensure that the response body has been completely written before exiting the forward method.
a4dfc8a466 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57178 Origin values of "null" should be included if "*" is allowed. Patch provided by Gregor Zurowski
8c7dbb4a56 Prefer CamelCase in log string keys.
010dc694f2 Fix broken XML markup
5de99b8df0 Back-port r1653550 to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57473 Add more logging to WarWatcher, specifically checking for odd states like non-existent files that were just listed by the filesystem, which suggests a permissions problem. Moved log strings into LocalStrings.properties
ca01ca6cff Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57461 When reporting value of java.home don't make it look like an environment variable.
d5aca7be9a git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1652943 13f79535-47bb-0310-9956-ffa450edef68
cb415735e6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57446 Ensure that the ServletContext presented to a listener for contextInitialized() is the same as the one presented when contextDestroyed() is called for the same listener.
c1934f280c Fix mbean descriptor of ClusterSingleSignOn.
53131f8472 Fix IDE warning
558238b636 Correct import order.
caed48b119 Checkstyle: 1) Missing Apache License header 2) Imports order
836e771d98 Don't add orderedLibs attribute if it is null. ReplicatedContext will fail otherwise.
392f0ea9a1 Enable custom context class when using embedded tomcat
3bd6c8f200 Happy New Year 2015
710d924bc8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57363 Log to stderr if LogManager is unable to read configuration files rather than swallowing the exception silently.
2ac637647c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57340 Ensure that Socket and SocketWrapper are only returned to the cache once on socket close (it is possible for multiple threads to call close concurrently).
d82e6d68b5 Use the provided atomic method to replace the attachment and return a reference to the old value.
eca2dfe588 Simplify. NioChannel.getAttachment(boolean) was only ever called with a parameter of false.
9e7445d3a5 Small improvement to the test
d8344d5a15 Add tests for AJP connector "requiredSecret" feature.
b5b86e8cf5 Use Map instead of HashMap in RequestDescriptor.
57431ca663 Add more thorough tests for AJP.
426908e61a Add new RequestDescriptor class which contains parsed data returned from the SnoopServlet.
9832216c06 - Add lots of info the SnoopServlet output. - Add SnoopResult class to parse SnoopServlet   response body. - Adjust TestRewriteValve to use the new   SnoopServlet / SnoopResult
c864a0373e Fix r1645628: - Remove merge markers - Replace <> notation - Replace try-with-resources
80df1cc523 Add document of ClusterSingleSignOn.
8778290793 EOL property.
4e93baf0e5 - Port websocket patches from Tomcat 8. - Correctly implement headers case insensitivity. - Allow optional use of user extensions. - Allow using partial binary message handlers. - Limit ping/pong message size. - Allow configuration of the time interval for the periodic event. - More accurate annotations processing. - Allow optional default for origin header in the client. - Note: client extensions support wasn't ported yet.
42e134e45d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57326 Enable AsyncListeners to re-register themselves through AsyncListener.onStartAsync ()
a27df4fd31 Remove some more unnecessary code.
96cff9ee8f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57324 If it is known that the connection is going to be closed when committing the response, send the connection: close header.
28267fd2d3 Have JspC initialize its ClassLoader before the ServletContext. This avoids the need to re-initialize the ClassLoader for every JSP being pre-compiled. This also fixes https://issues.apache.org/bugzilla/show_bug.cgi?id=57316 by removing the code that was causing the bug.
f19ee0bbc0 Backport some clean-up extracted from a patch by Jeremy Boynes.
ec09d0a610 In order to enable define in Cluster element, ClusterSingleSignOn implements ClusterValve.
0f6647b217 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57209 Add new JNDIRealm configuration userSearchAsUser
d24bc12017 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57344 Provide sha1 checksum files for Tomcat downloads. Exclude stray *.asc file from apache-tomcat-*-embed.tar.gz archive.
b6cec7fb4a Follow on to r1642702 Only currently running contexts should be returned. Handle the case where the mapper returns an unwanted non-exact match.
60f2e2f5a8 Ensure that the result of calling HttpServletRequest.getContextPath() is neither decoded nor normalized as required by the Servlet specification.
a72e5f5aa5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57238 Update information on SSL/TLS on Security and SSL documentation pages. Patch by Glen Peterson minus mention of OpenSSL syntax for ciphers attribute in security-howto.xml, as that feature is unavailable in Tomcat 7.
1ccb30109f Fix potential issue with BeanELresolver when running under a security manager. Some classes may not be accessible but may have accessible interfaces.
72a8692370 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57331 Allow ExpiresFilter to use "year" as synonym for "years" in its configuration. Update documentation to mention both "<unit>" and "<unit>s" duration unit names. Fix minor formatting issue (Many lines in XML text were wrongly wrapped. because quote character was replaced by &#27; and that broke wrapping algorithm.)
f6ae53fd71 Merged revision 1643675 from tomcat/trunk: It is not necessary to handle MalformedURLException separately as it extends IOException.
2aff9b244e Merged revision 1643761 from tomcat/trunk: Close the InputStream after retrieving the last modification time from URLConnection.
92157bbdc8 For http://issues.apache.org/bugzilla/show_bug.cgi?id=57261 Remove Diagnostics methods that are not used by Tomcat 7, reduce visibility. (Followup to r1643750)
7aa0a5742d Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=57261 Backport Diagnostics class, /vminfo and /threaddump command in Manager application and their Ant tasks from Tomcat 8. Update documentation.
3a41a9a9ec Add "sessions" command from antlib.xml
6274fd79d3 Reorder, aligning with antlib.xml.
6fa33575c2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57323 Correct display of outdated sessions in sessions count listing in Manager application Use separate slot for their counter.
7052a4cf99 Document /expire command. Merged revision 1641729 from tomcat/tc8.0.x/trunk (r1641721 from tomcat/trunk).
557bde57c0 Improve documentation of the Manager application:
ef17e6dc88 svn:eol-style=native
eacb675a61 Add service files from /res/META-INF/tomcat-websocket.jar/services/ to the list of text files. Merged revision 1643635 from tomcat/tc8.0.x/trunk (r1643634 from tomcat/trunk).
d6a48f9207 Fix ambiguity of anchors on config/valve.html page. Change algorithm for generation of unambiguous anchor names.
996b5c8f82 Simplify XPath expression. Not a functional change (no changes in the output). Merged r1643581 from tomcat/tc8.0.x/trunk (r1643045 from tomcat/trunk).
23675b4f79 Fix typo in docs.
c460daae03 Followup to r1643334: Replace calls to System.getProperty("path.separator") with File.pathSeparator One place missed in r1643334. This is in deprecated code that we never call.
0ef6468656 Correct a typo. Mention attribute name. Merged revision 1643539 from tomcat/tc8.0.x/trunk.
6a6a756579 Correct a typo. Make section names and anchors unambiguous.
2f5cf2be0d Add optional use of connector port in allow and deny expressions for RemoteAddrValve and RemoteHostValve.
3c5222b12f Add unit tests for RemoteAddrValve and RemoteHostValve.
acfc21d805 Follow up to r1643333 Replace calls to System.getProperty("path.separator" with File.pathSeperator
1c694c744c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57308 Avoid unnecessary use of System.getProperty("file.separator")
33070915ac Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57281 Enable non-public Filter and Servlet classes to be configured programmatically via the Servlet 3.0 API and then used without error when running under a SecurityManager.
7805c4303b Possible fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=57265
9807122abe Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57252 Provide application configured error pages with a chance to handle an async error before the built-in error reporting.
39f83a8b32 Add whitespace to align flags to make it easier to see which states set which flags.
a6222621e5 Fix concurrency issue identified while investigating BZ 57252. Ensure that non-container threads can't change the async state until the container thread has completed post-processing.
56cf0caaed With the changes to the behaviour AsyncContext.isStarted() this method can no longer be used to determine if complete needs to be called to add a new method that can provide this information.
3a7ca5a29e Fix three edgy async context bugs.
8375f1038c Back-port typo fix
72926aaeaa Backport clarification from Servlet 3.1 that requires an ISE if getRequest() or getResponse() are called after complete() or dispatch()
b20d43795f Update to Checkstyle 6.1.1 Fixed trailing whitespace in changelog file.
26ecfd5843 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57190 Fix ServletContext.getContext() when parallel deployment is in use.
78b159bc51 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57180 Don't limit HTTP methods to those defined in RFC 7231.
67c23cf02e Backport extensible session id generator from trunk/tc8. Not contained is the change to the manager interface and the corresponding method deprecations.
120d510b26 Document the Server Status page. Merged r1641730 from tomcat/tc8.0.x/trunk.
35569d9d81 Improve documentation of the Manager application: Swap "Using JMXProxy" and "Ant" sections. No change in the text of the sections themselves.
13da6348f1 Improving manager documentation. Better wording. Merged r1641988 from tomcat/tc8.0.x/trunk.
511eb5f677 Correct typos Merged r1641736 from tomcat/tc8.0.x/trunk.
2b80df23ee Improve documentation of the Manager application:
79c1facc90 Correct changelog typo.
4925a85646 Revert r1625559, the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56953 and an attempt to enhance performance of annotation scanning. The FastDataInputStream class was broken and caused multiple reports of regressions (https://issues.apache.org/bugzilla/show_bug.cgi?id=57173)
fb6bbef8b2 Correct changelog typo.
7f6e212084 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57234 Make protocol filtering case insensitive
ac9c25ec7f Add missing "${tomcat.home}" reference. Followup to r1627236.
8abb0c81f8 Document creating second Eclipse project to compile WebSocket classes with Java 7 (ide-eclipse-websocket target added in 7.0.56 r1627245).
b8a999c5c9 Correct Ant version in documentation of Eclipse settings.
9a9fd622f3 Aligning building.html with BUILDING.txt: Document installing Java 7 JDK in parallel with Java 6 one.
887dd528e0 Correction: WebSocket 1.0 -> 1.1
8966c0392b Improvements to building.xml:
18f898b9de Correct version of Ant
1fd1b0bb70 Close Jars opened during a test. Backport of r1641001 from tomcat/tc8.0.x/trunk.
a3527bf75d Minor corrections: Remove empty lines before sample text. Add missing '/>'s. Simplify markup by using CDATA.
31394b5a4c Enable wrapping for a wide sample text
73ff57c26f Backport test fix from Tomcat 8, to enable Apache Gump to run Tomcat 7 tests with Java 8.
7d8e7d4f15 Backport TestUtf8 fixes from Tomcat 8, to enable Apache Gump to run Tomcat 7 tests with Java 8. I tested this with Java 6 and 7 as well.
405dd2fea0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57239 Correct several message typos. Includes patch by vladk.
ddf786c093 Improve Java 7 support in build.xml: - Check correctness of java.7.home and fail early - Use ${java.home}/bin/java as a fallback - Echo the path to the selected Java executable - Simplify test-init1, test-init2 tasks.
3d15782b10 Fix various problems identified with flushing batched messages: - Flush triggered by disabling batching failed to flip buffer before writing and also failed to clear the buffer after writing was complete. This resulted in duplicated and/or corrupted messages. - The flush triggered by session close was too late since no writes are permitted once the close process starts. This resulted in an exception being thrown.
4c443d9d28 Update CGI-howto. Recommend to copy the servlet into one's own web application instead of uncommenting it globally. The default value for cgiPathPrefix is null. The "WEB-INF/cgi" value is the recommended one and used in conf/web.xml example.
5f23cfa8ba Correct message that is logged when load-on-startup servlet fails to load. It was logging context name instead of servlet name. Also correct message key. The message belongs to StandardContext. It is not used anywhere else. It is not used by StandardWrapper.
c4e2b5bef9 Remove unneeded taskdef for <setproxy> task.
8394263bcd Update to Checkstyle 6.0 Download just a checkstyle-6.0-all.jar instead of the whole bin.zip that contains that file.
f1525ce75a Automatically create target directory (base.path) when downloading files. Use random temporary filename instead of "file.zip"/"file.tar.gz" to allow several downloads to run in parallel.
838b88a513 Correct tests to use the correct context path for ROOT webapp. Those were printing the warning "StandardContext.setPath A context path must either be an empty string or start with a '/'"...
50ee9a2026 Correct tests to use the correct context path for ROOT webapp. Those were printing the warning "StandardContext.setPath A context path must either be an empty string or start with a '/'"...
93578218db Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57216 Improve handling of invalid context paths. This adds handling of paths that end with '/', including "/". This corrects handling of null path. It will now produce "" instead of "/null".
051a1dfd4c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57208 Merged revision(s) 1639653 from tomcat/trunk: Fixed NPE in JNDIRealm when "getUserBySearch" is performed, and no results are found. Based on a patch made by Jason McIntosh.
4a524a7f4e Update the release date
e8bd0b8f13 Removed arkward indent/outdent markup in favor of plain-old <pre> with manual spacing. (Partial revert of r1371336)
e1b12ead90 Minor improvements to SSL how-to. - Hilite keystore type (JKS vs PKCS12) to lessen confusion - Recommend to explicitly specify a protocol implementation when using SSL, instead of "HTTP/1.1" - Update examples to use explicit protocol implementation instead of "HTTP/1.1" - Remove example of setting SSLEngine="off" with APR. It makes no sense on this page as here we are enabling SSL, not disabling it. The "off" value is documented elsewhere. - The "8443" is not the default value for a port, as far as I know. One has to explicitly configure it.
cb0ac647bc Minor corrections: - Remove '\' at end-of-line when wrapping long lists of command arguments. Such character makes no sense on Windows ('^' is used there). I think that readers should be wise enough to unwrap the lines, and unwrapping is easier when you do not have to delete stray '\' characters. - Add double quotes to Windows command line samples, as %JAVA_HOME% is likely to contain a whitespace character.
4d8c00bf91 Prep for next version
790593ecd3 Log the current test name when the test starts. It makes reading the log files easier.
08ad0cba06 Configure javadoc tool to generate <META> tags with charset information.
1906bffc22 Remove patch-javadoc macros. It is not used, because another solution has been applier: all javadoc is generated with Java 7 JDK. Java 7.0.25+ is not vulnerable to CVE-2013-1571 that is fixed by this patch macro.
48770695b0 Suppress timestamp comment in generated Javadoc. Such as <!-- Generated by javadoc (version 1.7.0_65) on Wed Oct 22 09:10:36 EST 2014 -->
766d88e028 Fix standalone javadoc generation in jdbc-pool using "javadoc" task in build.xml of jdbc-pool. I doubt anyone uses it. Usually javadocs for the pool are generated from Tomcat-wide <javadoc> task in Tomcat's main build.xml file.
10094f0584 Simplify. Do not call toString() on values that are already strings.
5f22e7826a Simplify code that waits for threads to finish. This allows to shorten wait time if threads finish earlier.
52e3448745 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57144 Improve ClientAbortException to provide non-null message in getMessage() and full class name in toString().
667baa682c Improve test for BZ 54928: Cut down wait time by using Thread.join(time) instead of Thread.sleep().
04fb280fee Backport test case for BZ 54928. https://issues.apache.org/bugzilla/show_bug.cgi?id=54928
084325e467 Correct line wrap - followup to r1622253 Merged r1634250 from tomcat/trunk.
b9f810b3de Correct documentation typo. Add trailing dots in sentences. There are five protocols now.
ddc2f93d51 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57047 Fix possible false test failure when the session gets closed before the message write can complete.
a0671cb6d1 Merged revisions 1633824, 1633825 from tomcat/trunk: - Update to Tomcat Native 1.1.32 - Require Tomcat Native 1.1.32
694fd86eff Updated recommended patch level for tcnative.
1105d0c2ef Better handling for https://issues.apache.org/bugzilla/show_bug.cgi?id=56780 Now it is only necessary for the connector to be configured with sslProtocol="TLSv1.2" when using an IBM JRE in strict SP800-131a mode.
c55b0ddea5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57091 Work around the behaviour of the Oracle JRE when creating new threads in an applet environment that breaks the WebSocket client implementation. Patch provided by Niklas Hallqvist.
e3af3d05ec Move Async and Comet examples from JSP examples page to Servlets examples page, like it have already been done in Tomcat 8.
ca66308a59 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57079 When Eclipse Compiler JAR is updated, make sure to delete its old version from Tomcat lib directory.
0cf2f0686d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57079 Use Tomcat version number for jdbc-pool module when building and shipping the module as part of Tomcat.
f22169ad77 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57105 When parsing web.xml do not limit the buffer element of the jsp-property-group element to integer values as the allowed values are <number>kb or none.
d2d3f11f41 Add some debug logging for excluded protocols
7b1524a111 Update changelog for BZ 47919 per r1630407 It logs not just key env vars, but all of them, and logs command line arguments. I am emphasizing CATALINA_OPTS, JAVA_OPTS, as that may be a security concern for somebody. (It is not a real security concern, as those are expected to be visible in "ps" command output as well)
7d1211f7ec Ensure that that an EncodeException is thrown by  RemoteEndpoint.Basic.sendObject(Object) rather than an IOException when no suitable Encoder is configured for the given Object.
08f589ebf7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47919 Merged revisions 1630110, 1630407 from tomcat/trunk: - Extend the information logged when Tomcat starts to optionally include (enabled by default) the values of key environment variables. - Log all environment variables but disable this by default - Log all command line arguments passed to java.exe by default but include an option to exclude them
486a5aaec2 Merged revisions 1627296, 1627569 from tomcat/trunk: - Alternative solution for BZ56401 that doesn't trigger logging on shutdown - Improve the previous fix . Avoid logging version information in the constructor since it then gets logged at undesirable times such as when using StoreConfig
fbfd8e80e1 Do not increase remaining counter at end of stream in IdentityInputFilter.
0faa5d57c8 Fix timestamps in Tomcat build and jdbc-pool to use 24-hour format instead of 12-hour one and use UTC timezone.
35d4bccd5e Fix minor issues reported in https://issues.apache.org/bugzilla/show_bug.cgi?id=57079 Remove Ant hard-coded version. Remove "Created-By" Those lines will be added automatically (with the correct values) during build time. It is merge of r1632423 r1632424 from tomcat/trunk.
79d033cf95 Followup to the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53952 Deprecate SSL_OP_PKCS1_CHECK_1, SSL_OP_PKCS1_CHECK_2 flags. It is merge of r1632988 from tomcat/trunk.
7b01f56704 Note that using SSLProtocol="TLSv1.1,TLSv1.2" requires native 1.1.32 or later. Running with 1.1.31 is OK as long as the new values are not used in configuration. It is merge of r1632975 from tomcat/trunk.
d28d263fe7 Move recent fixes to the correct section. They will be in 7.0.57, not 7.0.56. (Followup to r1632634 r1632968)
78bd5b57a8 Further improve processing of null arguments in remote endpoint (followup to r1632625): 1) Document IllegalArgumentException in javadoc 2) Handle null arguments in sendObject() methods to throw IllegalArgumentException instead of NPE. It is merge of r1632965 from tomcat/trunk.
8a58813c85 Merged r1631987 r1631993 from tomcat/trunk: Java 8 isn't complaining about these but Eclipse is so fix them as well
394852bdd9 Merged r1631717 from tomcat/trunk: Fix the remaining Javadoc warnings for the EL API when building  with Java 8.
84950763ec Merged r1631568 from tomcat/trunk: Fix some Javadoc warnings when compiling with Java 8
9307b952fc Merged revision(s) 1631347 from tomcat/trunk: Fix Java8 Javadoc warnings for javax.websocket package
5a96f16052 Changelog for r1627420
fc89717ed5 Add null checks for arguments in remote endpoint.
e11408533a Fix xml markup broken by r1632606, move connector change into Coyote section.
b0583b68f4 Register mack-port of r1632604 missed in r1632606.
2996e76976 Back-ported r1632604 to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53952 Add support for TLSv1.1 and TLSv1.2 to APR connector.
aaa19b53fb Merged r1632601 from tomcat/trunk: Correct typo in message key, order alphabetically - followup to r1632310
fd7e9b9414 Correct a typo
9848e91e10 Disable SSLv3 by default for APR/native
50cbec6c86 Updates docs for new sslEnabledProtocols default.
3863abd29f Remove forcing use of SSLv3 in unit tests
ffb68eb5b9 Disable SSLv3 by default for JSSE HTTPS connectors (BIO, NIO, NIO2) Ensure SSLv2 is disabled (the JRE should do this anyway)
d9a6da4b09 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57099 Ensure that semi-colons are not permitted in JSP import page directives.
962490a40c Merged revision 1632251 from tomcat/trunk: Remove duplicate call which result is already cached in a local variable (Noted when reviewing r1632223)
80e21a474b Correct version of Java WebSocket mentioned in message displayed on Tomcat start on Java 6, in documentation and examples Followup to r1632232
8f79e3422c Merged revision 1631992 from tomcat/trunk: Correct version of Java WebSocket mentioned in documentation Followup to r1631839
9757e88907 Remove the unnecessary registration of context.xml as a redeploy resource. The context.xml having an external docBase has already been registered as a redeploy resource at first.
8e573facf1 Merged revision 1631818 from tomcat/trunk: Use constant strings for header names.
a8c43c76d3 Merged revision 1631817 from tomcat/trunk: Fix client subprotocol handling (pass protocol names from the annotation).
53f2820b99 Update WebSocket version
eadf8c8598 Merged revision 1631730 from tomcat/trunk: Avoid possible integer overflows reported by Coverity Scan
c0b461b16a Update the release date for 7.0.56
bec0df5814 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57054 Correctly handle the case in the WebSocket client when the HTTP response to the upgrade request can not be read in a single pass; either because the buffer is too small or the server sent the response in multiple packets.
2f10fe01b4 Back-port r1628984 to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57049 Clarify that jvmRoute can be set with either Engine.jvmRoute or a system property.
d91c16efa0 Prep for next version
70c7c2cdad Fix typo
d2a88ac90b Update docs as automatically setting the system property javax.security.auth.useSubjectCredsOnly was removed since it broke SPNEGO on IBM JREs.
1adfb1e584 Correct a couple of NPEs in the JNDI Realm that could be triggered with when not specifying a roleBase and enabling roleSearchAsUser.
02f49dbd95 Ensure SPNEGO authentication continues to work with the JNDI Realm using delegated credentials with recent Oracle JREs.
7119d3625f Cosmetic changes only to align with trunk to aid trunk/7.0.x diffs
67a0f27386 Moved description of ALLOW_NAME_ONLY option, so that it is near other "allow" options, and corrected an error: The old text was saying that "true" = enforcing. Actually "true" is allowing, as the option name says.
c8c4d12710 Merged revision 1627531 from tomcat/trunk: Fix broken Javadoc links
aea5ee6de0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57016 When using the PersistentValve do not remove sessions from the store when persisting them.
016a220bbe For https://issues.apache.org/bugzilla/show_bug.cgi?id=56739 )reviewing r1627401) Mark the AtomicInteger field as final.
1b74626300 Backport of 1627323 when reviewing r1627476: In CoyoteAdapter.asyncDispatch(): The local variable "success" has initial value of "true". Simplify code: there is no need to set it to true explicitly.
c856d4313b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57011 Merged revision 1627370 from tomcat/trunk: Ensure that the request and response are correctly recycled when processing errors during async processing.
dc3a01a683 Merged revisions 1626747-1626748 from tomcat/trunk: - Fix copy/paste error - Correct package (it was changed during the development of 1.0)
72825dba15 Merged revision 1626579 from tomcat/trunk: Fix a potential resource leak in JDTCompiler when checking wether a resource is a package. Reported by Coverity Scan.
72f6c3f9be Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56079 (Still need to sign the Windows Installer) Switch to the signed versions of the daemon binaries.
508f81bb85 Merged revision 1626765 from tomcat/trunk: Update WebSocket implementation to version 1.1 of the spec
7ab9577ae5 Merged revision 1626764 from tomcat/trunk: Reduce visibility for some methods. No API issues since this class is clearly documented to be for internal use only.
f4858f3774 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56739 Merged revision 1616441 from tomcat/trunk: If an application handles an error on an application thread during asynchronous processing by calling HttpServletResponse.sendError(), then ensure that the application is given an opportunity to report that error via an appropriate application defined error page if one is configured.
4c868d956a For https://issues.apache.org/bugzilla/show_bug.cgi?id=56990 Add build target ide-eclipse-websocket.
19153ff2a6 For https://issues.apache.org/bugzilla/show_bug.cgi?id=56990 Configure Eclipse to use Java 6 compliance settings for tomcat-7.0.x project instead of workspace-wide defaults
fd6424bd02 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56990 Ensure that the ide-eclipse build target downloads all the libraries required by the default Eclipse configuration files. It is port of r1626779.
ea76dcebfc Back-port r1626991 to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=57004 Add stuckThreadCount to StuckThreadDetectionValve's JMXBean.
9e2f44e5bf Correct a typo
f133f96b72 Update the Windows authentication documentation after some additional testing to answer the remaining questions.
3f4ae8091c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56991 Deprecate the use of a request attribute to pass a <jsp-file> declaration to Jasper and prevent an infinite loop if this technique is used in conjunction with an include.
88fd1d2417 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56982 Merged revision(s) 1624984 from tomcat/trunk: Return the actual negotiated extensions rather than an empty list for Session.getNegotiatedExtensions()
ad0c8f4e96 After double-checking SPN to domain user is a one to one mapping
b53404259b Answer an outstanding question and add some additional info
9c87e17ae7 Merged revision 1623695 from tomcat/trunk: Switch creation of the SHA-1 digest required to generate a WebSocket upgrade to use the ConcurrentMessageDigest rather than using a dedicated Queue.
e01d2ba2a4 Merged revision 1623693 from tomcat/trunk: Add SHA-1 support Add support for input consisting of multiply byte arrays (both changes are prep for switching WebSocket to use this utility class)
aad60396c3 Merged revision 1623685 from tomcat/trunk: Move MessageDigest utility classes from o.a.catalina.util to o.a.tomcat.util.security so they are more widely available.
16b915d25c Merged revision 1618835 from tomcat/trunk: Add plumbing to write reserved bits as set in the MessagePart rather than hard-coding them to 0. Re-order method parameters for writing header to align with RFC 6455.
ce1a42b2c2 Add a note about creating release builds on non-Windows platforms. It is merge of r1553126 from tomcat/trunk.
11b9beeb91 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56988 Allow to use relative paths in base.path setting when building Tomcat, e.g. "base.path=../libraries" Use consistent naming for "inheritAll" property: Ant manual uses camelCase for that name. It is port of r1625599 from tomcat/trunk.
d923ddc5cd Merged revision 1623236 from tomcat/trunk: Fix some checkstyle GenericWhitespace issues.
ed8a5a1b6d Merged revisions 1621698, 1622259 from tomcat/trunk: - Correct typo in a comment - No need for volatile. Can be final. Reported by FindBugs.
dead1dbcba Review comments from kkolinko Port of 1625563 from trunk
ad5153eb52 Merged revision 1619742 from tomcat/trunk: WebSocket permessage-deflate. Implement no_context_takeover parameters.
30d659afd0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56953 Further performance improvements to BCEL parser. Based on a patch by hzhang9 POrt of r1625504 from trunk
a10701e192 Use the DataInput interface rather than an implementation. Port of r1625501 from trunk
bbcb7c27f9 Merge AccessFlags and JavaClass as the other sub-classes of AccessFlags have been removed. Port of r1624959 from trunk
da644326c2 Remove branch that is not used by Tomcat. Thanks to Cobertura coverage report. Port of r1624648 from trunk
9e8deed1a7 Remove class_name argument from constructor, as Tomcat does not provide the name. Port of r1624647 from trunk
c0a547b3ac Inline ConstantPool.getConstantString() method. Port of r1624645 from trunk
656a5d9bc4 Move int -> String mapping for class and interface names from JavaClass to ClassParser. This avoids an intermediary int[] array. Move commons classname lookup and compact code into a helper method. Port of r1624642 from trunk
53a27bb5bd Do not create an empty arrays when Class has no interfaces. Skip creation of int[] indexes array and share the same empty String[] names array. Port of r1624636 from trunk
58c7471f25 Get rid of ArrayList arithmetics in JavaClass.getAnnotationEntries() Note that this changes return value of getAnnotationEntries() to be null instead of zero-length array by default.
55065e213a Flatten class hierarchy.  The only subtype of Annotations class is RuntimeVisibleAnnotations. Port of r1624605 from trunk
e38ad2a5e8 Remove RuntimeVisibleParameterAnnotations and its supporting classes. The fields in these classes have no getters (especially ParameterAnnotationEntry.annotation_table). As such, information stored in those classes was never read by Tomcat. Port of r1624598 from trunk
3ff3d1e070 Add 'final' modifiers to fields. Remove several num_xxx fields that accompanied an xxx array. Port of r1624592 from trunk
8b735cac56 Remove constant_pool_count field. The field is never read, and its value is known from the length of constant_pool array created in constructor. Backport of r1624588 from trunk
8a83802b45 Simplify. There is no real need to convert every attribute name into numeric tag via lookup table, when there are only two attribute names that we recognize.
06c9ea0ef2 Merged revision 1619738 from tomcat/trunk: Extend support for the WebSocket permessage-deflate extension to compression of outgoing messages on the server side.
eae990e640 Merged revision 1618834 from tomcat/trunk: Add rsv to MessagePart and re-order constructor to match order elements are used in RFC 6455
0cd2550f2c Merged revisions 1618832, 1618833 from tomcat/trunk: - Reduce visibility - Rename to align with RFC 6455 terms
2b38082334 Merged revision 1619585 from tomcat/trunk: Clear buffers as well as handler once they are no longer needed.
76ce1dcbef Merged revisions 1618688, 1618704, 1618830 from tomcat/trunk: - Whitespace - Add a little plumbing for outgoing messages (no actual compression yet) - Make a couple of fields volatile that are accessed by multiple threads (in succession, not in parallel) - s/inflator/inflater/
f71618bc31 Merged revision 1606653 from tomcat/trunk: Fix root cause of NPE when using WebSocket clients.
eb4ec330a7 Merged revisions 1606103 from tomcat/trunk: Plumbing to enable transformation / extension processing for outgoing server messages.
891c5c9862 Merged revisions 1560817, 1561623, 1606072 from tomcat/trunk: - Fix some arcane introspection errors. - Add a TODO to remind me to come back and look at this - Correct comment
36d3cffc5b Merged revisions 1605890,1605891 from tomcat/trunk: - Fix an i18n TODO - This time with the unsupported extension name
3dd096358f Merged revisions 1605821, 1605823 from tomcat/trunk: Refactoring with a view to adding transformation (i.e. extension) support to outgoing messages. Extract MessagePart into standalone class
ca6c512760 Merged revision 1605454 from tomcat/trunk: Handle preference selection for multiple extension headers with the same name Tighten up parameter validation for permessage-deflate
1d267d9780 Merged revisions 1605066,1605417 from tomcat/trunk: - Handle decompression for messages split across multiple frames. - Fix copy/paste error in r1605054 Control messages should be read into the control message buffer
664d673645 Merged revision 1605061 from tomcat/trunk: Add a new utility method and make use of it (will also be used in permessage-deflate)
decbf9a854 Merged revision 1605054 from tomcat/trunk: Refactor transformations to enable the handing of overflow (the previous code ignored this possibility).
bb878223a7 Merged revisions 1604822,1604833 from tomcat/trunk: - Add plumbing to enable permessage-deflate implementation - This is still a work-in-progress - Trivial format change
d409b39c00 Merged revision 1604810 from tomcat/trunk: Add the initial implementation for the permessage-deflate implementation This is a work-in-progress - There are still multiple Autobahn failures (or rather there will be once it is plumbed in) - No support (yet) for compression of outgoing messages
ef34f344ed Ensure that AjpNioProtocol and AjpAprProtocol enable the KeepAliveTimeout.
01c500c799 Set default file encoding to UTF-8 for svnmailer
35aea8c399 Merged revisions 1604776, 1604818 from tomcat/trunk: - Add an interface for the transformation (by an extension) of WebSocket frames. Only supports transformation of incoming messages at this point. - Add some inner classes that will be required when Transformation / extension support is plumbed in.
e9d9c17ab6 Merged revisions 1604781, 1604788 from tomcat/trunk: - Add support for parsing the extension header - Strengthen WebSocket extension parameter validation
f25826ecb1 Merged revision 1604768 from tomcat/trunk: Starting to look at WebSocket compression. These implementations will be required to process the extension negotiation.
293a4e3ec6 Merged revision 1597652 from tomcat/trunk: ISE is expected when using AsyncChannels. Handle it the same way an IOException is handled rather than expecting the client code to catch and handle it.
606fa6ba1a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56446 Merged revision 1595898 from tomcat/trunk: Clearer handling of exceptions when calling a method on a POJO based WebSocket endpoint. Based on a suggestion by Eugene Chung.
d87f10969d Merged revision 1589523 from tomcat/trunk: Add session ID to the exception message to aid debugging.
d92708ffdd Drop AnnotationDefault attribute as unused. This class has no getter methods and thus provides no value.
7211fb2312 Implement a TODO: change return value of AnnotationEntry.getElementValuePairs() from an array to a list. As all usages are known and constructor of ElementValuePair class is not accessible from outside (package-visible), I think it is OK to skip defensive copying.
908d913023 Reduce visibility of constructors. Remove unused constants
c9730ad967 Remove unused ConstantPool.constantToString methods. Found thanks to Cobertura coverage report.
388617acc3 Remove length and constant_pool fields from Attribute class.
a44d5152ae Remove unused method Attribute.getName(). It allows to remove name_index field as well. Found thanks to Cobertura coverage report.
ee0357ccb3 Remove serialization support and serialVersionUID fields from BCEL classes.
14d4629d31 Memory efficiency: Use a shared emptySet() as the value for JavaClassCacheEntry.sciSet when there are no SCIs for a class.
7748df110c Reorganize branches for better performance. The "docBase.toLowerCase(Locale.ENGLISH).endsWith(".war") && !file.isDirectory()" condition was the same in both branches.
9497c9ba3e Ensure web applications that have mixed case context paths and are deployed as directories are correctly removed on undeploy when running on a case sensitive file system.
083d19be7a Update changelog
4dcf3040c7 Use ClassFormatException in ElementValue.readElementValue() as this behaviour is driven by user-provided data, instead of logic errors in the code (as is the case for remaining RuntimeExceptions in BCEL).
896cf012ab Add performance test
f988882573 Clean up merge errors and align code wth trunk
b2757cc5e9 Port more code removal from trunk
0cfb7c5fe9 Port more code removal from trunk
81d06f497b Port removal of unnecesary code from trunk
291365de78 Port removal of unused code from trunk
c886c7155a Merge more simplification from trunk
4aa657472b Merge more simplification from trunk
13ccc055af Port more simplifications from trunk
29c49a48b2 Port simplications from trunk
ff72cc6360 Merge more unused code removal from trunk
7366ae03e8 Backport of unused code removal from trunk
a0e07a0f08 Backport fix for stack overflow error from trunk
6ab2c84a7f Back-port of more cleanup from trunk
dd55317400 Merge restoration of necessary code from trunk
38480d0b02 Merge addition of comments from trunk
5e3fbb4957 Merge removal of unused code from trunk
c0fb36b44f Port removal of unused code from trunk
fd33c4a480 BCEL changes that were then reverted
08591674a7 Merge cosmetic changes from trunk. No functional change.
2a29b3c5ea Correct a document of TcpFailureDetector.
5fee4987d2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43001 Enable the JspC Ant taks to set the JspC option mappedFile
3bfbc59582 Improve changelog entry of r1624223.
2ea6f987ee When deploying war, make sure that add dummy xml to the config base if war does not have META-INF/context.xml or deployXML is false.
0b3dc8f047 Improve changelog message for r1623692
df3d74a097 When using parallel deployment, correctly undeploy context of old version. Make sure that never undeploy older Context If current context is not running.
670f727bff Update class loader how-to to reflect new position of system class loader in loading order. Add a note the the original fix about the change in order.
f5e22b10fd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56910 -1 is not a supported option for maxConnections with the APR connector so don't allow it. Also prevent updates while the connector is running which is also unsupported.
6397b5e0d5 Correct the previous fix for bug 56825 that enabled pre-emptive authentication to work with the SSL authenticator. An SSL handshake is now triggered if: - premetive authentication is enabled; - CLIENT-CERT is being used; and - the previous handshake did not include a client cert
0c29573c7c Fix corrupted characters.
a9be2632f9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56908 Merged revision 1622342 from tomcat/trunk: Fix some potential resource leaks when reading jar files. Reported by Coverity Scan. Based on patch provided by Felix Schumacher.
c422bc5ae1 Merged revision 1622312 from tomcat/trunk: Fix some potential resource leaks when reading files and other resources. Reported by Coverity Scan.
cfe4297f13 Don't trigger re-authentication for webapps that don't need it.
b86833cbf9 Don't use Java 7 API in unit tests
c40fde1c90 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56848 Revert r1622303. It depends on a Java 7 API.
f4030db566 Revert r1622304. It depends on a Java 7 API.
70e19b2d6d Merged revision 1622297 from tomcat/trunk: Fix some potential resource leaks when reading property files. Reported by Coverity Scan.
d17b8d15a5 Fix parsing bug when quality ends in invalid character(s)
f503f4c6d2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56848 Improve handling of accept-language headers
a57b1f4e46 Correctly handle multiple accept-language headers rather than just using the first header to determine the user's preferred Locale.
007f6748ad Merged revisions 1621725, 1621726, 1621727 from tomcat/trunk: Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56900 Fix resource leaks reading property files Based on a patch by Felix Schumacher
de2ed4823e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56902 Merged revision 1621729 from tomcat/trunk: Potential resource leak in Default Servlet Based on a patch by Felix Schumacher
5cfe4122ff Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56895 Correctly compose JAVA_OPTS in catalina.bat so that escape sequences are preserved. Patch by Lucas Theisen.
f8d1c58f8d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56905 Make destruction on web application stop of thread group used for WebSocket connections more robust. Patch by kkolinko with minor tweaks
572a464d06 Merged revision 1622228 from tomcat/trunk: Fix a potential resource leak when reading MANIFEST.MF file for extension dependencies reported by Coverity Scan.
5fbf625211 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56907 Ensure that client IO threads are stopped if a secure WebSocket client connection fails.
ea47029528 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56857 Merged revision 1618169 from tomcat/trunk: Fix thread safety issue when calling ServletContext methods while running under a security manager.
4ca6337c86 Merged revision 1622187 from tomcat/trunk: Correct the information written by ExtendedAccessLogValve when a format token x-O(XXX) is used so that multiple values for a header XXX are separated by commas. Identified by Coverity Scan.
8e5715f6b3 Merged revision 1621929 from tomcat/trunk: Fix unit test for BZ 56903
b45ad885cb Merged revision 1621731 from tomcat/trunk: Correct the return value for StandardContext.getResourceOnlyServlets() so that multiple names are separated by commas. Identified by Coverity Scan and fixed based on a patch by Felix Schumacher.
6a0e34a802 Merged revision 1622163 from tomcat/trunk: Fixed the multipart elements merge operation performed during web application deployment. Identified by Coverity Scan.
5fe382857e svn:eol-style = native
c7924f9fd1 Merged revision 1621975 from tomcat/trunk: According to JavaDoc javax.servlet.jsp.PageContext.include(String) and javax.servlet.jsp.PageContext.include(String, boolean) must throw IOException if I/O error occur during the operation. When JSPServlet init parameter "development" is "false" then IOException is re-thrown, but when the parameter is "true", JasperException is thrown instead of IOException. This change guarantees that IOException is always re-thrown.
ebe0e82984 Mention the attribute name that configures the swallow limit added in 7.0.55.
9a89aed51b Reverted r1620924 after review.
c555473e3e Back-ported r1620923 Added missing hashCode method.
32b406ce51 Back-ported r1620917 Moved resource-freeing code from finalize() to breakdown() Have finalize() call breakdown() instead of vice-versa.
35708690b0 Back-port 1620915 Add super.finalize to finalize() methods that were missing them.
c786659f3b Update expected value after changes in r1617447
810bf2c104 Back-ported r1620743: - Fixed minor resource-leak [Coverity issue #45132]
2082478137 For https://issues.apache.org/bugzilla/show_bug.cgi?id=56882 Add testcase for processing of forwards and includes when Context have been reloaded. The bug is absent in Tomcat 7.
34f780cebd Delete empty directories. They are not tracked by Git.
90b849d564 Fix logic error. No functional impact but the code would have been a little slower. Based on a patch by martinschaef. This closes #13
5a7b5f81ba In JDBC Pool changelog file: - Add a note that this changelog file is obsolete. - Add XSLT stylesheet reference so that the file is viewable in a web browser (such as Firefox). - Fix a pair of markup errors.
f92e9351a8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56801 Improve performance of org.apache.tomcat.util.file.Matcher which is to filter JARs for scanning during web application start. Based on a patch by Sheldon Shao.
caa488da2a Followup to fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56829 Be more strict with executable filename on Windows (s/java/java.exe/).
082025cd22 Improve comments It is backport of r1617365
c32e28e984 Enable pre-emptive authentication to work with the SSL authenticator. Based on a patch by jlmonteiro.
5e09f19824 Fix copy/paste error spotted by kkolinko
6e6aa03dea Fix typo
7c416daed6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56829 Add the ability for users to define their own values for _RUNJAVA and _RUNJBD. Based on a patch by Neeme Praks.
d15a4c7d73 Fix missing trailing stop in a sentence.
c102941d9a Add a reminder
ce60cfc024 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56736 Avoid incorrect ISE if the timeout fires after a non-container thread has called dispatch() but before a container thread processed the dispatch()
320822580b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56780 Enable Tomcat to start when using SSL with an IBM JRE in strict SP800-131a mode.
9ad18da5ba Don't use Java 7 methods in Tomcat 7.
2af70d9930 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56797 When matching a method in an EL expression, do not treat bridge methods as duplicates of the method they bridge to. In this case always call the target of the bridge method.
ef2fcbf198 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56788 Display the full version in the list of installed applications when installed via the Windows installer package. Patch provided by Alexandre Garnier.
ef64712508 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56796 Remove unnecessary sleep when stopping a web application.
8ac412c003 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56771 When lookup for a resource in all the alternate or backup DirContext, NameNotFoundException will be thrown at the end of the search if the resource is not available in these alternate or backup DirContext. Based on a patch by Sheldon Shao.
c3acd8f0dc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56746 Allow secure WebSocket client threads to use the current context class loader rather than explicitly setting it to the class loader that loaded the WebSocket implementation. This allows WebSocket client connections from within web applications to access, amongst other things, the JNDI resources associated with the web application.
8cf552359c Allow the JNDI Realm to start even if the directory is not available. The directory not being available is not fatal once the Realm is started and it need not be fatal when the Realm starts. Based on a patch by Cédric Couralet. This closes #11
5107d32347 When scanning class files (e.g. for annotations) and reading the number of parameters in a <code>MethodParameters</code> structure only read a single byte (rather than two bytes) as per the JVM specification. Patch provided by labes.
80d8181255 Correct the label in the list of sessions by idle time for the bin that represents the idle time immediately below the maximum permitted idle time when using the expire command of the Manager application.
d6b4e18a20 Fix errors noted by checkstyle when building Tomcat 7: - Added missing license header in a test class - Imports order It is backport of r1613803 from tomcat/trunk.
da109b5656 Update the release date for 7.0.55
228aa754e0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53367 Fix interrupt handling in the FairBlockingQueue
8024cacbb0 Update changelog
2abc8d352a Prep for next version
a1a8fa595c Backport r1611551. Fix regression with r1611509: NPE on stop (only threadStop should set thread to null, or it needs a sync).
c91f9ef05c Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56724 Write an error message to Tomcat logs if container background thread exits unexpectedly. It is backport of r1611506 from tomcat/trunk.
0e71cbbaf9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56717 Allow repeated Mapper.addHost() calls for the same host. E.g. if the host has been implicitly added by addContextVersion() call.
f88f2c6068 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56717 Fix duplicate registration of MapperListener during repeated starts of embedded Tomcat. Properly unregister it when Tomcat stops.
daa43629cd Fix "No context found:" warnings from Mapper.addWrappers() -> findContextVersion() during context startup. If context has not been started yet, its "AFTER_START" lifecycle event will come later.
6f4b15407b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56710 Do not perform wrapper mapping if context is being reloaded, as such mapping is useless and may fail unexpectedly. Let mapper know that context is being reloaded.
154db1892d Fix an error with removal of the last context version in removeContextVersion(), add test. The issue was reported for Tomcat 7 in "Time for 7.0.55" thread on dev mailing list. It is backport of r1610197.
cfcb836095 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56658#c3 Fix regression that context reloads were broken. It is backport of r1610186.
b528f4548e Combine similar tests into same file. No functional change. ContextRoot and WelcomeFile mapper tests are moved into TestMapperWebapps class. It is backport of r1610188.
f5bf8722e6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56712 Fix session time comparisons in PersistentManagerBase. When asking for session times use internal**() methods to avoid an IllegalStateException.
0d46ae2836 BZ 56661: Fix Servlet API getLocalAddr().
fdd9f11dc2 Allow to configure maxSwallowSize attribute of an HTTP connector via JMX. This makes sense when configuring a new connector via JMX.
9ad9b8bf84 Aligned Tomcat 7 Mapper tests with trunk ones.
4d682c0b78 Mark MapElement fields as final, for better multithreading behaviour.
bb499f0e52 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56658 Avoid delay between registrations of mappings for context and for its servlets.
09ce73c075 Simplify. No functional change.
4b1818de6f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56684 Add a workaround for a bug that should never happen along with some basic debug logging.
ac7f1210ed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56653 Fix concurrency issue with lists of contexts in Mapper when stopping Contexts.
4e8617480b Correct javadoc.
7a556ca9c3 For BZ 56653 Improve handling of Context.versions field. Do not assign an empty array to this field, neither when creating a new versions list, nor when removing the last version from it. The mapping algorithm does not expect this list to be empty. Mark the versions list field as volatile, because it is updated when a Context is started or stopped.
c94013efbb Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=44312 Check that addContextVersion/removeContextVersion, addWrapper/removeWrapper, add/clear/removeWelcomeFile[s] are performed on the real Host, as expected by the caller.
eacbdca807 Add missing colon.
9879c85087 Add reference from an alias Host to its real Host. Add list of aliases to the real Host. Amend the test case.
a297747975 Fix import order
8951677660 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56685 Update to Tomcat Native Library version 1.1.31 to pick up the Windows binaries that are based on OpenSSL 1.0.1h.
c554e13cbf Replace field with a getter, to allow to change implementation (in view of possible backport of r1606651, r1606680)
75e5e3d238 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56685 Add quotes necessary for <code>daemon.sh</code> to work correctly on Solaris. Based on a suggesiton by lfuka.
5ca36b6f0c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56698 When persisting idle sessions, only persist newly idle sessions. Patch provided by Felix Schumacher.
0340327007 svn:eol-style = native
98a7697620 kkolinko review: Extend NPE protection
06530d4819 When the current PathInfo is modified as a result of dispatching a request, ensure that a call to HttpServletRequest.getPathTranslated() returns a value that is based on the modified PathInfo.
1f39256c99 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56677 Ensure that HttpServletRequest.getServletContext() returns the correct value during a cross-context dispatch.
5c5f290cfd Update Checkstyle to version 5.7
a9c6574a9f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56666 When clearing the SSO cookie use the same values for domain, path, httpOnly and secure as were used to set the SSO cookie.
c383175f0e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56543 Merged revision 1605528 from tomcat/trunk: Update to the Eclipse JDT Compiler 4.4
bd328efb11 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56665 Merged revision 1605402 from tomcat/trunk: Correct the generation of the effective web.xml when elements contain an empty string as value.
823457c0ee Simplify internalMapWrapper methods. No change in functionality. This completes backport of r1604066.
cd049d0310 Simplify. If there is only one version available, use it and skip exactFind(version) call.
24e18da9d2 Simplify. No change in functionality. Save contexts[pos] in a local variable. This backports part of r1604437.
5ed8cebde5 Simplify. No change in functionality. This backports part of r1604066.
c1ea1a1bca https://issues.apache.org/bugzilla/show_bug.cgi?id=44312 Log an error if there is a conflict between Host and Alias names. Improve addHost, addHostAlias, removeHost, removeHostAlias methods in Mapper to avoid occasionally removing a wrong host. (Add a check of whether the expected object was found, and whether it is the primary Host or an Alias).
2344742121 Test for https://issues.apache.org/bugzilla/show_bug.cgi?id=56653 Test concurrency issue with Mapper$ContextList.nesting field. It is backport of r1604309.
1452109e14 Mode test for adding duplicates from setUp() into a test method. Add two additional tests. It is backport of r1604217.
d8809a2b29 Simplify addContextVersion. This backports part of r1604066.
23c0330766 Simplify removeContextVersion. This backports part of r1604066.
61f1599a54 Simplify addWelcomeFile, removeWelcomeFile, clearWelcomeFiles. This backports part of r1604066.
3079bdb283 Simplify removeWrapper. This backports part of r1604066.
85216afe3f Add exactFind() method. Use it to simplify one of Mapper methods, addWrapper. Fixed error logging there. Old behaviour was to log only "(pos<0)" case. It did not log in wrong-match-found case (wrong name).
4210eddad9 Assert that MappingData object is empty before performing mapping work. The old code just skipped all work in that case, but I do not see why that would be useful, and it may return inconsistent results. The comet, async, websocket examples do work successfully with this change. It is backport of r1604434 from tomcat/trunk.
583c215911 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56657#c2 Ensure that re-mapping selects the context version that we expect. Merged r1604661 from tomcat/trunk.
34db38fcd5 https://issues.apache.org/bugzilla/show_bug.cgi?id=56657 If sessionid belongs to the latest version of webapp, use the latest version. Merged r1604605 from tomcat/trunk.
7be4cc5f5a A comment
9139d735a5 Mark Wrapper fields final. Implement a constructor. This backports part of r1604320.
13ad527f55 Simplify code, no functional change.
11efc3c37e Documentation. Correct copy-pasted comments Merged r1604165 from tomcat/trunk.
805871bea8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56611 Refactor code to remove inefficient calls to Method.isAnnotationPresent(). Additional fixes that were missed in r1603591. Merged r1604024 from tomcat/trunk.
dd1b8d55e4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56588 Update according to the changes in Tomcat 8: Un-deprecate Context.findApplicationListeners() It is followup to r1600505, r1600638.
89bcbcb150 Align Wrapper javadoc with actual implementation that was changed by r926377. Merged r1603947 from tomcat/trunk.
e3146f4b03 Fix compilation failure. (Followup to r1603781)
e89761c76b Followup to the tests for fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56334#c15 Enable result check for test 07g. Merged r1603783 from tomcat/trunk.
b1c8477e3e Add a new limit, defaulting to 2MB, for the amount of data Tomcat will swallow for an aborted upload.
c89275bf2f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334#c15 Handle potential whitespace around input.
6c7a23ea22 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56611 Refactor code to remove inefficient calls to Method.isAnnotationPresent(). Based on a patch by Jian Mou.
35f705f8ec Followup to r1602443: correct code formatting.
455a016de3 Follow-up to r1602510 after kkolinko review. Add patch chunk missed in backport
a3b38ec492 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56620 More general fix for incorrect request start times.
7359d9db15 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56620 Avoid bogus access log entries when pausing the NIO HTTP connector. Ensure that any requests partially read before the connector is paused are logged in the access log with the correct start time.
0a145f44d9 Make sure tests for classes in the examples webapp can be run from the command line
637db57bb2 https://issues.apache.org/bugzilla/show_bug.cgi?id=56518 Followup to r1602510: correct a copy-paste typo. Merged r1602851 from tomcat/trunk.
cbd3940605 Attempt to obfuscate session cookie values associated with other web applications when viewing HTTP request headers with the Request Header example from the examples web application. This reduces the opportunity to use this example for malicious purposes should the advice to remove the examples web application from security sensitive systems be ignored.
d02a98d403 Correct numeric order of changelog issues
9218324091 Followup to r1602522 Add "/" to the path like we do for session cookies. Use request.getContextPath() as I think it makes a better example.
5874b12322 Followup to r1602584: fix broken test for BZ 56581. I placed jsp file into a wrong directory, so the test request failed.
afe19e53cd Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=56581 If an error on a JSP page occurs when response has already been committed, do not clear the buffer of JspWriter, but flush it. It is backport of r1600899, r1602046, r1602583 from tomcat/trunk.
bfd1570b5a Set the path for cookies created by the examples web app This reduces the opportunity for using such cookies for malicious purposes should the advice to remove the examples web application from security sensitive systems be ignored.
de95bacffb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56518 Do not attempt an NIO write if a thread has been interrupted as it can lead to a connection limit leak
2a5dac17c6 Backport change that added ContainerThreadMarker (needed for a backport to follow)
6b2aacf048 Another Endpoint generics related backport. Original message: More side-effects from making endpoints generic
6e05c982b4 Backport change that added generics to Endpoint (needed for a backport to follow) The original commit message was: Create AbstractEndpoint.processSocketAsync() which will enable some further refactoring in the AJP processors. This requires adding generics to the endpoint so this patch also deals with the side effects of adding generics.
ce54499e45 Pull up getLog() and add some supporting plumbing
a3a7ccb10f git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1602483 13f79535-47bb-0310-9956-ffa450edef68
f81d67c850 Add changelog entry for r1602243 and similar earlier changes. That change was a backport of r1597982.
8bb657f1ec Changelog entry for r1602381
eccb83f534 When an error occurs after the response has been committed close the connection immediately rather than attempting to finish the response to make it easier for the client to differentiate between a complete response and one that failed part way though.
ed730f05d1 Trivial formatting change
354176dd87 Move resetting of error state to the processor's recycle method.
30bdc2c91f Refactoring. Switch from a boolean to an Enum for error state so we can differentiate between an error that requires the connection is closed after the current response is completed and an error that requires that the connection is closed immediately. This commit should be a NO-OP. While the different error states are set, the only the presence of an error (or not) is tested - i.e. no change from the implementation prior to this commit. Try to be consistent when an error occurs. Set the status code first (if required), then set the error state and finally log (if required).
c29d28c38b Add a (currently disabled) test for errors with a chunked response after the response has been committed.
9a2f7712fc Clean-up
e27a21ee18 Tiny bit of de-duplication. Add reference to RFC2616 for case insensitivity of transfer encoding names.
f7f1a5bfc9 Fix merge error
17d8196b7f Reduce duplicate by moving error handling into addInputFilter. Also makes error handling consistent.
9ab8339959 Align code with comment and use a 500 response (internal server error) as per the comment rather than a 400 response.
a432e70527 As per RFC2616, an unknown expect header should result in a 417 response.
eb18c85c80 Tweak comments
a42a3a8c86 Pull up error flag
7fe62c6bf1 Simplify logic Call Response.recycle() from Response.reset() rather than in Response.reset():  - doing ~half of what recycle() does  - calling ActionCode.RESET which resets the OutputBuffer which in turn calls Response.recycle()
4082abc0f9 More formatting changes
51e222cf40 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1602248 13f79535-47bb-0310-9956-ffa450edef68
4ef15dcc5c Check committed before changing any field values Remove various incorrect comments
5913847749 Backport some clean-up from trunk
55b2411af5 No need for the expectation check in an error state as the connection will be closed any way.
030e6645bc Fix copy/paste error and return a 500 rather 400 response
f53fa485ac Move code that parses EL expressions within JSP template text from Parser to JspReader class. This is done to get access to JspReader.nextChar(mark) to avoid calling reader.mark() in a loop, as that method allocates new Mark object on each call.
942935b35b Code cleanup: use if/elseif for alternative branches.
fb5eef27de Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56606 Update documentation for MemoryRealm. Align MemoryUserRule class (in MemoryRuleSet.java) with MemoryUserCreationFactory class (in MemoryUserDatabase.java) so that "username" attribute is read first. Merged r1601886 from tomcat/trunk.
6db61edc18 Remove obsolete documentation from realm package javadoc. The text is something very old that talks about "debug" attribute and that there are two standard realms, JDBCRealm and MemoryRealm. The up-to-date documentation is maintained in docs/config/realm.html Merged r1601855 from tomcat/trunk.
12ff3bf5fe Merged revision 1601850 from tomcat/trunk: Use StringManager for the async not supported message.
93adb80c7b Merged revision 1601796 from tomcat/trunk: Provide a better error message when asynchronous operations are not supported by a filter or servlet. Patch provided by Romain Manni-Bucau. Issue was reported via dev at tomcat.a.o.
d48daf4d86 Revert accidental commit.
84de822bb3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56612 Correctly parse two consecutive escaped single quotes when used in UEL expression in a JSP. Includes various unit tests that check the parsing of ${'\'\''}
8c53385ad7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56606 Ensure that the new attribute name username is used in the tomcat-users.xml examples rather than the old name of user.
6b23790bf7 Clean-up i18n for ChunkedInputFilter error message Add error flag to allow subsequent attempts at reading after an error to fail fast
eeaf16881f Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56573 The fix triggered a TCK failure
5672d1e68b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56600 Fix missing "return;" statements after sendError(): do not waste time generating response for PROPFIND requests that contain broken XML document.
178f42ea6e Don't assume that tests use the StandardManger
a40e59047b Fix ordering of changelog entries according to bug number.
6c3db215c2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56578 Correct regression in the fix for 56339 that prevented sessions from expiring when using clustering. The effect of removing expiring = true; from the DeltaSession is that if parallel calls are made to expire() then there is a slightly greater chance of some of those calls blocking while the first completes. This is because expiring is now set to true a little later.
af98e5e895 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56577 Better executor configuration.
aa3b8eabd2 Remove unused code from a test class.
acb6e51af8 Suppress an IDE warning. No functional change.
3350a9e3cb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56573 Restore query string. Add test cases.
073a2f8251 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56573 Change the value returned by Session.getRequestURI() from the value obtained from HttpServletRequest.getRequestURI() to the value obtained from HttpServletRequest.getRequestURI() with the scheme changed to ws or wss as appropriate. Note that the WebSocket Expert Group is expected to clarify the expected behaviour for Session.getRequestURI() which may result in further changes.
3cb0128f61 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56588 Followup to r1600638 Replace calls to addApplicationListener(new ApplicationListener(x, false)) with addApplicationListener(x).
12e1175df3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56588 Update according to the changes in Tomcat 8: Un-deprecate Context.addApplicationListener(String) Deprecate Context.addApplicationListener(ApplicationListener)
686a8a8e34 https://issues.apache.org/bugzilla/show_bug.cgi?id=55282 Fix message that is displayed when a duplicate listener is added.
cd089f71f4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56582 Convert implementations of ActionHook.action(..) to use switch(enum) operator. Part 2/2: HTTP processors.
88108dd387 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56582 Convert implementations of ActionHook.action(..) to use switch(enum) operator. Part 1/2: AJP processors.
7f07e1672e Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56555 which, after further discussion, was classed as INVALID.
135959dedb Add CVE numbers, correct typos.
99fe4e2055 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56555 When Tomcat closes the connection based on the HTTP status code of the response, ensure that only one connection header is sent to the client.
7a1a0eed81 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55282 Merged revision 1597855 from tomcat/trunk: o.a.t.util.descriptor.web.ApplicationListener overrides equals and hashCode methods.
eb73c926a4 Discern the first and the second requests in the test case. It is merge of r1597759 from tomcat/trunk.
f1a87d4c73 Add license header It is backport of revisions 1597753-1597755 from tomcat/trunk.
a01cdacb5f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56545 Pre-load an additional class if running under a security manager
6821998fac https://issues.apache.org/bugzilla/show_bug.cgi?id=56561 Followup to r1597532: check the output of the new test.
772d212836 Set bugtraq:logregex property on the root directory. This allows TortoiseSVN to parse arbitrary references to Bugzilla issues in addition to those that follow "Fix ..." template. Just the issue URL or "BZ + number" is enough.
4f628405bc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56561 Merged revisions 1597532, 1597541 from tomcat/trunk: Fixed NoSuchElementException when an attribute has empty string as value.
8fcced352e Add release date for 7.0.54
efad8520bc fixed timing and enclosed thread.join in a finally to avoid stopping the webapp before the request is finished (in case of assertion failure)
08ea59b6a5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56521 Implement a TODO Reuse the async write buffer between writes to reduce allocation and GC overhead. Based on a patch by leonzhx. Also:  - don't re-allocate the buffer / move the data in the buffer if the buffer is partially written on a subsequent write  - make the buffer size configurable, defaulting to 8k
f37fdfdd55 Partila back-port of r1667092 Avoid possible NPE
957b062426 Backport of r1575910 Better align 7.0.x with trunk to aid back-ports
2bd5e90b6b Backport of r1575885 Better align 7.0.x with trunk to aid back-ports
ba09353ff7 Backport of r1575545 Better align 7.0.x with trunk to aid back-ports
4031be23d7 Backport of r1557082 Better align 7.0.x with trunk to aid back-ports
d920b8c38a FindBugs setup() vs setUp()
ae41e734f9 Prep for next version
bc2dc2f11a svn:eol-style=native It is a merge of r1596081 from tomcat/trunk.
9cd7e4f7c1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56461 New option to make context startup fail if a load-on-startup servlet fails merged r1595690 from trunk
c95c4f19c2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56526 Improved StuckThreadDetectionValve to allow to interrupt stuck threads. merged r1595331 from trunk
dcdbea7cfc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56399 When recycling a Coyote request, ensure that Catalina request have been recycled.
77ac4f470e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56529 Test case for attributes with empty string values in custom tags. It is backport of r1595230 r1595365 from tomcat/trunk.
b1a1820192 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56529 Merged r1595289 from tomcat/trunk: Review of r1595174: 1. Call iterator() once. It creates an object, so it is better do not waste such calls. 2. Style issues: - "" does not make sense as 'generic' default for textAttributeValue. It makes sense for this specific case only. - 3 spaces indent -> 4 spaces
01693eb9c4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56536 Ensure that HttpSessionBindingListener.valueUnbound() uses the correct class loader when the <code>SingleSignOn</code> valve is used.
3f00c818b6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56529 Merged revision 1595171 from tomcat/trunk: Fixed NoSuchElementException while handling attributes with empty string value in custom tags. Patch provided by Hariprasad Manchi.
92b355a7ef Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56523 When using SPNEGO authentication, log the exceptions associated with failed user logins at debug level rather than error level.
e1cef8bb3e Remove unused code
dea42e9368 Merged r1594229 from tomcat/trunk: Require RuntimePermission when introducing a new token.
1f4c00928f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56501 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56501 HttpServletRequest.getContextPath() should return the undecoded context path used by the user agent.
e47859f17c Fix double checked locking issue identified by FindBugs
56975e97ca Correct typo in class name
9e516c0978 Correct regression introduced in r797162 that broke authentication of users when using the JAASMemoryLoginModule.
06f44a8182 Merged r1593877 from tomcat/trunk: - ThreadLocalLeakPreventionListener: Trigger thread renewals for StandardContext only. (Do not trigger them for FailedContext and similar). - StandardThreadExecutor: Pass 'threadRenewalDelay' to the thread pool executor. Otherwise this setting configured at initialization time is effectively ignored. - Improve documentation.
d1713a02d2 Merged r1593834 from tomcat/trunk: Simplify. No functional change.
a60c626ad4 Merged r1593800 from tomcat/trunk: Followup to r1593773: Explicitly create the logs directory. JUnit fails when the directory where it writes its reports does not exist. It happened at Apache Gump.
083548723c Merged r1593773 from tomcat/trunk: In tests: allow to configure directory where JUnit reports and access log are written to. This is useful for Apache Gump, where BIO, NIO and NIO2 tests in Tomcat 8 are configured separately.
eddffa51f0 Merged r1593697 from tomcat/trunk: Split into two paragraphs, so that note is more visible.
63fd78c420 Update package renamed Apache Commons BCEL to r1593495 to pick up some additional changes for Java 7 support and some code clean up.
d360661722 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56492 Avoid eclipse debugger pausing on uncaught exceptions when tomcat renews its threads
7ace372476 Merged r1593387 from tomcat/trunk: Small optimization: move "getRegistry(null, null)" call out of the loop.
3bfb1dfe18 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56472#c1
783d78bc2e Merged r1593335 from tomcat/trunk: Review of r1593288: Do not forget to call the symmetrical unset method on stop.
9e6cfa85fb Cleanup: the "entry.name" fields was read into a local variable. Use the variable.
09af06618b Cover both access options
68cebba9dc Update changelog
ee46d712c5 Back-port clean-up from 8.0.x package.access+=o.a.naming.resources
dc9e703e01 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Merged revision(s) 1593200 from tomcat/trunk: Document ErrorReportValve's new property 'showReport' on the "security HowTO" page.
ce74951a20 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56463 Merged revision 1593189 from tomcat/trunk: Property for disabling server information is added to the DefaultServlet.
4e5466d807 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56451 Revert r1592052 and apply and alternative fix that should have fewer side effects.
935ad525c5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56451 Make resources accessed via a context alias accessible via JNDI in the same way standard resources are available.
ee33f6cd9d Correct unit tests now EL Parser has been fixed to correctly parse "\$" as "$".
c2c07cf8de Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334 Merged r1590842 from tomcat/trunk: Additional tests and fixes Includes the following:
fc87bd8084 Merged r1590646 from tomcat/trunk: Fix Javadoc warnings
bcca94cd02 Merged r1590801 from tomcat/trunk: Document JspAttribute.isDynamic() and correct wrong value of this flag for "omit" attribute of <jsp:attribute> action.
8f56ef6b31 Correct the handling of back-slash escaping in the EL parser and no longer require that "\$" or "\#" must be followed by "{" in order for the back-slash escaping to take effect.
e20e70349c Clarify escaping
bb372057f2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334 Merged r1590604 from tomcat/trunk: Reviewing r1587887: s/ attrs.getValue(i) / attributeValue / in the messages as well, so that the actual expression text that is processed is printed in the message.
9a83fe7225 Merged r1590479 from tomcat/trunk: Improving valves documentation. Move valves implementing an Authenticator into new section "Authentication".
4d200ca738 Back-ported r1590474 from tomcat/trunk: Improving valves documentation. Move RemoteIpValve and SSLValve into new section "Proxies Support".
2c77612c20 Merged r1590471 from tomcat/trunk: Improving valves documentation. Wrap RemoteAddrValve and RemoteHostValve valves into a distinct section.
aca8f3b5b5 Merged r1590461 from tomcat/trunk: Improving valves documentation. Wrap Access Logging valves into a distinct section.
513b41e486 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55215 Merged r1501738 from tomcat/trunk: Remove unnecessary period at the end of file names Use space around = in properties consistently. Based on a patch by Brian Burch.
9a2b1dd2ff Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55215 Merged r1518536 from tomcat/trunk: Additional clarifications to logging documentation that make clear why access logs are handled separately. Patch provided by Brian Burch.
139e2a0ae6 Update svn:mergeinfo All changes from r1518540 have been merged.
0fc737dc35 Improve documentation markup. This is partial backport of r1518540 from trunk.
f5cfbba0f7 Improve documentation markup. This is partial backport of r1518540 from trunk.
52b680e6ea Improve documentation markup. This is partial backport of r1518540 from trunk.
59b66946c9 Improve documentation markup. This is partial backport of r1518540 from trunk.
9516a12a8f Improve documentation markup. This is partial backport of r1518540 from trunk.
128bc4d538 Improve documentation markup. This is partial backport of r1518540 from trunk.
9a27bed55f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Backport markup and styles for tables and source fragments from Tomcat 8.
af5cd9e18a Improve documentation markup. This is partial backport of r1518540 from trunk.
e7b9a956ef Improve documentation markup. This is partial backport of r1519668 from trunk.
14b18002b4 Improve documentation markup. This is partial backport of r1519668 from trunk.
0a6cb4a268 Improve documentation markup. This is partial backport of r1519668 from trunk.
e88908b066 Improve documentation markup. This is partial backport of r1519668 from trunk.
607dd494ef Improve documentation markup. This is partial backport of r1519668 from trunk.
d3951358d1 Improve documentation markup. This is partial backport of r1519668 from trunk.
24ae8839b3 Improve documentation markup. This is partial backport of r1519668 from trunk.
df4bb5f561 Fix processing of "target", "rel" attributes on links in Documentation.
13d0f6540d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Merged r1590451 from tomcat/trunk: Document the new feature on the "security HowTO" page. Move error valve documentation lower in the valves list (access log valves and access control valves should be the first ones there).
c013d84292 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Merged r1590438 from tomcat/trunk: Use non-empty title when both showServerInfo and showReport are false.
b5ac02ad78 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Merged r1590422 from tomcat/trunk: Review of r1589994: - Reduce visibility of fields that have getter methods - Do not print <h3></h3> line if showServerInfo is turned off
131811897f https://issues.apache.org/bugzilla/show_bug.cgi?id=56365 Document file name pattern syntax for StandardJarScanner. When configuring pattern lists: be tolerant of leading/trailing whitespace, ignore empty patterns.
2fb69cdb5c https://issues.apache.org/bugzilla/show_bug.cgi?id=56365 Simplify file name pattern matching code in StandardJarScanner: Remove unused code from Matcher class.
b599e0b707 https://issues.apache.org/bugzilla/show_bug.cgi?id=56365 Simplify file name pattern matching code in StandardJarScanner.
c1c53faa4b Merged r1590322 r1590345 from tomcat/trunk: Correct formatting and a few minor typos. No substantial changes to the text.
5f4c9d5b6a Merged r1590300 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56027 Alternative implementation for the new values of FIPSMode option in AprLifecycleListener
3402cc561a Merged r1590302 from tomcat/trunk: Move filters into their own menu section in Documentation webapp.
0c097992cd Merged r1590329 from tomcat/trunk:
aceda3c1db Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56441 Raise the visibility of exceptions thrown when a problem is encountered calling a getter or setter on a component attribute from debug to warning.
15dcc222f3 Stop threads used for secure WebSocket client connections when they are no longer required and give them better names for easier debugging while they are running.
344d71e847 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56425 Improve method matching for EL expressions. When looking for matching methods, an exact match between parameter types is preferred followed by an assignable match followed by a coercible match.
eaaa052dad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56418 Ensure that the Manager web application does not report success for a web application deployment that fails. Based on a patch by slaurent.
ab2fb20326 Use JLS recommended order
4ccd034c3a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56458 Report WebSocket sessions that are created over secure connections as secure rather than as not secure.
bb5e08fdb9 Followup to r1590036 1) simplify 2) add 'synchronized', as web applications may start in parallel
080878ea51 Ensure TLD parser obtained from cache has correct value of blockExternal
934f884f33 Defensive coding around some XML activities that are triggered by web applications and are therefore at potential risk of a memory leak.
fea8fb36d8 Merged r1590018 from tomcat/trunk: Add javadoc for AbstractReplicatedMap ctr parameters added in r1498820 / r1498855 That feature is controlled via "terminateOnStartFailure" option of BackupManager.
6246d8307f More defensive coding around some XML activities that are triggered by web applications and are therefore at potential risk of a memory leak.
eb70282ddf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56383 Merged revision 1589967 from tomcat/trunk: Properties for disabling server information and error report are added to the o.a.catalina.valves.ErrorReportValve. Based on the patch provided by Nick Bunn.
5159f2ca15 Refactoring to reduce code duplication.
745b77b66d Minor clean-up. kkolinko review.
16e07fae11 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56416 Document correct default for socket linger.
733e812973 Revert 1589672. Default linger setting is required.
f13055f039 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56382 Merged revision 1589698 from tomcat/trunk: Add information about finished deployment and its execution time to the logs. Patch provided by Danila Galimov.
e0652839c5 Merged revision 1589668 from tomcat/trunk: Fixed broken links to java.sun.com. Issue reported via comments.apache.org
85cc81010c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56416 Align the AJP and HTTP connector implementations with the documented behaviour and use JVM defaults for socket linger.
275f2e5dcf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56430 Extend checks for suspicious URL patterns to include patterns of the form <code>*.a.b</code> which are not valid patterns for extension mappings.
13daa28983 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56449 When creating a new session, add the message handlers to the session before calling Endpoint.onOpen() so the message handlers are in place should the onOpen() method trigger the sending of any messages.
33c13d77de Merged revisions r1589166, r1589165, r1589170 from tomcat/trunk: Reviewing r1589103 s/J2EE/JavaEE/ in a message Correct a typo in changelog Add changelog entry for Tomcat Native upgrade
ba0f032c0d Ensure that threads created to support WebSocket clients are stopped when those clients no longer need them. Note that while this happens automatically for WebSocket client calls made by web applications, stand-alone clients must call the Tomcat specific method WsWebSocketContainer.destroy().
f035a43b12 Refactor server container shutdown into the destroy method Destroy the thread group on shutdown Log a warning if the thread group can't be destroyed
1e3f3867b1 WebSocket has own section in changelog.
06a2695d9f Increase the default maximum size of the executor used for async writes
cbcbf0adbf Merged r1588102 from tomcat/trunk: Correct signature of SSL.fipsModeGet(), as native code is implemented as throwing an Exception in this method.
f51a1bc0c4 Merged r1588462 from tomcat/trunk: Update Javadoc, as addValve/removeValve methods belong to Pipeline.
37cdacf466 Modify generic exception handling so that StackOverflowError is not treated as a fatal error and can handled and/or logged as required.
73e98237b7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56409 Avoid StackOverflowError on non-Windows systems if a file named '\' is encountered when scanning for TLDs.
f8b316acbb Small optimisation. The resolver and the factory are only used when running under a security manager so only load them in this case. Also avoid a possible memory leak when creating these objects.
17ebae4d3b Fix back-porting copy/paste error
d8118585e7 Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56334
fe0fa3b3a5 Remove duplicated lines
c31bce5534 Back-ported r1587723 to fix objections to the original r1587379 patch. Removed inconsistent and confusing langauge from FIPSMode configuration. Added changelog.
bd95355973 Back-port r1587379 to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56027 Add more nuanced support for entering/requiring FIPS mode when using APR connector.
2cb0a65bd1 Back-ported r1587378 to require tcnative version 1.1.30.
99095cc86d Merged r1587272 from tomcat/trunk: Print a warning in case if neither server nor client jvm is found by service.bat. Fix comments (addresses sebb's note in "Re: r1000718").
fec9ce9964 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56406 Correct typo in example in VirtualDirContext javadoc.
c45fdbf26b https://issues.apache.org/bugzilla/show_bug.cgi?id=49993 Add changelog entry for old r1000718 That was in 7.0.3
afa13d5e58 Merged r1586961 from tomcat/trunk: Align DisplayName of Tomcat service installed by service.bat with one installed by the *.exe installer: Use "X.0" version number in both instead of "X".
d8b9443429 Merged r1586959 from tomcat/trunk: Followup to r1586897 : Apply the same not-null optimization to removeAttributeChangeNotificationListener method.
0b6b97f730 Merged r1586951 from tomcat/trunk: Correct message displayed by service.bat for an invalid command.
173ed8f620 Fix some issues back-porting the bug 56334 test case
b72714315e Align with 8.0.x and remove unnecessary @SupressWarnings
3ea38285fc Align with 8.0.x to aid future backports
b375839222 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55483#c4 Return exact match as soon as it is found. Note without the change the same method is returned it just takes a little longer
0422e311df Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56369 Ensure that removing an MBean notification listener reverts all the operations performed when adding an MBean notification listener.
4d99d0d645 svn:eol-style = native
855334da93 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56334 Correct double backslash escaping in attributes
b0f074ed38 Merged r1586658 from tomcat/trunk: Correct windows-service-howto.xml according to Apache Commons Daemon procrun documentation. E.g. the default value for LogPath option was documented incorrectly.
b7f8eb36ca Replace double space before '-JvmMs' with single one.
8f239ee586 Backport refactoring of AbstractReplicatedMap to implement Map rather than extend  ConcurrentHashMap to enable Tomcat 7 to be built with Java 8.
ba0296feb3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56343 Avoid NPE if WebSocket API JAR from RI is used.
3f1ab48bb3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56339 Avoid an infinite loop if an application calls session.invalidate() from the session destroyed event for that session.
a2b8b76064 Followup to r1584513: tabs -> spaces, as reminded by checkstyle
5bdd2ef2e2 Backport r1584505 and r1584507. -Simplify the code of o.a.c.ha.tcp.SimpleTcpCluster.  In order to add or remove cluster valve to Container, use pipeline instead of IntrospectionUtils. -There is no need to set cluster instance when SimpleTcpCluster.unregisterClusterValve is called.  Set null than cluster instance for cleanup.
694ab22cf7 Backport r1584267, r1584268, r1584270 and r1584274 Add support for cross context session replication to BackupManager. This fix is included sevral improvement of cluster manager.
6711b20dcc Add release date for 7.0.53
2522a977f8 Correct message text (missing whitespace)
99d5eb2704 Deprecate unused lifecycleEvent method.
74b7e623ff Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56321 When a WAR is modified, undeploy the web application before deleting any expanded directory as the undeploy process may refer to classes that need to be loaded from the expanded directory. If the expanded directory is deleted first, any attempt to load a new class during undeploy will fail.
22a15039ad Ensure that "name" request parameter is used as a application base of host if "webapps" request parameter is not set when adding host in HostManager Application.
27526ff765 Add Support for copyXML attribute of Host to Host Manager.
908c3c425c Fix custom UTF-8 decoder so that a byte of value 0xC1 is always rejected immediately as it is never valid in a UTF-8 byte sequence. Update UTF-8 decoder tests to account for UTF-8 decoding improvements in Java 8. The custom UTF-8 decoder is still required due to bugs in the UTF-8 decoder provided by Java. Java 8's decoder is better than Java 7's but it is still buggy.
42c64b010c Prep for next version
09f5b138cc Merged revision 1581061 from tomcat/trunk: Specify that Apache Ant version 1.8.2 or later is required for building Tomcat.
d539f5aa25 Whitespace police
2af5670468 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56304 WebSocket + BIO HTTP + Production = bad idea
e977b9398d Remove proposal This have been applied in r1580654 ;)
6e0631b81c Fix bug in example
834e0bc795 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53119 Make sure the NIO AJP output buffer is cleared on any error to prevent any possible overflow if it is written to again before the connection is closed. This extends the original fix for the APR/native output buffer to the NIO connector.
9cfb9153d7 Fix typos spotted by Cyril Bonté.
aec2ea12b1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56293 Cache resources loaded by the class loader from /META-INF/services/ for better performance for repeated look ups.
2c3ad04692 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56273 If the Manager web application does not perform an operation because the web application is already being serviced, report an error rather than reporting success.
ac72403e36 Make exception handling more robust - review by remm.
61d48e9d0c Rework the fix for 56190 as the previous fix did not recycle the request in all cases leading to mis-routing of requests.
ec001a81d0 Merged r1576288 from tomcat/trunk: Add a work-around for XML documents (often TLDs) that only refer to JavaEE schemas by file name Backport of markt's patch.
22b4055537 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56283 Add issue number for r1579176
56e7d248ac Fix merge
8c44b05b65 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54475 Add Java 8 support to SMAP generation for JSPs. Patch by Robbie Gibson.
1fccb568bb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56265 Do not escape values of dynamic tag attributes containing EL expressions Patch by kkolinko
cc1f09c3c1 Update JDT to P20140317-1600 to add Java 8 support and enable "1.8" as a valid option for source and target JVM versions for JSPs.
de18bf09cb Make default Java version for JSPs Java 6
eff89513ec Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56268 Merged revision 1578817 from tomcat/trunk: Specify the default value of the ${build} in the build section.
184cdc0d3f Fix possible overflow when parsing long values from a byte array.
321e2569c9 Merged revision 1578810 from tomcat/trunk: Corrected link to Tomcat 7.0 documentation. Issue is reported via comments at apache.org
f61edaa6c8 Update changelog
3c53c4da7b Prevent user supplied XSLTs from defining external entities
5c545da226 Redefine globalXsltFile as relative to CATALINA_BASE/conf or CATALINA_HOME/conf
b6974571c1 Improve processing of chuck size from chunked headers. Avoid overflow and use a bit shift instead of a multiplication as it is marginally faster.
c98baa40b1 Make upload process more robust. If upload fails and it was going to update an existing WAR, don't remove the existing WAR.
f10e35f09a kkolinko review Use deployed which is known to be absolute Also, deprecate use of getAppBase() method as it does not exist in 8.0.x and use deployed instead (deployed only needs to be absolute not canonical).
6288be176f Review from kkolinko The filename of a tagged war file should be  versioned + tag + baseName.war.  The "tag" part was lost.
99912399e7 Add definition of org.apache.catalina.ant.FindLeaksTask.
a1d5517440 Merged r1577944 from tomcat/trunk: Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
78b3223c92 r1576923 : Better Javadoc
aec32b9027 r1576908: Correct comment
69a57babda Merged r1577544 from tomcat/trunk: Add a couple more tests based on a report on the users list (There tests pass, the problem looks to be elsewhere)
8f65098fc9 Backport of r1577867 from tomcat/trunk: Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
4be939f242 Backport of r1577073 from tomcat/trunk: Split the test SSL/non-SSL.
c90b565996 Merged revisions r1576810 r1576722 from tomcat/trunk: TestWebSocketFrameClient: Add non SSL version of the frame test. TesterFirehoseServer: Fix an Eclipse nag now the received message is used.
895ba5c5ba Merged revisions r1576628 r1577873 from tomcat/trunk: Add some progress info to the websockets frame test.
7b6675b4cf Merged r1577714 from tomcat/trunk: Properly delete %TEMP%/ser{number}.tmp temporary file that was used to test serialization of a Principal.
f7cea1f33b Merged revisions r1577557 r1577565 r1577581 from tomcat/trunk: Better reporting for skipped tests. With org.junit.Assume the tests are clearly reported as 'skipped' in JUnit test run summary.
030061ce94 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56236 Add issue number
6f00f871a9 Review by kkolinko Avoid adding nulls to the map Log a warning for problems in addSelf() as well as add()
a776ee7c6d Fix bad merge Review by kkolinko
f93c6a1056 Enable Tomcat to work in a OSGI environment with alternative Servlet and JSP API JARs.
19aa755a49 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56248 Allow the deployer to update an existing WAR file without undeploying the existing application if the update flag is set. This allows any existing custom context.xml for the application to be retained. To update an application and remove any existing context.xml simply undeploy the old version of the application before deploying the new version.
16ca573cbe Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56246 Fix NullPointerException in MemoryRealm when authenticating an unknown user.
00e3e7d2a2 Add support for LAST_ACCESS_AT_START system property to Manager web application.
59727cbc60 Merged r1576271 from tomcat/trunk: Rephrase changelog message
d90fc9ed09 Fixed java.lang.NegativeArraySizeException when execute the command of Expire sessions of manager web application to context in which the session timeout is disabled.
2ea7f7d5f9 Entropy attribute for Manager gone since TC 7.
b089c79dec Improve the robustness of web application undeployment based on some code analysis triggered by the report for BZ 54315
1596ca7dbb Fix broken test, uncovered by the fix for BZ 56223.
009f607fb3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56223 Throw an IllegalStateException if a call is made to ServletContext.setInitParameter() after the ServletContext has been initialized
980814c84a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56190 AsyncContext.complete() should close the response. dispatch() should be used if further output to the response is required.
570812808b Pick some of r1560702. Call onError if the onClose call throws an exception.
81abc4fb11 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56213 Reduce GC when NIO connector is under load. Results in a small performance improvement. KeyReferences and finalizer references were accounting for 30%+ of the heap during my load tests before this patch.
295668ec64 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56217 Left align makes more sense as entries might be very long
f02c8efeec Add bug number
d668d7898d Merged r1574004 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56010 Documentation part of the fix
066ecb183a Revert occasional typo.
b11ebeac65 Bug number for r1570163
767831c0b2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56189 Remove unused file.
e547d48a14 Add tests for https://issues.apache.org/bugzilla/show_bug.cgi?id=56179 https://issues.apache.org/bugzilla/show_bug.cgi?id=56185 (Backport of r1571245, r1571725)
2860e60df4 Add CVE numbers to changelog.
5b6d59cd7e Fix typos
eaeb46ed15 Merged r1570601, r1570713 from tomcat/trunk: Allow to limit JUnit test run to a number of selected test case methods.
52c2762c96 Alternative fix to the empty dir in JAR file issue
50df46482d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56172 Avoid possible request corruption when using the AJP NIO connector and a request is sent using more than one AJP message. Patch provided by Amund Elstad.
bb6aa1a7b6 Update
c3df539364 Back-port unit test for bug 56147
15adf1564e Use varargs
f91d5fbd35 Back-port the remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55483 Handle overloaded constructors. As far as the constructor matching code is concerned, constructors can be treated as methods with a special name. Therefore, refactor the newly enhanced method matching code to handle methods or constructors and then use it to replace the current simplistic constructor matching.
4ca9feb4a7 Back-port the first part of the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55483 This fixes calling overloaded methods and aligns the method matching code in the API and the implementation. Unfortunately, this has required a fair amount of duplication. I don't see a way to avoid this, short of an el-util JAR that both depend on.
c498c4d20b Backport some more EL refactoring in preparation for the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56147 Includes some re-ordering of methods to simplify diff against 8.0.x
687615cbc7 Backport some more EL refactoring in preparation for the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56147
22b7292d08 Backport some EL refactoring in preparation for the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=56147
799e6ae8cf Restore the validateXml option to Jasper that was previously renamed validateTld. Both options are now supported. validateXml controls the validation of web.xml files when Jasper parses them and validateTld controls the validation of *.tld files when Jasper parses them.
9e6e247a79 Update changelog
9be978854d Update tests to check correct handling of all elements added between 2.5 and 3.0.
2d1b3ebdd1 Update tests to check correct handling of all elements added between 2.3 and 2.4.
48e45b4219 Follow up to r1570115 Need to include *.properties as well as *.class
8e21d1705e Simplify patternsets where possible Avoid pattern sets ending in "/*" as much as possible as they usually result in JARs containing empty packages with the contents of the package in a different JAR
3a85097a65 Update tests to check correct handling of all elements added between 2.2 and 2.3.
5c95420609 Add release date for 7.0.52
3c96747500 Make it easier for TomEE to modify the j2seClassLoader
2ca67230e9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56139 Avoid a web application class loader leak in some unit tests when running on Windows.
412c3715d0 Explicitly use the BIO connector in the SSL example in server.xml so it doesn't break if APR is enabled.
33747a402a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56093 Add SSL Valve to docs
f45f08a360 Merged revisions r1568779-r1568780, r1568828 from tomcat/trunk:
cdeec786f3 Backport r1532498, r1532501 from tomcat/trunk: Add support for the following tags to tomcat-docs.xsl style sheet: <version-major /> <version-major-minor /> <download> <security> <doc path="..">
bde662a752 Merged r1568768 from tomcat/trunk: Simplify Windows *.bat files: remove %OS% checks, as current java does not run on ancient non-NT operating systems.
de607a07fd Avoid possible deadlock when one thread tries to close a connection while another thread tries to write to it.
d6b4a54ea5 Clearer error message if we see test failures on Windows due to JVM bug. Fix some IDE warnings.
8df3aeddb3 Correct a typo and add a note that the tests are run with Java 7.
8373cab09e Merged revision(s) 1567993 from tomcat/trunk: Log close code and reason when the Websocket connection is closed.
d77031eebf Prep for next version
f31db2b5b7 Fix a secondary issue identified in https://issues.apache.org/bugzilla/show_bug.cgi?id=56079 Install the service with a single call to the .exe rather than three calls.
e2f556f2cc Tweak error message to show actual file name
a89568eb9b Remove use of optimize flag that has been a NO-OP since Java 1.1
0ebb486949 Additional fixes required to r1567632. Missed due to naming differences between trunk and 7.0.x
3ddc0248a3 In some circumstances asynchronous requests could time out too soon.
32713a61e3 Back-port some refactoring required for an async timeout fix.
8716b9dc4e Backport r1567580 from tomcat/trunk: One more followup to r1567148 Assert that version number of written and re-parsed web.xml is as expected.
96919db54e Mark 7.0.51 as not released based on the vote results.
ebddad90a7 Backport r1567429 from tomcat/trunk: One more followup to r1567148 Assert that version of merged web.xml is dictated by webapp's web.xml file, not by default one.
fa575d0f85 Backport of r1567382, r1567404 from tomcat/trunk: Followup to r1567148 Expand validation tests for merged web.xml: add default conf/web.xml into the merged one.
66d478099e Ensure that a valid root element is generated for the merged web.xml.
a2b0132b7f Prep for next version
ef0ab9df95 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56115 Merged r1566699 from tomcat/trunk: Followup to r1566695 Correct typo
bd8246873b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56115 Expose the httpusecaches property of Ant's get task as some users may need to change the default. Based on a suggestion by Anthony.
b0004da76e Correct the comment
9eba38a4d3 Fix failing test by increasing the time to wait for the socket to close.
586cfb980e Fix regression in previous fix for BZ55996
c0ed3d1c87 Add missing <fix ... /> tag
14ad5bf106 Remove mentioning of TC 6 from docs. Remove doClusterLog and clusterLogName description from cluster docs, those no longer exist.
86c0b57dec Merged revisions r1562458, r1565451 from tomcat/trunk: Provide more info if test fails in access log valve check.
005c651aa7 Merged revisions r1565300-r1565416 from tomcat/trunk: Improve handling of file upload errors. Display a message instead of error 500 page. Simplify parts handling code, as it is known that Tomcat takes care of them when recycling a request.
5794601c15 Fix CVE-2014-0050 DoS with malformed Content-Type header and multipart request processing. Update to latest code (r1565163) from Commons FileUpload
4ae8548ca9 Merged revisions r1562597,r1564742-r1564746 from tomcat/trunk: Make the xmlBlockExternal option in Catalina and Jasper to be true by default.
4fb6534a27 Merged revision 1564461 from tomcat/trunk: According to JavaEE specification (EE.5.4.1.3) when an env entry is specified in the web deployment descriptor and with annotation then the definition in the web deployment descriptor is with priority.
119b57a46c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56096 Merged revisions 1564299, 1564414 from tomcat/trunk: When creating JMXConnectorServer use the correct rmiBindAddress. Patch provided by Jim Talbut.
cdb25103d6 Merged r1564398 from tomcat/trunk: Move class Javadoc to the correct place
b21bbf50fe Merged revisions r1564309, r1564312 from tomcat/trunk: Fix javadoc markup (reviewing r1561778, r1561773). Do not include unrelated text into the value of @version, @param. Fix typo and unclosed <b> tag
7856fb0494 Merged revision 1563989 from tomcat/trunk: Fix typo.
968a4c8a82 Consistent text in rtext
566059b93b Add changelog entry for r1539177 This change was in 7.0.48. https://issues.apache.org/bugzilla/show_bug.cgi?id=55735
841b31667e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56082 Fix thread safety issue in JULI's LogManager implementation
62553e5764 Simplify the code of o.a.c.ha.tcp.SimpleTcpCluster.createManager(String). Remove unnecessary class cast.
cc259ded04 Fix bug handling the Sec-WebSocket-Protocol header returned to the client
f2adcaa257 Forward-port r1561625 from Tomcat 6. This aligns Tomcat 7 with Tomcats 6 and 8 and provides a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55166
10b484b1ed Merged r1561732 from tomcat/trunk: Fix two more errors in jspxml.dtd, found by validating the file in Eclipse IDE. 1. Complained for missing '(' in definition of jsp:text. 2. Element jsp:fallback (mentioned in jsp:plugin) was not defined.
77743b364c Keywords removal in Tomcat 7 is done. Update changelog.
a2b7d1e946 Merged revisions r1561085, r1561093, r1561098, r1561101 from tomcat/trunk: Remove $Id and $Version$ keywords from java files in java/javax/** Remove svn:keywords property from java/javax/**
e18d5f4403 Merged revision r1561094 from tomcat/trunk: Remove SVN $Id keyword and similar constructs for other source code management systems Remove svn:keywords property.
984b83fe15 Merged revisions r1561104, r1561106, r1561116, r1561121-r1561123, r1561126, r1561132-r1561133, r1561135-r1561136, r1561138 from tomcat/trunk: Remove $Id keyword from files in catalina/** Remove svn:keywords property from catalina/** With this all of catalina/** have been processed. With this all of java/org/** have been processed.
ecd38571ca Merged revisions r1561115, r1561131 from tomcat/trunk: Remove $Id keyword from files in catalina/tribes/** Remove svn:keywords property from catalina/tribes/**
5a33a6fd4a Merged revisions r1561114, r1561128 from tomcat/trunk: Remove $Id keyword from files in catalina/ha/** Remove svn:keywords property from catalina/ha/**
6e4ec1a491 Merged revision r1561127 from tomcat/trunk: Remove $Revision keyword from files in catalina/**
2839c54185 Merged r1561140 from tomcat/trunk: Remove svn:keywords property from coyote/** With this all of coyote/** has been processed. (None of the files here contained any keywords).
d267ab42a7 Merged revisions r1561143-r1561146 from tomcat/trunk: Remove $Id keyword from files in org/apache/el/** Remove svn:keywords property from org/apache/el/** With this all of el/** has been processed.
d3a6a664e9 Merged revisions r1561148-r1561151 from tomcat/trunk: Remove $Id and $Revision keywords from files in jasper/** Remove svn:keywords property from jasper/** With this all of jasper/** have been processed.
c4bcaf7bb1 Merged revisions r1561152-r1561157 from tomcat/trunk: Remove $Id and $Revision keywords from files in (juli|naming)/** Remove svn:keywords property from (juli|naming)/** With this all of juli/** and naming/** have been processed.
c7885cce93 Merged revisions r1561180-r1561182 from tomcat/trunk: Remove $Id keyword from all remaining files in tomcat/** Remove svn:keywords property from the rest of files in tomcat/**
4a352fc8fb Merged revisions r1561160-r1561162 from tomcat/trunk: Remove $Id keyword from files in tomcat/jni/** Remove svn:keywords property from tomcat/jni/**
1237dd0aab Merged revisions r1561178-r1561179 from tomcat/trunk: Remove $Id keyword from all remaining files in tomcat/util/** Remove svn:keywords property from the rest of files in tomcat/util/**
b0be599ed2 Merged revisions r1561171-r1561172, r1561175-r1561176 from tomcat/trunk: Remove $Id keyword from files in tomcat/util/(digester|file|modeler)/** Remove svn:keywords property from tomcat/util/(digester|file|modeler)/**
aa88e58968 Merged revisions r1561173-r1561174 from tomcat/trunk: Remove $Id keyword from files in tomcat/util/http/fileupload/** Remove svn:keywords property from tomcat/util/http/fileupload/**
26531f5d09 Merged revisions r1561166-r1561170 from tomcat/trunk: Remove $Id keyword from files in tomcat/util/(buf|codec|collections|descriptor)/** Remove svn:keywords property from tomcat/util/(buf|codec|collections|descriptor)/**
af7b31bc22 Merged revisions r1561164-r1561165 from tomcat/trunk: Remove $Id keyword from files in tomcat/util/bcel/** Remove svn:keywords property from tomcat/util/bcel/**
4204114bb9 Merged r1561054-r1561056 from tomcat/trunk: Remove svn keywords from test/** Remove svn:keywords property from test/**
3bd007ccba Merged r1561640 from tomcat/trunk: Correct typo in definition of default value for contentType attribute of jsp:directive.page element in jspxml Schema and DTD.
45a1eca4db Merged revisions r1561083, r1561635 from tomcat/trunk: Remove svn:mime-type property from *.dtd files. The value was application/xml-dtd.
3346d7643a The type of logger attribute of Context MBean should be not org.apache.commons.logging.Log but org.apache.juli.logging.Log.
5eed4ace6b Merged revisions r1561057-r1561065 from tomcat/trunk: Remove $Id keyword from webapps/** Remove svn:keywords property from webapps/**
d8ff3a9540 Merged revisions r1561067-r1561070 from tomcat/trunk: Remove $Id keyword from res/** Remove svn:keywords property from res/**
112eeca92c Merged revisions r1561074-r1561075 from tomcat/trunk: Remove $Id keyword from conf/** Remove svn:keywords property from conf/**
3ff3dd50ca Merged revisions r1561072-r1561073 from tomcat/trunk: Remove $Id keyword from bin/** Remove svn:keywords property from bin/**
09298099af Merged revisions r1561185-r1561188 from tomcat/trunk:
5fe04fabbe Merged revisions r1561190-r1561192 from tomcat/trunk: Remove $Id keyword from files in /* Remove svn:keywords property on files in /*
d6dc5e2c68 Correct Javadoc
eae0b76415 There is an additional CDDL licensed file in servlet-api.jar as a result of copying the jsp-api schemas
2af3454dd8 Use consistent naming for embedded web-socket JAR
fb6236d3b4 Fix copy/paste error
57a52786e1 Correct issue back-porting fix for bug 56044 Ensure new JARs are published
602ea3136d Package correct license and notice files with embedded JARs.
7cc9817451 Include javax.annotation.sql.* classes in annotations-api.jar
b910c29ad7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56044 Separate out the EL and WebSocket implementations into separate JARs for embedded.
e5efe7644a Update change log
5e9c887ff5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56045 Copy the XML schemas used for validation that are located in jsp-api.jar to servlet-api.jar so that an embedded Tomcat instance can start without Jasper being available. Also enable validation to work without Jasper being available.
c5a9aa622e Align EL variables names with trunk s/tomcat7/tomcat/
729186d436 Merged r1560856 from tomcat/trunk: Replace mailing lists links so that they point to the Mailing List page on the site, so that people have a chance to read instructions there
975dab1434 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56042 If a request in async mode has an error but has already been dispatched don't generate an error page in the ErrorReportValve so the dispatch target can handle it.
0886e38026 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56039 Enable JmxRemoteLifecycleListener to work with SSL. Patch by esengstrom.
0117055b02 Remove unused code
122c96a4f9 Need different value for BIO on 7.0.x as it is the default.
9e778a103b Merging ELParser changes from trunk, to better align TC7 code with trunk here (proposed TC6 patch for BZ 56029 already ports these changes to Tomcat 6)
5f907a5712 Merging ELParser changes from trunk, to better align TC7 code with trunk here (proposed TC6 patch for BZ 56029 already ports these changes to Tomcat 6)
68a67dec8c Merging ELParser changes from trunk, to better align TC7 code with trunk here (proposed TC6 patch for BZ 56029 already ports these changes to Tomcat 6)
bd9d8fb405 Back port unit test fixes / improvements
4e630b3798 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56032 After an IO error sending a WebSocket message, close the connection.
b72242734d Fix line endings
c450bd0819 Further work for https://issues.apache.org/bugzilla/show_bug.cgi?id=56029 Review from kkolinko - Fix bug in parsing functions and whitespace - More efficient resetting of StringBuidler - Use String.substring() for token and whitespace - avoid unnecessary use of trim()
79b83373ee merge fix for potential NPE
4d83edcc3a Additional fix for bug 56029. Now whitespace is not skipped, make sure it is trimmed before the function name is used. Includes a test case based on a jspx file by kkolinko.
c7d2122f09 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55956 Make the forwarded remote IP available on the Manager status page
8c73e99656 Remove unused code
5cdce44082 Fix typo
b91035c5ac Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56021 Make it possible to use the Windows-My keystore that requires keystoreFile="" to be set on the connector.
bf947bcf84 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56013 IBM JRE only understands indefinite lifetime
846c5bf646 Move JVM vendor detection to a global constant. Fix detection of Sun/Oracle JVM that only worked for older Sun branded JVMs.
8327a8d679 Second attempt at fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=56029 This fixes BZ56029 by storing any whitespace before a token with the token and then including it when the expression is re-created. It also fixes an issue with the function parsing that meant that ternary expressions could be corrupted if two tokens were parsed before the mark was reset.
6349e0cd9b Revert changes in r1559401 for this file. The first attempt at a fix introduced a different regression
9a5d4664ed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56012 Imports from unnamed packages are now explicitly illegal
9941090903 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56029 a regression in the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55198 Remove the code to skip whitespace from the 'simple'EL parser. It is far simpler to retain the whitespace than it is to teach this simple parser parser when to insert it. This also has the benefit that the EL should remain unchanged. Add a number of test cases for BZ 56029
a63e635f4f Set svn:eol-style = native
c2826c2713 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55943 Better implementation of the class loader check that prevents web applications from trying to override J2SE implementation classes. Refactor the way a null parent class loader was handled which enables a number of null checks and object creation calls to be removed
cf4cfeb424 Deprecate some code I intend to remove in 8.0.x
ad57dcc17f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56025 Always call ServerEndpointConfig.Configurator.getNegotiatedSubprotocol() CReate the EndPoint instance after calling ServerEndpointConfig.Configurator.modifyHandshake()
4481aa204b Adjust for different directory name in 7.0.x
cdd19bdf7e Correct r1558894 (my error)
fb9821c364 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56016 When loading resources for XML schema validation, take account of the possibility that servlet-api.jar and jsp-api.jar may not be loaded by the same class loader. Patch by Juan Carlos Estibariz.
88edfd5056 Follow-up to r1558814 - include the actual change
c77b8dc57f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=56010 Don't throw an IllegalArgumentException when JspFactory.getPageContext is used with JspWriter.DEFAULT_BUFFER Based on a patch by Eugene Chung. (markt)
d0bb7ea082 Fixed typo reported via users mailing list.
4c28ea95e1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55855 Provide a context level option to exclude container SCIs.
8200f62323 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55287 ServletContainerInitializer in container classloaders may not be found
161d7a87f3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55996 Ensure Async requests timeout correctly.
5edf75cd99 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55986 When forcing Tomcat to stop via "kill -9 $CATALINA_PID", the <code>catalina.sh</code> script could incorrectly report that Tomcat had not yet completely stopped when it had. Based on a patch by jess.
4a8b6eeea3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55743 Enable the stop script to work when the shutdown port is disabled and a PID file is defined.
c42fd88c71 Add release date for 7.0.50
1b5216699f Fix sendfile support on NIO
da0311798e Move fixes to correct section
72a8087378 Preserve the order of reported errors and warnings
80bb56e009 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55960 Improve SSO unit tests Patch by Brian Burch
eff06f720d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55958 Differentiate between foo.war the directory and foo.war the file
5c258ea312 Treat a context path of "/ROOT" as equivalent to "" (i.e. it is treated as the ROOT application). Note that when deploying an application via the manager text interface to /ROOT, it was deployed as the ROOT application but reported that the deployment had failed. It now deploys it as the ROOT application and reports a successful deployment to the context path "/"
018183ce50 Remove capital Omega from end of message
c6b0bc91bf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55888 Clarify that Container elements may only no more than one Realm.
326776063e Merged r1556725 from tomcat/trunk: https://issues.apache.org/bugzilla/show_bug.cgi?id=55671 Followup to r889966: Fix a typo in log messages: genStrAsCharArray init param in Jasper has been renamed to genStringAsCharArray in Tomcat 7.
8d4b714004 Prep for next version
da75a8c5b9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55973 Fix processing of XML schemas when validation is enabled in Jasper.
dbcf5561ca Happy new year 2014.
2740283181 Be more precise about how maxConnections works
002cc6dee8 Clarify based on feedback on users@ list
2a620118cd Remove explicit mergeinfo from the file (Noted when reviewing commit message for r1547931)
5c317b0ad8 Merged r1530426 from tomcat/trunk: Add index.xhtml to the welcome files for the examples webapp It is used by WebSocket (JSR356) Examples.
f9ffff711b Correct a regression in the XML refactoring that meant that errors in TLD files were swallowed.
e8e414915e Add missing tag
1de7c5f568 Avoid possible NPE when no charset is specified
f73596911f Resync filter name with trunk, I suppose it was accidently reverted.
b3e24fe773 JspC passes configuration with ServletContext init params so a real implementation is required.
4520854a15 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55905 Followup to r1552074 Correct message arguments in the Spanish message as well.
c19b6a34f0 Followup to r1552085: correct a typo
e9c9f6f352 Fix broken Javadoc. Add some detail to the deprecation marker
a60841a859 Fix the build - missing opening tag in the changelog.xml.
220b065567 Merged revision 1552080 from tomcat/trunk: Add a link from extras page to download page. Issue is reported via o.a.comments.
9a6e9c0237 Update changelog
d717201fdf Alternative partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55855. Don't do the expensive 'Is this a WebSocket upgrade request check' if no endpoints have been registered Also fix method name typo
07a45b81fb Revert r1551356. Lazy init of WsServerContainer causes problems with Atmosphere that can't easily be avoided.
bfac958163 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55905 Merged revision 1552071 from tomcat/trunk: Prevent NPE when the specified tld resource does not exists.
960fe74ea7 Sync TestWsSubprotocols with trunk to prevent occasional test failures.
63fa4b2cc5 - Add a 100 ms sleep to allow for the server side to   handle the request the client generated before   checking for the side-effects - Clean up subprotocols at end of test to keep   the two tests independent of each other
561c2f9885 Followup to r1551495: Fix typo in changelog.
7f7a0bc9eb Fix occasional test failure.
807190611e Fix typo.
718c2de62c Reduce timing sensitivity of test as some false positives have been observed.
52e857b42e Add time stamp to GET_ALL_SESSION message.
901f0f4e03 Avoid expected warning
bff5e4e642 Avoid NPE on shutdown if application isn't using WebSocket.
6f7f4f13b1 Performance improvement Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55855 Make the adding of the WsFilter lazy so it doesn't get added to web apps that don't need it.
a87ece9350 Need to handle case where message size limits are larger than the default buffer size. (Limits smaller than the buffer size were handled correctly.)
07e2964e21 Better handling if no message handler is configured. Message is just ignored.
201bdcd09f Merged r1550920 from tomcat/trunk: Use existing local variable instead of a getter. Spotted thanks to "manager can be null" IDE warning. No change in functionality.
af817033e4 Merged r1550743 from tomcat/trunk: Fix a find bugs warning about String comparison
ad1363a2ff Followup to r1550720: improve the changelog message.
13fa0c023c Mark 7.0.49 as not released based on the vote results.
e32f138b76 Correct typos
0f418f9fba Fix the sample configuration of StaticMembershipInterceptor in order to prevent warning log. uniqueId must be 16 bytes.
b515abcdbb Fix changelog.
146f927b73 Fix an edge case spotted while testing other functionality. If a context.xml file is added to a DIR it was always ignored. It will now trigger a redeploy.
f4ce7bf4a5 Better message text (reported via users list)
8b485c0747 Revert r1536092: this broke building of the Log4J adapter for our copy of commons-logging.
886888c699 In AbstractReplicatedMap#finalize, remove rpcChannel from channel Listener of group channel before sending MapMessage.MSG_STOP message. This prevent that the node that sent the MapMessage.MSG_STOP by normal shutdown is added to member map again by ping at heartbeat thread in the node that received the MapMessage.MSG_STOP.
c9bd1a31f4 Prep for next version
ef669ef3e7 Merged revision 1549909 from tomcat/trunk: In o.a.tomcat.websocket.server.WsHttpUpgradeHandler.init(WebConnection) if the endpoint is NULL the connection will not be initialized. Then in o.a.tomcat.websocket.server.WsHttpUpgradeHandler.destroy() the connection should be tested for NULL.
cee6baefe8 Update changelog
338b2ba0b0 Mark 7.0.48 as not released based on the vote results.
b23e47d844 Expand validation tests to make sure there are no parsing errors. Fix parsing errors identified by expanded tests.
be176794f2 Prep for next version
cbd7e9c704 Fix Javadoc warning
86e0163fa6 Fix Javadoc
b9e06ead01 Add an option to the Context to control the blocking of XML external entities when parsing XML configuration files and enable this blocking by default when a security manager is used. The block is implemented via a custom resolver to enable the logging of any blocked entities.
72613a0e2f New field can be final Add changelog entry
a91516b80d Improve parsing of trailing headers
9abdcc4d0f Better deprecation message.
7830334f01 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55811 Do not parse web-fragment.xml files when an empty absolute-ordering element is present.
56788745a1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55801 Add the ability to use a custom SSLContext when creating client wss connections. Patch provided by Maciej Lypik.
4040074ac6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55759 Update the Eclipse compiler to 4.3.1.
fff3368472 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55851 Enable SPNEGO to work with IBM JDKs. Based on a patch by Arunav Sanyal.
df94b7f4ab Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55842 Check if the output buffer can grow before flushing it when using a writer.
1cbf183817 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55839 Extend support for digest prefixes {MD5}, {SHA} and {SSHA} to all Realms rather than just the JNDIRealm.
fb2d6ade2f Tab police (thanks Gump)
b7b0444037 Convert JspDocumentParser to an DefaultHandler2
d0823b4bfe Convert ParserUtils to use the new ErrorHandler and EntityResolver
adc7c94629 Switch o.a.catalina classes to use the new ErrorHandler
b9ae5e6693 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55218 and https://issues.apache.org/bugzilla/show_bug.cgi?id=55219 Upgrade digester to use DefaultHandler2 and use LexicalHandler to detect publicId. Simplify web application version detection in web.xml Extracted from a patch by Jeremy Boynes.
23162402b0 Remove tests for test web applications that don't exist in Tomcat 7.
2b563ee937 In Tomcat 7.0.x, resources are still split between servlet and jsp.
394869e44d Back-port the Servlet 2.2 test web app
8249318d68 Back-port the schema validation test case
03a8a8bfa6 Switch o.a.catalina classes to use the new DigesterFactory and LocalResolver
b9d9a32506 Missed a Servlet 3.1 to 3.0 change
0c00357682 Drop the references to the Java EE 7 resources
99485943ed Add the unit test for the LocalResolver
4dab0d069f Add the new descriptor package to the tomcat-util.jar
be9140bb80 Backport the new descriptor package (but not the parsers) to support some refactoring to use the new LocalResolver.
8da9d30121 Merge changes from bcel r1521061-1547757
84b74188ea If ping message fails, prevent the wrong timeout detection of normal member that is no failure members.
5e2c0c6bb7 -When the ping timeouted, make sure that memberDisappeared method is not called by specifying the members that has already been removed. -Add log message of session relocation when member disappeared.
2d6745c052 Correct URL for fragment
a5b84ea584 Got Windows auth working with Tomcat running on a Linux server. Add the details to the docs.
96c4d1114d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55804 If the GSSCredential for the cached principal expires when using SPNEGO authentication, force a re-authentication.
db2f352642 Additional fix required for bug 55799
b80483f9ae Fix NPE reported on users list when HTTP session ends
53444d1c07 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55807 The JSP compiler used a last modified time of -1 for TLDs in JARs expanded in to WEB-INF/classes (IDEs often do this expansion) when creating the dependency list for JSPs that used that TLD. This meant JSPs using that TLD were recompiled on every access.
33efb6e648 Merged r1545863 from tomcat/trunk: Fix Cobertura runs that were broken by r1545075
8726d2e8b4 Merged r1545847 from tomcat/trunk: Mark private fields as final. (Review of r1508200 )
4307283576 Merged r1545832 from tomcat/trunk: Correct a typo in documentation: a network interface name is not a boolean option. (Reviewing r1498342 )
bdf665781d Merged r1545814 from tomcat/trunk: Correct a typo.
8136334073 Merged r1545799 from tomcat/trunk: Review of r1545580 Rephrase the docs.
0b27a21891 Merged r1545750 from tomcat/trunk: Align description of properties of StandardContext in mbeans-descriptors.xml with its Javadoc.
4a6cc82b3c Remove the option to use schema validation for *.jspx and *.tagx files
30ba27864a Remove use of Java 7 class
660031496a Fix regression in fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=55799 that broke stream messages. Add a test case for stream messages.
598d7db968 Expose stateTimestampDrop of org.apache.catalina.ha.session.DeltaManager via JMX.
aabd57e824 Correct the documentation for Cluster manager.
8194392a01 Merged r1545215 from tomcat/trunk: Fix typos
fde3dee374 Merged r1491890 from tomcat/trunk:
c978baf8d2 Merged r1545480 from tomcat/trunk: Correct typo in a message
61c70ea141 Fix bug in r1545481 backport
ff4af6a854 Prevent a web application from deploying if it contains a context.xml, deployXML is false and there is no explicit descriptor as the descriptor may contain necessary security information.
4f6abf947d Correct typo, fix missing '>' in a tag.
7ad8b5f91c Document new attribute
0323a1d287 Backport automatic deployment changes part 21 Review diff with trunk and add missing changes
6df1df9595 Backport automatic deployment changes part 20 Document the expected behaviour
9eee57d432 Backport automatic deployment changes part 19 Add support for a per Context copyXML attribute
80aaddac49 Backport automatic deployment changes part 18 Fix test failures when the file timestamp hadn't moved far enough for the OS to report it as changed.
3c21473dbd Backport automatic deployment changes part 17 Add test cases for failed start when anti-resource locking is in use
1453042ddb Backport automatic deployment changes part 16 Enable remaining tests Fix failures
dc2e024c08 Backport automatic deployment changes part 15 Add test cases for setting unpackWAR on the context
10b44fccec Backport automatic deployment changes part 14 Complete the addition tests
787bf203dd Backport automatic deployment changes part 13 Add dummy reload resources to trigger a reload if a WAR or DIR is added to an XML Add dummy redploy resources to trigger a redeploy if an XML is added to a WAR
799c010510 Backport automatic deployment changes part 12 More tests for addition
389c113907 Backport automatic deployment changes part 11 Start the tests for additions
b431fa0453 Backport automatic deployment changes part 10 Complete tests for modification
0e59f0c40e Backport automatic deployment changes part 9 Add another test
481ccae7a8 Backport automatic deployment changes part 8 Start the modification tests
f1402cdfc5 Backport automatic deployment changes part 8 Complete the deletion tests. Note some tests commenting out pending the back-port of the necessary fixes
19d72b1dd7 Backport automatic deployment changes part 7 More deployment tests
1aa65b71d2 Remove Java 7 dependency
6a20ba18ab Backport automatic deployment changes part 6 Add the first part of the deletion tests for the auto-deployer.
a12196ff53 Backport automatic deployment changes part 5 Complete the implementation of the deployment tests
d915a38e0d Backport automatic deployment changes part 4 Add tests for WAR+XML based deployments.
551a76ef0f Backport automatic deployment changes part 3 Initial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51294 This is an initial implementation that includes some but not all the anticipated test cases. It is expected that as the test cases are expanded, further changes will required.
495d02983c Backport automatic deployment changes part 2 Initial test cases
09dd23990d Backport automatic deployment changes part 1 If the resources fail to start, trigger a LifecycleException to align behaviour with Tomcat 8
5f1e4a75bd Avoid possible NPE
62c1fce60f Fix logic error that meant that unpackWARs was ignored if a WAR failed to deploy (since the Context is an instance of FailedContext in that case)
4bf1dad2e2 Fix trailing whitespace
13a892d4d0 When running under a security manager disabled deployXML by default.
d0223021f9 Merged r1544679 from tomcat/trunk: Fix copy/paste error in log message
7d991226eb Merged r1545082 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Exclude servlet-api and Jetty JARs from Cobertura classpath and thus from the classpath used by our tests. It works without them.
8f96b2be89 Merged r1545078 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Correct typo, add note about licensing
751c935d18 Merged r1545075 from tomcat/trunk: Do not include Cobertura and instrumented classes into the junit classpath, unless Cobertura is enabled.
2480d934e1 Merged r1544472 from tomcat/trunk: Correct typos in javadoc
c513323d09 Switch from ServletContext attribute to init-param. Note that Jasper was incorrectly (now correctly) looking at init-params in some places.
7926542690 Better names
9007ea7070 Better name
1c6f63b446 Better Javadoc
0a7a965413 Use correct attribute for TLD validation. Add missing attribute.
248fa7cf35 With separate .xml validation options no need to spell everything out in xmlValidation
1c1759ba4d Update changelog.
0380d1db17 Follow-up to r1544488 Reviewed by kkolinko
243a057d7c Update docs after deprecation of tldNamespaceAware
ef96f55744 Add command line support for TLD and JSP document validation to JspC
37f107b84f Hook up validate option
411549a4a3 Tomcat 7 has a specific attribute for TLD validation so use it.
53d1522bab Always use a namespace aware parser for TLD files.
a086f0c43c Separate validation of *.jspx and *.tagx files into a new option.
2a6f7fd226 Minor clean-up. Inherit the Javadoc.
a6f99ab481 Better Javadoc
cadfb465fc Protect against NPE.
c0e2226bce Correctly enforce the restriction in JSR356 that no more than one data message may be sent to a remote WebSocket endpoint at a time.
9eb5e3a220 Align the XML parser configuration between the Digester (web.xml, web-fragment.xml, *.tld) and JspDocumentParser (*.jspx, *.tagx)
b67ebdbfa3 Extend the reach of the Context attribute xmlValidation to cover XML parsing by Jasper the JSP engine.
72951843ad Be more explicit about what the xmlNamespaceAware attribute controls
3f37f888c6 Clarify purposes of buffers.
411cd9ad68 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55798 Log an error if the users file can't be found
fffe9f122e Merged r1543383 from tomcat/trunk: Followup to r1456457 Correct typo in the name of a private field
cc53b3dd8e Merged r1542841 from tomcat/trunk: Fix a FindBugs warning. Throw NPE rather than triggering one.
ebe34571d1 Merged r1542769 from tomcat/trunk: Work around false positive test failure
da1a0a0ca8 Update sample Eclipse IDE project: Explicitly use a Java 6 SE JDK. Exclude WebSocket classes that require Java 7 from build path.
6f0a82041e Correct a typo
fc4b3bdd90 Merged r1542856 from tomcat/trunk: Fix a couple of typos and clarify what QOP stands for.
1effb7baaf Fix typo
8ad09c979a Fix typo in new attribute name
b2d25dba56 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55778 Make value used for javax.security.sasl.qop with SPNEGO configurable.
03f480e003 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55772 Ensure that the request and response are recycled after an error during async processing.
b868694c48 Merged revision(s) 1540807 from tomcat/trunk: Only schedule a TimerTask when the first player enters the Room (and cancel it if the last player exits the Room).
9e45901f98 Followup to r1540649: correct a typo
ef75e9556d Merged r1540765 from tomcat/trunk: Correct two typos. s/a users/as users/, /Manager/Host Manager/
a86cd71755 If a request that includes an "Expect: 100-continue" header receives anything other than a 2xx response, close the connection. This protects against mis-behaving clients that may not sent the request body in that case and send the next request instead.
cc175757f1 Add more detail to the security how-to
3f79f79c1d Remove unnecessary setting of property that causes problems whe using SPNEGO with IBM JDKs.
dc243549bb Follow-up to r1540539 after kkolinko review
2d6100ec21 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55749 Improve error message when SSLEngine is disabled in AprLifecycleListener and SSL is configured for an APR/native connector.
2834865cae Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55746 Add documentation for AllRolesMode for CombinedRealm Patch by Cédric Couralet
2b15b380f7 Whitespace police
77ffd65ba9 Various fixes:  - Use Commons DBCP rather than commons-dbcp  - Differentiate between DBCP 1.x and 2.x  - Update for improvements in DBCP (mostly in Pool actually) around synchronization  - Remove stagnant point Reduce line length to aid readability.
bc793066d3 Make the time the internal executor waits for request processing threads to terminate before continuing with the connector stop process configurable.
258558c832 Simplify
d296bd39a0 Remove unnecessary sleep when sending session blocks on session sync phase.
d3e253cbbe Correct stop failure log of cluster. Failure cause is not only Valve.
e05fae957e Fix MBean attribute definition of stateTransfered. The method name is not isStateTransfered() but getStateTransfered().
658df7673f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55735 This fixes a regression caused by the fix to https://issues.apache.org/bugzilla/show_bug.cgi?id=55198 When processing JSP documents, attributes in UninterpretedTag nodes that contain EL should have the the non-EL components XML escaped and the output of the EL components should not be escaped.
799b6923d0 Fix various bugs in Jasper's simplified EL parser and add the test case that found them. This is a precursor to fixing BZ55198 / BZ55735 since that is going to require separating an attribute value into EL and non-EL components
7343491a6b Fix indent
636dfc5f5c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Follow up to r1538534 kkolinko review comments
bc7e5bda1a Merged r1538798 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Do not download Cobertura unless it has been enabled.
a9eae4da43 Merged r1537057 from tomcat/trunk: Review of r1537041: a pair of typos.
359266ba83 Merged revision 1538781 from tomcat/trunk: According to the ServiceLoader specification the name of the provider-configuration file is the fully-qualified binary name of the service's type. In this case instead of javax.websocket.server.ServerEndpointConfig.Configurator the file name should be javax.websocket.server.ServerEndpointConfig$Configurator.
a629c3617c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52323 Add support for code coverage with Cobertura (disabled by default) when running the unit tests
6cdfb6803e Merged revision 1537835 from tomcat/trunk: Close the stream after using it.
d56646e7f6 Fix broken tests
0b33f01e40 Merged revision(s) 1537073 from tomcat/trunk: Only refresh the Display Canvas on a MouseMove event if mouse was inside of the Canvas.
c39ad95e54 Fix markup
f0663b1fcb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55715 Add a per web application executor to the WebSocket implementation and use it for calling SendHandler.onResult() when there is a chance that the current thread also initiated the write
ad698a9ee5 Remove unnecessary attributes of stateTransferCreateSendTime and receiverQueue from cluster manager template. These attributes should not be defined as a template.
33467df0bd Simplify the code of DeltaManager#startInternal(). Reduce unnecessary nesting for acquisition of cluster instance.
b26ba540eb Merged revision(s) 1536850, 1536852 from tomcat/trunk: Follow-Up to r1536834: Use correct order of initialization methods.
47b4be1f47 Merged revision(s) 1536834, 1536848 from tomcat/trunk: - Add mouse events to the document object so that the canvas correctly gets notified by MouseUp/MouseMove events even if the mouse cursor is outside of the canvas. - Add a description of to the Drawboard page.
357efc6387 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55703 Clarify role of singleton attribute for JNDI factories
7f4fd24062 Update changelog
08fc779179 This is Tomcat 7 so need to define a 3.0 not a 3.1 fragment
e5f470a246 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55684 Log a warning but continue if the memory leak detection code is unable to access all threads.
482e10b4f1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55691 ArrayELResolver needs to handle the case where the base object is an array of primitives.
d95fc3aac4 Provide modifyHandshake() with a per session (i.e. per connection) view of the user properties rather than a per endpoint view (that would be shared will all connections to that endpoint). This allows for easier configuration of per connection properties from within modifyHandshake()
742b46a674 Use application class loader when calling ReadListener and WriteListener methods
c5176623cd Build javadoc with java 7
0a8b482d3e Update the documentation with information for WebSocket 1.0 specification and javadoc.
27c258c88a Updated RELEASE-NOTES with bundled APIs available in a standard Tomcat installation.
11c05d359d Update Changelog.
34331391a3 Keep using older versions of Log4J and Avalon: - They are only used to build commons-logging against them,   we don't ship them - commons-logging is still fine with building against   the older versions - we don't want to risk forcing people to upgrade their   Log4J or Avalon versions without good reasons.
9cd1ef4cb0 1) Update to Commons Logging 1.1.2
6925f9562a Add Mladen's code signing key, the one that he added to /tomcat-7/KEYS file in the dist repository in r1387 (2013-02-12).
9c5b4e424c Fix the unexpected closure issues with APR/native, SSL and the drawboard example
9bd1d2160c Improve debug logging of SocketWrapper that just uses toString()
491932f40b Add wrapper information to error message
ca42fd11ac Remove socket from list of connections as soon as we know it is going to be closed.
33c9a4241f Check for closed sockets earlier and reduce code duplication.
b9b91b99f5 Revert the swallowing of the Status.APR_EGENERAL. It can't be the SSL handshake failing as that has to have completed for the code to get this far and it appears to be related (the same?) as the random closes when using the drawing board example.
768d1c97c3 Add release date for 7.0.47
d634d8e2e2 Update spec version and section number when rejecting a JAR file based upon pre-defined list of trigger-classes.
d7f621f067 Add to cluster document a description of notifyLifecycleListenerOnFailure and heartbeatBackgroundEnabled.
9e010b1fc1 Add subsection name.
8a81d21386 Add a description of the side effects of r1534575.
0c6fda4cc8 Add mergeinfo.
e6aba59507 Merged revision(s) 1534846 from tomcat/trunk: - Prevent recursive invocation of Runnables by Room.invokeAndWait() to prevent errors like ConcurrentModificationException when Room.broadcastRoomMessage() iterates over an ArrayList and then calls Room.invokeAndWait() recursivly, iterating again over the array. - Add comment about blocking Session.close() method.
0b27cad015 Add some timouts rather for IO operations while establishing a WebSocket client connection.
b3d32292cf Document client side SSL config
e0aa7a8be4 The logger of AbstractReplicatedMap should be non-static in order to enable logging of each application.
21dd73fc38 Merged revision 1534418 from tomcat/trunk: Removed the extra line-ending information in the files.
428bd06bf4 Add log message that initialization of AbstractReplicatedMap has been completed.
7576c52d20 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55681 Pass the session to the Pojo MessageHandler wrappers so it is passed in to the MessageHandler method calls.
64523f8246 Handle arrays of generic types in encoders, decoders and MessageHandlers.
d2041c8eff Javadoc fixes.
a15793106d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55663 Notice files are corrected according to http://www.apache.org/legal/src-headers.html#notice
171ccc59c7 Prep for next version
d1404944ff Provide credit for the test case.
3afc5f4c67 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55664 Correctly handle Encoder, Decoder and MessageHandler implementations that use a generic type such as Encoder.Text<List<String>>
0523fa3749 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55663 Merged revision 1533312 from tomcat/trunk: Notice files are corrected according to http://www.apache.org/legal/src-headers.html#notice
8817badb2b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55656 Configure the Digester to use the server class loader when parsing server.xml rather than the class loader that loaded StandardServer. Patch provided by Roberto Benedetti.
1989bde0bb Prep for 7.0.47 version
3dec03e7a1 Use lazy init for the room in the WebSocket drawing board example. This is primarily to avoid an issue with a hang on Java 6 in Tomcat 7 (the JSR-356 examples require Java 6) but may also help with adding multiple room support.
da63cb03b4 Revert r1533035. A better solution is required.
bd62292413 Require 1.1.29 as a minimum
7248d8bd69 Avoid hangs on shutdown
b181b205d0 Changelog for r1533016
f0a0653111 Revert r1516411 which was soem code clean-up that broke the old WebSocket implementation for NIO and APR
ae61e2f531 Fix broken link
7c006c62a6 Merged revision(s) 1532765-1532766 from tomcat/trunk: Restore the ServletContextListener for the Drawboard example to be able to shutdown the Room (dispose of Graphics2D) when the Context is destroyed.
9e0d2561ba Don't call the onError() method of the endpoint if the WebSocket close message cannot be sent for abnormal closure as this is not unexpected.
03a0d9ed15 Handle the client dropping the connection during the SSL handshake in the same way as it is handled at any other time.
03d819bcdf Include socket reference in IOExceptions to make debugging easier
34c2400dbb Add a debug message that enables the socket reference (used in most debug messages) to be matched to the port number (used in tcpdump) to enable unusual behaviour in the debug logs to be easily matched to the corresponding network activity.
6d4587cb57 Add a flag to the SocketWrapper to indicate if the socket is using a secure connection. Initially this is intended for use with the APR connector to better determine what various error codes may mean.
2828734bdd Merged revision(s) 1532627 from tomcat/trunk: Prevent default mouse event on Canvas element to prevent browsers from marking text (and Chrome from displaying the "text" cursor).
6a49752870 Merged revision(s) 1532622 from tomcat/trunk: Show crosshair cursor on the canvas. This still needs a workaround for Chrome.
b297c3df64 Fix Gump failures when the SCI scan finds too many classes.
bf22ec0cdd Fix WebSocket when running under a security manager
1c6207574f Add xhtml file extension to list of text file types
b8208eae5d Merged revision(s) 1532437 from tomcat/trunk: - Do not use a extra Thread for the room as synchronizing access to the Room's internals should suffice.
78b25852e1 Use correct limits when writing SSL data
bc9fefb2c7 Refactor WebSocket examples to only require the SCI
abfda53f51 Merged revision 1532269 from tomcat/trunk: Fixed typo. Issue is reported via o.a.comments.
d0204c8916 Merged revision 1532036 from tomcat/trunk: Update to APR/native connector version 1.1.29
294ca67e57 Revert r1531680 to prevent CI failures and to prevent the Examples webapp from failing to start when running Tomcat 7 with Java 6.
4439faa7e2 Allow the JSR 356 WebSocket examples using the programmatic API (Endpoint subclasses) to work as they use a ServletContextListener that has @WebListener annotation, which would not be called with metadata-complete="true".
54c5b399d7 Update some comments.
e981015073 - Link to correct location of Tomcat7's WebSocket examples. - The examples using the deprecated API have been restored as of r1525279 so link to them (in trunk) instead of the 7.0.42 tag.
67eb68fcd7 Follow-Up to r1531276: Merge changes for index.html from r1524838.
c960b39863 Align the drawing style in Java2D with the one in HTML5 Canvas.
844e6cc00f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55639 Merged revisions r1530296, r1530298, r1530325, r1530342, r1530348, r1530353, r1530791, r1530822, r1530989, r1531130, r1531138, r1531156, r1531161, r1531271 from trunk: Add a Drawboard WebSocket example.
f29db3c8e2 Remove "svn:merginfo" property
4d02bc4bc2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55383 Merged revisions 1524838,1526510 from trunk: Improve markup for examples (part 1)
5cd47a1067 Fix a bug introduced in r1357039 that removed a local close variable which mean that code that should of triggered a socket close, ended up closing the Poller as well.
2568be69ad Merged revision 1530909 from tomcat/trunk: The link to the Manager App How To was missing. Issue was reported via o.a.comments.
284db853b4 Merged revision 1530875 from tomcat/trunk: The link under Tomcat Context Descriptor section should point to documentation about context.xml and not the one for server.xml. Issue is reported via o.a.comments.
59c359086f Avoid stacktrace in logs if the session closes due to an IO error in the middle of sending a partial message.
f68622049b Forgot to back-port the change in webapp location. Remove the debug code.
846f03d53e Correct logic error in Node.isLiteral() that was returning the inverse of the desired result when the value was an EL expression.
257270740a Fix issue observed with APR, WebSocket and blocking messages. If one client freezes the system freezes once the network buffers are full. When the client unfroze, the backlog of traffic was cleared and then one or more connections were closed unexpectedly. This was caused by incorrectly setting a very short timeout when readding the socket to the Poller after only a subset of the registered events triggered.
18b9782ac2 Handle write errors when the client drops the connection in the same way read errors are handled.
4653d8bf2c Fix infinite loop issue triggered by the test case for BZ 55638
d36abb3adf Clear the handler then close the connection so the handler gets to the the exception that caused the problem rather than any exception that may happen during close.
03271c3d34 Move comment to go with code that was moved earlier
cf319b761d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55638 Fix the corruption of large WebSocket messages when using the NIO connector.
118f6cc1eb Extend the test case to cover RequestProcessors
be9434e521 Fix an intermittent failure with TestWebappClassLoaderExecutorMemoryLeak. If the executor threads did not stop quickly enough, Thread.stop() was used. Sometimes this resulted in the executor not shutting down and the test failing. This makes using clearReferencesStopThreads marginally safer.
3e4117e807 If the browser crashes or a similar event occurs writing messages will start failing. Rather than ignoring these failures, close the session.
f4bfc09a15 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55633 for APR. If the socket was registered for read and write and only one occurred, the registration for the other event was lost. Ensure that the socket is re-registered with the Poller when necessary.
6926f6e4b4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55633 for NIO. The Comet code that ensured that multiple threads didn't process the same socket when the selector indicated that a socket was ready for read and write pre-dated r1001698 where syncs where added to the SocketProcessor to achieve the same aim for Servlet 3.0 asyncs processing. The Comet code was re-used to handle upgraded connections. The upgrade code did not handle the case where a socket was registered for read and write but only a write event occurred. In this case the read registration was lost. This is the root cause of the lack of responsiveness observed in bug 55633. With the changes in r1001698, a simpler solution can be used for both Comet and HTTP upgrade. The new approach unregisters the socket operations the selector has reported ready for and then triggers a read and/or write as appropriate. For Comet the syncs will ensure that read and write aren't processed in parallel. For HTTP upgrade such parallel processing is permitted.
9181c19b3c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55629 Merged revision 1529787 from tomcat/trunk: Remove JMX notification listener when destroying servlet o.a.catalina.manager.StatusManagerServlet
2471c8c550 Partial fix for re-opened https://issues.apache.org/bugzilla/show_bug.cgi?id=49134 Ensure nested realms are correctly destroyed, ensuring that the associated MBeans are deregistered.
79b65f49cf Expand note in docs regarding use of sessionCookiePath="/".
e0ea2ad76e Revert r1529150 as it triggers unit test failures. It needs more thought.
8d032a600a Re-check error state after service method regardless of keep-alive to ensure unused input is not swallowed on error. This allows the socket to be closed as quickly as possible.
d569c589f8 Only send a close message on an IOException if the client has not yet received a close control message from the server as the IOException may be in response to the client continuing to send a message after the server sent a close control message. This change is in response to an observed failure in the unit tests.
ddf25184e0 Deprecate unused expireSessionsOnShutdown attribute.
ab03733b96 Handle Windows specific error code for connection abort
04937367e3 Errors need to be propagated for upgraded connections
f946344846 IOExceptions need to trigger the closing of the WebSocket connection.
6677a5b2a8 Move comments as they are being associated with the wrong values.
4501655c7c Swallow exception when writing to a closed client
a665a55f3a Handle error when user closes browser while playing snake game.
0ade585b1b Ensure that the Poller actions socket close requests ASAP
e73a201aa6 Fix broken link to "ServletToJsp.java.html" - it is generated by Ant txt2html task.
1f3d5a6cf8 More debug logging for the APR/native connector.
458d1e324e Address issue reported with high CPU usage under low load load.
298b08cc71 If there are sockets to close, close them rather than waiting for the next Poller run.
62ee96e6e6 Ensure that connectionCount remains thread-safe
f012316dc1 Better log message for socket destruction and remove reference to deleted parameter
e0bea4df23 Update changelog
04d714d028 Switch to destroySocket in a few places where it is safe to do so.
0563901551 Refactor the method names some more.
91e3c4b6cf Add a warning comment and simplify the code a little.
876c8df7fb Refactor the remove list in the Poller to be a close list. The poller now removes the socket if it is in the Poller then destroys it. Note the socket is always destroyed whether it is found in the Poller or not.
c56d2c6a98 Rename method
0d28a3716c Move the point where the socket is removed from the connections Map so all the actions apart from removal from the Poller are in a single method to facilitate refactoring removal of the socket from the Poller.
ce14c5f53c Better debug messages
ba22b5c0f8 Add missing bracket
77dea2d1e4 Fix copy/paste error
040d390fb9 Add document for sessionIdAttribute attribute in JvmRouteBinderValve.
ae2e9c56e1 Removal of a socket from the poller needs to happen on the poller thread as removal, like addition, is not thread safe. Removal of a socket from the poller needs to remove the socket from the addListif it is present otherwise the closed socket could end up in the poller.
a73f238ec3 Narrow scope of localAddList
536648cc8c Mark 7.0.45 as not released based on the vote results.
febccf71d1 Fix broken link to HTTP connector in the Proxy HowTo, as reported on the users list.
50be7b9f13 Fix broken link to comments.html page when the directory of the docs is not "tomcat-x.x-doc", as reported on the users list.
7329d52b3e Correct the javadoc for Lifecycle interface.
286d275051 Add support for notify periodic event of cluster.
52b490add9 Prep for next version
7e1ffadfbf Checkstyle: spaces should be used instead of tabs.
b8834f7d43 Mark 7.0.44 as not released based on the vote results.
e9d1a11c1b Add the Tomcat 7 WebSocket impl JAR to the maven upload script
4e2701ef8f Correct reference to name of Tomcat 7 WebSocket implementation source JAR
cb17a96d49 Fix issue with unwrapping. Cast needs to use the unwrapped request object.
e5a1fb13aa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55576 Preserve the order that request parameters were presented by the client.
1343d56a7d Logger instance of cluster session manager is changed to non-static in order to enable logging of each application.
80a2beb405 Prep for next version
44feef58d8 https://issues.apache.org/bugzilla/show_bug.cgi?id=55582 Correct concurrency issue that can result in two instances of JspServletWrapper being created for one tag. Patch provided by Sheldon Shao.
a4132df9e6 ServerContainerProvider was removed from JSR-356
ed396ea342 Mark 7.0.43 as not released based on the vote results.
fc033e99fc Restore Tomcat 7 WebSocket examples. The examples and the code is marked as deprecated.
3f493150db Fix typo
ffc819cad5 Improve message when JSR356 support not available
0df80616f6 Remove empty tree
2615e863a0 Remove files accidentally added in r1524763
2a48a2f65a Prep for next version
9b249f7c45 Adding code signing key.
3e3ad345f1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55570 Correct log exceptions so they appear in the logs
05f2fb3c9a More robust solution to the problem of blocking writes not be closed when the web application stops. Futures used for blocking writes are registered with the session and the session completes them with an exception if they are outstanding when the session closes.
fc99305121 Revert addition of closing flag on wrapper. A more robust solution is required.
f2f3ca164f Extract FutureToSendHandler to a separate file
148023e9d3 WsListener->WsContextListener to more clearly differentiate between it and WsSessionListener
10bccd1827 Rename method for clarity
8c9a1d76dc Use the intended (based on the changes to the policy file) name for the new system property.
08875ce68d Fix code style. Add stderr log source (class/method). Add catalina.policy entry for new system property.
2969e602fd Avoid possible poller error with sendfile
8c57791bb5 Improve handling of situation where socket / connector closes down while an application thread is using the socket. This ismost likely to occur with upgraded connections that use concurrent read/write (e.g. WebSocket)
05eb4148eb Merged revision 1523958 from tomcat/trunk: Fixed realm documentation - the number of the standard o.a.catalina.Realm implementations provided by Tomcat was not correct. Issue was reported through comments.apache.org.
e7b6386411 Fix logic where sendfile thread could get stuck in infinite loop on connector stop.
d2eb65641d Fix logic where poller thread could get stuck in infinite loop on connector stop.
246f0db62a Avoid possible NPE during shutdown.
aae6aa0f05 Fix error showing in unit tests when socket is closed while still in poller. This happened after a web-socket timeout.
a7a309bcb8 Fixed inadvertently-added </code> element that broke XML.
06327a6db3 Added logging of logging.properties location when system property is set.
11b5756507 Update to APR/native connector version 1.1.28 that includes a necessary fix for WebSocket and Servlet 3.1 non-blocking IO. Also update the minimum required version to 1.1.28
2d32fea5ea The loaded attribute never exists in PersistentManager. isLoaded is defined as operation in mbeans-descriptors.
ccc2e979f8 Ensure that only the web socket implementation classes are compiled with Java 7. This is done by making sure everything else is compiled first with Java 6.
c52eb72ad2 Remove Java 7 dependency that was missed in back-port
710862038a If both the input and output buffers are exhausted at the same time, return UNDERFLOW as more input data would be required to trigger OVERFLOW.
cc337635cc Put a limit on the number of Locale to StringManager mappings that will be cached.
7a8ae49bab When less than 127, no need to convert to unsigned.
56f70bbcaf Profiling indicates that UTF-8 encoding is the bottleneck. Harmony's encoder is slightly faster than Java 7's so use Harmony's.
71f3b7a8bf Improve performance of unit tests and hopefully fix intermittent unit test failure.
bed3a1a0d0 Add support for limiting the size of chunk extensions when using chunked encoding
c51c7a14ab Performance tuning after analysis with Yourkit Use bulk write for the payload rather than a loop when there is no mask to apply (i.e. on the client side).
bbacfadb01 Update changelog.
41b90b6ebc Better adherence to RFC2616 for content-length headers
8f24dc0bb6 Merged r1521687 from tomcat/trunk: Followup to r1514376. Use value from local variable instead of repeating a method call.
91b76b56be Fix circular logic as per rjung's suggestion
deea4d2960 UriTemplate should not trigger failures for '/' for for instances used for matching that end in '/'
7ad7306674 Update based on the WS EG discussions around some edge cases. Note that some of these will never happen in practise as Tomcat will have normalized the URI.
212e3830ae Sync bcel, codec and fileupload  - one minor API change in fileupload
572332c951 Fix a couple of Javadoc warnings
41c56b528e Fix (remove) references that don't apply to Tomcat's fork of the file upload code.
115bbcc006 Fix typo
062b285038 Fix checkstyle failures  - no License header  - invalid (old JUnit) imports  - trailing whitespace  - missing @Overrides
c07061e1b2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55534 Update for Commons Annotations 1.1
aa8b4a7173 Preparation for fixing BZ 55534 Add @since markers for common annotations Fix a few spec non-compliance issues  - Generated#comment -> commnets  - DenyAll is permitted on classes
d35c6d3f94 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54693. - Add a validationQueryTimeout property - Avoid NPE caused by createConnection(..) returns null. (see Comment 6)
3d93dd972e Don't register the ReadListener until after onOpen has completed as MessageHandler instances are likely to be registered during onOpen. This prevents incoming messages from being processed until the onOpen event completes.
857a9c0f01 Prevent problems if the message handlers are updated in the middle of handling a message spread across multiple frames. The entire message will be handled by the message handler in force at the start of the message.
ececa81552 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55521 Ensure that session.expire() doesn't return until the session has been invalidated. Ensure that the return valid of session.isValid() is consistent the current state.
db9b403d48 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55524 Refactor to avoid a deadlock. Move the exception handling that may execute user code outside of the sync block.
98b880d2c9 Fix mbeans-descriptors.xml of DataSource. Add undefined attributes and operations to mbeans-descriptor.
6a2f8288ed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55343 Add flag to ignore error of connection creation while initializing the pool.
f9961a115f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55342 Remove unnecessary reset of interrupted flag. If the InterruptedException is thrown, the interrupted flag has been cleared.
c525c58a5a Correct several incorrect formats of JdkLoggerFormatter. -Remove duplicate spaces in front of log level. -Add a space between logger name and message. -use system property.
9b19e72ff9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55500 Ensure async timeout is applied when using Servlet 3.0 async with the AJP NIO connector.
d9cf41e6a8 More definite thread name for MessageDispatch15Interceptor.
5344a9c998 Add document for org.apache.catalina.tribes.group.GroupChannel.
6bf6933a8d Fix back-ported test. Webapp location in 7.0.x is slightly different.
77b165353a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55494 Reduce log level of exception messages that are logged for re-tries. Make clear in the message that a retry is taking place.
5cca62de56 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55453 Do not return a response body for those status codes and request methods that do not permit one.
4862b560b2 Fix comment
d0b3e252eb Content length is managed internally as a long. Fix a few places that were unnecessarily restricting it to an int.
edb8ced932 Fix import order
5e9169b3d1 Extend the AJP test client to support methods other than GET and implement a simple POST test.
cf1566d187 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51526 Added missing test resources.
091483684f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51526 Merged revision 1517941 from tomcat/trunk: o.a.catalina.startup.Tomcat.addWebapp(...) will process web application's context.xml when it is presented in the provided baseDir.
03d198f860 Merged revision 1517536 from tomcat/trunk: javax.el.BeanELResolver: - getFeatureDescriptors, getCommonPropertyType do not throw NPE when the supplied context is null. - unit test is added
e2d8eec4ec Add the WebSocket changes to the changelog.
dfd1d6268e Add note on WebSocket 1.0 requiring Java 7.
7e8344c802 Hopefully fix some intermittent unit test failures in buildbot
d88e27af55 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55469 Merged revision 1516710 from tomcat/trunk: tr and td tags for UPLOAD_SECTION were not properly closed
87499dcfeb Back-port APR/native changes required to support JSR-356 Significant changes are: - Switch to a single Poller with multiple Pollsets - Enable HTTP upgrade connections to use concurrent read/write - Lots of refactoring and clean-up
4b17f1ea89 Ensure destroy() method of upgrade handler is called
e66e34cbd6 Ensure that HTTP upgrade responses are flushed as the normal code path for this is bypassed when using HTTP upgrade.
70b47aca12 Change the way max concurrent connections are counted in the test to avoid the intermittent failures observed with the previous method.
a538412f77 Backport Remove unnecessary code
8f529e5a51 Fix some NPEs observed while investigating some unit test failures.
1d356fa2e4 Fix comment typo
34119edf45 Back-port NIO endpoint changes required to support concurrent read/write for JSR-356 upgraded connections
72a440f2bd Fix an issue highlighted when running the Autobahn test suite on Linux. Don't register the socket for a read when a write event completes (may lead to thread starvation)
391347f515 It is the socket that is the key for the connections map, not the processor Align debug message with trunk code
2268a4b2d7 Refactor connections as upgraded connections will need to support multiple threads processing the same connection
a8a5097964 Add a debug message I found useful when trying to track down a WebSocket issue
8005cb5c50 Use a common wait time on the server and the client. This fixes an exception observed on some platforms with 7.0.x that distracted from the root cause of the test failure.
5164be20ad WebSocket API has neither SCIs nor TLDs WebSocket Impl has no TLDs
5f411ca4cd Silence some TLD warnings when running unit tests
a671ff1978 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1516119 13f79535-47bb-0310-9956-ffa450edef68
4e9ca938fb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55439 Don't try a forced stop (kill -9 $PID) if Tomcat has already been stopped and the PID file cleared else a bunch of errors will result. Additionally, improve handling in a forced stop of situation when the PID file can be written to  but not deleted.
6668a2e3e0 Remove duplicate test
e41b289272 Missed renaming the fileset for the JSR-356 WebSocket implementation in one location.
f72a31bbe9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55454 Merged revision 1515841 from tomcat/trunk: Fixed NPE thrown when parsing an invalid content type.
b7afc48736 Deprecate the Tomcat 7 proprietary WebSocket API
13318bde07 Move the JSR-356 WebSocket API and implementation to the main code location. Update the build to build the JSR-356 WebSocket implementation with Java 7. Switch the WebSocket examples to use the JSR-356 implementation. Remove any Java 7 language features (<>, multi-catch).
6b2ffbc909 Deprecate an unused class
3ab86f77b8 Fix some Javadoc errors
c8acdc45b3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55434 Ensure only duplicate parameters rather than duplicate segments trigger an error.
f5dbdae4c9 Fix unit test failures after changes to SSL tests to use class loader to locate resources.
64ad7f841b Ignore output dir
b25f826190 Remove remaining uses of Java 7 from implementation code
e5e8af7bba Merge generics updates from Tomcat 8
dc4219f65c Remove most uses of Java 7 from implementation code
ef7e0f7f17 Remove use of Java 7 from test code
b33a169007 Back-porting JSR-356 Obtain absolute paths for SSL keystores etc. via the class loader rather than relying on using the current working directory.
eeb3c6a646 Obtain absolute paths for SSL keystores etc. via the class loader rather than relying on using the current working directory.
75db8aaf30 Back-porting JSR-356 WebSocket unit tests need a couple of features to be implemented (or at least not throw an exception)
07cb3d8676 Need to cast to the Facade
1d7d250b01 Back-porting JSR-356 Add some necessary plumbing for Servlet 3.1 based HTTP upgrade
355209bc1a Back-porting JSR-356 RequestFacade needs upgrade method too.
f2eaada049 Back-porting JSR-356 Add upgraded flag to SocketWrapper
3b1ef5cb01 Back-porting JSR-356 Some renaming and refactoring to make it easier to port other changes.
bbb2400bd9 Back-porting JSR-356 Rename SocketState.UPGRADING -> SocketStatus.UPGRADING_TOMCAT to indicate a Tomcat proprietary HTTP upgrade is in progress Add SocketStatus.UPGRADING to indicate a Servlet 3.1 style HTTP upgrade is in progress.
84cb180e79 Back-porting JSR-356 Need to cast to Tomcat's request object to access upgrade method
ddd45b6dce Fix unit test failures.
64094f9532 Back-porting JSR-356 Switch to the AbstractServlet[In|Out]putStream implementations as they have the new Servlet 3.1 methods required that aren't part of the Servlet 3.0 API present in Tomcat 7. For the same reason, point to the relocated ReadLister, WriterListener, HttpUpgradeHandler and WebConnection interfaces.
c7318ebfe2 Back-porting JSR-356 Add the Servlet 3.1 based HTTP upgrade mechanism. The aim at this point is to enable the back-ported JSR-356 code to compile. I'm not worried (right now) about whether the added code works or not as long as it doesn't break any existing Tomcat 7 functionality.
84ce8599d2 Back-porting JSR-356 Add InstanceManager to Context interface. This is required by the Servlet 3.1 based upgrade mechanism.
efaa20dcce Back-porting JSR-356 Rename ActionCode.UPGRADE to ActionCode.UPGRADE_TOMCAT to mark this as the Tomcat proprietary upgrade mechanism. Add a new ActionCode.UPGRADE action for the Servlet 3.1 based upgrade mechanism.
440f37bcdd Back-porting JSR-356 Old and new upgrade mechanisms have a isUpgrade() method on the processor and they need to be differentiated. Calls to the old version can easily be replaced so do so.
5e4c14bc97 Back-porting JSR-356 Need to be able to register sockets for read and/or write for the APR/native Poller to implement non-blocking IO
2e2ee5e20f Back-porting JSR-356 Add the locks to the SocketWrapper required to implement non-blocking IO
e758ee0ca6 Back-porting JSR-356 Rename SocketStatus.OPEN -> SocketStatus.OPEN_READ Add SocketStatus.OPEN_WRITE Required by the changes to implement non-blocking IO.
05bf2ef502 Back-porting JSR-356 Coyote has new dependency on Servlet API because upgrade mechanism uses Servlet[In|Out]putStream.
cfaf49bee6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55354 Merged revision 1514470 from tomcat/trunk: Restore the context environment parameters after associating the Principle with the given user. Based on patch provided by Richard Begg.
4e8582ed4a Start with the easy compilation fixes. Tomcat 7 hasn't refactored web.xml parsing so change ApplicationListener import to pre-refactoring location.
1b31f4719b Ignore some Eclipse files
e9678681f6 Make method public so WebSocket module can use it
9dda880dfa Copy JSR-356 WebSocket API and implementation from trunk into new Tomcat 7 module
af8ff92b22 Add structure to receive WebSocket backport from trunk
df1a122b7c Revert 1514505. On reflection, an svn copy is a better way to do this as it makes the history easier to read.
0c56b4bdfb Start to back-port JSR-356 implementation to 7.0.x
e0a7ac1e8b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55399 Have the message in the response line use the locale set for the response.
02359aab17 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55357 Merged revision 1514281 from tomcat/trunk: Set the web app classloader as a context classloader before reading the object data.
ce5b4fe6cf Fix issue reported on users list. Because the default bundle reports as the ROOT locale rather than as ENGLISH, the request locale to resource bundle mapping failed.
e785ce0bcb revert r1513714
c8e9431e1a Deprecate TldConfig and TLD-related properties of Context as they have been removed in Tomcat 8.0.x where TLD processing is handled by Jasper.
70fcab1c09 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55404 Log warnings as warnings
5b44065b3c Switch from ignoring unavoidable generics warnings in Eclipse to explicitly using @SuppressWarnings Fix a few other warnings (e.g. auto-boxing) also spotted
9de36eaf6b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45428 Trigger a thread dump to aid diagnostics if Tomcat fails to stop in a timely manner.
681abecd38 When using a security manager always use the same method inside the doPrivileged call as triggered the call.
cf9d1f263b No functional change. Fix long lines.
b6973690b4 Remove experimental label from AJP NIO connector.
d876edb24c Improve error message
74c8c3e6ec Fix copy/paste error
731cf65424 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55336 Correctly quote parameters passed to eval
034b76b17b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55333 Correct regression in fix for bug 55071. Don't commit the connection until after the ResultSet has been used.
fb500c50c4 Remove trailing whitespace
df8d0e6a67 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55331 A dispatch to an async servlet during the onTimeout method of an async listener should not trigger an ISE.
3873dc73dd Fix NPE in FileMessageFactory.main when specify empty file as arguments.
b947c46a70 Fix javadoc formatting typo
ed5cff46c8 The contextClass attribute of HostConfig refers to the value of the contextClass attribute of Host.
f4218d80d4 Remove odd space. Reflow.
cf49805999 NIO endpoint should not be swallowing Virtual machine errors
e8e2ee0b68 Add @Deprecated.
17dffe0b4e git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1508339 13f79535-47bb-0310-9956-ffa450edef68
dd849f1be1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55309 Fix concurrency issue in TagPluginManager PageInfo should not be a field as it is per page and there will be conflicts with concurrent compilations. Patch provided by Sheldon Shao.
3b92561253 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55297 Look in CATALINA_HOME for jsvc if it isn't specified and isn't found in CATALINA_BASE
4fbd484d41 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1507053 13f79535-47bb-0310-9956-ffa450edef68
e67c50857b Merge latest changes from Commons BCEL
88a88bbdf0 Fix IllegalArgumentException thrown by simple test for McastService.
6f7d6fbea7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55267 Separate read and write timeout for NIO and ensure that the write timeout is always the connection timeout configured in the connector. This prevents long Comet timeouts (which are intended for read operations) being used for writes which - particularly in error conditions - can cause long delays. Since only NIO supports comet timeouts this change is only required in NIO.
92ad4f8c37 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55268 - Replaced uses of "test -z" with "test "$FOO" = ." for better shell compatibility.
bcc0f6b79a Avoid NPE. If the channel fails to start, localMember is null.
df8787119f Avoid ConcurrentModificationException when sending a heartbeat.
740a3b5a49 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55268
7751c9e6e4 Expose the current connection count over JMX
09d17476a0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55228 Allow applications to set the Date header.
dbc1541522 Confirm proxy resources are not cached when context has caching disabled.
78b0670bf2 Fix typo
8368f6e1e0 Merged revision 1501910 from tomcat/trunk: javax.el.ArrayELResolver: According to javadoc: 1. getFeatureDescriptors - always returns null 2. isReadOnly - when property cannot be coerced into an integer it is ignored by the resolver. 3. getType - when property cannot be coerced into an integer it is ignored by the resolver. Unit tests are added
edc8e9fdda Merged revision 1501823 from tomcat/trunk: javax.el.ListELResolver: According to javadoc: 1. getFeatureDescriptors - always returns null 2. isReadOnly - when property cannot be coerced into an integer it is ignored by the resolver. Unit tests are added
83d6ea2eb1 Ensure the log4j v2 jars are scanned Patch provided by Nick Williams.
1213241225 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1501938 13f79535-47bb-0310-9956-ffa450edef68
6fc3657280 Merged revision 1501719 from tomcat/trunk: javax.el.ResourceBundleELResolver: According to javadoc: 1. When creating FeatureDescriptors shortDescription must be empty string 2. isReadOnly returns true if the base is instance of ResourceBundle Unit tests are added
cd67bdf9f0 Remove some debug code.
f66aab2de3 Move the log to the correct subsection.
6744180005 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55230 Use the correct resource path when obtaining an InputStream for resources served by a ProxyDirContext.
dd6d278d69 Merged revision 1501266 from tomcat/trunk: javax.el.MapELResolver: 1. According to javadoc when creating FeatureDescriptors - ShortDescription must be empty string - ELResolver.RESOLVABLE_AT_DESIGN_TIME must be TRUE 2. Unit tests are added
365cc43f2c Merged revision 1500663 from tomcat/trunk: Provide test case for META-INF/services/javax.servlet.ServletContainerInitializer that contains multiple SCIs and comments.
b88b78d52d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55210 Merged revision 1500590 from tomcat/trunk: When searching for ServletContainerInitializer, ignore comments in the provider-configuration file. Support multiple ServletContainerInitializer in the provider-configuration file. Patch is provided by Nick Williams.
7994fd1d6c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55211 Merged revision 1500577 from tomcat/trunk: Fix namespace. Rename "tagclass" to "tag-class" in various tests tld files so that they become valid against the dtd/schema. Patch provided by Jeremy Boynes.
518e2218fd svn:eol-style=native
a832424923 svn:eol-style=native
e107ec5c7a Correct a typo
1d1dbc6bef Add section name
18011e08fd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55205 Reorder web.xml elements so that it becomes valid against the schema. Patch is provided by Jeremy Boynes.
03ea06e4d8 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1500431 13f79535-47bb-0310-9956-ffa450edef68
675dc178c0 Merged revision 1499953 from tomcat/trunk: According EL javadoc ELContext.getContext must throw NPE when the provided class is NULL.
8b83de66c8 Prep for next version
3451ef42b8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55198 ELInterpreter needs to know if page was originally in XML
dce694f729 Add missing quote
e93b4a62ca Add release date for 7.0.42
1aaa55bfe4 Ensure local name is recycled between requests so IP virtual hosting works correctly.
f3c91677eb Add new attribute terminateOnStartFailure in BackupManaber.
51a3dd0caa Correct changelog
9b7bfbe4c5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55180 Merged revision 1498808 from tomcat/trunk: Correctly handle infinite soTimeout when disableUploadTimeout is set to false. Patch provided by Roger Wang.
4426116441 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55179 Correct attribute name.
69e0dc72f8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55176 SSI expression parser failed to correctly handle the use of an '=' character inside a regular expression. Includes a test case.
8d7017dc8d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55177 Correctly handle infinite soTimeout for BIO HTTP connector. Based on a patch by Nick Bunn.
c9e275ecc3 Tab police
0755184ab0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53777 Enable instances of the JAAS Realm to specify a dedicated configuration file. This is likely to be of particular use when the realm is specified at the Context level. Based on a patch by eolivelli.
0118645286 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54013 Give forced stop a short period (5s) to complete before returning. Patch provided by mukarram.baig
dc08904d6f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55160
5d31de75b5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55155 Avoid constant focus grabbing when running the Tomcat unit tests under Java 6 on OSX. Patch provided by Casey Lucas.
1c6e23af99 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55158 Merged revision 1498409 from tomcat/trunk: Small performance improvement Patch provided by Adrian Nistor
da5c3a1fc8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55159 Merged revision 1498368 from tomcat/trunk: Small performance improvement Patch provided by Adrian Nistor
7f47bb7f3a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54086 If stopListening is called while the thread is processing selector events it is possible for two threads to try to use the keys collection at the same time. Prevent the ConcurrentModificationException that can occur.
2a70c12ede Use the right changelog
3f7b7971fe Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55017 Add the ability to configure the RMI bind address when using the JXM remote listener. Patch provided by Alexey Noskov.
78bf287157 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55031 Merged revision 1497754 from tomcat/trunk: Fixed Export-Package header and the "uses" directives. Import org.apache.juli.logging package with no version so that any version of a bundle that provides it can be used. Patch provided by Martin Lichtin.
0e0b449a2a Merged revision 1497474 from tomcat/trunk: When calculating the path in AsyncContext.dispatch(), methods ServletRequest.getRequestURI and ServletRequest.getContextPath cannot be used. That's because the first one returns a string that is not decoded and not normalized, but the second one returns decoded string. Instead of this methods ServletRequest.getServletPath and ServletRequest.getPathInfo will be used as requestURI = contextPath + servletPath + pathInfo.
86b09c6fea Fix regression in r1459346 Thanks to Brian Burch for spotting this and kkolinko for the fix.
ee3f70bf05 Merged revisions 1496732, 1496734 from tomcat/trunk: When AsyncContext.dispatch(...) is invoked do not cast request and response to HttpServletRequest/HttpServletResponse. ServletRequest.startAsync(ServletRequest,ServletResponse) can be invoked with custom ServletRequest/ServletResponse.
35f66bd6f4 Line length. tomcat -> Tomcat
3e69c5ad71 Avoid Warning message at shutdown, if GlobalResourceLifecacleListener isn't configured
e31cff8bff Changes to java.beans.Introspector#flushCaches() mean that AppContext protection is not required from 1.7.0_02 onwards. Changes to AppContext meant the memory leak protection required a graphical environment from 1.7.0_25 onwards.
66d07bc0d1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55102 Add support for time to first byte to the AccessLog. Patch by Jeremy Boynes.
b830b7c0ec Fix broken test.
d463c3b330 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55125 No point starting a process if the Server container fails to start.
cde242a280 Tab police
396b9ffe48 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55119 Ensure that the build process produces Javadoc that is not vulnerable to CVE-2013-1571. Based on a patch by Uwe Schindler. See https://issues.apache.org/jira/browse/LUCENE-5072
96d3ee213b r1495155 incorrectly removed the commit Restore the commit and clean the code up a little.
d2e034bb1b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55071 Remove unnecessary call to commit(). The rs.close() just above will commit anything that needs to be committed.
6fe7ab7032 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54745 Fix JarScanning when Tomcat is started via Java WebStart. Patch provided by Nick Williams.
6d70e06422 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53665 Document when a javax.mail.Authenticator is configured.
46702fd07d Replace Tribes's TaskQueue as executor's workQueue in order to ensure that executor's maxThread works correctly.
72991e7f2d Back-port of r1494143: Display hostname and port when failing to stop Tomcat via socket connection.
8f89828217 Complete the document for MessageDispatch15Interceptor.
296a1ce56c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55073 Small performance improvement Patch provided by Adrian Nistor
531b7730d9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55108 Small performance improvement Patch provided by Adrian Nistor
51347fc28f Small performance improvement Patch provided by Adrian Nistor
9ab87a70ae add @Deprecated.
d0ed63839c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55110 Small performance improvements Patch provided by Adrian Nistor
ff59561eb9 Add logging of when a member is unable to join the cluster.
1eff7ffd86 If GET is not protected but other methods are, the redirect after authentication (that normally uses GET) fails. Because it is unprotected it is not passed to the FORM authenticator for processing (where the original request would be restored).
06a9d01907 Fix indents
6650ad101b Merged r1493113 from tomcat/trunk: Followup to r1493073: correct a typo.
5a5769cef1 Rename string and update text
80cd539c5e As per review from voiletagg, restrictions from in Servlet 3.0, section 4.0 apply to listeners added through the pluggability API as well as via TLDs.
d56c85321e Merged r1492570 from tomcat/trunk: Replace anchor links that use spaces with underscore ones.
782d8c86ae Update JDBC-Pool POM to use JUnit 4.11 as well.
f2f4aa3916 Merged r1492555 from tomcat/trunk: Update Tomcat and JDBC-Pool to JUnit 4.11. Download Hamcrest 1.3 core library and add it to testing classpath.
8235f3bc18 Fix API compatibility issues with r1492331
b75f5c717e Align name with logic
1754c45033 Remove unnecessary warnings
de98b4f148 Implemented
951e08108e Better name
7c1d03ee3d With clarification from the EG for Servlet 3.1 section 4.4 finally makes sense. Implement the necessary restriction and add a test case.
00c4d55bf0 Merged r1491485, r1491841 from tomcat/trunk: - Change Maven Central repository location to be repo.maven.apache.org - Update junit to version 4.9 - Download it from Maven Central instead of GitHub
3637c935e0 Increment version ready for next release
21edc6af46 rel="nofollow" for external links
4f4af080ad Released yesterday
a3dab51f11 Ensure that the keepAlive of NioSender works correctly when keepAliveCount/keepAliveTime is set to a value greater than 0.
055d3cf5a0 Delete leftover of war file from tempDir when removing invalid FileMessageFactory.
003147107f Try and clarify the rules for context names when using automatic deployment
43a5c86671 Fix backport from Tomcat 8. Servlet 3.1 / Java 7 issues.
2dd664e750 Clean-up
fd83aabbd7 Add CORS Filter Patch by Mohit Soni.
8a470bad68 Update merge info
4b28c68ce7 Prep for CORS filter
0a6ccd0e8d Clean-up
fdd0877295 Add removeSuspectsTimeout attribute in order to dispel remove suspect. The removeSuspects members never be removed until disappeared really. Remove members that worked properly specified time by removeSuspectsTimeout from removeSuspects.
f97f3fa7ca Fix typos.
1aebbcfe90 Merged revision 1489536 from tomcat/trunk: IllegalStateException will be thrown if more than one asynchronous dispatch operation is started within the same asynchronous cycle.
8e1a668ef9 Merged r1489610 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54939 Follow-up to r1489444: Update description of UserDataHelper uses in documentation. Correct a typo s/to/too/.
500f1797af Remove @Deprecated marker from getCoyoteResponse() method as it has been resurrected in trunk in r1358055.
ac097a1072 Wrap line. (Followup to r1489408)
a474bdce68 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54939 Log errors parsing HTTP request headers using a UserDataHelper
5550095982 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55052 Fall back to un-prefixed property if a prefixed one is not present
886f8ce8e6 Silence some Eclipse warnings
0997522a6f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=55035 Add support for the version parameter to the deploy Ant task. Patch provided by Sergey Tcherednichenko.
7f18b85a5d Merge r1488871 and r1488876. -Add maxWait attribute that the senderPool will wait when there are no available senders. -Improve error message by including specified timeout if failed to retrieve a data  sender.
7864612384 Add document for o.a.c.tribes.group.interceptors.TcpFailureDetector.
b489b7b718 Merged revision 1488151 from tomcat/trunk: (Reviewing r1485114) Make antiLockingDocBase an absolute path. It is very unlikely that java.io.tmpdir is not an absolute path. For consistency, convert it to the absolute form just once, so the path used when starting and stopping the webapp is certainly the same.
4c6c187817 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54999 Fix JSESSIONIDSSO not recreated when a logout and login occur in the same request. Patch provided by Keith Mashinter
1e60194e34 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54971 Pass the calculated location to AplicationPart rather than it having to recalculate it every time. Now correctly handles relative locations.
095c36c9ba Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54964 Enable tag plug-ins to be packaged with a web application. Patch by Sheldon Shao.
6c1a919640 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54947 NIO connector incorrectly rejects a request if the CRLF terminating the request line is split across multiple packets. Patch for the fix by Konstantin Preißer. I added a test case.
64f8f72e57 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54944 Enhancements to TestFormAuthenticator. Patch by Brian Burch
7e88afa318 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54931 Add information on creating multiple services. Based on a patch by Chris Derham
d288f08edf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54984 Merged revisions 1486134, 1486217, 1486294, 1486443 from tomcat/trunk: Ensure that the correct encoding will be used when processing the multipart data.
811109b458 Clean-up / simplify based on review by kkolinko.
0b74764fd1 Make deletion of the copied WARs used for anti-resource locking more robust if the context fails to start (there were some circumstances where the original WAR could get deleted).
0525b0fd8b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54955 Merged revision 1484592 from tomcat/trunk: During reloading the application, the context root Wrapper is not removed correctly. This causes 404 to be returned later on when the context root is requested.
c3e0749da3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54981 Merged revision 1483229 from tomcat/trunk: ServletContext.getJspConfigDescriptor() must return NULL when there is no jsp configuration
da2dd977f2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54932 Merged revision 1482799 from tomcat/trunk: Fixed a broken link to Tribes documentation.
1ddb100ed2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54974 Merged revision 1482720 from tomcat/trunk: SessionCookieConfig.setXXX methods will throw IllegalStateException if the ServletContext from which this SessionCookieConfig was acquired has already been initialized.
4334799f0f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54968 Return the correct version number (2.2) of the JSP specification that is supported by the JSP engine when javax.servlet.jsp.JspEngineInfo#getSpecificationVersion() is invoked.
a38599338b - Rather than get cluster instance from container on every request, use instance variable. - Reduce nest.
fb7c4ed65a Ensure HostConfig has the latest settings of copyXML, deployXML and unpackWARs before performing automatic deployment.
8a0f01ec64 Prevent possible WAR file locking when reading context.xml from WAR
a138abd1cc Bits copied to /dist yesterday
11a34f7e07 Prep for next release
12d2234cd7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54703 Be tolerant of applications that pass CR or LF in setHeader() values. Fix some whitespace parsing issues idnetifed by the extended test cases in readTokenOrQuotedString()
f5dc7b28cd Avoid FileMessageFactory leak. FileMessageFactory will be removed immediately after receiving the complete WAR file but when failing to receive a FileMessage which was sent dividing, FileMessageFactory will leak without being removed. Add a newly maxValidTime attribute to prevent the leak of FileMessageFactory. FileMessageFactory that is leaking will be automatically removed after maxValidTime.
3a44b95851 Set svn:eol-style native.
edf6d758d5 Deal properly with 204 responses Fix an irritating warning
9c89804ecf Doh.
267314e2f8 Remove accidental commit.
d3d8c9db62 204 responses are permitted entity headers
a5d4137dc7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54906 Better error message for ConcurrentModificationException when checking for memory leaks and continue with remaining checks. Based on a patch by NateC.
d509ca13b4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54888 Support a csv list with the ForEach tag plugin Patch provided by Sheldon Shao.
b862448be5 Port unit test changes from trunk that should allow ASF CI system to complete without error
9bf948f61d Changelog for r1475733
a468f78e32 Don't use port 8080 for unit tests
e90badc8d3 Seeing some failures in 7.0.x. Reduce timeout to make them easier to repeat.
495e801f0a Fix failing unit test now that a RuntimeException in an AsyncListener is caught and logged.
3cadb619cd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54801 and https://issues.apache.org/bugzilla/show_bug.cgi?id=54821 Don't try to parse EL expressions if EL is disabled or inside scriptlets for JSP documents. Based on patches by kkolinko
af71f4aef4 Fix BZ54890. Update daemon to latest release
77d7b0bd08 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54791 Restore tools.jar entry in jarsToSkip
dcb70b3aa5 Outbound errors need to trigger an onClose event on the inbound side
22bee42bf1 Ensure write errors when using HTTP Upgrade with the APR/native connector result in IOExceptions rather than errors being silently swallowed.
f505d993d4 Protect against AsyncListeners that throw RuntimeExceptions (they should normally only throw IOExceptions). Includes a test case.
3d5867d3ee Add several improvements for FarmWarDeployer. Merged following revisions from /trunk. includes r1467891, r1467893, r1468290, r1468311, r1469138, r1469144, r1469703, r1469708, r1470852, r1470859.
482ab8200a Clean-up: Remove unnecessary code.
ae0f89c71e Merged revision 1470400 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54872 Correct the range for the bindPort of the cluster receiver object. Correct the example.
d377402447 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54851 Merged revision 1468415 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54851 Directories without any web.xml fragments should not impact the status of distributable. Patch provided by Trask Stalnaker.
701a2e4b77 Merged r1467091 from tomcat/trunk: Correct typo, s/Xml/XML/
d104222179 Merged r1464781 r1466106 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54802 Provide location information for exceptions thrown by JspDocumentParser
b32f5efcfb Merged r1466072 from tomcat/trunk: Correct indents
862cf9baf8 Merged r1466051 from tomcat/trunk: Change spelling
7dd7d50116 Merged r1465807 from tomcat/trunk:
c9f44dc6e8 Merged r1465795 from tomcat/trunk: "Monitoring and Managing Tomcat" Corrected text for link to Java documentation. It is Java 6, not 5. Mentioned that for local monitoring no special configuration is required. Clarified the "set CATALINA_OPTS" command which was a mix of Windows and Unix syntax. Mentioned JmxRemoteLifecycleListener. Reduced indents and wrapped the text in several places. The document was unreadable due to horizontal scrolling. Cleared the list of authors. This document is a collective effort.
7ba074e542 Add @Deprecated.
fe7789ed7b Make sure closed is set even if flush fails.
e667e11ef1 Update to FileUpload 1.3
f3fa73b88c Speed up test, reduce errors reported in logs
3b03855ddd Fix Javadoc errors
6f658f5d53 Just released the bits
df6cbb7dcc Merged r1461110 from tomcat/trunk: Update to Eclipse JDT Compiler 4.2.2
45992079a8 bin/daemon.sh was added in r1202063 (7.0.23). Mention it in changelog.
159f176a59 Merged r1461026 from tomcat/trunk: Fix a typo
e36fd0f95f Deprecate old method that was used to build JMX names
7f490e39d4 Add deprecation markers. Documentation (valve.html) explains why this attribute is unused.
3641be34bc Merged revision r1460633 from tomcat/trunk: Test for the issue fixed by r1457403
9d6eadc048 Merged revision 1460533 from tomcat/trunk: Correct typo reported via comments.a.o
35f73b18c7 Fix Javadoc. (partial backport of r1397873 )
86e4dc9c99 Merged revision 1460342 from tomcat/trunk: Change sample jsvc run command to a) explicitly use CATALINA_HOME and CATALINA_BASE variables, as it is more guaranteed to work (as suggested by a comment via comments.a.o), and as it is needed for logging configuration. b) include proper configuration for logging
70613465ed Merged revision 1460330 from tomcat/trunk: Change wording of the comments section notice. I hope this one is more clear.
1d7d50b40c Merged revision 1460313 from tomcat/trunk: Fix NPE in SlowQueryReportJmx.getObjectName() when running TestSlowQueryReport test
ad80b71d7c Merged revision 1460234 from tomcat/trunk: No need to create a new String if data length is 0.
77eea578a0 Add deprecation markers to unused method that was removed in r1448103
2ea6a09f8c Merged revision 1460115 from tomcat/trunk: Remove read permissions for UserDataHelper properties from "tomcat-juli.jar" section of catalina.policy. The class using them was moved in r1242371 and is now in tomcat-coyote.jar.
bbae890f04 Merged revision 1459769 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54732 Fix leak of statements in StatementCache interceptor. Based on patch by Bertrand Guay-Paquet (BZ 54732) / Patric Rufflar (BZ 54337)
8d64d56f32 Changelog update for recent commits
57b31bbbcd Merged revision 1435765 from tomcat/trunk: Enable checkstyle check that forbids use of JUnit 3 methods
dfcd7aa3df Merged revision 1402683 from tomcat/trunk: Use methods from JUnit 4
4439e6919d Merged revision 1435760 from tomcat/trunk: Fix broken test (it has been broken for a long time) The timeout needs to be shorter than the sleep time so the connection is abandoned
ff12960297 Merged revisions r1435505 r1435509 r1435759 from tomcat/trunk: Convert jdbc-pool tests to JUnit 4
2b49092db4 Merged revision 1380376 from tomcat/trunk: Clean-up - unused code - autoboxing
279f82194a Merged revisions r1435126 r1435600 from tomcat/trunk: Use JUnit4 methods
2d5323f0c4 Merged revision 1434757 from tomcat/trunk: Make sure changes to result are visible to all threads currently calling get()
e1b7563ae4 Merged revision 1432517 from tomcat/trunk: Fix threading issue reported by FindBugs - in a test class in jdbc-pool
740b46fdfb Merged revision 1459761 from tomcat/trunk: Remove stray obsolete comment. This method has been already implemented.
5f7c13d7ce Merged revision 1459933 from tomcat/trunk: Documentation for StatementCache interceptor.
2e9ef29b11 Prep for next release
fbe253284b Merged revision 1459681 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54599 jdbc-pool: Do not expose connection password via DataSource.toString(). Based on a patch by Daniel Mikusa
f442b3d0d6 Merged revision 1459673 from tomcat/trunk: jdbc-pool tests need JUnit 4. Use the same version of junit as used by Tomcat.
d37c818571 Add an order of magnitude to check results are roughly the same (they are)
8e61b29253 Improve performance for typical use cases by roughly an order of magnitude
5466feec2f Switch to Base64 encoder/decoder from Commons Codec. Performance testing shows it to be ~25-30x slower than Tomcat's implementation.
febc401c77 Reorder sections in ascending order according to the issue number.
c3602e1f52 Ensure that StandardJarScanner#scan will use the provided class loader when scanning the class loader hierarchy.
fbd56d607d Ensure HEAD requests return the correct content length when the requested resource uses a Writer. Patch by Nick Williams.
51f80d9375 Buidlbot needs a little longer
ea775d91c7 Keep auth headers out of the StringCache
28be68d222 Switching to the new Decoder has fixed a couple of TODOs. Update the comments and tests accordingly.
8afb6fcbf6 Deprecate Tomcat's internal Base 64 encoder/decoder and switch to using the JRE provided implementation.
afdd4c5357 Replace Tomcat's own base64 encoder with the one from the JRE. Deprecate Tomcat's encoder which will be removed in Tomcat 8.
b519922cf6 The JRE (since Java 6) ships with a perfectly good Base64 Encoder/Decoder. Use it.
7e6ffa3a35 Merged revision 1458694 from tomcat/trunk: Correct typo reported via mailing list
3473635cee Update Commons Fileupload to r1458500
8872421f75 Link to the 7.0.x code which uses the old API
441ae36ce9 Add changelog entry for r1457889 Reorder sections according to canonical order (as stated by a comment at the top of Changelog file)
3dc41e3027 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1458222 13f79535-47bb-0310-9956-ffa450edef68
a0ef81b1e7 Update Fileupload
2074ca551c Merged revision 1457968 from tomcat/trunk: Correct typo reported via comments.a.o
4c076f5c3c Rebase daemon to 1.0.14
505c5d45fd Enable support for overloaded methods
cd1bfb34d3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54712 Code clean-up. Use Locale.ENGLISH consistently for upper/lower case conversions.
7731c5e2f5 There was a reason mark/reset was used here. Restore use of mark/reset and add a comment.
ae32e0fd77 Merged revision 1457382 from tomcat/trunk: Document the command to quickly build documentation, without using a "deploy" build.
5dd4df86aa Fix incorrect wrapped message It was correct in trunk ( r1434882 ) and broken during backport ( r1434887 ) To actually wrap a line in a properties file, you have to end it with a backslash.
4eec22b441 For https://issues.apache.org/bugzilla/show_bug.cgi?id=54707 Merged revision 1457362 from tomcat/trunk: Review of r1457303: 1) Correct comments. 2) In readLhex(..): Document lowercase conversion. It was documented before r1457303 and I think it is in line with support for incorrect values implemented in response to BZ 54707. Convert digits to lowercase on the fly, instead of relying on String.toLowerCase() call. This should generate less garbage for GC.
0d9fb99eb9 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1457303 13f79535-47bb-0310-9956-ffa450edef68
1a9560d64f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54702 Merged revision 1456959 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54702 Close the stream at the end of the parse operation.
4e133da870 Expose new rotate method via JMX
af7d827acc Update to Commons IO 2.4 and run UCDetector over the copied classes
9f254a6f5f Diff trunk and 7.0.x and apply missing updates to 7.0.x
94a222162b <> is Java 7 only
72c4451018 Backport Commons FileUpload changes from trunk
19e9806af1 Backport Commons FileUpload changes from trunk
4c8ec73345 Add Violeta to the list of authors in changelog file. s/ @ / at /
596eec3d89 Merged revisions r1456740 r1456762 r1456766 from tomcat/trunk: Rephrase the context naming rules. Clarify.
1187b22211 Merged revisions r1456706 r1456713 r1456716 r1456721 from tomcat/trunk: Correct Deployer and Manager pages of Tomcat documentation: Wrap long lines. Better introduction of the Manager web application. Added mention of Tomcat Maven Plugin project. Context descriptors are not created for deployed apps in Tomcat 7. Add RemoteAddrValve to Manager configuration examples.
735bbd67a5 Merged revision 1456678 from tomcat/trunk: Correct typo reported on the users list http://tomcat.markmail.org/thread/xnxj7whkh6hnsd3t
8d52fe5d00 7.0.38 release was cancelled
d5840d1131 Merged revision 1456666 from tomcat/trunk: Correct typo reported via comments.a.o
d879c74b16 getFilename() -> getSubmittedFileName() in preparation for Servlet 3.1 Based on a patch by Nick Williams.
2d29aefaaf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54660 Allow the AccessLogValve file data format to be changed via JMX. The change takes effect as soon as the next message is logged.
60d477d098 Fix import order (checkstyle)
77ca8da60f Merged revision 1456440 from tomcat/trunk: Fix the recycling of the o.a.t.u.buf.UEncoder.output field. Fix javadoc. Add a test case.
c607beb93e Fix typo
6181bac9f3 Use server defaults not client defaults for SSL protocols and ciphers if none are defined for the connector.
35df47988d Check that the loader is not null. There are use cases where the loader does not have parent. Backport of patch by violetagg
bee66052db Follow-up to r1456080. Update mergeinfo
c077fb9fec Follow-up to r1456068. Update mergeinfo
cd68516a38 Tag was not properly closed.
fb8c517e87 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52318 The version for imported package 'org.apache.juli.logging' is extended to include 7.0.x versions. Patch provided by Martin Lichtin.
9057bce21f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54684 Added 'javax.naming.spi' to the header 'Import-Package'
87022b321e Log message on SCI error
a9339c996f Fix unit test failing only for TC 7 (Java 6) by excluding the Java for-internal-use-only charset 'COMPOUND_TEXT'.
b12ab7954e Add info about failing charset to unit test.
bf88ea9070 Fix javadoc.
10d19bdf05 Fix external javadoc URL for commons-io.
7c3b6fb67a Update Tomcat version
eb913474ce Allow membership longer to establish
833e281b74 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54628 Only write data from start position in array rather than start of array. Patch provide by blee.
6b6f08aed3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54624 Read request body before content length header is restored for the old request as AJP connector uses this to determine how many bytes to read (and it will block until they are read)
ec1c535881 Clarify how context paths are derived.
2ad42e424e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54612 Check if socket is closed before trying to write a message to it. Also, flush any partial buffered data before closing the socket.
163d9dfa6b Control messages can be sent in the middle of a fragmented message.
03848726be Merged revision 1453112 from tomcat/trunk: Fix several issues with the schema, aligning it with actual output generated by StatusTransformer class. 1. Add memorypool element to status.xsd schema. 2. There is no minSpareThreads attribute on threadInfo.  I removed it from xform.xsl stylesheet file as well. 3. There can be 0..many workers 4. There can be 1..many connectors
75735813c5 Merged revision 1453105 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54638 The status page of manager webapp was reporting wrong value for "Used" memory in XML mode.
80e2665181 Switch to Tomcat's internal UTF-8 decoder for URIs and request bodies. Improve handling of trailing invalid byte sequences. Replace rather than fail for invalid URIs.
1674eb32ee Refactor encoding/decoding to use NIO
c1bf6cc0ea Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54602 Ensure URI converter is recycled in case of error in previous conversion
9f6aa8ab21 Update UTF-8 decoder used by WebSocket connections.
c7ac707223 Merged revision 1451769 from tomcat/trunk: Disable comments section for the "Changelog" page. This fixes JavaScript errors when viewing changelog as XML file in a browser. (I suspect that is because you cannot use document.write() with XML)
1258a4f9ab New certs. Same DNs. Same CNs. Expiry in ~2 years
10a4c1f9c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54585 Take account of setting of delegate when building the class path that is passed to Jasper
f636141689 Remove trailing whitespace. Prep for BZ54585 fix.
ad2ee12419 Add more status data to the webapp MBean.
26aec6e17f Merged revision 1449406 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54601 Use LOGGING_MANAGER variable, do not modify JAVA_OPTS one.
ed4e40a4cc Disable scanning of the bootstrap classpath by default and remove the jarsToSkip entries that were added to achieve the same objective
b6b21e7d2e Deprecate
fd60bde640 UCDetector: Use some unused code so log messages can report the acceptor thread name
b49512059c Add the release date
7dd506aaad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53871 Add the class hierarchy that triggered the StackOverflowError to the error message to aid debugging.
6429087a78 Another typo
52885bd551 Fix typo
2ef94507c7 Improve Javadoc. Clarify difference between spec minimum behaviour and what Tomcat does.
0f17fe47c8 Merged revision 1447012 from tomcat/trunk: Correct definition of a term. Reported via comments.a.o.
c8d3fa1b75 Merged revision 1446650 from tomcat/trunk: Correct typos in configuration samples: XML comments start with '<!--'.
ad82ee410b Merged revision 1446640 from tomcat/trunk: Remove stray '-->' in a configuration sample
9c341a10e1 Escape slash consistently.
fa5c53fc86 Merged revision 1446357 from tomcat/trunk: Add access-bridge-32.jar to jarsToSkip property This library is in JDK 7u13 32-bit on Windows
a53493c016 Follow on to r1446110 Since -1 is used to indicate the start time has not been set, make sure that is what is used for the initial value
b1519eb362 Ensure request start time for HTTO NIO connector is measured correctly.
1968934c98 Complete Part javadoc. Content copied from Commons FileUpload with minor changes as necessary.
7aded9e4b5 Prep for next release
4e19249881 Increase time allowed for test in an effort to reduce false test failures.
1602a80bad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54536 If a custom error status is used and a message is provided, display that message via the default error page.
2627c16d7d Update to Commons Daemon 1.0.13
3060871755 Update tc-native to 1.1.27
a5f1e11826 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54239 Enable applications to use a custom EL interpreter. Based on a patch by Sheldon Shao.
066c72e9c3 Merged revision 1445125 from tomcat/trunk: Document possible value for closeMethod attribute
2508035198 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54505 Clearer links to Tomcat specific options for JNDI resources
955d3d5f90 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54456 If the client aborts the request, make sure this is communicated to the application reading the request body.
0e6c78ec76 Whoops. Fix porting to Tomcat 7 issues in unit test
88a0c09f92 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54521 Ensure concurrent requests that require DIGEST auth receive unique nonces.
549f42e865 Fix warning
e6010c8ab8 Ensure that when loading Servlet instances the correct class loader is used.
762c5e5b13 Increment version ready for next release
4efe169661 Make the test more robust. The socket may get closed before the client has a chance to send all the data.
3bf0d948a4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54497 Make error handling more robust so an error in the leak detection code doesn't prevent the Context from stopping unless the error is fatal to the JVM
86a37b72b0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54507 Don't start expiring sessions until the web application is fully started. Stop expiring sessions as soon as the web application is stopped.
a8a3fb7bf3 Merged revision 1441348 from tomcat/trunk: Correct typo, reported at comments.a.o
21e037f6fc Merged revision 1441342 from tomcat/trunk: Review of r1440096 (r1440095) Include the exception in the error message if the parsing fails. digester.parse() is called several times in HostConfig.java, so I am fixing the rest of those calls.
8c47c4d951 Align NIO with BIO and APR and include leading blank lines when counting input for HTTP header size limit
df537f913a Check cluster member before sending replicate message in ClusterSingleSignOn.
83eda3a5d8 Include the exception in the error message
246d067701 Additional fix for r1439758. Prevent SSO deregister when node shutdown normally in cluster environment.
15877a7d4f Prevent the SSO deregister when web application is stopped or reloaded. When StandardManager(pathname="") or DeltaManager stops normally, all sessions in the context are expired. In this case, because most sessions is not time-out, SSO deregister was triggered.
17df5aaec8 Merged revision 1439667 from tomcat/trunk: Correct the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54496 Remove duplicate "append(getName())" that was copied from the next line.
5b7895362b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54496 Don't use hard-coded class name in toString()
ce346f1e9a Follow-up to https://issues.apache.org/bugzilla/show_bug.cgi?id=54060 More buggy client implementations of DIGEST auth. This time it is the JDK (Oracle 6.x, Oracle 7.x, OpenJDK 7.*)
6617ea0a9d Add Jespa Use no-follow as suggested by kkolinko
a4bd79d51b Close parentheses on docs page. Noted on comments.a.o.
c4e8d80910 Add missing title
38eb3ced6f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53869 Performance improvement for pages with lots of heavily nested tags. Retain a reference to the root JSP context rather than traversing the hierarchy on every call. Based on a patch suggested by Sheldon Shao.
ae3a7e015d Fix translation s/recycling/reloading/
ac992f249a Fix Javadoc. destination has minimum length of 1, not 2
0e6519b6bb Update to Commons Daemon 1.0.12 (add files missed in r1437898)
1afe55ba96 Update to Commons Daemon 1.0.12
b2af2c421c Improve error message by including the name of the file when the java file generated from a tag file cannot be compiled. Based on a patch by Sheldon Shao.
7b71a08a52 Improve the documentation for the compiler attribute in the Jasper how-to
2f378a4ad7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54458 Include exception in error log message Patch provided by Violeta Georgieva
578d4aefd0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54450 Correctly handle resource injection when part of the servlet properties uses @Resource and the other uses 'injection-target' Includes test case Patch provided by  Violeta Georgieva.
a30f7185f4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54448 Correctly handle @Resource annotations on primitives. Includes test case. Patch provided by Violeta Georgieva.
84454a047d Move to correct section
602cd4e696 Proposal.
7b0573329c Fix incorrect increment of counterSend_EVT_SESSION_EXPIRED and counterSend_EVT_CHANGE_SESSION_ID. These values are not incremented if no members active in cluster group.
2554013bed Fix broken Javadoc
8d5bfcc49e Merged revision 1435642 from tomcat/trunk: Correct broken sentence. There are no loggers in Tomcat 7. An XML parser is not bundled, as it is now provided by JRE.
87619155fe Merged revision 1435636 from tomcat/trunk: Add link to RUNNING.txt and refer to it as the main documentation on this topic.
a738bafcb8 Merged revision 1435606 from tomcat/trunk: Correct links to specifications and correct chapter numbers mentioned in the text. This is in response to a comment posted on the web site.
2b250d3a18 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54324
9b549772ea Fixed mergeinfo
c6a78895ad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54438 Fix a regression in the fix for BZ 52953 that triggered a NPE when digested passwords were used and an authentication attempt was made for a user that did not exist in the realm.
2b707504b0 Add the release date
6d36ae62e1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54440 Fix a regression caused by the changes for https://issues.apache.org/bugzilla/show_bug.cgi?id=54240 that broke compilation with JspC. Patch provided by Sheldon Shao.
b6e6b3749e Tab/trailing whitespace police
4ee74b4b45 Merged revision 1432751 from tomcat/trunk:
6e4b415419 Remove deprecation from method restored in Tomcat 8
18cea2a048 Remove svn:executable property from Tester.java.
61b98b2a86 Merged revision 1431920 from tomcat/trunk: Correct version of Eclipse Java Compiler dependency
47a2ff0429 Bump version ready for next release
9defe31158 Merged revision 1431661 from tomcat/trunk: Relax the test. Relative ordering can pick more JARs than those two that belong to the web application.
1b419dd3fe Merged revision 1431298 from tomcat/trunk: Remove unnecessary warnings (It was me who added those @SuppressWarnings several days ago. These are unneeded if "Potential resource leaks" warning is turned off in IDE).
af7356813e Merged revision 1431310 from tomcat/trunk: Tests for https://issues.apache.org/bugzilla/show_bug.cgi?id=54391
ccdf99e907 Merged revision 1431302 from tomcat/trunk: Add name of JSP file to an error message in JspServlet. Fix misconfiguration that caused  org.apache.catalina.core.TestStandardContextResources test to log this message, javax.servlet.ServletException: missing jspFile 	at org.apache.jasper.servlet.JspServlet.init(JspServlet.java:123)
f0f572cfd1 Follow-up to r1431300. Fix error on reload when postConstruct and preDestroy entries are present in weeb.xml
52fd1b97b3 Fix typo
a1d78129d8 Java 6 not 7
30e584ab11 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54387 Multiple servlets may not be mapped to the same url-pattern
cb75ba61b9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54379 Implement support for post-construct and pre-destroy elements in web.xml Patch by  Violeta Georgieva.
440946095e Add support for auto-detection and configuration of JARs on the classpath that provide tag plug-in implementations. Based on a patch by Sheldon Shao.
38926993df Merged revision 1431206 from tomcat/trunk: Tweak wording of the notice in the "comments" section. Added comments feature to the changelog.
997d15b088 Merged revisions r1430775 r1430791 from tomcat/trunk: Tabs -> spaces, as reminded by Checkstyle
1b36073b2a Merged revisions 1431171 from tomcat/trunk: Fix release of processors in AjpNioProtocol. Wrong object was used as a key in the connections map.
e1a3a4af58 Merged revision 1431164 from tomcat/trunk: A pair of typos
56e8cddc5e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54244 Clarify documentation for BIO/NIO SSL config attributes sslEnabledProtocols and sslProtocol
61eebfe141 Better description of <%= obj =%>
0616d13593 Correct changelog
36afb5e9bf Add issue number for r1429124, move according to the sort order.
40f8b867b2 Merged revisions r1430799 r1430809 from tomcat/trunk: Avoid ArrayIndexOutOfBoundsException in HttpParser on incorrect input. Inspired by o.a.t.util.buf.HexUtils.getDec()
2cf3603494 Java 6 not 7
c0e5d9c547 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54391 Provide a value for the javax.servlet.context.orderedLibs attribute
44f123249c Reduce the dependencies for building the source JARs
592ab4c1d9 Proposal
59f46bfd7a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54390 Changelog update.
4bdce521c6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54390 Back-port r1430567: Use /usr/libexec/java_home to determine JAVA_HOME on Mac OS X if it is available.
069a18012c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54382 Avoid NPE with an empty SSI directive
4336899d6d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54381 Add support for receiving pong messages.
11c9062476 Folowup to r1430182: one more NPE to avoid when stopping a WebappLoader. This line is absent in Tomcat 8.
f986bdecc4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54377 Correctly set request attributes for AccessLog in RemoteIpFilter Patch by Violeta Georgieva
dce29207b1 Merged revision 1430481 from tomcat/trunk: Review the section on setting the environment variables.
7afb075561 Correct versions. Merges r1430445 r1430448 from tomcat/trunk
e66c89b27b Merged revision 1430165 from tomcat/trunk: Fix NPE in WebappLoader.stopInternal that happens after a failed start. Add tests that a context can be started again after a failure.
57b53ce6d1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54380 Changelog for r1430147
65105efa75 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54380 In MapperListener.lifecycleEvent(): call registerWrapper(), registerContext() only if the parent component has already been started.
1fe1d79abf Merged revisions r1429687 r1429745 from tomcat/trunk: Amended the test for bug 46243: Test that a context can be started again after a failed start. There is no need to redeploy it. ........ Added comments and a pair of additional checks. Renamed a variable to correct a typo. ........
442278e57d Need to reset the decoder when the B2C converter is recycled to ensure BOMs are correctly handled for those encodings that require them.
1f95c1ee1c Follow-up for r1429858. Further fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=54371 Handle the additional cases that r1429858 did not ('~', '+', ';' and '&' characters in the context path) and simplify at the same time.
4e190c2a03 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54284 As per clarification from the Servlet EG, anonymous Filters and Servlets are not permitted. Patch by Violeta Georgieva.
964acd1ee2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54262 An empty <absolute-ordering /> should turn off all web-fragments. Based on a patch by  Violeta Georgieva.
9b7ab5464e Include the binary distributions when uploading artifacts to Maven repos
15b9630cc5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54371 Prevent exceptions when processing web fragments for unexpanded WAR files when the context path contains characters that need to be encoded in URLs such as spaces. Patch provided by Polina Genova.
bb522dd08e Make non-JSR356 WebSocket implementation non-blocking between HTTP upgrade and first message.
e7bbd69090 Merged revisions r1429179 r1429180 r1429356 from tomcat/trunk:
22286d87d1 Merged revisions r1429173 r1429182 from tomcat/trunk: Fix leak of servlet instances when running with SecurityManager: a) In case when initServlet() or destroy() fail. b) In case of a SingleThreadModel servlet. (fix wrong argument)
dff0ab5cbf Merged revisions r1428993 r1429167 from tomcat/trunk: Followup to r1428645 1. in ApplicationFilterConfig.release(): Align implementation between IS_SECURITY_ENABLED==true and ==false branches. (The difference is i18n and Error handling). 2. in ApplicationFilterConfig constructor and ApplicationFilterConfig.setFilterDef() method: Remove the setFilterDef() method and inline the code into the constructor. (This avoids the need to fix the filter destruction code in setFilterDef() which is actually never called). The removed method has package visibility, so there should not be any 3rd-party callers.
d045bf46a0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54338 Correctly coerce the value to the expected type when using the tag plug-in for the JSTL set tag. Patch provided by Sheldon Shao.
3bc0514c5e Make HTTP DIGEST authentication header parsing tolerant of known buggy clients.
54363b9792 s/2012/2013/g
22b0155865 Fix line endings
0f67546b70 Stop broken filters breaking things on application stop.
5fdb176aa3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54370 Improve handling of nulls when trying to match sets of parameters to a method in EL.
0412297796 Avoid NPE when using JSP unloading and tag files.
765431c94c Line endings
24d6bdcb8c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54256 Improve error reporting when a JAR file fails extension validation by including the name of the JAR file in the exception.
601564d882 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54249 Ensure resource properties are available when the context path contains encoded characters such as a space. This triggered compilation issues in Jasper.
6a63e1095c Prevent ClassNotFoundExceptions on stop when running as a service
a716039752 Commit change missed in r1427851
e35c5669c0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54242 Fix NPE in tagPlugins:ForEach when iteration is null. JSTL spec says it should be treated like an empty iteration. Patch provided by Sheldon Shao.
9245264ceb Revert the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=35410 as it is not specification compliant Remove the remainder of the write(String) method as well as it serves no purpose since it is identical to the method it overrides. Add some test cases to confirm the expected/correct behaviour Note: BZ 35410 claims there is no requirement for Object.toString() to be non-null. Many have argued (and I agree) that null is not a String representation and therefore not a valid return value for Object.toString().
78463bc714 Should have been excluded - only used for Tomcat 8
77235af515 Put all JSPs for bugs 50000-59999 in a sub-directory. Should be no functional change.
fbd042dea2 Deprecate unnecessary code
2872903775 Clean-up
1e91bbf2bf Merged revision 1424894 from tomcat/trunk: Correct a pair of typos
30c55e6b45 Add user comments system to docs.
9f7dafd4b7 Add a CSS style "notice". Will be used for the docs comments feature.
b88681862d Fix sitedir.
5a034ed309 Pass some more context information to style sheet which generates docs. Will be used when embedding the docs comments feature.
f127c6b424 Make docs menues consistent in the various levels.
a4be591bb3 Add release date. Start section for 7.0.35
59348caf66 Update changelog.
e27917c876 Remove "maxLogMessageBufferSize" ALV attribute from docs. It only exists in trunk and has erroneously been added to the docs in backport r1417437.
16b3ea23ac Improve ALV docs:
473c55a866 - Style - Fix Javadoc - Move default setting to the right place. - remove obsolete comment warning.
e4ae38c8de Avoid NPE Log error sooner
1c49e74b97 Merged revision 1417282 from tomcat/trunk: Clarify the docs that the thread priority value is a number and not some weird string value. A thread on users@ from Dec 02 2012: http://tomcat.markmail.org/thread/iud2m7j743qwx4ui
452fdd2f82 Merged revision 1417224 from tomcat/trunk: Review of r1412576, which was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54170 Reduce GC. There is no need to copy characters into a new char[] array here.
f72fb1da6f Prep for next release cycle
5317139433 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54194 Make sure that connection pool mbean is not registered when jmxEnabled is false.
b07314335e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54150 Make sure that SlowQueryReportJmx mbean deregistered during webapp shutdown.
9f7f1ce8ea Simplify the TimeZone handling in the AccessLogValve and correct a few edge cases. The previous code did not handle edge cases - for example (and what ID'd this issue) the UK was at +01:00 from Oct 1968 to Oct 1971. It is far better to let the formatted handle the TimeZone directly as it will handle all the edge cases.
d2706c208d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54220 The ErrorReportValve should only generate an error response if the error flag on the response is true.
5cf6ef1901 Only rename AccessLogValve file with renameOnrotate=true if target file does not already exist.
639d15b00c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53871 Improve error message for StackOverflowError
6705b2c74d Speed up unit test. Patch provided by Brian Burch.
adae54e7eb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54217 Prevent PoolCleaner instances retaining references to the ConnectionPool which  may result in a memory leak.
a9f09f8909 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53565 Fix a handful of Eclipse warnings in the JDBC pool source code
86e0cd5689 Fix javadoc.
4f2bdd54fb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54190 Improve unit tests. Patch by Brian Burch.
954cf82327 Add new ALV attribute "renameOnRotate" (Default:false).
9756021ebc A little more Javadoc
44a3bf7daf Improve wording
10d1803b85 Populate the SCI Javadoc
bc29c70b74 Follow up to r1413557
0778688469 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54207 Correct package name in Javadoc
727265ecf1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54198 Clarify that sendError(int) results in an HTML response.
ddedc4375a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54170 Ensure correct registration of Filters and Servlets in the JMX registry if the Filter or Servlet name includes a character that must be quoted if used in an ObjectName value.
d86a8c7e9a Align the date with what is written on tomcat.apache.org
bbcfc3a0b0 Complete release date
e0d11fc40f Merged revision 1411993 from tomcat/trunk: Followup to r1411587 Update JDT complier to 4.2.1 in classpath file sample for Eclipse IDE
3a79918c4b Update JDT complier to 4.2.1
3d66b64b1e Fix typo
0ddceb797d Fix time zone formatting in ALV test. Test failed in non-GMT time zone.
dab327448b Prep for next release
e91e21c0aa Restore -dev in version for trunk build
a4093c446f Follow up to r1410636 Fix test failure
a903c1e02d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54144 Add required behaviour for Reader objects when used with c:out
db1834426c Follow up on the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Need to use the body as the default if no default attribute is defined
9aa34c8c03 Fix TCK failures under a security manager. Fix additional security exceptions identified during testing
15e7526c8e Correct case for class
1b26018f8f Make sure onComplete() works when running with a security manager
b0dc8b01d4 Revert additional of "final" modifiers to BaseDirContext.List() that was done in r1392099.
c1dc59e991 More updates to the async error handling triggered by kkolinko's review - simplify check to see if listeners changed async state during onTimeout - add option to control if onError fires during error handling (it doesn't if called from the timeout code since that has its own event) - add check to see if listeners changed state during onError - add check to see if state changed during "error dispatch" - remove AsyncState.ERROR as a valid start state for asyncPostProcess() - aligned the unit tests (one change) with the new behaviour
2c722de2b5 Merged revision 1409007 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54143 Add display of memory pools usage (including PermGen) to the Status page of the Manager web application.
ec4c9ee263 Merged revision 1408934 from tomcat/trunk: Align warning message with the code. It calls AsyncListener.onError() here.
ed078ce187 Merged revision 1408906 from tomcat/trunk: Use 'final' for the field initialized in constructor.
bf8a28e778 Merged revisions r1408872 r1408875 r1408876 from tomcat/trunk: Use explicit locale in toLowerCase(), toUpperCase() calls.
d8ee3b3ee4 Fix unit test failures after case-insensitivity changes
e9b817c73f Optimisation suggested by kkolinko and a test case to make sure it does what it is meant to. The test case is obvious but I missed something in my first look at the code so wrote the test case which may as well be kept.
9869b25f53 Make parameter names in MediaType case-insensitive. Based on review by kkolinko
3379844e21 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54141 Increase the number of supported nested realm levels from 2 to 3 and make the maximum configurable via a system property.
111dfc3968 Ensure onComplete() is called with the correct context. Review from kkolinko
a28f59c122 Increase error margin to 100ms after observing some test failures.
04ec88e3f9 Merged revisions r1408562 r1408565 from tomcat/trunk: Fix an NPE caused by r1408520 Fix trailing whitespace, as nagged by Checkstyle
abdbe5d54c Merged revisions r1408513 r1408517 from tomcat/trunk: For https://issues.apache.org/bugzilla/show_bug.cgi?id=53960 Review of r1402846, r1408157 - Correct typo in a field name. - Remove call to extractUriElements() from processBody() method. If someone needs the extractUriElements() method, one has to call it explicitly. The method was made public. So that a) we do not waste time in 90% of tests where this info is not needed, b) we do not waste time if the response is not HTML.
69ca7af3f6 Merged revision 1408504 from tomcat/trunk: Allow to customize the HTTP status code used for denied requests in CsrfPreventionFilter.
4eedd01c75 Merged revision 1408438 from tomcat/trunk: For https://issues.apache.org/bugzilla/show_bug.cgi?id=54044 Add test for org.apache.juli.DateFormatCache. It is port of the test of AccessLogValve.DateFormatCache. I am using reflection to get interesting fields, so no need to change field visibilities.
b7c1791641 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54087 Ignore invalid If-Modified-Since header as per RFC2616-14.25.a
7e4be853fa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54007 Fix memory leak that prevents context.xml files associated with failed deployments from being deleted. Fix errors uncovered once the above issue was resolved.
c6b4778069 Update docs after r1407596
ed6066df9c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54115 Minor enhancements to HttpClient test helper class Patch by Brian Burch
f886d2cef7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54124 Correct ASYNC_REQUEST_URI. Addition of query string appears to be left over debug code Add missing ASYNC_PATH_INFO which appears to be an oversight.
cf4fae533c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54123 There are two things going on here: 1. The reported bug. If there is a async timeout and no async listeners, trigger a 500 response. 2. Implement "error dispatch". This is used a couple of times in the spec without any definition. The implication from the part of the spec quoted in the bug report is:    - The standard error page mechanism should be used to identify the page    - An async request that has been started should be left in async mode when forwarding to the error page    - The error page may call complete() or dispatch() This commit hooks into the StandardHostValve to access the error page mechanism. I could have copied and pasted but I preferred the dependency on StandardHostValve Because the error page may do a dispatch(), need to ensure that when running the dispatch(), the error page mechanism is not triggered a second time. Depending on what emerges running the full unit tests and the TCK, I mat still decide to copy the error page code to AsyncContextImpl
d47286e243 both timeout and complete, as with all container callbacks must be invoked with the right context Backport of fhanik's r1356898
9caecb5dfb Merged revision 1408043 from tomcat/trunk: In FormAuthenticator: If it is configured to change Session IDs, do the change before displaying the login form.
3d35db6508 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54127 Add support for sending a WebSocket ping Patch provided by Sean Winterberger
c594a95986 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54096 env-entry can use any type that has a String or char constructor
ab62370653 Merged revision 1406481 from tomcat/trunk: * globalresources.xml: Document the "closeMethod" and "singleton" attributes of a Resource element. The text is copied from context.xml.
e91294fa11 Merged revision 1406456 from tomcat/trunk: Move JAR Scanning-related properties into separate section. Correct a typo: the file is conf/catalina.properties.
6deee5f32a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54086 Ensure only a single thread tries to close the selector. Prior to this change both the NioReceiverThread and the thread that stops it called closeSelector() I also reviewed all other accesses to this.selector and fixed a handful of other potential threading issues.
18b1f3b8e9 Follow-up to HTTP parser changes
c6a447e15f Work-around that enables HTTP keep-alive to be deisabled for specified user agents using SPNEGO.
72cf54a491 Move media-type parsing to the new parser and drop the JJTree based parser.
05045b8024 Fix broken test (qop and nc are *not* quoted)
f84400a6d8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54060 Use new HTTP header parser to address issues in current regular expression based parser. This roughly twice as fast and generates about a third of the garbage (based on profiling the load unit test)
6e495be147 Make the nonceCountWindowSize configurable else the performance test fails.
cc4a115f73 Handle case where relative ordering refers to fragments that are not present in the application
b3a97fab19 Fix broken test by adding relative ordering to resources2.jar so it is processed after resources.jar
fd14428482 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54068 Re-write the fragment ordering algorithm to over come multiple problems. Expand the unit tests to cover the identified issues.
c0b576685c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54067 1xx response codes do not have an entity body. Prior to this fix 101 responses (HTTP upgrade) included "Transfer-encoding: chunked" which does not make much sense.
1cdb2eb637 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53867 Improve performance of XML escaping Based on a patch by Sheldon Shao
dc186989e6 Fix backport from trunk (no Java 7 features in 7.0.x).
ab25f2542a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53896 Use an optimised CompositeELResolver for Jasper that skips resolvers that are known to be unable to resolve the value. Patch by Jarek Gawor.
8ec8b61c62 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53960 Extensions to HttpClient test helper class Patch by Brian Burch
f36206d6b2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54054 Do not share shell environment variables between multiple instances of the CGI servlet.
04f21cd35d Fix EOL for test case. Copy fix to similar code in JULI.
161b5c6432 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54044 Add test case for BZ 54044
f3053dac29 Extend list of files to skip
2b8dc7e333 MIME types update: sync with Apache webserver mime.types file using res/scripts/check-mime.pl.
2afbc4a6f8 Expand test cases to cover BZ54025
c1b597c8cb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54022 Ensure Comet END event is triggered on client disconnect with APR/native on Windows Vista/2k8 or later. Patch provided by Douglas Beachy.
203da5df35 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54017 Simplify and reduce GC.
4421d180a1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54012 Enable the tag plug-in for c:set to work in tag files. Based on a patch by Sheldon Shao.
0ac99d9722 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54045. Make sure getMembers() returns available member when TcpFailureDetector works in static cluster.
94bb644e96 Add support for LAST_ACCESS_AT_START system property to PersistentManager.
70bfb64b01 Follow up to https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Simplify code. Based on a patch by Sheldon Shao
42bef4b64e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=54011 Fix copy/paste error and use correct attribute name Value is coerced to boolean in ctx.generateAttribute() so no need for additional conversion Patch by Sheldon Shao
fef31b188d Fix NPE in unconfigured VirtualWebappLoader. StringTokenizer throws the NPE if the virtualClassPath wasn't explicitely configured (null by default).
67d2f79742 Add getSessionIdsFull operation to mbeans-descriptor. listSessionIdsFull no longer exist.
0afa23d320 Expose the option to register an APR Socket for write as well as read events. This is currently unused but will be required when the (as yet unwritten) updated WebSocket implementation is back-ported from trunk as the JSR-356 API is non-blocking.
040645139a Fill in some Servlet 3.0 Javadoc
97b2898a3f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53993 Avoid NPE when the session is invalidated
9ca4ac14e3 Fix my errors. Reviewed by kkolinko
cb4fbea6f6 Servlet 3.0 Javadoc improvements
49f98081aa Update strings missed in r1397476
f24d6dbc57 Fix a long standing TODO so correct exceptions are thrown. Clean-up Javadoc.
ca8148298d Clean-up  - Servlet 3.0 Javadoc  - line-length
d2626bbce0 Fix WebSocket + NIO + HTTPS. Utilise underlying read buffer rather than trying to read the exact number of bytes. This is more efficient for HTTP and required for HTTPS since it is not possible to unwrap a single byte.
a016313832 Update changelog
8f93824447 Fix imports
a03cf5e571 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53986 Ensure current and reset Mark are always separate objects. Corrects issue with parsing JSP comments that end with "---%>".
1fd38efbf8 Announcement will go out once web site syncs
ead27676c8 Remove bugtraq: properties that were added in r1388712. Those properties are managed not here, but at the root of the project.
f77609a38c Adjust the changelog.
d19dd89fb4 Prep for next tag
927807370e Update changelog prior to 7.0.32 tag
d6a6dfb255 Merged revision 1393115 from tomcat/trunk: Update to Checkstyle 5.6
bd325e2976 Merged revision 1393071 from tomcat/trunk: Improve session management in CsrfPreventionFilter
ba8a2f40f8 Reverted r1381635 for further discussion.
ea42c9e9a0 Fix Javadoc
dc809028a8 Prep for next tag
4e2ea313a0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53854 Get directory listings working with aliases
8a4b51f311 Deprecate unnecessary code
be24285ace When the DefaultServlet is under high load, parsing the content-type header generates significant garbage and takes noticeable time. Add a simple cache to address these issues.
57b2c6bd0f Correct fix for BZ 53843 that triggered a TCK failure
d94e5ccc80 The "running" flag is moved out of "if" block.
62ca27c3a7 fix typo.
1a01ca97ad Fix a behavior of TcpPingInterceptor#useThread. If set to false, ping thread is never started.
3ef3ee2231 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53863 Ensure implicit Servlets (JSP, default) are marked as override-able when using embedded mode.
3bd2b14467 Take account of clusters and persistent session managers when checking if all sessions have expired.
db2715202d Make sessions in the session Store visible via the Manager web application if showProxySessions is enabled
b6e8cf9563 Review comments from kkolinko
be4b2c8f21 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52777 Implement optional automatic removal of old applications where parallel deployment has been used.
05fb2474ca Clarify difference between tag and version in Manager app.
fd58f3a281 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53843 request.isAsyncStarted() must continue to return true until the dispatch/complete actually happens (which at the earliest isn't until the thread where startAsync() was called returns to the container).
14e767d918 Add release date for 7.0.30
3023484194 Added multi-op modes to JMXProxyServlet.
5adb203b80 No functional change: a bit of clean-up before adding a new feature.
d9acccc86c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53713 Performance improvement (up to four times faster parsing) for JSP processing. Patch provided by Sheldon Shao.
f19e89b064 https://issues.apache.org/bugzilla/show_bug.cgi?id=52811 Retroactively add BZ 52811 to the changelog (7.0.27). It was implemented by r1300154 + r1300155 + r1304275 + r1304895
073f8ebb00 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53828 Use the correct status code
9337b9fa4c Merged revision 1380637 from tomcat/trunk: Correct a pair of typos in cluster MBeans descriptions
d25be01d72 Merged revision 1380635 from tomcat/trunk: Add one library from JDK 7 to the value of jarsToSkip access-bridge.jar is from 32-bit JDK 7u7 on Windows
09cb0a31f4 Additional fix for r1380072. Expose static members.
e84dbe6891 Doc updates
46ffe02a5a Cluster JMX improvements - expose cluster members - expose deployer
20800af002 Increment versions ready for next release
d6ac67bb4f Add a missing reset of the property resolved flag
00987943ca Revert r1379591
879687aa6a Remove unnecessary method calls. The Resolvers manage this flag.
de1e49098d Yet another attempt to fix Comet test failures for Connector stop. If the endpoint is stopped - don't add sockets to the poller (it may have been stopped already) and process the STOP event directly. If the connector stop has completed then the executor may be null so protect against NPEs and log when a socket couldn't be processed.
65cf5b48b6 Merged revision 1378322 from tomcat/trunk: Correct Javadoc for code added in r423453 (s/after trailer mark/before trailer mark/, and do not say 'trailer' as in the spec the term "trailer" has other meaning)
543463db44 Remove commented out code from a previous attempt to fix BZ53677
41ed2264bb Javadoc fixes. Inner classes. Grr.
9b6d20af9c Javadoc fixes
c31429f366 Add missing entries
91bcdd8e56 Overlapping URL patterns were sometimes merged incorrectly in security constraints leading to incorrect 401 responses. Note: it was possible for access to be denied when it should have been granted but it was not possible for access to be granted when it should have been denied.
d92d44fd4a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53677 Ensure a 500 response of the HTTP headers exceed the size limit
c2ea7dc9ad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53792 Support method expressions that include a method call that is not at the end of the expression
c9503be66f Implement fall-back for checking for failure when socket is closed before client can read response. Fixes intermittent issue on Windows.
e519f4e86b More chunked encoding improvements - Expand unit tests for chunked encoding - Fix a parsing error at eol when multiple headers are present (regression in r1378702) - Make parsing of terminating CRLF non-tolerant (RFC2616 only suggests to be tolerant of LF at the end of headers) - Revert previous unnecessary change to SimpleHttpClient
7994be3a80 Merged revision 1378818 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53800 FileDirContext.list() did not provide correct paths for subdirectories. Patch provided by Kevin Wooten.
85b8f74338 Add missing colon and whitespace.
dcc4af0593 Add some tests for Bug 53792
9bd782371a Resolve a FIXME and expand unit tests to cover CRLF vs LF checking.
6b41fb05c0 For https://issues.apache.org/bugzilla/show_bug.cgi?id=53725 A bit more safety. I do not see whether it is actually needed, but before r1378403 this call was protected by "!def.finished()" check. So I am restoring this protection.
6086b4ca3a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53725
72814b2b62 Revert fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=53725 (r1377343 + r1378378 + r1378389)
811243f7e1 Follow up to r1372390. Since decoded URI is used for matching, make sure it is set for the landing page. (kkolinko review)
b411feb8fc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53725 Flushing the single byte needs special handling to avoid corruption in some edge cases. There may still be other edge cases where this fails.
7e09009b8a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53725#c3 Fix FlushableGZIPOutputStream. It might be that the input has been consumed already, but encoder still produces data from its internal buffer.
d2525ff61a Merged revision 1378361 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53793 Change webapp links in Manager to point to /appname/ instead of /appname
0a92672158 revert change. vetoed per http://tomcat.markmail.org/thread/6hmjgrzys5txekew
6aaecee20b Merged revision 1377900 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42181 Better handling of edge conditions in chunk header processing.
3141e7fbdd Update for new default
f78c0cdfc8 Merged revision 1377887 from tomcat/trunk: Remove unneeded handling of FORM authentication in RealmBase.
1956dace6e Update documentation to include the new value
4a3b7df9b3 Improve concurrency of DIGEST auth
bdbe1daee4 Correct section
0389ee4daf Better handling of exception
a4b9dcae97 Take advantage of new ConcurrentMessageDigest
459be0f7da Add a MD5 digest method as it is the most commonly used.
7997a8a338 Followup to r1377688
74a0585c82 Digest improvements: - disable caching of authenticated user in session by default - track server rather than client nonces - better handling of stale nonce values
1f9153cc4d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53783 Handle case where tool generating JARs does not generate entries for directories. Patch by Violeta Georgieva.
43662f0117 Per http://markmail.org/message/nqnogctvfuyzhtol
82ad7c88ff Per patches supplied in https://issues.apache.org/bugzilla/show_bug.cgi?id=53267 Don't hard code the value, make the default the same as the hard coded value
083ddbbbc1 Revert r1377511
f191db9109 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53758 Fix Dynamic Filter Registration mapping logic inverted
41ceb31a2b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53735 Merge updates from Commons BCEL that provide the limited Java 7 support required for Tomcat's cut-down BCEL fork.
0f61865612 Remove unused dump() method and attributes
363d1f282e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53737 Access JSP configuration information via the ServletContext rather than re-parsing web.xml
8b60c11859 Merged revision 1377444 from tomcat/trunk: For https://issues.apache.org/bugzilla/show_bug.cgi?id=53047 Update documentation. Thanks to the changes introduced by implementing BZ 53047, the roleNameCol and userRoleTable attributes in JDBCRealm and DataSourceRealm became optional ones.
5a2c9d8e9e Merged revision 1377433 from tomcat/trunk: Fix typos etc. in code that prints "merged" web.xml
54f9558513 Fix corruption in some GZIP'd content
f4e0f3cadd Merged revision 1377311 from tomcat/trunk: Mention the %{xxx}t pattern in AccessLogValve javadoc. Correct markup in valve.xml. (<ul> cannot be nested in <p>)
b55fdf0b61 Merged revision 1377292 from tomcat/trunk: Add two files to the value of tomcat.util.scan.DefaultJarScanner.jarsToSkip property.
19cfe85a21 Merged revision 1376994 from tomcat/trunk: Fix Javadoc comment typo
0feb980412 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53714 Provide a means of excluding JARs from pluggability scans, TLD scans or all scans.
be738d552a Use LinkedHashSet to preserve ordering
336d42d497 UCDectector  - Deprecate unused code
c5f1ef3138 UCDectector  - Use unused constants where appropriate  - Deprecate unused code
2ce01b8b51 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53697 Fix a regression in the fix for BZ 51881 that mean that in some circumstances the isComet flag was not reset on the HttpAprProcessor. This caused problems when the Processor was re-used for a new connection.
804d48050d Always make the final web.xml file available
ec1710ddec Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53702 <jsp-property-group> may contain multiple <url-pattern>
da9a5ac508 Clean-up l12n messages
11f5410c70 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53654 Support file:// URLs for JSP dependencies Patch provided by Viola Lu
f12e47c3db Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53624 Remove some include specific code from dispatch, copied when the doDispatch() method was created. Note that this bug report pre-dates that copy. At the time of the bug report, dispatch was implemented by calling include()
71cbff0d2c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53623 Async dispatches require similar handling to RequestDispatcher.include() hence the implementation of async dispatch uses RequestDispatcher.include() However, since RequestDispatcher provides no API for differentiating between and INCLUDE and DISPATCH some form of trickery has to be used. The previous implementation worked in most cases but failed in some cases (multiple forwards prior to dispatch, wrapping the request). This alternative implementation calls a specific method on the RequestDispatcher implementation (we have to access the implementation class since we can't modify the servlet API) which removes any ambiguity and allows the correct handling in all cases.
cad1a3d412 Javadoc fixes provided by Sebb.
788eb39fd1 Additional fix for http://issues.apache.org/bugzilla/show_bug.cgi?id=53584 Store decoded and original request URI. Restore both. Use decoded for matching.
a966241207 Deprecate duplicated constants
ecc4853bc5 Add additional check on current behaviour to try and catch any regressions in the fix for 53623
202aa69587 Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53071 Trim long exception messages
ae49b9a607 Minor cleanups: Add missing ':' in changelog. Mark r1370549 as merged.
cd2c11c90d Remove unneeded svn:mergeinfo properties The merge with r1371896 has already been recorded on tomcat/tc7.0.x/trunk/ in r1371900 The values were /tomcat/trunk/modules/jdbc-pool/src/main/java/org/apache/tomcat/jdbc/pool:1371896 /tomcat/trunk/modules/jdbc-pool/src/test/java/org/apache/tomcat/jdbc/test:1371896
0377e8b568 Set svn:eol-style=native
c319338bf6 Update comments and change-log post clarification from the Servlet EG
4bec4206cb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53574 Ensure Servlets defined using jsp-file are available when metadata-complete is true.
9220f08d2f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53601 Clarify that building Tomcat 7 from sources requires Java 6 JDK.
0c3ce72eae Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53545 Ensure buffered data is cleared when using a jsp:forward action to a static resource inside classic a custom tag
5ca739353f Need to reset content length as well to ensure custom error page is not truncated.
d65581bc9a Fix JAR scanning when WEB-INF/lib is provided via VirtualDirContext Patch provided by Philip Zuev
46ad844236 ConnectionState must supported with short name too.
648c0f7e8c tab police
70887c5f66 Added missing changelog entry.
1d5605358e Updated mergeinfo
a77483d579 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53653 Allow for wrapped source code example in config/context.html
a535fb57b2 Removed file inadvertently added with last commit.
e49e367d23 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53481 Added support for SSL_OP_CIPHER_SERVER_PREFERENCE / SSLHonorCipherOrder.
c9e22277b0 Deprecate code that will be removed in 8.0.x
4664a130ea Deprecate code that will be removed in 8.0.x
5fd572300f Deprecate code that will be removed in 8.0.x
eb8f7c3b45 Document the constants that were added to the RequestDispatcher interface in Tomcat 7. Mark them as "@since Servlet 3.0". It is backport of r1370916.
32f3bc3884 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53641 Correct name of HTTP header used in WebSocket handshake for listing the preferred protocols
af69e30a8b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53584 Ignore path parameters when comparing URIs for FORM authentication. This prevents users being prompted twice for passwords when logging in when session IDs are being encoded as path parameters.
1d977f310f Deprecate unused code
0f888257e3 Deprecate unused code
bde60e6fce Deprecate unused code
60301e2654 Deprecate unused code
e25c4d5017 cleanup
b30a4fc517 implement equals and hashCode so that they survive connection closure
6b1daf72aa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53607. To avoid NPE, set TCP PING data to ChannelMessage.
f54476c56a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53606 Fix possible NPE when sending pings between cluster nodes Based on a patch by F.Arnoud
958aa45002 Add missing entry
8a4d587367 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53535 Reduce memory footprint when performing class scanning on Context start. Patch provided by Cedomir Igaly
38f80abb64 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53469 If the relative URL can't be made absolute, do not encode it and return it as is
e8a782aed0 FindBugs: Fix potential NPE
379d2cf168 Add @Deprecate annotation, aligning code with javadoc, as prompted by Eclipse. It is followup to r1360851.
d5aaf811fb Deprecate unused code
c3ea7fee8e Deprecate unused code
c6ea8be09f Don't parse username twice with different methods
87a44e8532 Fix (normally unused) DIGEST performance test. Failing to clear the cached principal meant that the DIGEST auth was only performed once per thread
7457019968 Make utility method static and deprecate/remove unused instances
8639996848 Deprecate unused code
64a526c203 Deprecate unused / unnecessary code
8dc04588ca Deprecate unused / unnecessary code
58a6f211fc Remove redundant output of error message from error report.
f2f43c7b26 - Update list of HTTP status codes.
cf9b1f6c1f Revert r1361434: method is not deprecated. Add javadoc to clarify method use.
ebffe5fdc8 Add getter/setter for roleSearchAsUser
a2e744eab1 Deprecate unused code Remove deprecation markers from JAASReam#setAppName
7d1ba2b8d6 Deprecate unused code
17b4b1939a Deprecate unused code
76619d6351 Deprecate unused code
f64a176bfd Deprecation prior to removal in 8.0.x
f5f1bc72ac Deprecate unused code
50c1109cca Deprecate so they can be made private in 8.0.x
817bc5b07b fix override annotation
99d2407659 jdbc-pool is branched off into Tomcat 7 so that refactoring can take place in trunk
695c1de8e4 Add missing word
2dfad07bd1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53524 Fix typo and spelling
249193da99 Handle fragments as well as query strings in normalisation of redirects
57b0e5d82f Back-port of change to ExpandWar.expand to check return value of docBase.mkdir.
0780b9fce4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53062 Correctly handle case where redirect URL includes a query string (with test cases)
85fbd50898 Fix NPE observed running unit tests with APR on Linux
660d2ff73f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53513. Fix race condition between the processing of session sync message and transfer complete message.
82e2618354 Add 7.0.28 release date (today)
f46a358a13 Cannot set traffic class on a socket returned from accept(). On Java 6 it is always ignored. On Java 7 BIO ignores it, NIO throws an Exception
2e466012e1 Further testing shows that this has no affect for BIO for a socket returned via accept()
710516baa9 Java 7 throws an exception when a socket option cannot be set. Move option setting to before connection is completed since at least one option (traffic class) can not be set after the connection is completed. For NioReceiver, I don't see a way to set traffic class on an accepted connection so simply remove it (it is ignored when using Java 6)
2197da0000 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53498 Fix atomicity bugs in use of concurrent collections. Based on a patch by Yu Lin.
e7b0d29f9b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53505 Update JSTL version info
5425978e9d Added information about and links to the Manager's JMXProxyServlet.
27d524fb55 Merged revision 1356505 from tomcat/trunk: Automatically delete temporary files used by Servlet 3.0 file upload when request is recycled.
e7dc567109 Increment version ready for next tag
c84a35490f Add missing deprecation annotation
e2826fb4e3 Deprecate test of deprecated code
836a4822e7 Remove unused code
b8e52ead09 Fix typo
e991b503bd Merged revision 1356045 from tomcat/trunk: Document roleNested property in JNDIRealm configuration reference. Better document its effect on roleSearch pattern. Rephrase descriptions of userRoleAttribute (was added in r1355615 (r1355617)).
9fcf2d9337 Merged revision 1356014 from tomcat/trunk: s/Catalina/Tomcat/ and several typos
dea95176a1 Review of r1355615 (r1355617) Correct obvious typos Remove trailing whitespace as reminded by checkstyle It is merge of revision 1356007 from trunk.
d882520795 Merged revision 1356006 from tomcat/trunk: Provide more specific command example for running the "validate" target
ca0b463582 Set svn:eol-style = native
164155951d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52135 Implement support for a default error page. It appears that this was meant to be in the 3.0 spec but got left out in error.
d7b0a1ae6a With more and more use of RFC 2307 http://tools.ietf.org/html/rfc2307 There is a new way to search for roles using the memberUid that can contain the value of another attribute within the users directory entry. This may not be very specific to 2307, but that is where I see this combination of role searches occur the most.
111b076878 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53454 Return correct content-length header for HEAD requests when value is > 2GB
db75de001b Correct typo in r1354686 It is merge of revision 1354817 from trunk
bd5bf64e09 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53473 Correct documentation and web.xml comments for SSI isVirtualWebappRelative option since the allowed values are true or false
ea6a3a8c61 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53467 Use more explicit URI constructor to ensure components are correctly encoded.
177b1a3f35 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53416
aae1007dc4 Make the request available when the WebSocket connection is being created
7d4e28a4b4 Add finals
655bc11d9f Add file missed in r1354258
f1436b8cf7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53465 Populate mapped-name property for resources defined in web.xml Based on a patch by Violeta Georgieva
26f81ac395 There are two parts to this fix: - don't swallow exceptions when the PageContext can't be created - if the PageContext is null when an error occurs (and therefore can't be used to handle the error) propagate the exception wrapped in a ServletException and let the container handle it.
e8d3ac61cd whitespace police
8ac664f65f Fixed https://issues.apache.org/bugzilla/show_bug.cgi?id=53445
75a3014f79 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53464 Correct file location (it was moved from Commons Daemon to bin/)
28b69e7103 Align protocol values with the surrounding text
afcc3bd5f0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53459 Fix SSLVerifyClient option in APR SSL example and further clarify how to modify server.xml based on the desired connector implementation.
06c586d218 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53456 Minor fixes to the HTTP docs. Patch provided by sebb.
a3ee0ea108 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53430 Fix problems with missing / wrong version of APR/native library when APR connector is explicitly configured. Protocol now declares if it needs the library and the connector ensures it is available if required.
0d3f654418 Deprecate unused code
fadfceac73 Revert most of changes in ant/antlib.xml per user's comment on dev@. http://markmail.org/message/izcghp5z6hv3dp6j
f63489e13a Merged revision 1353261 from tomcat/trunk: s/taskdef/typedef/ in catalina-tasks.xml
018506d818 Align Ant tasks definitions in *.tasks files and in antlib.xml files. Some tasks were defined only in one of them. It is backport of r1353240
124a258380 Correct typos in documentation
3802c04c5d Provide more useful error message when bean property getter/setter cannot be found.
3cfcfcb95f Merged revision 1353087 from tomcat/trunk: Correct typo in a message
475367c140 metadata-complete does not control the processing of ServletContainerInitializers
6f45d52702 As per clarification from Servlet EG, version declared in web.xml does not control annotation scanning. I don't like it but the EG was very clear this was the intended behaviour.
358c15858f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53450 Correct regression in fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52999 that was likely to cause a deadlock when deploying a ROOT web application.
b2b9150c24 Port clean-up from trunk
dbfcdae36e Merged revision 1352011 from tomcat/trunk: Correct description of UserDatabaseRealm
f0d1a37aa5 Merged revisions r1351991, r1351993 from tomcat/trunk: For https://issues.apache.org/bugzilla/show_bug.cgi?id=50306 Improve StuckThreadDetectionValve: - Add getStuckThreadNames() method, callable through JMX - Add thread ids to the log messages
c5490ab8c2 Merged revisions r1351636 r1351640 from tomcat/trunk: Change formatting of the Realm configuration reference. <h3> -> <subsection>, so that they are listed in Table of contents.
27880ff463 Add missing changelog tags
154bb86ef4 Merged revision 1351604 from tomcat/trunk: Fix Checkstyle exclusion pattern for MANIFEST file of jdbc-pool module. The file does not pass validation because of trailing space characters on two lines, which are required by manifest file format.
0f726438a7 Exclude manifest files from checkstyle
97a6f85d82 Manifest files are text files.
067b52edd3 Clean up minor issues in source distribution
b54b21252e Merged revision 1351068 from tomcat/trunk: Properly close input streams in TestNamingContext.testAliases().
a322ce35d7 Merged revision 1351056 from tomcat/trunk: Correct reference to Apache Batik project It now lives in xmlgraphics.apache.org.
ec818fda26 Merged revision 1351054 from tomcat/trunk: tabs -> spaces, as reminded by Checkstyle
2eae24c328 Fix the WebSocket examples so the work with secure as well as non-secure connections.
b721cb65ad Correct typos
c937d2966b Fix checking recommended tcnative version.
82e3205e2e Simplify Maven publishing - Use Nexus throughout - Remove now unused scp related sections - Prompt for passwords rather than reading them from a file
bcf962e0fa Update version for next release
a7cc548015 Mention Tomcat-Native version update (r1349937) in the changelog.
7e1ed8f01b Implement maxHeaderCount attribute on Connector. It is equivalent of LimitRequestFields directive of Apache HTTPD
4b57ec6240 Merged revision 1350294 from tomcat/trunk: Improve InternalNioInputBuffer#parseHeaders() Move the code and s/end/pos/
57bf6a9890 Deprcate code to be removed in 8.0.x
1c780c1ae9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53173 Remove some duplicate calls to countDownConnection() While the connector is running, destroySocket() will call countDownConnection() Once the connector is stopped, the latch is removed so it does not matter that destroySocket() does not call countDownConnection() in that case
8172442f48 Make sure that the revisions are up to date prior to tagging
a4f47daf3c Update changelog
643f1a77ae Update merge info
13cc469d80 Update APR SSLProtocol defaults and configuration
0d3ebe32c3 APR 1.1.24 is now required. Remove unnecessary code.
93ff6fe823 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53074 Make WebSocket connections use infinite read timeouts by default.
7ed2c07299 Simplify the APR poller now per socket timeouts are supported
64545c7b3c Add per socket timeout to JNI API
c4994e7635 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53406 Fix possible stack overflow on connection close when using Comet (fhanik)
49310f2edf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53403 Correct specification version reference to include new specification versions
0ad22057c2 Remove unused code
1f07b3ff88 Merged revision 1349539 from tomcat/trunk: For https://issues.apache.org/bugzilla/show_bug.cgi?id=50182 Review of r1349477: use more simple code when converting a list of mime types into array and ignore empty strings.
9c412aa47a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50182 Various improvements to the compression filter example. Patch by David Becker
645b8aaa36 Merged revision 1349410 from tomcat/trunk: Review of r1349300: Make ReadWriteLock fields final (the new one and an old private one as well).
994f4ba967 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52954 Be tolerant of slightly broken Android implementation of DIGEST auth. Security is not impacted.
b5efb44249 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52999 Remove synchronization bottleneck in container event handling
8ed26d430b Refactoring has been completed in fix for BZ 48870
7bb357be4d Deprecate pointless constant
e0e04de770 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53266 Handle missing classes defined in @HandlesTypes more gracefully - the specification requires it should not stop the web application from loading
5138e19d97 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53398 recieved->received
2c4fb296e4 Clean properties
c5bb727d6c Additional Comet test cases for connection closing
b99eeb87e6 Javadoc fixes
d2aa115b59 Fix logic
8911d4deb7 Throwable.getMessage() might be null
a6cfb8a9a0 Update changelog
0895ab6c15 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53071 Stepping through the code, light dawns as to what the bug report was getting at. Use the message from the Throwable for the error report if none was specified via sendError()
de486b16f1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53071 Add a test case that confirms this issue does not occur in trunk
2bba7660db Merged revisions 1348461-1348495 from tomcat/trunk: r1348461, r1348490 (kkolinko) Further improvement of RUNNING.txt. Mention CATALINA_PID, as it is another frequently used environment variable. Address Mark's review comments. Document Apache Tomcat Native and Apache Commons Daemon. ........ r1348495 (markt) Review by native English speaker as requested. Mostly a/the changes and inserts Re-worded a few sentences that didn't scan cleanly Removed the section on Win 95/98/ME since they are all well past end of life. ........
239b0e3299 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53047 If the Realm is configured for an authentication only all roles mode and no role table or column is defined, don't populate the Principal's roles
e852345be8 Merged revision 1348425 from tomcat/trunk: Rephrase instructions for installing Tomcat. Improve description of environment variables. Mention CATALINA_OPTS.
9f9273932a Merged revision 1348398 from tomcat/trunk: Review of r1345026, comparing it with proposed patch for BZ 52955: Add final modifiers to improve thread safety Add BZ 52955 to changelog - it has been implemented in r1345026.
812ab80619 Merged revision 1348357 from tomcat/trunk: Add dependencies and description to "validate" target in build.xml, so that it can be run separately. Improve documentation for running with Checkstyle. Add documentation for ends of lines check ("validate-eoln").
9a4d8d2d19 Merged revision 1346519 from tomcat/trunk: Review of r1298986 (r1298983) Update comments Update for one field name variant used by Apache Harmony. Do not test Method and Field handles for null, as NoSuch(Method|Field)Exception is thrown instead of null value This aligns Tomcat 7 with patch proposed for Tomcat 6.
30fdbc4ab6 Merged revision 1348105 from tomcat/trunk: Documentation for property maxQueueSize that was added in r723889
023f99174f Add changelog entry for r1301256 (r1239899 in trunk). It is in 7.0.27.
5887a14feb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53374 Update external to reference r1348056 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53374 Fix support for the following properties in DataSourceFactory: commitOnReturn rollbackOnReturn useDisposableConnectionFacade logValidationErrors propagateInterruptState
10ac2c6476 Merged revision 1347737 from tomcat/trunk: For https://issues.apache.org/bugzilla/show_bug.cgi?id=53057 Better wording for OpenSSL version number message that was added in r1312006. This is because OpenSSL version number includes name of the library.
27bdd03364 Merged revision 1347583 from tomcat/trunk: Review of r1347108. Better cleanup if the test fails: - schedule temporary directory for after-test cleanup immediately, instead of after successful test run. - close output streams even if write fails.
c9dc698c52 Backport of r1347108 and 1347109 from trunk: clean-up of test case.
ee99b817ee Merged revision 1346885 from tomcat/trunk: https://issues.apache.org/bugzilla/show_bug.cgi?id=48097#c7 https://issues.apache.org/bugzilla/show_bug.cgi?id=53366#c1 If _jspService() in generated JSP page code unexpectedly cannot properly handle an exception because _jspx_page_context initialization did not happen, log it instead of silent swallowing.
76c3199bb0 Back-port of r1347087 from trunk. Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53373 Trim whitespace from around <Context> aliases delimiters (,=) to improve readability of many aliases.
7dcd4d8ddd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53368 Make WebSocket play nicely with a security manager (kkolinko)
990dd20777 Bugs should be in numerical order (as per the comment at the start of the changelog).
3bf8160285 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53366 New http header parser needs to be pre-loaded when running under a security manager
52ff7d31b9 Fix (hopefully) persistent failure of Comet unit test for connector stop when the END event is not received
ceb8dd09e6 Remove svn:merge-info property on EchoMessage.java, that was added in r1346684
19268c5a42 Re-merge r1346683, r1346794 This only updates svn:merge-info, marking those revisions as merged.
c7caddd260 Merged revision r1346404 from tomcat/trunk: Add a test for CharChunk.indexOf().
5a7260e882 Add support for SecureRandom to cluster manager template.
13abc392ab Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53367
a65671100b Clean-up: avoid NPE and immediate catch when init parameter does not exist. Also do not assign default value unless necessary.
4c6a34488a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53230 Changed exception type thrown when session manager exceeds active session limit.
001d0ccc8d Restore deleted file
1f99fe2f01 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53032 Modify JspC to extend o.a.tools.ant.Task so it works with name spaces The main change is that execute() no longer throws JasperException so it matches the signature for Task.execute(). This required a small change to main()
0a860b8261 Remove unused file
73ce0aa25d Additional fix. Correct context & servlet paths
1b57382091 Fix eol
ed4e7f4c13 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53356 Add support for an explicit mapping of a servlet to the context root
4e30b9b84c Merged revision 1346376 from tomcat/trunk: Review of r1345367. Rename new public API method added in r1345367 so that the name were less ambiguous.
a111ce3ac5 proposal
d2c81ccfa6 Create STATUS file for Tomcat 7.
d8fbfd8f2a Rework fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=53333
6515f9ca61 Merged revision 1345846 from tomcat/trunk: Code formatting (indents). No functional change.
1d80f03f5f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53354 Don't add empty filter mappings to the set of mappings - they'll fail validation
5d89e1f15d Merged revision 1345779 from tomcat/trunk: Review of r1345737: Correct copy-pasted comments to match the method that is actually called there.
d19509ff35 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53353 Make the HTTP header parser for ContentType tolerant of invalid parameters with names but no values. The invalid parameters are available in the collection of output nodes but skipped by the various toString() methods.
2aa4cdab4a Add quotes that were missed - tests still pass
1445d5d1c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53339 Ensure WebSocket event calls are made using the web application's class loader. Includes a test case.
4b9f5d2194 Refactor - no functional change
fae00b77c5 Extend test cases for BASIC auth and RFC2617 compliance. Patch provided by Brian Burch.
9e6b0f7ae7 Fix typo
affb87d2d6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53337 Fix RequestDispatcher.forward() to an async servlet. Includes a test case based on code by Rossen Stoyanchev.
040d9fd5ad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53333 Validate JNDI resource types against injection target types and use target types when no type is specified for the resource. Based on a patch by Violeta Georgieva.
e9a48559f3 Correct typos
2f249c09c6 Correct wording
e5a86da61a Merged revision 1345357 from tomcat/trunk: For https://issues.apache.org/bugzilla/show_bug.cgi?id=53257 Review of r1344902: restore passing DirContextURLStreamHandler instance into the new URL.
5228dc73d8 Merged revision( 1345309 from tomcat/trunk: Update exclude rules for RAT report
2f24c50fe2 Merged revisions r1345287 r1345290 from tomcat/trunk: Remove trailing whitespace from ContainerBase.java Add one more test for https://issues.apache.org/bugzilla/show_bug.cgi?id=53257
3341c2625a Add missing test case file
da11881a10 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53301 Prevent double initialisation of servlets when using existing servlet instances with embedded Tomcat
f27b51e95c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53342 To avoid BindException, make startStopThreads into a demon thread.
68ad33219e Modify how the digester processes security-role-ref since link is optional and null parameters are not handled by IntrospectionUtils
ed72b881d7 Fix checkstyle warnings in Ant build
71cf9b6cb7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53257 BZ 53257 is partially a regression caused by r1152593 (the fix for BZ 51584) and partially an existing issue that had always been present. This patch: - reverts r1152593 - extends the test cases to cover BZ 53257 & BZ 51584 - correctly fixes BZ 53257 & BZ 51584 - fixes the additional issues the unit tests uncovered
c0498c4634 Merged revision 1344725 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53115 Allow "catalina.bat run" to work even if %TEMP% contains spaces. Note that it affects "run" command only.
606fe03c6e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53225 Fix ISE "zip file closed" when urlCacheProtection="false" in the JreMemoryLeakPreventionListener
a97bb83cc6 Additional JARs to skip for annotations, initializers etc.
a319429bc8 Correct typo
0b219e1769 Merged revision 1344528 from tomcat/trunk: Note that Remote Host Valve|Filter needs enableLookups being enabled on a Connector.
8ec940c720 Merged revision 1344515 from tomcat/trunk: Organize imports to pass Checkstyle.
027ece51e2 Resurrect method of NioEndpoint$Poller that was removed in r1342473 I think it is an internal method, but compatibility concerns were stated in "Re: r1342473" thread. Anyway, it is easy to re-add it.
915ec36e22 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53169 Allow servlets to opt to avoid chunked encoding with a response of unknown length by setting the Connection: close header. Based on a patch suggested by Philippe Marschall.
881848f52e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53119 Make sure the buffer is cleared on any error to prevent any possible overflow if it is written to again before the connection is closed. I can't reproduce the error with the provided test case but based on code inspection this should fix it.
e1e8edcd9e Move to correct section
fe0abe3cd1 Merged revision 1344068 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53322 Follow JavaBeans specification when converting setter method name into property name for resource injection.
0cdc51db5e Merged revision 1344063 from tomcat/trunk: (Followup to r1343721) tabs -> spaces.
2e06a74b8a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53267 Stop the JreMemoryLeakPreventionListener triggering a full GC every hour
c1a29d3536 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53180 Add additional checks when looking for a setter method. Patch provided by Violeta Georgieva.
b591477ec6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53081 Do not always cache resources loaded by the web application class loader
a4134c16d3 Merged revisions r1335547 r1343629 from tomcat/trunk: Fix typos
3c94bee2d9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53161 Better error message if a ClassFormatException is encountered during annotation scanning and do not fail to start the web app in that case.
9a8feac8c6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53090 Include superclasses when considering injection targets Patch provided by Borislav Kapukaranov
b97ed6bc1b Merged revision 1343335 from tomcat/trunk: Correct broken HTML in Javadoc comment. <engine> -> &lt;engine&gt;
4803926453 fix for Konstantin's review. Use ContextConfig.getBaseDir() method instead of system property.
190d582fa7 Merged revision 1343045 from tomcat/trunk: Followup for http://issues.apache.org/bugzilla/show_bug.cgi?id=53034 Correct license name and version
196382dc64 Merged revisions r1343044 r1343046 from tomcat/trunk: LICENSE, INSTALLLICENSE: Note that jsp_2_2.xsd is covered by CDDL 1.0 NOTICE: Reorder file names to be closer to alphabetic order.
9ace25a3dd BZ53034. Improve POM license info
d37d378605 Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52055. Ensure ChunkedInputFilter is correctly recycled.
593aeb2f71 Merged revisions r1342498 r1342503 from tomcat/trunk, updated jdbc-pool external to r1342500: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53289 Clarified ResourceLink example that uses getConnection(username, password) Improved JDBC pool documentation on jdbcInterceptors and alternateUsernameAllowed attributes.
ee18d2dc91 Merged revision 1342476 from tomcat/trunk: Fix documentation of default value of "xmlBase" attribute of Host. The place where it is already documented correctly is Host.getXmlBase() and Host.setXmlBase(). The actual default value is calculated in HostConfig.configBase().
971323f054 Merged revision 1342320 from tomcat/trunk: Simplify. The "req" argument in processSendfile() is always true,  and it is no more used since r1340215
f4949a4ea6 Merged revision 1342315 from tomcat/trunk: Followup for r1340215 Move new log message below unreg() call and align it with similar debug messages, fixing a couple of typos.
cfd5e33dc1 Enable host's xmlBase attribute in ContextConfig.
692e17509d Update external: Fix unused imports to make checkstyle happy.
2bfb3fbd7e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53138 https://issues.apache.org/bugzilla/show_bug.cgi?id=52858
3a92275c4c Add in ability to purge the pool https://issues.apache.org/bugzilla/show_bug.cgi?id=53254
b2dc1a7880 When a connection is disconnected, make sure we reset the cached values. This can happen during a failed validation when reconnect() is called.
3419059a0c Merged revision 1338178 from tomcat/trunk: Correct one JavaSE documentation link
c8f83b7538 Merged revisions r1338151 r1338154 from tomcat/trunk: Correct links to Java documentation Those are at docs.oracle.com now.
e91146a333 Merged revision 1337745 from tomcat/trunk: Pass correct URL to encodeURL() call and safeguard it later.
23aa4f02df Merged revision 1337741 from tomcat/trunk: Pass all string values through the filter in RequestInfoExample servlet.
66f313c13f Merged revision 1337734 from tomcat/trunk: Simplify code and correct HTML markup in RequestInfoExample servlet.
17769595fc Merged revision 1337719 from tomcat/trunk: Fix several trivial HTML markup errors in example servlets e.g. duplicate <body> tag preceding <head> one.
933b7ca161 kkolinko review of r1337643
cf1fd30ba6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53067
3b1985f04e Merged revisions r1337591 r1337595 from tomcat/trunk: Followup to r1336516 Add Javadoc (as asked by sebb) and avoid looking up a volatile field twice
47a5ecdf8d Update changelog
29f95e268f Merged revision 1337572 from tomcat/trunk: https://issues.apache.org/bugzilla/show_bug.cgi?id=53203 Correct documentation of default value of connectionTimeout for AJP protocol. See org.apache.coyote.ajp.Constants.DEFAULT_CONNECTION_TIMEOUT
0270ca9afb Merged revision 1337546 from tomcat/trunk: Clarify the effect of maxActiveSessions attribute of a Manager.
d8b1c56b0e Merged revision 1337426 from tomcat/trunk: In TestCometProcessor: add diagnostic message that reports whether END event has ever been received.
3342c9d0ae Merged revision 1337419 from tomcat/trunk: Correct typo in a link (followup to r1336889)
f5fe2aa3bd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53063 When using an Executor with BIO, use the executor's maxThreads as the default for maxConnections
390021bce7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53062 Normalize redirect URLs constructed from relative paths
f53eb98f9e Fixed typo.
48a74569d9 Fixed documentation for maxInactiveInterval: default is 30 minutes, not 60 seconds.
2b95038b4c Fix a problem whereby if the poller was under low but consistent load (>1 request/per second and always less than 1s between requests) timeouts never took place. After the change, timeouts will be processed every X seconds where pollerTimeout <= X <= (timoutInterval + pollerTimeout + time taken to process timeouts) Note the default values for pollerTimeout and timeoutInterval are 1000ms
c7207f82ae Add public method to retrieve the current connectionCount from an endpoint.
637555db5b Ensure maxParameterCount applies to multi-part requests handled via Servlet 3.0 file upload
0e8255392c Changelog update
d1163ac34c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53034 Add project.url and project.licenses sections to all the POMs
ded2a9fd0d It appears that pausing requests for a Context during reload was relying on the mapper not being cleaned up correctly. The Lifecycle refactoring cleaned up the mapper registrations and broke the handling of paused requests. This commit restores that functionality and extends it. The key changes are: - Contexts are no longer from the mapper if they are stopped while they are paused - The CoyoteAdapter pauses for 1s if a request is mapped to a paused Context and then tries to re-map it. This replaces the reloading handling in the StandardContextValve - The reload handling has been removed from the StandardContextValve - Editing a watched resource now triggers a reload (that pauses requests received during the reload) rather than a stop/start which will return 404s for requests received while the context is stopping and starting
5dacfd4808 Deprecate unused code
00c4c6118f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52853 Clarify how JarScanner handles directories.
df011e62dc Make sure ContextMBean#findFilterDefs returns correct filter definitions.
eaf1db1122 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52055 Ensure input filters are recycled when the request is recycled for all connectors.
f446a10129 Use a proper URL else attempts to external entities will fail.
f5d5a6fdb5 Modify the default pollerThreadCount as processors go, it gets very polluting and resource wasting to have 24,48 or 64 and more poller threads Very hard for applications to see a performance benefit of more than 2 pollers
c956820f0a Fix trivial docs typo (missing ")").
fc14de5974 Removing obsolete bug warning.
62f10d6c13 update changelog for https://issues.apache.org/bugzilla/show_bug.cgi?id=53173 fix
bf619b9197 https://issues.apache.org/bugzilla/show_bug.cgi?id=53173 Properly count down maxConnections
55478475de BZ 53158: Fix documented defaults for DBCP. Patch provided by ph.dezanneau at gmail.com.
9b93408930 Make sure complete message takes priority over access message.
362d896b70 Apply Konstantin's suggestion. "if (diff && (isDirty || complete))" block was executed regardless of the value of "complete".
88186d4621 Merged revision 1327670 from tomcat/trunk: Save a bit of memory in annotations cache in DefaultInstanceManager occupied by unused entries in annotation lists.
12f1cfb1bd Delete explicit svn:mergeinfo property on org/apache/catalina/core It was updated on each merge involving that subtree. I see no reason for it to be there - all mergeinfo is already in the root of the project.
2d85ed06e0 Reduce indent 8->4. No functional change. Backport of r1327617
d0b22233d4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53087. In order to avoid that a backup node expire a session, replicate session access time in BackupManager.
d8285c7e1f use StringManager.
0ad980a075 Avoid NPE when reload if a state of a BackupManager is FAILED.
dd71321397 Updated mergeinfo.
02f36b974e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53057 Add OpenSSL version number INFO log message when initializing
14bc343ba2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=53056 Add APR version number to tcnative version INFO log message
c02548157f https://issues.apache.org/bugzilla/show_bug.cgi?id=50864 Allow most pool properties be configured using JMX
25971bd117 Fix comment
3877720410 changelog: Correct a typo and hilite attribute names
8344fbaadb Add bug reference. Correct protocol name.
fe0cc78ce8 Update changelog
44e3603f7b Remove TODO (ThreadLocal would have been a bad idea here)
2042876ce5  Add missing dependencies
557cc49313 Checkstyle, Eclipse, typo and style fixes
9aa3e6ad6f Fix potential bottleneck on accepting new WebSocket connections
5ae8c86c6a Send header with uppercase header
b531bc3142 update to ecj 3.7.2
9e2a3981b4 Correct websocket protocol version detection
a9375246bb Change of an attribute name. enabled and disabled are changed into allow and deny.
671063ec3b Add the release date
665ae8514c Prep for next release
f55fe59416 Add new attributes of enabled and disabled to UserConfig.
5605951c7a Update changelog
0d7167efe5 Merged revision 1307597 from tomcat/trunk: Followup to https://issues.apache.org/bugzilla/show_bug.cgi?id=51741 Remove wrong call. The tests pass for me with this call being removed. If allowLinking feature is really needed, it should be configured explicitly.
a612f7b631 Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52998 Cache ExpressionFactory class per class loader (kkolinko)
35b5cb8b4f Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52998 Remove static references to ExpressionFactory. These should be per web application.
9b74c94f89 Refactoring. Move class name discovery into separate helper method. (kkolinko)
1e387a6ced git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1307514 13f79535-47bb-0310-9956-ffa450edef68
4d901afa44 Fix a hanging test with APR. Connections using HTTP keep-alive were not closed on Endpoint.stop() so a stop() start() sequence meant they were kept open with any data sent being ignored until the connection timed out.
752bfaf5fe http://markmail.org/message/j7jk7xalhs7t7op7 Correct class loader to load pool threads, to avoid the leak detector
9aca53d601 Tweak the test so it can easily be run multiple times in a row without failing.
b79edcbf48 Fix intermittent JMX deregistration test failure.
412ac74b1e When using automatic ports, include the port number in the name used in logging if we know it.
3a10d7372c Since the method that gets interrupted does something like         if (Thread.interrupted())             throw new InterruptedException(); The flag is actually cleared by the method itself. If we wish to propagate the interrupt we have to set the flag again
a702099d46 Add support for multi-thread deployment in UserConfig.
10a44c7ab1 Pick-up clean-up
180259b924 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52974 Fix NameNotFoundException when field/method is annotated with @Resource annotation Patch provided by Violet Agg.
f08b5fa3a7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52833 Fix NPE in some embedded / osgi scenarios where the class loader my not have the system class loader as a parent.
607634442a https://issues.apache.org/bugzilla/show_bug.cgi?id=52066 Add in configuration option to allow a thread to retain its interrupt state.
9528d78a33 Complete the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52002 useDisposableConnectionFacade is by default true
84d88c15dd Merged revision 1300108 from tomcat/trunk: Exclude Eclipse files from checkstyle checks if jdbc-pool has been opened in Eclipse as a separate module
eeb7c4127d Merged revision 1305194 from tomcat/trunk: Review of r1301269 1. Restore *.dll pattern. (Why was it changed? Both variants do work). 2. Let's reference the LICENSE file instead of VERSIONS one. It should always be there. I am not sure where VERSIONS file comes from, as I do not see how it is generated in tc-native 1.1.x sources.
da2725a6ba Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52970 Take account of coercion rules when invoking methods
6570df4490 Cleaner (kkolinko review)
5c00c8a789 Merged revision 1304468 from tomcat/trunk: https://issues.apache.org/bugzilla/show_bug.cgi?id=52830#c6 Alternative implementation of the fix, which does not require that name were an instance of CompositeName.
799a8e8365 Update merge info
ccceba1d38 Remove unused code after upgrade was refactored
6816f497ae Remove unused code after upgrade was refactored
9284830a3d kkolinko review of r1304011: Always close selector Additionally, ensure that an exception during the close does not prevent the poller loop from ending
0d08a3429b Remove unused code after upgrade was refactored
007bc46a0b Merged revision 1304135 from tomcat/trunk: In "echo" websocket example: Treat the text typed by user and echoed by server as plain text instead of HTML, effectively safe-guarding it.
1dfc9823e7 Observed strange NPE while running tests. This isn't much more than a guess at what might have caused it.
f587a05991 Only try to stop children that are currently started. Prevents error messages appearing in logs.
81d9835425 Still process events when closing to ensure that Comet connections that are in use when the poller is stopped are sent an end event.
3365ae139e Merged revision 1303852 from tomcat/trunk: Replace two examples links in ROOT/index.jsp with one. This is to make WebSocket examples more visible.
ed6d4e92db Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52957 Ensure Valve implements Lifecycle before calling Lifecycle methods
280e8063a1 Review of r1303587 by kkolinko. Ensure domain is set before channels are started.
df05e80873 First stab at keeping concurrent runs of the tribes unit tests from interfering.
72e3e47c40 More detailed logging to help track down failures
4c9564ebf1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52958 Fix xml
5a1dc3c956 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52953 When using DIGEST auth, digests are always represented using lower case hex characters
b2f35a62d8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52839 New unit test for DigestAuthenticator and SingleSignOn Patch provided by Brian Burch
a23eba60e4 Deprecate ELResolverImpl since it supports the deprecated EL implementation Move the default EL resolver to the ELContextImpl so the deprecated code depends on undeprecated code rather than the other way around. Fixes a handful of deprecation warnings
4686a607c0 Update external to pick eol-style and checkstyle fixes in jdbc-pool.
dcbf2a1df2 documentation update of jdbc-pool
2a536869e2 Update external to pick up svn:eol-style fix. Fix changelog.xml formatting: 1. Wrap lines 2. Missing ':' after issue number 3. Credit the author
7190b5e1af Bug fixes to jdbc pool
047d6cd57e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52926 Protect against a NPE if the socket has been closed on another thread
c0c441eac2 Make implementation of getParentClassLoader() consistent with the other implementations across the code base.
fe2f40807f Refactor the ThreadLocal leak tests: - Move the supporting classes to so they aren't treated as container Servlets - Ensure the supporting classes are loaded by the web application class loader - Break the direct and indirect leak tests into separate tests - Ensure JRE memory leaks do not interfere with the results of the test - Use a logging filter to ensure error messages are logged for the ThreadLocal leaks - Remove pointless sleep code - Add assertions to check a) a leak occurs and b) it is logged
6076abfe11 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1302614 13f79535-47bb-0310-9956-ffa450edef68
43b8b57328 Sync with trunk. Fix Javadoc.
b00ee2e09e Sync with trunk. Remove unused strings.
6ff5e68fd2 Port websocket updates
e694e34a25 Fix broken changelog.xml with s/&/&amp;/
c56ed4df0d Implement chat example Plus some minor clean-up. Patch provided by Johno Crawford
c6bda3dc29 Final WebSocket change
dc1e4deb58 Add finals
5fdf47338b Exclude warning with comment Add some finals
fb9ab94bfd More WebSocket
06482bfd9e Cache downloaded files
08b98d9c2a More WebSocket
36882eeebb More WebSocket changes including some code based on ideas in a larger patch by Petr Praus, Jonathan Drake & Slávka
4f5198d314 Next stage of WebSocket impl along with some clean-up for MutableInteger required for the WebSocket patch to apply cleanly. Includes code written by Johno Crawford.
7ac5a20df8 Added support to the JMXProxyServlet for fetching a specific key from a CompositeData value. Added documentation for the entire 'get' command for the JMXProxyServlet, including the new optional 'key' parameter. Backport of patch by schultz
d8d12c405f Backport use of constants
67c3ec187c Start to merge WebSocket implementation from trunk. I'm combining commits where I can but I can't back-port in a single commit as they interleave with other commits.
a143d73b39 Simplify merge-info Backport some additional finals
d172120985 Simplify merge-info Port some: - use of final - whitespace clean-up
5638c14831 Simplify merge-info Back-port some clean-up
fb84a28e28 Simplify merge-info
327d5d9eea Simplify merge-info Port additional constants
1e6bc11a59 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52858 Fix high CPU load caused by tight(ish) loop when client breaks the connection and stops reading data
15b60099ca Simplify merge info A few whitespace changes
52570c483a Update / simplify merge info
2de5227b92 Add test code present in trunk but not 7.0.x
b807a63c91 Remove an accidental commit
1fd57c490e Port some clean-up Simplify merge info
6fefe68aaf Merge some FindBugs fixes Simplify merge info
cf2bf05168 Simplify merge info
36a3927d67 Simplify merge info
efb423ddc3 Fix Javadoc warning
ca9dd2e70b Update to JDT 3.7.2
a890a50ab3 Daemon -> 1.1.10 native -> 1.1.23 Use simpler tomcat-native distribution which comes with 1.1.23+
8993233df7 Prep for next release
9bef1a060e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52811 Make use of the newly added HttpParser to correctly process Content-Type headers As well as the problem identified in the bug report, this fixes a couple of related issues: - setting the content type via (set|add)Header bypassed some checks - avoids parsing the content-type header multiple times
7bf40e8413 Add an HTTP header parser. The driver for this was an attempt to fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52811
9d9e218fba UCDetector improvements. Use final. Deprecate unused code.
48aa507a1c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52723 Clean-up
0a70d29e90 Fix checkstyle warnings I missed earlier
8d09dac2d3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52850 Enable the memoey leak protection code to play nicely with IBM JVMs as well as Oracle JVMs. Extend test case coverage of memory leak protection. Patch provided by Rohit Kelapure.
bcbec7aa9f Back-ported two cleanup patches from markt.
571c2c2787 Clean-up
293e4c4c89 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52776 Refactor the code so JspFragment.invoke cleans up after itself. Patch provided by Karl von Randow.
bdcac0868d More merge info simplification. Merge additional changes from trunk where appropriate.
1b0f63b5e0 More merge info simplification
b10fc7d662 More merge info simplification
9d0c0e5fca Start to simplify the merge info. Merge additional changes from trunk where appropriate.
68057e2a0c Simplify merge info
47043fb95b Simplify merge info
a4749f591e Simplify the merge info.
0ff5561a4b Start to simplify the merge info. Merge additional changes from trunk where appropriate.
6704c374db Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52830 Align parseName(Name) with parseName(String) so both have the same behaviour
b387996aae Fixed javadoc complaint.
a987496264 Fixed eol-style.
168376d4b1 Fixed poor merge conflict resolution.
89fef1b7eb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52500 Added configurable mechanism to retrieve user names from X509 client certificates. Based on a patch provided by Michael Furman.
ed9c71206f Replicate Principal in ClusterSingleSignOn.
a1b7b049f4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52719 Correct theoretical resource leak during Jar validation
0f2576ab68 Fix trailing whitespace prior to merge of patch from trunk
46537fd080 Update changelog
a8a8c0cb8d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52792 More informative error message when something in JNDI can't be found.
05002adcd9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52772 Re-order checks for uriRoot validity and ensure that all the checks are completed before it is used.
b346f2463c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52770 Fixes very rarely (if ever) used infinite timeouts on write
01d0ad99e6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52846.
7c30130e00 Another StandardThreadExecutor attribute with "is" getter. Fix MBean descriptor.
e17c1dd474 BZ 52842: Exception in MBeanDumper.
40f07685fb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52732 Clean-up code. Fixes potential resource leak although the problems that would trigger the leak are far more serious than the leak.
95b8f6eaee Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52731 Clean-up code. Fixes potential resource leak although the problems that would trigger the leak are far more serious than the leak.
11e5487c56 https://issues.apache.org/bugzilla/show_bug.cgi?id=52729 Even if the end event fails, try and perform the close.
29f018616b https://issues.apache.org/bugzilla/show_bug.cgi?id=52727 Code clean-up
8ab4b84d7f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52726 Clean-up. Avoid unlikely fd leak.
b32256ffbf Fix comment typo.
f69026781f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52725 Use constant rather than hard-coded package name since package name is meant to be configurable.
b4d8b417ab Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52724 Code clean-up. Add some finally blocks to close resources. Not really necessary since JVM is shutting down.
db0d9034d8 Fix remaining failing tests after error response bodies were made available
ddbc7770ce Fix intermittent unit test failure on the command line.
ea40da8a7a Fix unit test failures now response bodies are returned for failed requests.
e6e28176b8 Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51197 Allow the ErrorReportValve to write a response body if sendError() is called during an async request if it is being handled on a container thread. As per SRV 10.9.2, if an error occurs during an async request on an application thread, writing the response body - if any - is entirely an application responsibility.
0f3a8e7dac Improve comment
c354174bac Improve base test to return response body on an error response.
26e8bd8db7 Remove unused imports
5de712e17d git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1296102 13f79535-47bb-0310-9956-ffa450edef68
4c8cd85926 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52804
ac6f131ebd BZ 52760: Fix expires filter mime type in javascript examples.
2de4d8c5d1 Add changelog entry for r1293834.
aba4cdc1cc Add the subsection name "Jasper".
46c6a99971 Bring builtin mime types more in line with the ones defined in our default web.xml.
f4d978d1c3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52758 Implement additional method added to JDT interface but not yet released
1fb0932771 Fix BZ52750. Correctly parse command options
8faa9c54cf Merged revisions 1292345-1292347 from tomcat/trunk: Fix nesting of <p> and <ul> elements. Wrap long lines.
3db528bd36 Merged revisions r1292334 r1292338 from tomcat/trunk: Explicitly ignore empty tokens in the value of VirtualWebappLoader#virtualClasspath Document that VirtualWebappLoader#virtualClasspath trims spaces from the values. Use this feature to make documentation examples more readable.
fae54c0c9f Bits were released today. The announcement might not make it until tomorrow.
71819bbde4 Fix svn:eol-style.
243276dc24 Merged revision 1245849 from tomcat/trunk: Remove dependency on compile in validate-eoln target so that it can be run ahead of compilation. It does not need to download all those libraries needed to compile Tomcat. It allows to simplify its Gump configuration, removing those dependencies.
f6d5b48bf8 Review of r1244737
4d218fd592 Merged revision 1245274 from tomcat/trunk: Skip debug call if debug logging is not enabled.
bc687b85c8 Set svn:eol-style=native on 10 files, as detected by validate-eoln target run on Windows
0873157693 Merged revision 1244302 from tomcat/trunk: Implement check for correct end-of-line characters in the source files.
df8ba05b6b Update jdbc-pool external to get eol-style fix. Fix a typo in the changelog.
7a9d612661 Change svn:eol-style from LF to native
03a4c1e665 Increment ready for next release
2c5ca876ef Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52671 Log NPEs for attributes that are not set at debug.
25844ea674 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52669 Correct regression introduced by the invalid assumptions made in the hack for Eclipse to address https://issues.apache.org/bugzilla/show_bug.cgi?id=51741
df7256196d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52666 Correct coercion order in EL for A {==,!=,eq,ne} B
227c5041b3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52548 Update Commons Daemon to 1.0.9
562c2c90be Update to pick up validation fixes and missing AL2 header
8130179294 Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51582
12f8acdf66 BZ 52641: Remove mentioning of ldap.jar
0ef293b716 Fix threading issue in initialization of standard authenticator list
6a8c520c1a BZ 52634: Fix typos in JSP examples. Patch provided by Felix Schumacher.
1b5799afbb Fix ocmment
3970215b77 Fix a couple of issues with the UserDataHelper 1. Packaging. It should have been packaged with juli-adapters.jar. The class has been moved so this is no longer an issue. 2. The wrong class/method was reported if the extras were used. The logging code has been pushed back to the caller. In return for a small amount of code duplication, the caller class/method will now always be correct.
94b43a5e5d Deprecate code that will be removed in 8.0.x
3d8d806a75 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52607 The ExtensionValidator needs to be aware of the classes in the shared and common loaders.
0b22a15607 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52606 Ensure replayed POST bodies are available when using AJP
cf013d2c6f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52591 Skip attributes where getters throw UnsupportedOperationException
127588c705 Remove deprecation. Required by JSR-77.
81a1aca06e Remove a package dependency
f173cfbc3d Fix millisecond handling in AccessLogValve when used with a general SimpleDateFormat time pattern.
02c6600381 Remove a package dependency
352371bb88 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52586 Remove hack that changes path info when forwarding to an error page
79cad0fcb9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52577 Only reset the encoder information when the 'has getWriter()' been called flag is reset. Includes a simple test case
555c42aa99 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52587 Ensure that if it is necessary to fall back to the default NullRealm, the NullRealm instance is created early enough for it to be correctly initialised.
3b6791b4b8 MIME types update: sync with Apache webserver mime.types file using res/scripts/check-mime.pl.
6b55b2ea79 Add generic create Valve method
c7ed35fd7a Fix merge error
a21b22bea4 Deprecate unused code
d127991a74 Add deprecation missed in r1239489
82428a1a9a Remove embedded specific start code
0e5eda4797 Mark unused code as deprecated
d8002b0447 Refactor to remove dep on StandardContext
878bf7c850 Deprecate code that will be removed
b3f50dea9e Refactor to remove the circular dependency between o.a.catalina and o.a.naming
4fa4f817dc Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52444 Avoid NPE
31b365f30b Deprecate unused code
451355a0be Deprecate unused code
c547d33ead Remove references to MbeansDescriptorsDynamicMBeanSource that was removed in r415811
3809c39c2e Deprecate unused code
937902246d Deprecate unused code.
754b8338c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52444 Remove need to load classes unless they actually match an HandlesTypes entry
4256182801 Deprecate code that has been removed in 8.0.x
35441ca36c Restore some previously removed BCEL code that is required for fixing BZ52444. Use it to determine if a class is an annotation without loading the class.
bba6d73c73 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52547 Ensure byteCount is reset at the end of a HTTP 1.0 request Refactor to reduce duplicate code
91b9460893 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52543 Provide a meaningful error message when writing more response headers than permitted
73c6ba6661 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52515 Note that DIGEST auth requires MD5 digests
54a9a45c76 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52511 Don't log an exception just because WEB-INF/classes does not exist
57d29407bd git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1235210 13f79535-47bb-0310-9956-ffa450edef68
3bff2f0c5f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38216 Better handling when MBean ops return null. Patch by kkolinko
b67ef7acce Add release date
ceacdaba63 Correct the instructions
751ed2e642 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52474 Ensure leading and trailing white space is removed from lister class names extracted from TLD files.
7fdbd1b7df Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52488 s/exipre/expire/g
751ab5517b Simplify obtaining references to common Charsets
9311bf3612 Merged revision 1232842 from tomcat/trunk: Add package-list files to rat-excludes.txt
66a710082b Rearrange earlier jdbc-pool fixes into its distinct sections in the Changelog file.
b0948fb752 Merged revision 1232869 from tomcat/trunk: Fix code style issues in jdbc-pool (here: update externals to pick up the fix) Enable checkstyle checks for jdbc-pool in Tomcat's build.xml
5f04785ff9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52480 When converting class path entries from URLs to files/directories, ensure that any URL encoded characters are converted. Fixes JSP compilation with javac when Tomcat is installed at a path that includes spaces.
75c36eb24e Merged revision 1232813 from tomcat/trunk: Correct typos in documentation
ab06df5afd Merged revision 1232760 from tomcat/trunk: Correct typo
5a1cefc9b7 Merged revision 1232447 from tomcat/trunk: Improve BUILDING.txt. Especially: 1. Reformat the document. 2. Document creation of "build.properties" as an explicit step before building. 3. Document enabling GPG when doing a release. 4. Document enabling Checkstyle. 5. Document running the tests.
241d70f762 Merged revision 1232380 from tomcat/trunk: Correct spelling of StandardHost's attribute copyXML
498e0817fa Fix OpenPGP signatures
a966812565 Update version for next release
147b132c1e Update changelog
1ba041ec2e Build handling of "target" directories: - do no longer exclude from copying to dist/src - Add comment to .gitignore why we do not ignore "target"
32edb27e19 Make generation of OpenPGP signatures dependent on definition of valid GPG binary.
b747b74ca6 Correct typos (s/first/the first/)
ae7f348b9c Automate OpenPGP signature generation
2746eb4845 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc7.0.x/trunk@1231887 13f79535-47bb-0310-9956-ffa450edef68
c15782edee Fix typo
3758789920 Fix line endings
c543461a6a Fix svn:eol-style for recent source files (including update of modules/jdbc-pool external).
47fd2828e8 Add missing changelog entry for r1207799
63b41c0264 Merged revisions r1231624 r1231625 r1231630 from tomcat/trunk: ........ 1. When building a Windows installer do not copy whole "res" folder to output/dist, but only the files that we need. Apply fixcrlf only after all files has been copied.
925445fab7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38216 Add the ability to invoke MBean operations through the JMXProxy Based on a patch by Christopher Hlubek Also improved error reporting to help debugging.
10f4f592ff Ensure that connections from unlockAccept() do not get passed to a processor. Reduce differences between BIO, NIO and APR acceptor code.
eb88283f34 Log full stack trace when there is an error - may provide more clues as to what is going on.
0b06d0efd1 Updatesvn:externals for modules/jdbc-pool to pick up svn:ignore changes.
17edd8623e Update svn:ignore: - add Netbeans project folder "nbproject" - sort entries - ignore .* instead of individual files for   modules/jdbc-pool like in the main directory
8414558666 Merged revision 1231621 from tomcat/trunk: Add several other manifests paths to rat-excludes.txt
1e9cda1e7c Merged revision 1231620 from tomcat/trunk: In TestNonLoginAndBasicAuthenticator: Reduce visibility of methods that are not called from outside. Fix javadoc formatting.
47e81186db Fix warnings
63721e90ba Add non-SSO test cases for BASIC and non-Login authenticators Patch provided by Brian Burch
5e87ae0bd7 Fix failing unit test now connectors are bound to localhost for tests
b07191a280 Update rat-excludes file for Buildbot, porting recent changes from trunk.
5d1bc2aa56 Update jdbc-pool external to pick license fixes
b26b131d7d Merged revision 1231310 from tomcat/trunk: svn:eol-style=native for recently added file
27e0270541 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52461 Don't assume file based URLs when checking last modified times for global and host level web.xml files Patch provided by violetagg
875291675f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52445 Do not assume method expressions have exactly three elements Includes a test case
2ce1eaf6f3 Add the NullRealm and make it the default when no Realm is specified
331bfec170 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52443 Move the default Realm for the embedded case to the Engine
4171384844 Move destruction of ContainerBase objects to ContainerBase to ensure that they are destroyed.
60c6c50ba2 Code clean-up Logger will not implement Lifecycle. This was a leftover from the pre-JULI logger implementation.
325159128e Fix comment
9453435208 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52245 Don't allow webapps to package javax.el classes Patch provided by pid.
b911b53c52 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52440 Need to resolve EL variables when returning ValueReferences Includes a new test case.
74f55b1f59 Update to JDT 3.7.1
50b606d4a4 Add test case
ce8f63d780 Further improvements for https://issues.apache.org/bugzilla/show_bug.cgi?id=52328 Add a buffer to the converter
75a96204a1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52328 Initial fix. Don't flush on every write.
cd026afabd BZ52450 Add setter for EntityResolver
76cc9b9852 Align spelling of message key
4f106de806 Whitespace and Javadoc fixes. No functional change.
019f40328c Move MBean dump code from JMXProxyServlet into a utility class.
9fb9fdb4fc Remove some stale attributes from MBeans and set one attribute to is="true".
86194f80f5 Merged revision 1229307 from tomcat/trunk: Further improve Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52237 Make "usefile" flag of junit formatter configurable as well. The default value is "true".
725f5d9883 Merged revision 1228969 from tomcat/trunk: Update TestAsyncContextImpl, so that the test logic does not need to change when the tests are run with "test.accesslog=true": Always add a host-level AccessLogValve. The test is about error 500 for unhandled request. That access log entry is written into topmost AccessLogValve.
a1422f0aa9 Merged revision 1228929 from tomcat/trunk: Followup to Mark's r1228724 The ObjectName.quote() must always be called with address, because ip6 addresses have characters that are must be quoted in QName. The Connector.java changes in r1228724 bypassed that call. Update TestRegistration.java accordingly.
88adb7f7b2 Merged revision 1228920 from tomcat/trunk: Re-enable TestCometProcessor test. It reverts r1225632
f34ce2ca55 Merged revision 1228918 from tomcat/trunk: Change TestCometProcessor#testCometConnectorStop() to test whether END event was processed by servlet and write other information as a "Status:" log message. The old test was not 100% reliable and fails for me with APR. It needs more investigation.
5d80ac6e5a Mark unused code as deprecated. It has been removed for 8.0.x onwards.
5fe4263f37 Bind connectors to localhost for unit tests Improve format of JMX names that include an address Update unit tests so they pass with the above changes
508bc1276a Remove some unnecessary code that may be a cause of fd leaks
04870bdf88 Use port in JMX name if known.
38b0925a79 Merged revision 1228196 from tomcat/trunk: Add sample configuration for SetCharacterEncodingFilter to the default web.xml
ea3fce7db7 Correct error in r1666072 "return true" was originally "continue" that would have continued the for loop and was, in fact, unnecessary since it was at the end of the loop.
2078ea0785 Update jdbc-pool external for new coyright year.
7e6d4b7f5c s/2011/2012/g
90bca0fe62 Update changelog
59e1763358 https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 20 of 20 Ensure underlying collections are immutable
f66eb12954 https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 13 of 20 Injection targets are now always merged
5a14c2d725 https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 12 of 20 Identical resources in fragments are retained
adad804b4f Get unit tests working with Ant
76b12431f1 Pickup Javadoc fixes
dc9eb59fb7 Fix Javadoc warnings
94c7f4872f Better info for Gump failures (hopefully)
e2f9cb31f5 Merged revision 1226215 from tomcat/trunk: Apply "Organize Imports" to fix imports order that did not pass checkstyle validation
b68844d5c0 Merged revisions r1174975 r1226214 from tomcat/trunk: Add links to @SuppressWarnings documentation for Eclipse IDE. Add note about "Organize Imports" setting in Eclipse IDE.
785cafaf54 https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 5 of 20 Tighter control of web.xml elements (name, ordering, absolute-ordering)
aa477f1dc8 Fix possible NPE
b10756fe0f https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 2 of 20 javax.servlet.annotation.MultipartConfig.location may be relative and if it is, it is relatve to TEMPDIR
8526e61f95 https://issues.apache.org/bugzilla/show_bug.cgi?id=52405 Servlet 3.0 Rev A updates Item 3 of 20 maxActiveInterval <= 0 means never expire - previously 0 meant expire immediately
082b677c97 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52387 Silence logging for correct host Patch provided by David Calavera
24987302d2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52326 Reduce log level for class loading errors during @HandlesTypes processing to debug
41ceacda80 Disable Comet tests by default for now
2cfb10aa23 UCDectetor: Deprecate / add TODOs to currently unused code
c8f556daf3 Fix import order
79d85ed939 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52316 Improve response length logging when sendfile is being used
2f88c06c81 Review by kkolinko. - Remove FORM auth specific call. - Javadoc formatting. - Honour the cache attribute of the authenticator.
32085a8f25 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52303 Allow web applications that do not have a login configuration to participate in a SSO session. Patch provided by Brian Burch.
b8e06005da Merged revision 1224910 from tomcat/trunk: Further fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=52184 Apply a separate instance of UserDataHelper to the "maxParameterCount reached" message, so that its threshold is calculated independently of other parameter errors.
a34ed77602 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52243 Clarify how to include # or ; in an environment value
359898e4df Correct commons components names, for consistency.
8b244f8c06 Merged revision 1224682 from tomcat/trunk: Update to commons-pool 1.5.7. Fix build condition for tomcat-dbcp to always rebuild when a new version of pool or dbcp is downloaded.
7a23e97ac5 Merged revision 1224663 from tomcat/trunk: Reduce log level for message for hitting parameter count limit from warn to info.
7a46dd8fb8 Merged revision 1224662 from tomcat/trunk: Further fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52184 Apply UserDataHelper to o.a.t.util.http.Parameters
3c56be38a5 Merged revision 1224657 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52384 Do not fail in Parameter parsing when debug logging is enabled. Also do not flag extra '&' as errors.
cc9bac59a2 Merged revisions r1224648 r1224650 r1224652 from tomcat/trunk: Improve fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52184 - UserDataHelper: 1) Fix bug in suppressionTime processing. The config value is in seconds, but time arithmetic needs msecs. Now multiplying the configured value by 1000L. 2) Change the API to allow to distinguish the case when next message will be printed at DEBUG level. 3) The private method logAtInfo() now always updates the time. Thus I removed its argument. - Cookies: 1) Add i18n and print special message when we fall from INFO to DEBUG logging.
9ddcce601d Merged revision 1224617 from tomcat/trunk: Correct description of roles
00942b7027 Merged revision 1224607 from tomcat/trunk: Improve manager-howto.xml: Document the list of roles that allow access to Manager webapp. The manager-script role is just one of them.
c0b71ac401 Merged revision 1222690 from tomcat/trunk: Avoid deprecated code and provide consistent output regardless of platform
c998400d1d this is not needed anymore.
4963d4e66d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52356 size also needs to be volatile
309a80aefc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52213 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52354 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52355 Make enabled and debug flags volatile as they are accessed by multiple threads
ed14baffcb Get tests working
07264f49fe Merged revision 1222201 from tomcat/trunk: Better document FailedRequestFilter and SetCharacterEncodingFilter filters. Change TOC list at the left margin of config pages: rename last section to "Other" and move Filters page there.
0225c4057a Merged revision 1222189 from tomcat/trunk: ROOT/index.jsp: Replace link to Bugzilla search with one to Tomcat's bug reporting page
d3b89a3b45 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52293 Correctly handle the case when antiResourceLocking is enabled at the Context level when unpackWARs is disabled at the Host level. Based on a patch by Justin Miller.
bf84ce2d1f BZ 52366: Fix typo in VirtualWebappLoader documentation (configuration example).
94ebbce902 Fix typo
40e851480e dependency on ClusterRuleSet has been removed and now really optionnal, no more need of this hack
3ad03af276 Add missing property.
8ebbe209ce Fix the deploy-release task to use nexus.
3b6971d16a Add properties required by new logging helper when running under a SecurityManager
b7398add53 Fix cyclic JAR dependency and add check to ensure it doesn't return
b4bb7fc5e8 Correct fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=52335
34db005488 Better description
32cd029b77 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52335 % is only escaped as <\%, not \%
ddb4a6cdb8 Fix coop/paste error
112a83dc69 Update the changelog
4b32a4be55 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52321
518a3e36ea Include new o.a.juli.logging.UserDataHelper in extras
ec118dae84 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52208 Avoid possible NPEs if stopListening is called in a different thread
006280e3d4 Update changelog
7e5011d8f3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52184 Add a helper class that provides options (via system properties) for controlling how errors triggered by invalid input data are handled. Currently only addresses invalid cookies but can be used elsewhere as the need arises.
d4876d7dd1 Clean up
daa4b6cb52 Remove emptySessionPath JMX attribute. This setting no longer exists.
3fe5d3ff77 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51741 bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat https://issues.apache.org/bugzilla/show_bug.cgi?id=51741 merged revisions 1209685:1209731 from trunk to tc7
272cbca887 Simplify
c30ec699f5 Fix copy/paste comment typo
bdf4781338 Trying to fix Gump failures
ecf5e0173e Consistent layout
ca8cd1eb0b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52237 Allow configuration of junit log output format. Defaults unchanged. Patch provided by M Hasko
c36a739d5c Fix failing test for APR now random ports are used by default
7e733265fe Fix unlocking of the acceptor thread when a random port is used
79fce0a40e Retain thread safety for ContainerBase.realm but don't try and start/stop it multiple times
07dfefd5ed Fix copy paste error in BZ 52259 fix
22e6563bc5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52259 Regression caused by bug 46264. Prevent deadlock if no Realm is configured.
27cd1c4d48 maybe this time
2c08c504df attempting to set externals
3a9bf8e112 Update Daemon to the latest release
36b82a7fa0 update changelog
8dfa4ef720 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52028 Add support for automatic selection of a free port for a connector when the special value of zero is used
9325e18fcb Fix XML markup - missing quote
39f2d49aba Add release date
f541167ca2 Merged revision 1206200 from tomcat/trunk: Do not throw IllegalArgumentException from within parseParameters when chunked POST request is too large, but treat it like an IO error.
a7184c2e9c Followup to r1195962 Document recommended alternative for the deprecated class
6def50cd4c Merged revision 1205112 from tomcat/trunk: Correct javadoc markup
9790d82fe4 Merged revision 1205097 from tomcat/trunk: Correct typo in javadoc
aeb34b3361 Merged revision 1205082 from tomcat/trunk: TestMaxConnections: improve log messages printed by this test. Do not use SEVERE level. Print introductory message about what logging output is expected. Use port number as configured by TomcatBaseTest (8001) instead of hardcoded 8080.
f026506139 Merged revisions r1205033 r1205065 from tomcat/trunk: Add clarification to RemoteIpValve and RemoteIpValve that to use their IP/hostname/port/protocol values in access log you should properly configure your AccessLogValve. Correct request attribute names mentioned in RemoteIpFilter/RemoteIpValve javadoc and mention them in documentation.
bf9f52d86f Merged revision 1204982 from tomcat/trunk: Copy jdbc-pool.xml before it is validated by checkstyle.
0d52bf8c24 Merged revision 1204938 from tomcat/trunk: Align .gitignore and build.xml with svn:ignore values. Remove .gitignore from defaultexcludes where it is since Ant 1.8.2.
0089af79fa Merged revision 1204936 from tomcat/trunk: Change pattern for maven-ant-tasks JAR. The latest version is 2.1.3.
baf5e02a0b Merged revision 1204867 from tomcat/trunk: Run Mapper performance test twice if the first run took too long, to reject occasional failures observed by Gump/buildbot
04ad55585e Merged revision 1204856 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52225 Fix ClassCastException in Alias added for existing host via JMX
382d6a7c38 Add .gitignore to text.files list in build.xml which drives fixcrlf.
875cbbba47 svn:eol-style native.
fc1b53c921 Prep for the next release
906ef02c02 Prep for the next release
8a0ab6eb8c Reduce sleep in acceptor thread pause from 1000ms to 50ms. This significantly speeds up shutdown, particularly with testing, with no measurable increase in CPU usage while the acceptor is paused.
214073c2b5 Refactor acceptor pause and shutdown to remove need for 'random' waits in the shutdown code. Removes the need for the fastShutdown attribute
ec7ff880db Merged revision 1203091 from tomcat/trunk: - Align %2f handling (aka CVE-2007-0450 fix) between implementations of UDecoder.convert(). - Make convert(MessageBytes) to consistently throw an IOException, even if it calls convert(String). (convert(String) and convert(CharChunk) are rare cases with little impact and inherent bug: hardcoded handling of %xx as ISO-8859-1). Updated changelog.
a759acba14 Correct typo in a comment
3c92bb1d96 Merged revisions r1203047 r1203049 r1203052 from tomcat/trunk: Reduce overhead from exception handling, using ProxyDirContext.NOT_FOUND_EXCEPTION as an example. Limit second string scan using results from the first one. Use findByte() instead of indexOf(). Implementation is the same, but it is more fair to its arguments.
cf52171677 Adjust timing limits for new PING delay
5a839a9235 Increase time between PINGs in an attempt to reduce false test failures
0f73c3db08 Merged revision 1202705 from tomcat/trunk: Parameters.java: - Fix regression in urldecoding of parameters that contain spaces Patch by Willem Fibbe
2bb152e578 Merged revision 1202578 from tomcat/trunk: Followup to r1202565 Correct description for one of valves. (Already done for the second one).
d65a20e097 Merged revision 1202565 from tomcat/trunk: Add "denyStatus" attribute to RequestFilterValve, RequestFilter. Add overridable denyRequest() method to RequestFilterValve. The denyStatus attribute is used to change HTTP status code that is used when rejecting denied request. E.g. to be 404 instead of default 403.
cf3eb40079 Merged revision 1202271 from tomcat/trunk: Correct wording in build instructions Simplify instructions for downloading Tomcat source code
c508e96813 Make sure daemon.sh is included/excluded from the dist
6b3849b6c6 Add Commons Daemon wrapper script
f689c663ad Make sure .bat and .sh files have executable property set
bfc0f91673 Merged revision 1202039 from tomcat/trunk: Correct wording. It is in the same section, not the next one.
6a2bc3c57f Merged revision 1202035 from tomcat/trunk: Correct typo in Javadoc and changelog. Add note to BUILDING.txt, that you do not need to build Tomcat if you just want to run it. Move warning earlier than note, so that it is more visible. Correct SVN sources URL for Tomcat 7 in building.xml
86f074bc5c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52173 Improve Javadoc for delgate attribute of WebappClassLoader Based on a patch by bmargulies
a5bd2f01ac Improve handling of failed deployments - Allow failed configurations to be fixed via JMX - Ensure once a deployment fails, the context is not deployed - Ensure changes to any context.xml file trigger redeployment rather than reloading - Tweak base lifecycle implementation to allow failed components to be restarted once they have been fixed
6bcd9c973d Merged revision 1201608 from tomcat/trunk: Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown: process exceptions thrown from Constructor.newInstance(). In DataSourceLinkFactory: unwrap exception from within InvocationTargetException.
0787475ac3 Merged revision 1201576 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52172 Make build instructions clearer about /usr/bin/java Based on the patch by bimargulies
f7c3676c28 Merging revisions r1201521 r1201542 r1201545 r1201546 r1201548 r1201555 r1201556 r1201568 from tomcat/trunk: Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown. Part 2 of 2. Updated mergeinfo and changelog.
d2f641b3e0 Merging revisions r1201521 r1201542 r1201545 r1201546 r1201548 r1201555 r1201556 r1201568 from tomcat/trunk: Improve processing of errors that are wrapped into InvocationTargetException. Rethrow errors that must be rethrown. Part 1 of 2.
278e74dd96 Update jdbc-pool to r1201562
9fbbeb39dc Merged revision 1201508 from tomcat/trunk: When building jdbc-pool from within Tomcat, use Tomcat's output directory location. The new subdirectory used for jdbc-pool build is "output/jdbc-pool".
4afa9bfe59 Update to latest jdbc-pool (r1201499) Update changelog for jdbc-pool changes.
4ca25ba64d Merged revisions 1201235-1201237 from tomcat/trunk: Deprecate unused methods in IntrospectionUtils classes Remove unused code from "tribes/demos" copy of IntrospectionUtils
90a863569c Merged revision 1201180 from tomcat/trunk: Check state and throw ISE only if the new value differs from the old one. Throws NPE for invalid null values.
b28454060f Fix formatting, sorry for the noise.
54e285f6ce Improve multi-byte character handling in Coyote output for HTTP and AJP.
8c4ab517bb Merged revision 1200941 from tomcat/trunk: Unwrap subsection title
0b6b7f1dc2 Merged revision 1200937 from tomcat/trunk: Remove round brackets from listener section titles. This improves readability of TOC on that page.
1c666c641e Merged revision 1200725 from tomcat/trunk: If FIPSMode="on", treat its initialization failure as fatal, regardless of the cause, be it implementation failure or missing tc-native. Updated mergeinfo for previously backported revs of this feature: r1200445 r1200446
b9ae3f2173 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52121 Merged revision 1200696 from tomcat/trunk: Fix bug in FlushableGZIPOutputStream: - It could not flush the last byte, because it should have been done in finish(). Note that GzipOutputFilter.end() calls finish() explicitly before calling close(). The tests called close() only and it did not catch this use case. - Improve IOException handling in flushLastByte(), finish(), close().
45246e840c Use setters when cloning cluster managers (at least in ClusterManagerBase).
e0bb71c2e8 Add more attributes to manager cloneing when initializing via a cluster configuration: - maxInactiveInterval - sessionIdLength - processExpiresFrequency
8ac6a0a02d Back-ported documentation and error-handling improvements for AprLifecycleListener FIPSMode.
cfffd1d19a When deploying a specific named app, don't try and deploy it multiple ways.
f3599ff2fa Correct comment
17d403ea3d Merged revision 1200320 from tomcat/trunk: Fix typo in message name
3bca1becf6 Merged revision 1200316 from tomcat/trunk: Do not log invalid parameter value unless debug logging is enabled
0aeab40130 Revert r1200302. Adding parameter with no values is allowed - see getParameter(). Sorry for the noise.
b4bec957f2 Add sanity check. This method is absent in trunk.
ad9601ef03 Correct typos
05fbdaf856 Merged revision 1200263 from tomcat/trunk: Add links to FailedRequestFilter in several places and do other small documentation improvements.
de2eb3f19a Merged revision 1200089 from tomcat/trunk: Refactor special attribute names handling, to use hash table lookup + adapter class, instead of series of name.equals() tests. Extracted add/change/remove notification delivery into separate methods.
1ecf55700c Merged revisions r1198696 r1198707 r1200056 r1200107 from tomcat/trunk: - Introduce new request attribute to be used to mark request if there was a failure during parameter parsing, - Implement FailedRequestFilter - a filter that triggers parameter parsing and rejects requests marked with that attribute. - Add sample configuration for FailedRequestFilter to conf/web.xml.
ce09c9a846 Fix compilation failure caused by r1200184
b7f9640ccf Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 10, the last one. Updating mergeinfo.
62d0436533 Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 9
fb7e12ec5f Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 8.
57e7916c62 Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 7.
0007342e06 Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 6.
7dfd8fcbbe Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 5.
1139079f7a Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 4.
ffa40927f9 Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 3.
a7c6eff271 Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 2.
c7e0cfba40 Merged revision 1187753 from tomcat/trunk: Clean-up. No functional change. Part 1 of n.
a6fa05cf45 Merging revision 1187781 from tomcat/trunk: Whitespace removal from /java/org/apache/tomcat I won't merge all of it (as it spans bcel etc.), but only our code. Part 7, the last one. I am not updating mergeinfo, because not all of the original revision was merged.
5d62dc6125 Merging revision 1187781 from tomcat/trunk: Whitespace removal from /java/org/apache/tomcat I won't merge all of it (as it spans bcel etc.), but only our code. Part 6.
1d8658ee8d Merging revision 1187781 from tomcat/trunk: Whitespace removal from /java/org/apache/tomcat I won't merge all of it (as it spans bcel etc.), but only our code. Part 5.
97bb7c51fe Merging revision 1187781 from tomcat/trunk: Whitespace removal from /java/org/apache/tomcat I won't merge all of it (as it spans bcel etc.), but only our code. Part 4.
f5bb14cb6c Merging revision 1187781 from tomcat/trunk: Whitespace removal from /java/org/apache/tomcat I won't merge all of it (as it spans bcel etc.), but only our code. Part 3.
a8f05f8864 Merging revision 1187781 from tomcat/trunk: Whitespace removal from /java/org/apache/tomcat I won't merge all of it (as it spans bcel etc.), but only our code. Part 2.
a5830d2794 Merging revision 1187781 from tomcat/trunk: Whitespace removal from /java/org/apache/tomcat I won't merge all of it (as it spans bcel etc.), but only our code. Part 1.
572b238c13 Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 8, the last one. Updated mergeinfo.
1dfe76d7ee Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 7
8b1b7688d2 Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 6
afa6447500 Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 5
67c8d33cdf Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 4
49a8756458 Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 3
a522f27a52 Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 2
00851fd8ab Merging revision 1187801 from tomcat/trunk: Whitespace removal from remaining /java/org/apache/catalina Part 1 of n
16031b6b4d Followup to schultz's r1199985: Update mergeinfo marking r1199980 as merged
2ea402c83c Merged revision 1200106 from tomcat/trunk: Reformat and rearrange code samples to reduce the width of the document, for better readability.
04747187d1 Merging r1187809 - Trailing whitespace removal from /webapps Last remaining files. Updated mergeinfo.
c539c19e75 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 9
08b2d95e6f Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 8
5d073a9534 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 7
fb7b5c0298 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 6
5d8109e1ce Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 5
dd63e0285e Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 4
0ab0b0ba78 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 3
a521f33c81 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, 2
46938558b0 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/docs, part 1 of n
d4bc68ee33 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/examples, 5
01a3ad11af Merging r1187809 - Trailing whitespace removal from /webapps /webapps/examples, 4
f9e9d2593d Merging r1187809 - Trailing whitespace removal from /webapps /webapps/examples, 3
192ddc5906 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/examples, 2
696bcb0127 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/examples, 1 of n
1288b0f9b7 Merging r1187809 - Trailing whitespace removal from /webapps /webapps/host-manager
f87f5f906d Merging r1187809 - Trailing whitespace removal from /webapps Part 2. - /webapps/manager
2833b342a1 Merging r1187809 - Trailing whitespace removal from /webapps Part 1 of n. - /webapps/ROOT
c7cd62c024 Merged revision 1199996 from tomcat/trunk: Followup to r1199980
3c17a01348 Fixed poorly-formed XML in changelog.
cb3ff48510 Fixed bug #50570 - Allow explicit use of FIPS mode in APR lifecycle listener - Added "FIPSMode" attribute to AprLifecycleListener that causes OpenSSL to go into FIPS mode
7327509476 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52156 Need to use normalised path to look up resource in DirContext
a71db01809 Add changelog entry for BZ52148
cbb57c4462 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52148 Ant tasks require tomcat-coyote.jar Patch provided by Volker Krebs
17c4054719 Fix typo
f0cd04640f Fix typo
c60f6491e5 Correct parameter description
2cdf6e0435 Reorder, so that properties are listed alphabetically. No functional change.
0351f661e9 Merged revision 1198640 from tomcat/trunk: Restore handleQueryParameters() call that was lost in r1189882
e5978c0a7f Merged revision 1198622 from tomcat/trunk: RequestFilterValve (RemoteAddrValve, RemoteHostValve): - Refactor process() method separating value testing logic into a new method, isAllowed(String) - Expose isAllowValid, isDenyValid properties and the new isAllowed(String) method through JXM
6300d84814 Merged revision 1198607 from tomcat/trunk: Add synchronization to close()
bbecfa72f8 Merged revision 1198604 from tomcat/trunk: Remove synchronization from write(byte[]), because it is not needed there, as write(byte[],int,int) that it delegates to is synchronized.
afab9b7175 Merged revision 1198602 from tomcat/trunk: Add test for FlushableGZIPOutputStream.write(int). Remove unneeded &0xff in int->byte conversion from the method. According to JLS 3rd ed ch.5.1.3, narrowing of int to byte "simply discards all but the n lowest order bits".
0ae5487a5b Merged revisions r1197263 r1197305 from tomcat/trunk: Clean up code and use logging framework instead of System.out. Remove 15s wait after each test. I do not understand why that 15s wait with "inspect connections" message was there. Nothing was checked after the wait. Replaced it with a check of the count of received messages. Removed wait after sending the last message in the group of 3.
7aeaa0a22e Merged revision 1197261 from tomcat/trunk: Introduce a new class LoggingBaseTest and move the following features from TomcatBaseTest there: setting up logging, creating temporary directory, deleting files on tear down. This allows to use the same logging configuration in tests that do not use Tomcat.
e7d3145d66 Porting r1187806 - whitespace cleanup in /test Last portion - xml, jsp, tld files. Update mergeinfo on the tc7.0.x\trunk folder.
55ad34c3f3 Porting r1187806 - whitespace cleanup in /test
7ab994cb44 Porting r1187806 - whitespace cleanup in /test
0ab42f9ce5 Porting r1187806 - whitespace cleanup in /test
d42b68beba Porting r1187806 - whitespace cleanup in /test
758ebcf136 Porting r1187806 - whitespace cleanup in /test
201e695a90 Porting r1187806 - whitespace cleanup in /test
7206c4af8d Porting r1187806 - whitespace cleanup in /test
354bf8965d Porting r1187806 - whitespace cleanup in /test
5fa117de01 Porting r1187806 - whitespace cleanup in /test
0bd4142174 Porting r1187806 - whitespace cleanup in /test
eca35c5b80 Merged revisions r1197158, r1198552 from tomcat/trunk: Add new attribute to AbstractEndpoint and use it to speed up Tomcat tests. If the attribute "fastShutdown" is set on the endpoint, the usual wait of 1 sec during pause() is skipped.
0bfb7445aa Merged revision 1198528 from tomcat/trunk: svn:eol-style=native
a9efe6871a Merged revision 1198497 from tomcat/trunk: Update to Checkstyle 5.5
760e28ecc4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52121 Based on a test case by David Marcks. Improvements to test case and actual fix by kkolinko.
fcc5370df2 Casting clean-up
450a6a7413 Ensure that subsequent attempts to start the Valves will not succeed until valid configuration is provided.
6a729869e0 Correct descriptions
b6580d51ae Merged revisions r1196825 r1196827 from tomcat/trunk: Wrap and format long lines. No functional change.
d2d1d0f352 Merged revisions r1175798 r1196735 from tomcat/trunk: Improve RUNNING.txt: - Better describe environment variables. - Document setenv scripts. - Mention "catalina start"/"catalina stop" as well as "startup"/"shutdown" scripts. - Better document running with separate CATALINA_BASE and CATALINA_HOME. - Provide example of setenv files and example of using a context that points to ${catalina.home}. - Replace Netscape browser instructions with Firefox ones. - Add several references to User Guide and Configuration Reference.
be8e5fbac0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52113 Don't assume presence of context.xml file with JMX deployment
03a9e2580b Clarify behaviour if limit is reached
fc21d4161a Merged revisions r1196212 r1196223 from tomcat/trunk:
ff765619fa Merged revision 1196175 from tomcat/trunk: Make sure that ISE thrown by parseParts() or by addParameter() is remembered and rethrown when getParts() is called.
eea2abd418 Update to latest jdbc-pool changes
9649a2147c Extend the parameter limits to multi-part processing
f839eea12f Clarify behaviour if limit is reached
db0c42c547 Deprecate use of o.a.[catalina|jasper].util.enumeration and replace with Collections.enumeration
597edaab88 Merged revision 1195949 from tomcat/trunk: Followup to r1195943 (r1195944 in TC7) Simplify code. Move toString() call out of urlDecode() method. No functional change.
7b05232350 Merged revision 1195943 from tomcat/trunk: Followup to parameter parsing improvements. urlDecode() sets bc.charset. If decoding is skipped (because there is no '%' in the string) we shouldn't forget to set the charset.
c7950cf9f2 Merged revision 1195905 from tomcat/trunk: Followup to r1195531 (r1195537 in tc7) Use standard Collections.enumeration() wrapper instead of our Enumerator class.
0891ec362d Merged revision 1195899 from tomcat/trunk: Fix checkstyle validation for startup/catalina.properties: validation runs before compile and the file must be copied before validation runs. Reconfigured the build so that copying occurs before validation.
4af00e2388 Restore changelog entry for issue 51940 that was occasionally removed in r1195441.
a2fede48c2 Merged revision 1195531 from tomcat/trunk: Replace Hashtable with HashMap in parameter processing. Improve paramsAsString() debug method by iterating over entries instead of keys.
86963eced0 Fix order
0346fbf8b2 When Context manager does not exist, no context manager message is replied in order to avoid timeout (default 60 sec) of GET_ALL_SESSIONS sync phase.
c2508191c1 Simplify addition of parameters
233dcc857e Review from kkolinko. Minor performance tweaks.
a4bfa01d4e Review comments from kkolinko for parameter parsing improvements
94dcb57528 Add bug number for r1190194 Add linewrap in a long name
5fd94ded5e Fix NPE in parameter re-factoring identified by JSP TCK.
f1c6719f8e This is not AJP specific
661a1bbae3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52091 Address performance issues related to lock contention in StandardWrapper Patch provided by Taiki Sugawara.
e77cda572d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52091 Address performance issues related to log creation TagHandlerPool. Patch provided by Taiki Sugawara.
0569aa6a01 Implement review comments from kkolinko
d23ede0256 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51744 Throw the correct exception if an application attempts to modify the associated JNDI context. Add an option to the StandardContext that allows exception throwing when an application attempts to modify the associated JNDI context to be disabled.
5070ff4e01 Fix possible NPE
af3e038592 Update for bz46264
277d18867d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46264 Implement threaded container start/stop
619543e52a Deprecate unused code
0c5d3a9035 Re-factor parameter parsing to improve performance
218ed392eb Add a test for parameter processing prior to some refactoring
4104a3d214 Work around a known JVM bug that is fixed in 1.7.0_01 but still present in 1.6.0_29 and was triggering intermittent unit test failures for org.apache.catalina.tribes.group.TestGroupChannelMemberArrival.testMemberArrival
ea8f68c630 Fix intermittent unit test failure for TestCometProcessor.testCometConnectorStop Previously either the running or close field could end the loop but only close performed the necessary clean-up. This patch removes the ability for running to end the loop.
db0791dc99 Merged revision 1189477 from tomcat/trunk: Followup to r1189256 Correct typo in i18n message: RemoteIpValve is a different beast Add Javadoc for new fields in RequestFilterValve
6cdda5bf26 MBean deregistration is not responsible for clearing the serivce. This happens during destroy()
022b24c55e Fix typo
3698f4ec08 Merged revision 1189386 from tomcat/trunk: In DeltaSession.setId(String): fix duplicate resetDeltaRequest() call. It occurred via super.setId(id) calling overridden DeltaSession.setId(id, true).
58401eb235 Make configuration issues for security related valves and filters result in the failure of the valve or filter rather than just a warning message.
1b9f4580b7 Merged revision 1189240 from tomcat/trunk: Update logging documentation: group together the files that are put in lib/ when configuring log4j logging. Some users were confused and put one file into bin/.
00f69d230d Followup to deprecating the auth method names constants in authenticator.Constants Add Javadoc comment that points to replacements. Replace use of the old constants with the new ones from HttpServletRequest.
7ab28047a4 Align Clock2.java implementation with current trunk. It covers revisions r1050653 (already in tc7.0.x), r1187755, r1189183. Fixes Eclipse warnings in the class and trims ending whitespace.
95c08f3252 Remove trailing whitespace from bat, sh, res/tomcat.nsi and textual files in /, /bin, /res
a298ecac97 Merged revision 1187775 from tomcat/trunk: Remove trailing whitespace from the files in /conf
1bb6b3b586 Merged revision 1188301 from tomcat/trunk: Ignore .git dir when building src distro (markt)
a916f46d57 Merged revision 1189129 from tomcat/trunk: Correct a typo
29e98e9098 Merged revisions 1188930, 1189116 from tomcat/trunk: .gitignore files r1188930: Git ignores empty directories and the unit tests require this directory to be present for the welcome file tests to pass. The presence of this file doesn't break the unit tests. (markt) r1189116: license header and svn:eol-style
87834c1445 Remove unused code
fe289a6f1d Make unused code as deprecated prior to removal in Tomcat 8.
658c82a734 Start deprecating unused / unnecessary code
61bf2a8528 i18n resource fixes
8f8a983459 Remove trailing whitespace from values in *.properties files These are from revisions r1187791, r1187792, r1187794, r1187795, r1187800, r1187801
d9a43aaed4 Remove trailing whitespace from values in *.properties files These are from revisions r1187781, r1187782, r1187784, r1187786, r1187787, r1187789, r1187790
46fe4418ba Remove trailing whitespace from values in *.properties files in java/javax/ These were part of r1187778
d4d5620738 no more need to try delete/clean src directory
e704a3641d temporary copy sources ${basedir}/target/src/main/java rather than to ./src/ it will prevents to add too much svn:ignore and will be deleted by a simple clean
3dca96ea58 Fix license headers to align with our checkstyle rules The issue was noticed by Gump run
47bc84f399 import external sources only if not exits: build speed improve when not using clean
830400eb43 not delete copied sources for all builds
3b34b28385 fix inclusion of some default *.properties files
6941d1b486 ignore target directory in the maven build
16789d2024 add a basic .gitignore
ee7f1e3927 add a minimal maven build to build artifacts only: distrib will come later. sources layout not modified everything is in a new maven path
1484b6f418 Add info from back-port of r1187028
67b7172a2b Ensure the the memory leak protection for the HttpClient keep-alive always operates even if the thread has already stopped.
126ef68b8b Additional fix for r1186632.
5d89c8af8c Thread safety
d50f7aab36 Clean-up. No functional change.
fae18de41b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52049 Improve setup instructions for running as a Windows service - remove references to specific Windows OSes - it easily gets dated - correct info on how a JRE is identified / selected
729d181bd6 Clean-up. No functional change.
dd1d70fbc9 When a comet request ends and the socket is being kept alive, prepare the buffers for the next request.
91e35415b9 Remove unnecessary calls. Closing the socket recycles the processor which in turn recycles the buffers.
78ae8be5e6 Clean-up. No functional change.
73d8c82248 Merged revision 1186763 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52059 Delete Tomcat key from HKLM branch of Windows Registry on deinstallation.
64b927c6bb Merged revision 1186750 from tomcat/trunk: Expand the test to cover regression fixed in 7.0.23: check that parameters in the original request have reached the protected page. https://issues.apache.org/bugzilla/show_bug.cgi?id=51940#c9
ef9369b02b Merged revision 1186743 from tomcat/trunk: in TestFormAuthenticator: Replaced string concatenation with StringBuilder. Autoformatted the code. No functional change.
15982ba27b Merged revision 1186712 from tomcat/trunk: https://issues.apache.org/bugzilla/show_bug.cgi?id=51940#c9 Restore original method name when forward to the login page returns Simplify a changelog message.
d0a9223848 Update external.
c55552f0e7 update changelog for bz52015.
1e4ef1ba5a Avoid an unnecessary session ID change notice. Notice of changed session ID by JvmRouteBinderValve is unnecessary to BackupManager. In BackupManager, change of session ID is replicated by the call of a setId() method.
3eb3328309 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52055 Buffers not correctly reset between keep-alive requests when using async
a6ecaf2b0b Code clean-up. No functional change.
87cb0d8cfb Fix the regression caused by r987955 Correct a regression in the fix for bug49779 that prevented parameters POSTed by an unauthenticated user to a page that required authentication from being lost during the authentication process.
704d6db5b5 Minor refactoring. No functional change.
38207e2f4d Code clean-up. No functional change.
ad3d9c22d2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52051 Return a 404 if an attempt is made to process a resource that does not exist
00222653d0 Code clean-up. No functional change.
cc1eb16e40 Merged revision 1186153 from tomcat/trunk: Several additional occurrences of s/dB/database/
bd0c435be5 Merged revisions r1186123, r1186137 from tomcat/trunk: Correct the markup. s/db/database/ Rearranged the introductory section for DBCP pool. Removed mention of JVM 1.4.
f82b8345aa Merged revisions r1186011, r1186104 from tomcat/trunk: Rewrote the DriverManager section in jndi-datasource-examples-howto.xml. The point of view is that driverManagerProtection feature in leak prevention listener is enabled by default. The old warnings about how the things may break thus have much less value.
f5de1088d3 Focus DIGEST auth performance test on authentication process.
2a404f8cd7 Update jdbc-pool to latest
f396db8ed3 Resolve a warning about unboxing operation. Perform unboxing explicitly. (kkolinko)
f6d82a42b0 Remove unused code
325c120072 Resolve "Redundant null check: the variable cannot be null at this location" warning. The JspC constructor cannot throw a JasperException. (kkolinko)
e0d62d58e8 Fix possible NPE
d1854fc41e Do not sort lists that have only one element (kkolinko)
60c9c390ce Sync with trunk. Whitespace only.
47a689aa0a Sync with trunk. Add performance unit test.
3bf0484989 Code clean-up. No functional change.
ef61d9e6f7 Correct possible (but very small) memory leak when using maxLoadedJsps to limit the number of JSPs loaded at any one time.
38729b39d0 Correct additional threading and premature clearance issues with the annotation cache.
2dd4d66bbd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52042 Correct threading issue in annotation caching that could lead to an NPE if multiple threads were processing the same class hierarchy for annotations
4424d08a37 Add issue number and correct a typo.
2c81e678bf Merged revision 1185626 from tomcat/trunk: Replace links to Servlet and JSP specifications with a link to our wiki page. One link still remains in appdev/introduction.html.
672ed840e1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52045 Merged revision 1185588 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52045 Better document what "default" Manager implementation is. Also added a separate section about the pathname="" trick that is used to disable session persistence.
de53615d8e Improve start up time by caching the result of parsing the global and host level web.xml files.
e9c571acee Re-factor merge code so it does not modify fragments to support caching of default web.xml settings
20e1e3969e Fix copy paste error s/dir/war/
b35e94c432 Make differences between WEB-INF/lib and $CATALINA_BASE/lib clearer
530eea4c5a Add changelog entry for r1185021
b6b86af7bd Always format juli date and time stamps in US locale (currently the class is only used by the OneLineFormatter).
4e71e8614b Comment typo.
d6a46ab79a Update docs in light of https://issues.apache.org/bugzilla/show_bug.cgi?id=52025
ae5539a518 Fix typos
f9da26f41f Merged revision 1183605 from tomcat/trunk: Organize imports. Nagged by checkstyle.
4a5167d44f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=52009 Port fix (r1183494) from trunk Fix the NPE if an error occurs during comet processing Add test cases for errors during comet processing Ensure access log entries are made if an error occurs
e65be75ea4 Port refactoring (r1183493) from trunk Move the access log validation to the TesterAccessLogValve so that is is available to all tests that use the valve.
8e2b2b581f Port clean-up (r1183492) from trunk - remove trailing whitespace - add final where appropriate - add {...} where appropriate
a383436489 Merged revision 1183328 from tomcat/trunk: https://issues.apache.org/bugzilla/show_bug.cgi?id=50923 Documentation: Use default color, but lightcyan background for code tags. Based on a suggestion by sebb. Properties table (e.g. config/systemprops.html) needs the same handling as attributes table.
d671ec4f40 Simplify deployment code Use full paths in log messages to remove ambiguity
1854b3dc8d Address review comments for r1181030
7f7c3067c2 Remove unused code
41c74ba0d0 Update copy of Commons BCEL to latest code from Commons BCEL trunk
49ea099ee5 Correction.
92915389af Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51940 Don't limit saving of request bodies during FORM authentication to POST requests since any HTTP method may include a body. Based on a patch by Nicholas Sushkin
dc96154eac Update changelog
a985bea923 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51972 Add support for handling scheme/protocol relative URLs for redirects
9b07e7eab7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51952 Make inclusion of a response body for redirects optional as it may cause issues and is only SHOULD in RFC2616. See also https://issues.apache.org/bugzilla/show_bug.cgi?id=41718
0d9a528b08 Fixed bug #51956: RemoteAddrFilter uses remote host (not address) in doFilterEvent
53ffb91aec Merged revision 1178721 from tomcat/trunk: rat-excludes.txt file for ASF Buildbot INFRA-3948
2aa4b611bf Merged revision 1178681 from tomcat/trunk: List jars in alphabetical order.
938d96e378 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51630 Correct bug in async examples. Remove unnecessary call to AsyncContext.complete() that triggered an ISE.
716accc82c Update changelog
0328d0cac2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51881 Don't mark processors handling comet requests as non-comet too early. Before this fix, finishing a comet request was processed as non-comet meaning the comet clean-up code was not executed which was likely to break processing of the next request on the connection.
7fbcea3008 Merged revisions r1177850, r1177862, r1178228, r1178233 from tomcat/trunk: Removed wrong duplicate lines from aio.xml. Javadoc for CometEvent: Added <br> tags to make it more readable. Corrected markup.
c58b557f96 Merged revisions r1175690, r1178209 from tomcat/trunk: https://issues.apache.org/bugzilla/show_bug.cgi?id=50923 Use distinct color for <code> and add small spacing around it. Do not color attribute names (the names in the first column in attribute lists in Configuration reference).
cc0b6e4803 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51910 Prevent NPE on connector stop if Comet applications are being used without the CometConnectionManagerValve.
739c96294f Add release date for 7.0.22
774033073e Merged revisions r1177152, r1177160 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51912 Fix several small issues in Header processing in Nio HTTP connector: - Exception in skipLine() if debug logging is enabled. - Several corner cases, identified through code review.
bb877952e1 Merged revisions r1177125, r1177245 from tomcat/trunk: Improve MimeHeaders.toString() to deal with multiple headers having the same name. This method is used only for debugging.
f2a09aa427 Merged revision 1177060 from tomcat/trunk: Improve TestNonBlockingCoordinator: - Format code for better readbility. - In testCoord1() change how equality is tested. Read expected value from 0th member, instead of (i-1)th. They all should be the same. - Remove unneeded main() method.
227bfe0a81 Merged revision 1177050 from tomcat/trunk: Improve TestGroupChannelMemberArrival 1. Add synchronization when accessing TestMbrListener.members. This should fix the failures observed by Gump. 2. Remove unused method #clear(). 3. Improve messages printed to System.out during the test 4. Print messages when memberAdded()/memberDisappeared() performed no work.
c8ef4fb173 Add revision number for 7.0.22 tag to subclipse:tags property
a62ef4f849 Update mergeinfo: mark r1156115 as merged, because this change has been applied in r1156111.
e4b2eeff7a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51905 Merged revision 1176799 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51905 Skip attempt to shutdown AprEndpoint acceptor threads if the server socket has been already forcefully closed. Reduce waiting timeout from 30s to 10s. I think if things go wrong 10s is enough to wait.
8f0035d914 Prep for next release
9eae334e94 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51872 Ensure access log always logs the correct remote IP. Ensure requests with multiple errors do not result in multiple access log entries.
d5bd2e6000 ContainerServlets are always restricted.
7ab8b421b6 Merged revision 1174325 from tomcat/trunk: Fix a small number of Eclipse warnings.  - Unused code  - Unnecessary null checks
202c2736d3 Add CVE number. Sort issues by number.
5dce89574b Fix a FindBugs warning
a9c018e94a Fix some FindBugs warnings
7938a340be Remove unused code
50c4537fa1 Merged revisions r1174322, r1174329 from tomcat/trunk: Document thrown exception. This suppresses "Exception is never thrown" warning in Eclipse.
b4864568c7 Add thread name to juli OneLineFormatter. Merge of r1175713 from trunk.
abe9fe2763 Update mergeinfo: mark r1156519 as merged: this change was committed in r1156518.
13015693fa Correct issue number. Add missing changelog entry for r1169796.
0f5ecdcbdf Merged revision(s) 1175633 from tomcat/trunk: There is a caveat when using RemoteAddrValve with IPv6 addresses - see thread "tomcat 7.0.21: bug in RemoteAddrValve?" of 2011-09-14 on users@ Document it and update configuration examples in manager and host-manager apps. Add usage examples to valve.html, filter.html.
8478d02f0a Merged revision 1175613 from tomcat/trunk: Use slightly more correct markup
b2b41f3c9a Merged revision(s) 1175602 from tomcat/trunk: Remove unused webapps/docs/tribes/tomcat-docs.xsl
8fdfb04991 Accept AJP request even if endpoint is paused, if CPING was successful. Merge of r1175594 from trunk.
8f4c883018 Add changelog entry for r1175187.
129b4bd3ec Align APR AJP connector with NIO one. Send 503 if endpoint is paused. Marge r1175589, r1175590 from trunk.
d65921d4de Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51871 Merged revision 1175582 from tomcat/trunk: Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51871 Wrong transitive dependency listed in tomcat-jdbc maven pom It should depend on tomcat-juli, not on itself.
91d5e6e806 Add r1173333 to mergeinfo. This change was committed to 7.0.x in r1173330.
c3e35a97bf Add r1173342 to mergeinfo. It was merged in r1173343.
efc5212f6d Update changelog message for r1066244
3d46a26b1c Merged revision 1175283 from tomcat/trunk: Cleanup temporary files created by tests: register them and delete them in tearDown(). In TestRegistration also aligned mkdir calls with their usage elsewhere.
8f6a19aa67 Merged revision(s) 1174339, 1174799 from tomcat/trunk: Fix warnings
23ca5dd432 Merged revision 1175275 from tomcat/trunk: Reduce visibility of static field ManagerBase.name and make it final. We already had a bug being introduced in r1174181 because of this field being assignable. If anyone wants to read it, there is getName() method, or just substitute the literal string value.
fab8b7f73c Merged revision 1175272 from tomcat/trunk: Correct a typo
ede078a6ed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51887 Use an insecure random source for session ID generation during tests for speed. Based on kkolinko's suggestion.
1218769d15 Fix Javadoc typo. Merge of r1175190 from trunk.
da503ee393 Break from AJP CPING handling if endpoint is already paused.
ff2ca877f2 Merged revision 1175167 from tomcat/trunk: Do not try to delete the whole output/test-tmp subdirectory when running tests, because that wouldn't succeed (at least on Windows).
7d04ae8fd9 1) Use setters when cloning attributes. Should be more safe in most cases.
f5617d2ce3 Merged revision 1174983 from tomcat/trunk: Ignore warnings in classes generated with JavaCC/JJTree
1fcb272cbb Allow the BIO HTTP connector to be used with SSL when running under Java 7.
2320a5fa5c Merged revision 1174330 from tomcat/trunk: Remove unused code
7cdf4256e4 Merged revision 1174337 from tomcat/trunk: Remove unused code
ab89ad0043 Merged revision 1174338 from tomcat/trunk: Remove unused member variable
855f32de80 Merged revision( 1174343 from tomcat/trunk: Fix Eclipse warnings in a sample class in documentation
10625a1fcc bug 51862: JreMemoryLeakPreventionListener enhancement to load configurable classes https://issues.apache.org/bugzilla/show_bug.cgi?id=51862
0a9e649604 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51862 bug 51862: JreMemoryLeakPreventionListener enhancement to load configurable classes https://issues.apache.org/bugzilla/show_bug.cgi?id=51862
9cb171ddfc Fix docs typo.
f36b495f95 - Pull up members "cluster" and "notifyListenersOnReplication"   to common base class. - Pull up common clone code to base class. - Add sessionAttributeFilter to clone method - Reduce visibility of notifyListenersOnReplication
ba4cd0d8ab Ensure DefaultInstanceManager changes for caching work with a security manager
1a16663dd0 Merged revision 1173722 from tomcat/trunk: Followup to r1173630 Simplify code: methodName can be tested once per iteration
3492bd2608 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51860 Fix issues when using NIO, SSL and a custom SSLImplementation. Based on a suggestion by Roman Tsirulnikov.
947a97acf8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51852 Correct 2 issues in varargs handling  - Incorrectly constructed varargs arguments (resulting in ArrayIndexOutOfBoundsExceptions)  - Incorrectly detected matching varargs methods Patch (with a test case!) provided by Matt Benson
906679ca41 Backport of r1173614 Simplify code in NioEndpoint$Poller. The events.size() call is costly, because it is a loop that counts entries in a linked queue. Actually it is not needed here at all, because we iterate the queue by ourselves.
b7a6baea4d Fixed bug #51580: Severe error deploying WAR application (ExpandWar error) - Added nicer error message when WAR file filenames are improperly encoded.
a06fcb8f18 Fixed bug #51687: Improve JreMemoryLeakPreventionListener against leak caused by sun.java2d.Disposer - Added (optional) protection against sun.java2d.Disposer thread pinning a WebappClassLoader into memory in the JreMemoryLeakPreventionListener.
286020b301 Fixed bug #51687: Improve JreMemoryLeakPreventionListener against leak caused by sun.java2d.Disposer - Added (optional) protection against sun.java2d.Disposer thread pinning a WebappClassLoader into memory in the JreMemoryLeakPreventionListener.
30b8d631ce Modify test to account for behaviours of different platforms and different connectors.
f15943b93f Fix a timing issue in NIO connector that meant that stopping a connector did not trigger a Comet END event if the associated processor was processing a READ event when the connector was stopped.
a298c30348 Reduce waiting time to a single 5s wait rather than 2*10s
e7abda3f50 Don't add to Poller when socket is closing to prevent NPEs.
b8d4369e86 Mark r1170647 as merged. (It was merged in r1170656)
4258200c16 Remove ununsed comment
4ceabfde2b Better detection of thread termination at end of test Better failure messages so it is easier to see the cause of any failure immediately
360435d0ff Fix threading issue with changing visibility of methods and fields
957a96d70b Fix resource leak in annotations cache that prevented unloading of resources that used annotations
e51e977697 JSP unloading code was retaining a reference to the unloaded JSP preventing the associated class from being unloaded until the JSP that replaced it was unloaded.
8799ae78a4 Add Java 7 sunec.jar and zipfs.jar to jarsToSkip.
0a1500b6c3 Fix javadoc and comment typo. Backport of r1172278 from trunk.
1b3acb26f2 BZ 51811: Fix typo in attribute name (sslImplementationName instead of  sslImplemenationName).
c841446dce 1) Allow to overwrite check for distributability of session attributes by session implementations. Backport of r1172233 from trunk.
665f4ad4d3 Merge r1171692 Report tests failure only after all connector variants (BIO,NIO,APR) have been tested. - do not stop on first connector that fails.
3b66b55e01 update changelog
ff03745f17 https://issues.apache.org/bugzilla/show_bug.cgi?id=51794 Fix race condition potentially causing a delay in select operations
f9eeec909e update changelog for bz51786.
d605d2bbdb Update external.
9277d6f8b6 Followup to r1169453 Remove svn:mergeinfo on DefaultInstanceManager.java Record r1169447 as merged on /tc7.0.x/trunk Only svn:mergeinfo properties are changed.
c26f0f6d3f The cache only gets populated if the context is not null.
603d7c8c69 Beckport r1167394 from trunk. It is followup to r1164569, because not all occurences have been replaced.
c169f9024f Merge r1167368 from trunk: Reviewing r1166576... Improve performance of Http11Processor.disableKeepAlive(): call getMaxThreads() first and do not call getCurrentThreadsBusy() twice, because ThreadPoolExecutor.getActiveCount() in JRE is implemented as a loop that counts threads and that should be expensive.
28438354c3 Merge r1166757 from trunk: Fix Eclipse warnings in unit tests
1155ee8de1 Add bug number to the issue fixed by r1166619
fd77baae7c Fix possible NPE if instances aren't created through the DefaultInstanceManager but are destroyed through it.
60cbcc7202 Tomcat 6 introduced a custom attribute for SSL session ID. Servlet 3 introduced a standard attribute for this. Support both, deprecating the custom attribute.
96c9b7565a update changelog for 1166619.
8f4e49fdb3 Update external.
d64ced66c0 Add caching of postConstruct and preDestroy annotations
58b7116e63 Merge re-factoring from trunk that pulled up HttpXXXProcessor.process(), better aligned the behaviour of the HTTP connectors and provided better support for infinite connection and/or keep-alive timeouts
340131035b Correct a typo in the changelog
ef09e4bab1 Reduce cache memory usage for classes with no annotations. Review comment from kkolinko.
1e9282a81b Add an annotation cache to the <code>DefaultInstanceManager</code> that improves performance for applications that make use of a lot of non-poolable objects (e.g. tag files) that need to be scanned for annotations when created.
ade56fb212 Use <scode/> where I had previously <code/> Put entires to the correct sections
211517e54a Correct broken changelog entries, sort by issue number.
acf53fd6c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51774 Use method Set rather than EnumSet since the method signature uses Set.
f1f90deb25 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49683 Support separate connection and keep-alive timeouts for the APR/native connector HTTP and AJP connectors.
0b61bfb98c Revert r1165240. Documented defaults are correct.
2b9b0a086c Correct documented default for connectionTimeout with HTTP connectors
2400e0a58c Further re-factoring of the HTTP connectors to align the BIO, NIO and APR implementations.
3618cf3b1e line length
4a875dc300 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51758 Align the digester logger names with the class name else users will never be able to figure out how to stop it logging
6ffa6277da Backport of r1164480:
4e1b1ceea9 Fix a regression with the fix for 51653 that broke custom error page handling for error status codes return by the authenticators. This moves error page handling back to the host valve and also moves request listener handling to the host valve. This ensures that everything at a context level happens inside the listeners and that custom error pages are available for all context errors.
46f1249f2c Correct connectionLinger documentation
ac095dbf14 Remove unused, undocumented configuration option
545c5b66bd adding subclipse:tags for tc7 tags up to 7.0.21 to allow subclipse to display tags in history view.
a871790845 removed unused sections
65bdd5444b Add release date
ba275db05c Fix comments (aligns with trunk)
3ed5430413 Fix spacing (aligns with trunk)
2b45ff6e31 Update external to pick up latest changes (already in changelog)
2b8d3da257 Add changelog for r1163986. In jdbc-pool: Avoid IllegalArgumentException when setting maxActive less than or equal to 0. ArrayBlockingQueue doesn't allow capacity of 0 or less.
37aa42b980 Revert r1163807: Remove subclipse:tags property.
9796b84858 bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat https://issues.apache.org/bugzilla/show_bug.cgi?id=51741
4962464476 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51741 bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat
02f18f16aa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51741 bug 51741: Eclipse WTP "Serve modules without publishing" broken with tc7, needs patch in tomcat
e7806438d7 Revert r1163643
ba6991388c As per the comment, remove the deprecated code
7eae820ef2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51744 Don't allow user code to close the JNDI context while a web app is running
90ec9675fa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51698 Fix CVE-2011-3190 Prevent AJP request forgery via unread request body packet
e0796d78ff Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51739 Set the method when using a landing page
5cb8a81aa1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51712 Ensure cache control headers are sent even if request is secure. Patch provided by Michael Zampani
a3067524ee Followup to r1162721 (r1162735) Get list of members only once Improve message and code formatting
f22309e483 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51736. Make rpcTimeout configurable in BackupManager.
3cba89d06f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51704 Make calls to File.mkdirs() more robust and handle errors in a few places where they were ignored and should not have been.
daac5346e0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51558 No need to force the use of the StandardManager with addWebapp() since StandardContext will add it if it is not set.
3a79aae13d Update jdbc-pool to r1162102 to include the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51583
37828f4010 Backport r1162082 Make the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50394 done in r1148815 more explicit. No functional change.
77c85504a1 Fix typo, better format for revision numbers.
513f2a7cc3 Tweak the message validation. Body messages don't have terminators
2e082c95cb Correct message
f92af02b2f Revert unnecessary changes.
7f720accb3 Detect incomplete AJP messages and reject the associated request if one is found
dff9618638 Backport r1161339 Do not pass exception to message template, because exception itself is logged as well. Remove argument from message templates that is never passed.
230d8b40fe Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51713 Improve message that is logged if there is a typo in the value of protocol in a <Connector> element.
15c067d4e0 Backport of r1161310 Fix two typos in tomcat.nsi (uppercase vs. lowercase in a macro call and in a message)
0093dfef1b Update mergeinfo as if r1161303 has been merged to tc7.0.x. Correct whitespace and a typo in changelog.
ed7b5cc0ac Re-factoring Add byte read count Add ability to swallow input
4f07212e70 Pull up refillReadBuffer()
e172466e98 More re-factoring to reduce duplication. Pull up flush() and finish()
f20301eefe Clean-up and re-factoring to reduce duplication
5021af7cb5 Remove unnecessary (duplicate) code
c73b1ef1f0 Ensure AjpMessage header is correct for the direction in which the message is being sent
26c4697b93 Fixed capitalization of "AWT".
700f47434f Fixed bug 51688: JreMemoryLeakPreventionListener should protect against AWT thread creation - Added awtThreadProtection setting
b6d1ca94bd Merge HTTP connector refactoring from trunk
aa3e06e59d nOnce -> nonce for consistency
f4e5d55612 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51658 Fix copy/paste error that could trigger an NPE. Based on a suggestion by Felix Schumacher
7d1661472f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51654 Log an error message if an appBase is specified that is not a directory and disable automatic deployment to prevent subsequent errors.
14c868bfb7 Correct location
7af0a6f1ac Fix benchmark tests
6def297804 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51653 Move application level error page handling from the Host to the Context. This ensures that application error page handling is completed before the requestDestroyed event of any ServletRequestListener is fired.
fdf38cfb0a update doco for bug fix
354393746e Not planning any Comet API removals
b946b0261d Fix typo
4cf93a477f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51650 Code clean-up Patch provided by Felix Schumacher
93568d9b3a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51649 Document ThreadLocalLeakPreventionListener
31acce40a1 Add release date
58e27c209f Add missing tags
e8c1423931 Follow up to r1156533. Filter URL (mainly in case of &).
295a6d5435 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41718 RFC2616 says redirects should include a response body.
8fd5f56d37 Unregisters MBean of DataSource when web application stops.
a2358e9490 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41673 Use platform line endings when reporting error messages
bf0f444e48 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51644 Annotation scanning was broken for contexts with a multi-level context path such as /a/b
538202cbfe Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51640 Improve the memory leak prevention for leaks triggered by java.sql.DriverManager.
2c5ea324d5 Future changes will be merged from tomcat/trunk so remove the svn:mergeinfo props to keep merge commits cleaner.
e8dda4cbbd Remove unnecessary svn:mergeinfo properties
24d885025a Externals relative to current dir won't work when tagging so use repository root
04d8c85b92 Update change log
160fcb78bf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51641 Connections map uses NioChannel, not <SocketWrapper<NioChannel>
37b7c6a37f Add external to pick up jdbc-pool. Use same revision as 7.0.20 tag.
2e6940ca73 Remove the modules from 7.0.x/trunk
a6dcdf18e8 Create separate trunk for Tomcat 7
fc2cbbd95f Update post tag
8adb950731 Upadte to 1.1.22 of the native connector
0040fe4eb3 Add missing getter and setter for the alwaysUseSession attribute of the authenticators.
3b513e1d28 Correctly indicate if socket is closing when calling recycle for the AJP NIO processor. Note since the flag is unused in this case there were no bugs triggered by the re-factoring error. (rjung)
04f309d9fa Correctly nest locks and unlocks to resolve FindBugs warning
a029606bb5 Only try and create the dir if it doesn't already exist
6a7347948d Rename socket -> socketWrapper
631b370efc Align HTTP NIO with BIO and APR and hold a reference to the socket wrapper not the raw socket in the Processor.
04a4387dbf Start to align process method
2958ba63e1 Fix some false npe warnings
69cbfeaddf Missing @Override markers
f10b8176e1 Fix a small number of warnings reported by FindBugs.
2f71f40a21 Remove error message since a) it is provides very little / no useful information and b) writing to stderr is just plain wrong.
4350ac4e7a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51621 Add additional required JARs to the deployer distribution.
4ad34626d8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51615 Code clean-up.
5a54d8ea08 Prevent spurious log warnings on container stop if a child component has previously failed.
f867eee126 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51610 Make lifecycle transitions more robust at handling unchecked exceptions
cd153f1090 Expand description
13d1118ed7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51614 Avoid two times calls of store.load() and session.expire() in PersistentManager.
35ff4995eb Allow to have several AccessLogValve instances in the same scope (e.g. in the same Context).
dc24104e03 Split "condition" attribute of AccessLogValve into two, "conditionIf" and "conditionUnless". Implement conditional logging that logs only if a request attribute is present. The old attribute "condition" is provided as well, for backwards compatibility, and is equal to "conditionUnless".
4b762ecf48 Update logging documentation 1. Place a better note that Log4J configuration is not needed if it is only osed by one's webapp. 2. Rearrange Log4J configuration section and document how configure it to be used by a single CATALINA_BASE only. 3. Add "productive usage considerations" subsection to JULI one.
d1c7a42327 Explicitly configure what icon is used with Tomcat in the list of uninstallable programs on Windows.
0e27c62e62 Add info on ciphers
3b14eb6b9c Update to daemon 1.0.7 This fixes CVE-2011-2729
d3779985cb Committing connection if autoCommit is false. Make sure committed connection is returned to the pool if datasource is enabled.
facdd03ed8 Prevent direct invocation of the Windows uninstaller without a service name from executing since the uninstall will not be complete.
1d39831785 Remove path attribute from examples of <Context> where this attribute is not needed.
9fc37824cf Correct relative links. It is followup to r1151537. CTR: Docs
985330a31a Quote the service name parameter in the registry as well as in the shortcut
c66134c050 Correctly handle uninstall with the Windows installer of the service is installed with a name that contains a '-' character.
54657c0164 Remove unused files
19109502d8 Simplify mapping for jsp servlet in the default web.xml. Multiple url-pattern values in the same servlet-mapping are supported since Servlet 2.5.
ef4d01ca21 Remove resolveHosts attribute from AccessLogValve configuration in the default server.xml.
f941bd9439 Additional comments about resolveHosts attribute of AccessLogValve. - The resolveHosts attribute could be used to change the meaning of "common" and "combined" patterns (as it still does in JDBCAccessLogValve), so I mentioned in the docs what to do when that is what the admin wants. - Align Javadoc with Configuration Reference. - Mention the effect of enableLookups attribute of connector on ExtendedAccessLogValve.
8871f11425 Ensure that calls to StandardWrapper methods() that may trigger creation of a Servlet instance always do so in way that correctly instantiates a Servlet instance.
1b42d0c1dc Remove unnecessary call. Reduce timeout.
d99ff8f97b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51588 Make it easier to extend the AccessLogValve to add support for custom elements.
22c5d53697 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51586 Expand error handling to cover anything that is recoverable (or might be recoverable) when loading classes during HandlesTypes processing.
cf95c379f4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51584 Ensure file paths are encoded/decoded when translated to/from URLs so special characters don't cause issues.
c73cc13248 Improve class loading documentation
df198affd8 Set "reuse" flag of final AJP "END_RESPONSE" packet to "0" if we plan to close the connection.
90e4aebe09 Improve class loading documentation
e99ceae12e Add a unit test that confirms that comet sockets are closed when the connector is stopped.
27eb1d9a0b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51567 Update the class loading page of the documentation web application to include information on the search order for the common class loader when separate values are used for $CATALINA_HOME and $CATALINA_BASE.
f0f9c610fe Ensure APR socket is not added to multiple pollers.
f84d5a4a93 Improve error handling for APR connector if sendfile fails
cccdf69162 Catch less specific exception to deal with intermittent failures with OpenJDK
51ee7ecc06 Typo
64b3672d18 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48997 Fixed some typos and correct cross-referencing to the HTTP Connector documentation with the SSL How-To page of the documentation web application.
e66450724a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49122 Layout improvements and tweaks
ee69e10c8c Correct LocalStrings.properties. Some invalid messagekeys are removed. e.g.  remove AsyncSocketSender.XXX and FastAsyncSocketSender.XXX keys.  ReplicationValve.XXX and SimpleTcpCluster.XX are removed from org.apache.catalina.tribes.transport.LocalStrings.properties.
6119e2bf0a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51561 Recommend the use of digest.[bat|sh] to generate digests rather than calling RealmBase directly.
0e174c9cf3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51557 Ignore HTTP headers that do not comply with RFC 2616 and use header names that are not tokens.
0edfd0acbb This is now available
24036687b2 Fix SSL unit test failures with APR/native
15ec4fcb12 Tests are run with all three HTTP connectors. No need for separate tests.
3938a7cf3a Update to checkstyle 5.4
bd4240870e https://issues.apache.org/bugzilla/show_bug.cgi?id=51545
e10b1d7be8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51555 Permit an additional lifecycle transition. Allow destroy() to be called on components that are initialized. This can occur in some start failure scenarios.
7923e677dd Converting tribes tests to JUnit 4 - done. Update changelog.
70b9962686 Converted tribes tests to JUnit 4.
3d13d6b79f Conversion of TomcatBaseTest classes to JUnit 4 completed. Rename TomcatBaseTestJUnit4 -> TomcatBaseTest.
8e26b61cb6 Converted the tests to JUnit 4.
8cbd77e081 Converted the tests to JUnit 4.
78d4d273ca Converted the tests to JUnit 4.
3f2f48664f Converted the tests to JUnit 4.
e1b0dcb610 Converted the tests to JUnit 4.
54d6f7cd1e Converted the tests to JUnit 4.
f71f5bdf3c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51550 Stop the adaptor swallowing internal errors.
6b7bb6aa2a Converted the tests to JUnit 4.
ca6b41cb99 Converted the tests to JUnit 4.
3398a53a6c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51544 Correctly resolve bean methods in EL so accessible methods that are overridden by inaccessible methods do not cause an IllegalAccessException. Modify test case to catch this problem on Oracle and OpenJDK JREs.
7e7ab65e1e Converted the tests to JUnit 4.
9d2505ee02 Converted the tests to JUnit 4.
9dd25084b6 Converted the tests to JUnit 4.
39559e2129 Converted the tests to JUnit 4.
b1a81431cf Update checkstyle rules to treat imports of "org.junit" as a separate group vs. "org".
5f8f6f2054 Converted tests in org.apache.catalina.deploy to JUnit 4.
1f714e4870 Update checkstyle configuration to allow static imports of org.junit.Assert members. This is for JUnit 4.
4aebe80053 Update project to use JUnit 4 libraries.
4b3fea2b79 Another test case for bug 51544
4e9292a16d Add tests for bug 51544 (note tests pass - can't reproduce error yet)
91c1247c39 Add tests for bug 51544 (note tests pass - can't reproduce error yet) Fix some find bugs issues
b4d582a164 Make rules on settng path clearer
0231ebc2ac Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41709 Provide exception messages for ISEs when response is already committed
2f26e7f545 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41498 Add info for allRolesMode
e412a07e66 AJP NIO is still experimental but is fully functional.
11b660afc7 Improve i18n support.
b6e55ec632 Promote the Set Character Encoding filter to the filters package so it is more widely available.
7efcaa5fb1 Improve wording in a message and in one entry in changelog.
c40190fbab Trivial improvements to access log valve docs. Fix typos noted by André Warnier.
c9f8db1f6f Fix for 51056. remove SSLv2 from all. Needs native 1.1.21. Now to allow SSLv2 you have to use: SSLProtocol="SSLv2+SSLv3" for example.
d97a43af35 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51532 JSP files with dependencies in JARs were recompiled on every access leading to poor performance.
d7a6cb61d6 Remove unused code
a8035cacaf Improve fix for PR50394 Requires native 1.1.21
7218305d47 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51516 Correct property to change SSO session cookie name
36aa30d8e7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51531 Update for ecj 3.7
e09d86896a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51509 Fix potential concurrency issue in CSRF prevention filter that may lead to some requests failing that should not.
707f42b784 Add info on which connectors these fixes apply to. Correct order. Add periods to the end of the sentences.
b7d3edae76 Add changelog for 1148254 and 1148216
2cf634209a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51518 Correct error in web.xml parsing rules for the <others/> tag when using absolute ordering.
3f15d04c26 Fix for PR50394
9e16fbb62f Add release date for 7.0.19
84cd98b53a Add test cases for syntax checking of jarsToSkip.
f2b1136291 Add section title
b86cd19e6d Fix for PR49595
4e00e2940f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51503 Add additional validation to Windows installer and Tomcat start for connector port numbers
9be6517f39 Cleaner code
d1094167fa Update to changelog
dd24dbe623 Only test for timeouts if timeout is greater than zero (aligns with BIO and APR)
a6d74aac4c Modify the test to ensure that the default connection timeout (-1) is used and so that pipe-lining doesn't trigger false positive results
a9ca4fceca Minor improvement to javadoc
f74247ab09 Add some units info to the Javadocs
ec798da825 Missing svn:eol-style.
8f0a7232b2 Corrected typo in the value of tomcat.util.scan.DefaultJarScanner.jarsToSkip property
11b82fac78 Update ready for next release
8e86e4a00a CATALINA_BASE is always set, so simplify
ddc9a77586 CATALINA_BASE is always set, so simplify
7b2c136ef1 Add CVE reference for sendfile issues
6a71454731 When running under a security manager and using sendfile, validate sendfile attributes to prevent sendfile being used to bypass the security manager. Part of the fix for CVE-2011-2526
c2337520ce No need to include class in message, results in "classclass"
06b211323a Protect against crashes in the HTTP APR connector if sendfile is configured to send more data than is available in the file. Part of the fix for CVE-2011-2526
94d708b6a4 git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@1145627 13f79535-47bb-0310-9956-ffa450edef68
f41d4b6484 Socket has been closed, return false so an attempt is not made to re-use the socket Part of the fix for CVE-2011-2526
63fe7142ba Correct a comment Part of the fix for CVE-2011-2526
77340040e2 Maybe someone wants to realize that change.
73daeb4c9b Never compare docs and code:
36e6efdd40 Protect against infinite loops in the HTTP NIO connector if sendfile is configured to send more data than is available in the file. (markt) Part of the fix for CVE-2011-2526
a1ab3e96d5 A little bit of docs is better than nothing ...
ffa02294c9 Remove unused attribute
c861aa123c Remove unused import
d6cab889c2 Use en_US as locale for creationdate in WebdavServlet.
69711bc5c8 Followup to r1145209 Do not expose TCN_FULL_VERSION as a public constant, but calculate it when needed. Using this way it will be easier to throw away the code in AprEndpoint when it becomes unneeded. I do not mind reintroducing the constant if it were used in two or more places.
420a032f52 Expose recently added "encoding" and "locale" options of AccessLogValve through JMX.
48949c0df1 - Remove unused code:   Cookie dates are formatted elsewhere.   This class used a very strange format:   " EEEE, dd-MMM-yy kk:mm:ss zz" - Add log.isDebugEnabled()
def239fdc3 Always use en_US as locale for timestamps in ExtendedAccessLogValve.
0f14b3a20b * JULI FileHandler, AccessLogValve: Create a directory automatically when it is specified as a part of the file name, e.g. in the prefix attribute. Earlier this happened only if it was specified with the directory attribute. * AccessLogValve: Log a failure if access log file cannot be opened.
3c921de91f Revert unintended commit
cb3a652bab Improve logging of error conditions
cfc2fd248a BZ 51477: Support all SSL protocol combinations in the APR/native connector.
fa353c1461 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46252 Allow to specify character set to be used to write the access log in AccessLogValve.
07fe6427ca Fix javadoc.
f5071e7bf9 Allow choosing a locale for timestamp formatting in AccessLogValve. Only relevant to timestamps explicitely given by SimpleDateFormat syntax.
760bb03d6a Ignore doc copied in during build process
96cf27df34 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51494 Prevent an NPE when a long running request completes if the associated web application was destroyed while the request was processing
2ff7928839 Replace <tt> by <code> in docs. The physical markup <tt> was only used in few places. Mostly we use the logical markup <code>.
712544787e Update changelog for bz51490 fixes
c65b646876 Fix broken HTML
aa83ead250 Fix broken HTML
9126061a70 Reduce variable scope to reduce testing issues
fc8ff18edd Ensure it is clear when tag isn't working
d698ea6d2f Fix broken HTML
505f6f34e2 Add a simple AJP test.
068972c217 Make it easier to test that the right response was returned
5c0c981e6f Set includeantruntime in jdbc-pool javac build tasks.
187d8ea2d5 Fix version pattern in jdbc-pool manifest.
726811edf9 Add jdbc-pool to jarsToSkip.
09cbe99f7d Reorganize jdbc-pool inclusion in releases.
e2dec49ca3 Add changelog entry for Filip's inclusion of jdbc-pool in releases.
8b367f714c Move new changelog entries to correct subsection.
8291e3b163 Make it easier for tests to override the protocol (e.g. to test AJP)
24852bc551 Add missing thread name in RequestProcessor when Servlet 3 Async is used.
24059e1368 Disable one test validation in TestAsyncContextImpl if an AccessLogValve has been activated.
eb24b82e8b Another regression in 7.0.18: year number formatting in AccessLogValve is broken due to type "yyy" instead of "yyyy".
0eb66fe7e5 Remove unused code.
f5335f3b13 7.0.18 not released
aaa993192d 7.0.18 not released
7914a613ad Add option test.accesslog to activate AccessLog for unit tests.
0fd334182d Fix regression producing invalid MBean names when using IPV6 addresses for connectors.
0c7fd73c2c Update to Eclipse JDT Compiler 3.7
8ecdaf9b77 Update to Commons Daemon 1.0.6
1996bc707f Remove some more unnecessary code
9bb92c6fdd Add regression fix to changelog
1991e44587 Fix Comet with HTTP/APR connector r1144391 switched the key for the processor map for this connector from the socket to the socket wrapper. That prevented Comet from being able to retrieve the processor from the map when processing a comet event. This commit changes all the connectors to map the socket (or rather whatever the SocketWrapper wraps) to the processor rather than the SocketWrapper.
ceaefd6597 Pull up Handler.process
50777181df Align AJP and HTTP prior to pulling up Handler.process
e4a434e666 Pull up Handler.process for the Http11 connectors. Note that this is an intermediate step. The aim is to pull this up to AbstractProtocol
fffc023c07 Pull up Handler.process for the Ajp Connectors. Note that this is an intermediate step. The aim is to pull this up to AbstractProtocol
6a1af43739 Yet more protocol alignment (with an eye to aligning with AJP)
fee068cab2 Change eol-style and add link to jdbc-pool on the documentation home page
7c77c78dab More protocol alignment (with an eye to aligning with AJP)
3c49d5d0d7 Protocol will call recycle
d49de704da Bring the Http11 protocol implementations closer together.
d3574af368 Completely align process methods
63153ff636 Align the process methods some more.
8e4b98f0a0 Align the process methods some more.
5d9ef2054a Remove unnecessary call. Socket can't be in connections at this point. Leave currently unused socket parameter in method - plan to use it in later re-factoring
9b74ff13de Improve comments
c82f12baca Fix regression in connector re-factoring that was too aggressive cleaning up AJP/BIO between requests triggering 400 entries in the access log
465cf31b3f Fix indentation
a7599e1f67 Pull up reset for remoteHost etc. to a common location
a0e7671c4c Remove pointless code (see finally block just above)
73b026d9a5 Pull up asyncDispatch()
c5311b0a94 Include jdbc-pool into tomcat release.
1886cdcdd2 No functional change - make it the same as BIO & APR
5ef0f22dbd Missed a reference to comet which will always be false in asyncDispatch
aceb49358d Remove unnecessary throws Move timeout lookups to where the timeouts are reset (in preparation for this being in a separate method)
7f718e3241 Collapse the multiple if statements
7eec0f65f3 Post refactoring, can't be processing a comet request in asyncDispatch
9c9dc83676 Add re-factoring to the changelog
d6df099a95 Already loaded via SecurityClassLoad
1d4b0a6149 Use SecurityClassLoad to pre-load HexUtils to prevent a security exception
d6a20bfeb5 Update ready for next release
ab2e42c34f Remove debug code
bdb81b8a97 Refactor to avoid NPEs during test
6fee58d2c9 Correct regression caused by connector re-factoring that meant that sendfile data was not reset between pipe-lined HTTP requests.
a1a54aec69 Fix typo
be93511aff Add sync to fix test failures on Linux. Should have minimal impact in normal Tomcat usage since each instance/JVM only opens a single socket.
d1a091b2a0 Refactor the bind call to reduce the length of the stack traces when the unit tests fail. It probably won't fix the issue but it will make the logs easier to read.
847b8d8c82 Not just this test failing. Need a better solution. Revert r1143126.
75382ed711 Javadoc fixes
fd0a090a7b Review comments
cf5047b764 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51475 Handle messages larger than the buffer size. Expand test cases to cover this. Based on a patch by Christian Stöber.
312f8f40bb Extract test to a test case
702b65a870 Prevent test failures on Linux
7e5850df09 Update changelog
b016a07cdb Remove unused code
aced551378 Based on current usage within Tomcat, message length of 0 should result in null. Populate the test for this and ensure the test passes.
61610985cc Remove main method
6dff8dc1d3 Remove ununsed methods. Convert from using main() to a unit test Use valid test data
e1561bbace Move working JUnit tests to align with package of class being tested.
d9f61af2b1 Limit exclusion to 'old' tests so tests added to o.a.catalina.tribes will execute
a22c16b010 Revert r1142953. The analysis was incorrect.
02651044da Fix response.encodeURL() for the special case of an absolute URL with no path segment (http://name).
358a4ab5a8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51472 Correctly test modifiers when resolving bean methods with the BeanELResolver. Patch provided by Friedhelm Kuehn.
a088a868bd Further improvements to the Windows installer 1. Install into "**/Tomcat7.0_servicename" when service name differs from default, but install into "**/Tomcat7.0" if the name is the default one. This is to be in line with 7.0.16 and earlier versions, but differs from 7.0.17 which used "**/Tomcat7.0/servicename". 2. Changed name of registry key for running of Tomcat Monitor 3. Do not forget to delete Tomcat Monitor running entry from HKCU in 32-bit part of registry
d90dcd4005 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51473 Fix concatenation of values in SecurityConfig.setSecurityProperty() when the value provided by JRE is null.
88d182f723 Validate Windows service name
94e6c058df Correct regression caused by connector re-factoring that made AJP APR/native connector very unstable on Windows platforms.
ea891d968a Add @Override annotation
27ede6e91e Add @Override annotation
07d83549d4 Add @Override annotation
9df798d783 Add @Override annotation
24ccc54304 Add @Override annotation
7d3f7bbead Add @Override annotation
7c5ddbecbc Add @Override annotation
e1782a8436 Add @Override annotation
dad5cdeb46 Fix "potential null pointer access warning".
9c66e4b6b9 Fix "potential null pointer access warning". As a bonus, it avoids allocating char[] buffer for an empty string. Add $FALL-THROUGH$ comment where we fall through to the next label in switch().
64f9d19fdc Fix a small number of warnings
7be0487bbd Add @Override annotation
a11bf633e3 Add @Override annotation
27b689f227 Remove publicId field from SchemaResolver class, because is never read and is not cleared when digester is reused. If anyone needs this, this value is available by calling SchemaResolver.digester.getPublicId().
360ea82bf9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51467 start() not run() Patch provided by Felix Schumacher
a8baa2aba2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51466 Fix typos Patch by Felix Schumacher
ff984d6362 Fix possible NPE
eaae2f1d11 Start the 7.0.18 changelog
2a093d9c8a Fix Eclipse warnings in the o.a.c.startup package
fa6b32eb4e Remove dead code
5dc9c69bb6 Fix generics warnings
71456e917d Fix Javadoc warnings spotted in 7.0.17 build
fa2898b4ae Update ready for for next release
fd4d1559e5 Only add instance if it has just been created.
d0e929e976 Correct deadlock introduced in r1142112
5626799010 When using Servlets that implement the SingleThreadModel interface, add the single instance created to the pool when it is determined that a pool of servlets is required rather than throwing it away.
22cdb69169 Prevent test failures when two objects get generated with the same hashCode
abcc624c3c Read/write by multiple threads outside sync - needs to be volatile
1df3265ba8 In Tomcat.initBaseDir(): set a value for catalina.home only if it has not been set previously.
7a9fbfb46f Followup to r1140693 Declare a separate public method for the new use case of makeJavaIdentifier(), instead of passing the "false" flag as an argument.
7ab3de1f8e Add support for configuring the shutdown port
96947d3fe5 Build server.xml for the installer by search and replace rather than combining fragments. No ore work to keep the original and the fragments in sync and esy to expand to add additional search/replace as well as insertions etc.
b635105f63 Use specified AJP port rather than always using default
31aeaec369 Consistent reporting for the connectors
acaeb4ece7 Fix possible NPE when serving STM servlets
1ebcf143a3 If things go wrong, don't wait forever for the latch.
925245a42f Fix faulty test
5a719fde57 Seen on Windows too (less frequently)
e111e4b20e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51453 Fix a regression in the preemptive authentication support (enhancement <bug>12428</bug>) that could trigger authentication even if preemptive authentication was disabled.
6ccc38490e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51445 Correctly initialise all instances of Servlets that implement SingleThreadModel. Based on a patch by Felix Schumacher.
5256122922 Improve the handling for Servlets that implement the deprecated SingleThreadModel when embedding Tomcat.
08af5b70d8 The change in session ID is notified to the container event listener.
bb24439201 Fix bad logic. Need to postProcess if socket is *not* closed and it is an async request.
16dd533f04 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51450 More Spanish translations. Based on a patch by Jesus Marin.
b563e8b315 Better error handling that may help track down the cause of https://issues.apache.org/bugzilla/show_bug.cgi?id=51088
aa4dbe43d4 Ensure that if asyncDispatch() is called during an onTimeout event and the target Servlet does not call startAsync() or complete() that Tomcat calls complete() (or does the equivalent) once the target Servlet exits.
7ecd0d7fcd Ensure an access log entry is made if an error occurs during asynchronous request processing and the socket is immediately closed.
1ae9c6fa0e If the socket is closed (i.e. due to an error) no need to postProcess
5a71153825 Fix what were originally typos Similar to https://issues.apache.org/bugzilla/show_bug.cgi?id=50648
cc8b86ac7d Fix what was originally a typo Similar to https://issues.apache.org/bugzilla/show_bug.cgi?id=50648
2549020316 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51443 Document the notifySessionListenersOnReplication attribute for the DeltaManager.
8accac27cd Notifications of changes in session ID to other nodes in the cluster should be controlled by notifySessionListenersOnReplication rather than notifyListenersOnReplication.
6df6bc0dfe Added symmetric sslAvailable=false in terminateAPR.
14e247e801 Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=51445
37353a5971 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51436 Send 100 (Continue) response earlier to enable ServletRequestListener implementations to read the request body. Based on a patch by Simon Olofsson.
9755dbaa29 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50353 Rather than the eventual NPE, throw an ISE if an application attempts to access an AsyncContext after the request processing has ended.
cf2f497981 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51447 Viewing a back up session in the HTML Manager web application no longer changes the session to a primary session. Based on a patch provided by Eiji Takahashi.
f687e7b4b7 More https://issues.apache.org/bugzilla/show_bug.cgi?id=51400 related changes Based on a patch by Konstantin Preißer
aec677fa84 Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=36362 to address regression for attributes with names that include underscores
abd68a9c6f Increase size of file the test tries to send since there is enough buffering on my system that 200k can hide in the buffers triggering a test failure (the limit works - it just fails in a way the test doesn't expect)
2e5abd78ef Increase size of file the test tries to send since there is enough buffering on my system that 200k can hide in the buffers triggering a test failure (the limit works - it just fails in a way the test doesn't expect)
002ae1812f Fix the remaining instances of new String(byte[] b, String enc) that can be fixed
1d91fa95ab No need for a ConcurrentHashMap now pre-population is used.
9117606c7d Update for recent changes
a84a959372 Use a more reliable method to expire sessions.
dedd8e0103 Simplify. Covert aliases to lower case too.
8cd3030835 Need to include aliases in charset cache
aa705621b5 Remove upgrading info - it has been added to the site
14e03f9a2a Remove unused files
1898c9e0fe Pre-populate Charset cache. Since cache is pre-populated, no need to look up non-matching values which effectively caches misses too.
aa3b508bf2 Prevent multiple variations of the same sncoding filling up the cache
b6cc95f93d Fix typo
0ecc464393 Fix CVE-2011-2204. Prevent user passwords appearing in log files if a runtime exception (e.g. OOME) occurs while creating a new user for a MemoryUserDatabase via JMX.
59f3ed053e Use "eval exec" instead of "eval" for "catalina.sh run".
27e3e0dc8e Add an upgrade page to the documentation that can be used to determine the changes in any of the configuration files between two given versions.
120d273fbc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50949 Provide the ability to specify the AJP port and service name when installing Tomcat using the Windows installer. This permits multiple instances of the same Tomcat version to be installed side-by-side.
3ca20e0988 Disable the shutdown port when running as a service. One less port to conflict when installing multiple services.
9718c6bf4f Remove unused code
65011b7b02 Fix IllegalStateException for JavaScript files when switching from Writer to OutputStream.
ba6455af15 Correctly support 'S' and 'SSS' in SimpleDateFormat timestamps for the AccessLogValve.
f9fbbdd3b8 Remove dead code and correct comment about thread-safetyness.
c7d9ed81a4 Prep for fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=50949 Use a variable for the service name and ensure the uninstaller still works
00993551b5 Use a function to start the service so the service name can be changed during the install
fd98a47103 Remove inaccurate comment
67d011c424 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=40510 Provide an option to install shortcuts for the current user or all users. Also ensure registry is correctly cleaned on uninstall for 64-bit platforms.
09c559c5f1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=33262 Install monitor to auto-start for current user only rather than all users to be consistent with menu item creation.
234444d9c3 Add important missing word
b8ab5ffd89 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36362 Handle the case where tag file attributes (which can use any valid XML name) have a name which is not a Java identifier.
5cd2f9477c Improve JMX unit test.
b900ae2bc3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51425 Update Spanish translations. Based on a patch provided by Jesus Marin.
37986ad3c4 Follow-up to r1137925: Use buf.add(char) when there is a single character string.
8b2e4be301 Move the statics out of the "instance variable" section
8c278e8034 Remove unnecessary variable BASEDIR from scripts.
bf94c33077 Use system properties loaded from catalina.properties via the class path in unit tests.
91dad0ff29 Remove redundant copy of catalina.properties from o.a.c.startup. Generate this copy for inclusion in bin and src jars during the ant "compile" task.
dcbc00be10 Remove unused code
1d81bb0bbc Don't cache xml parsing config locally, get it from the Context
525561bde5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51395 Better fix for memory leak that aligns ContextConfig with TldConfig Fix part 3 of 3 for CVE-2011-2481
1f83d65bf0 Revert r1137753 - I have a better soution in mind Fix part 2 of 3 for CVE-2011-2481
f4766bd14b Amend description for the fix applied in r1132700. The problem there was less severe than it sounds: The port number was not treated as hex. The arithmetics to summ up the digits has already been using base 10.
df248dbd67 Connector refactoring SocketWrapper changes for AJP processor
c6ca5ad519 Followup to r1138573 Improve support for embedding Tomcat 7.
d8bbab5edf Connector refactoring SocketWrapper changes for HTTP processor
b335855650 Connector refactoring Rename socketWrapper to socket to align with BIO/APR
b5249f10de Remove the local socket object
f390e970e1 Connector refactoring Another small step towards SocketWrapper for NIO
3b22d9d7a5 Connector refactoring Another small step towards SocketWrapper for NIO
83bda16d94 Connector refactoring Another small step towards SocketWrapper for NIO
3c8570f085 Connector refactoring. Start moving the NIO connectors towards using SocketWrapper<NioChannel> rather than NioChannel to align them with BIO/APR and permit further refactoring. Do this in small steps since when I tried to do it in one hit, everything broke.
76e66974da Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51418 Provide more control over Context creation when embedding Tomcat. Based on a patch by Benson Margulies.
83858811d5 Fix copy/paste error that broke crl handling
a8c18a5763 No functional change. Refactoring so all attributes are handled the same way.
a079ec9a85 Further improvements to startup performance. Use File URLs where they can be determined for speed.
f082e5e2ca Fix Eclipse warnings in Valves
c1bbfb27fb Fix Eclipse warnings / remove unused code
13cd49b4c8 Another fp
c02981c0d0 Fix warnings in SSI package
4d46c80a39 Remove unused code
7a71737909 Revert to previous, no need for Charset here.
b8ba8af80a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51400 Avoid known bottleneck in JVM when converting between Strings and bytes by always providing a Charset rather than an encoding name. Based on a patch by Dave Engberg.
24162b622f Avoid NullPointerException in JULI FileHandler if formatter is misconfigured Fixes https://issues.apache.org/bugzilla/show_bug.cgi?id=51403
596a22099e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51401 Correctly initialise shared WebRuleSet instance used by the digesters that parse web.xml and prevent incorrect warnings about multiple occurrences of elements that are only allowed to appear once in web.xml and web-fragment.xml. Patch by kfujino
40f18bebd5 Add missing comma
72b37bc315 Align tomcat.util.scan.DefaultJarScanner.jarsToSkip value in TomcatBaseTest. Add junit and ant-launcher to the value in catalina.properties
25180b9dd7 Add @Override Use buf.add(char) when there is a single character string
c1c3033df6 Fix typos in committer ids
4e4cde3b96 Add comment on item ordering, update one entry, add one entry.
dfbeab8bdb Fix typo and more clarification about CATALINA_OPTS vs. JAVA_OPTS.
e438cc5c4a Add an info about setenv.sh before listing the customizable variables.
d0e7559b77 Clarify difference between CATALINA_OPTS and JAVA_OPTS in the scripts.
eeb1f3fc63 Define CATALINA_BASE fallback earlier, so one can use CATALINA_BASE and CATALINA_HOME variables in setenv without knowing, whether the two have been split (i.e. CATALINA_BASE is set) or not.
685126f5a5 Auto format
5febad12a5 Deprecated TagPool that may trigger memory leaks.
5a06199e75 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51396 Correctly handle jsp-file entries in web.xml when the JSP servlet has been configured via code when embedding Tomcat.
b060c28ddf Ordering
2a75323ca7 Fix odd looking code
f5dd8ebe7e Make sure we never use the DateFormatCache with millisecond patterns.
b126bc1e32 Let OneLineFormatter use DateFormatCache.
d9f1fa7b36 More Jars to skip: ant-junit and Java Help.
2e74353c95 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51395 Fix memory leak triggered when an application that includes a SAXParserFactory is the first web application to be loaded. Fix part 1 of 3 for CVE-2011-2481
9b2b5c0cc3 Remove unused code.
3af4c32a40 Address kkolinko's review comments
0707054d8c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=33453 Recompile JSPs if last modified time of the source or any of its dependencies changes either forwards or backwards. Note that this introduces an incompatible change to the code generated for JSPs. Tomcat will automatically re-compile any JSPs and tag files found in the work directory when upgrading from 7.0.16 or earlier to 7.0.17 or later. If you later downgrade from 7.0.17 or later to 7.0.16 or earlier, you must empty the work directory as part of the downgrade process.
74a25890ae The fix for bug 51310 caused a regression that re-introduced bug 49957 and deleted the contents of the work directory when Tomcat was shutdown. This fix ensures that that work directory for an application is not deleted when Tomcat is shutdown.
80d8fa829a Add note about script changes.
98e8c51c5c Packaged tag files have jndi URLs not file URLs
4479c0901d Remove unnecessary code.
71002eb316 Add configtest to Windows catalina.bat.
ce822db534 Slight improvement of configtest handling in Unix shell script:
e5aed19344 Make variable explanations for catalina.bat and tool-wrapper.bat consistent with their Unix counterparts.
a09f5c73a3 Make tool-wrapper.sh consistent with catalina.sh.
bb803f8b41 - Clarify JRE_HOME in catalina.sh - sort OS detection by OS name
57527b8761 Make JRE / JDK detection on Windows work the same way as on Unix: - if "debug" is demanded, only use JAVA_HOME   and check for a JDK there - without "debug", either use JRE_HOME   or JAVA_HOME with precedence on JRE_HOME
bc8949b973 Add missing Windows configtest script.
8e3046dfeb Make Windows shell scripts for individual commands consistent.
60f8d52918 Make Unix shell scripts for individual commands consistent.
d1ad89c2a8 Add the Tomcat extras JARs to the list of JARs to skip when scanning for TLDs and web fragments.
ccb8892c41 Method is identical to method in superclass so remove it
b509fe4837 Pull up prepareRequest()
217e18a05c Align with BIO (add debug log messages) Prepare for pulling up (add tests around adverts for comet support)
4ad88dce7f Add flags that indicate optional feature support
7eaa4de56e Reset sendfile data in recycle method so prepareRequest can be pulled up
ff46cdeadd Extend margin lese tests fail on Linux VM
e8cd3fe98b Add an additional error margin to avoid false test failures
11b0323b7b Add missing sync that triggered test failures on Linux VM post re-factoring
0292d9e11f Align with JIoEndpoint
69725a380c Pull up getBody message
3ade3644f5 Pull up common code
e95ddfeaa6 Pull up more common code in Processor constructors
b1a43edabe Pull up common endpoint code in Processor constructors
68f659928d No need to for addToPoller in APR HTTP.
6fb27bf399 Add new timestamp formatting info to AccessLogValve docs.
be1e00b3de BZ 49165 and more: - Allow any time stamp formats supported   by SimpleDateFormat in AccessLogValve. - Support logging begin and/or end of request.
15184f1e35 Start to pull up common code from constructors
9fa98a5579 Pull up definition of standard messages
a6078cbabc More refactoring since last release
6a9463d4f4 Use static final instead of volatile in AccessLogValve.
dbf68bce4d Don't use println to write output since os differences will result in different numbers of bytes output
1912eb5130 Connector re-factoring Align APR with BIO/NIO
c3be8b419c Connector re-factoring Start to align APR with BIO/NIO
9ea0d0a69f Gump is failing. Re-order tests to try and figure out why.
2bc2f7e9fc Speed up test
27b7d66e87 Connector re-factoring Broadly align NIO Handler.process with BIO Handler.process Remove event() method from NIO handler
1d428601f6 Connector re-factoring Remove the need to track isAsync in the SocketWrapper
630a885b71 SocketState.ASYNC_END should no longer reach BIO endpoint
2440dd0bcc Connector re-factoring Align Ajp impl with Http impl for BIO
082138111c Connector re-factoring First step towards removing SocketState.ASYNC_END from the endpoint Also a few percent faster, at least running the Async unit tests
32317fb47c Connector refactoring No functional change
02a42705ac Connector refactoring No functional change
a7ccb5ba9f Connector re-factoring No functional change
141a1a6163 Ignore Eclipse files
7f2697a02f Add a simple Comet test case
6bec7bf5a7 Remove empty dir
5143ea436f Remove empty dir
bde9e17b7d Aligning code between connectors Remove extra method from JIoEndpoint.Handler
aa7a3c0374 Add missing transition
1bcfbb80ce Tomorrow is the 17th
37fa74a6f6 Release tomorrow. Mirrors should have sync'd by then.
85f0d087ef Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51386 Correct code for processing @HandlesTypes annotations so only types of interest are reported to a ServletContainerInitializer.
e5743d2f6a Align SSI regexp handling with htttpd
2dccf6ad11 Add session="false" directive to the index page of the ROOT web application. There is no need to create a session when accessing this page.
6c7540a4cb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48956 Implement regular expression support for SSI
23f9d0d196 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43538 Add host name and IP address to the HTML Manager application. Patch by Dennis Lundberg.
ca46f56287 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51376 Complete fix. Ensure Servlet.destroy() is only called if Servlet.init() was called.
3f540b31e5 Pull up asyncDispatch()
bf7985c4cf Align code between connectors in preparation for pulling code up to the superclass No need to close the AJP connection if there was no error
6d365dcd01 Align code between connectors in preparation for pulling code up to the superclass When returning SocketState.CLOSED, recycle is always called
c229a822f9 Align code between connectors in preparation for pulling code up to the superclass
55dd91c786 Align code between connectors in preparation for pulling code up to the superclass No need to pass the socket into the asyncDispatch() call. It will always have been set beforehand.
3ef9a4cb72 Add to the logging.properties file a sample configuration setting for enabling debug messages in TldLocationsCache. Slightly improve the messages printed by TldLocationsCache.
c2e6701fab Add sunmscapi.jar to jarsToSkip I found it in version 6u25 of Oracle JDK and JRE on Windows 32-bit.
f0b4d109c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50677 Allow ANT style variables in the common.loader and other *.loader properties in conf/catalina.properties
f8ee86b7b5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51376 Dynamically added Servlet instances were ignoring setLoadOnStartup(), @ServletSecurity, etc.:  When adding a Servlet via ServletContext#addServlet(String, Servlet), the Servlet was not initialized when the web application started and a load on startup value  was set.
9577313c3e Fix typo reported by @earthgecko
b03525e06b Fix crash observed during pausing the connector when using APR.
894c20c7cf Fix copy&paste error in comment.
89a4e0ea6a Remove superfluous quotes from thread names for connection pools.
d8f79770b5 correct changelog.
b806d3c087 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51306. Avoid NPE when handleSESSION_EXPIRED is processed while handleSESSION_CREATED is being processed.
5d661467b9 Update the Maven repo info
bf3883badf Fix unit test for bindOnInit.
f66196ff0d Update ready for next release
ed50f3fa86 Add bug number for r1134048
c5fe824569 Document the state transition diagram
0b56e6c236 Fix Javadoc error
36f6e44d6e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51348 Prevent possible NPE when processing WebDAV locks.
4bef1ec504 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51344 Fix problem with Lifecycle re-factoring for deprecated embedded class that prevented events being triggered.
2b243df055 https://issues.apache.org/bugzilla/show_bug.cgi?id=51249 Reimplement system properties replacement code in ClassLoaderLogManager of JULI 1. Do not use recursion. 2. Do not stop on the first unrecognized property, but continue with the rest of the string. 3. Do not call System.getProperty() on an empty key, because it throws IllegalArgumentException. Threat "${}" as unrecognized property.
96363095ae Followup to r1133816 Remove properties that TortoiseSVN added to the new subdirectory. It propagates those from the parent directory.
e459d73606 Tests for ClassLoaderLogManager#replace()
cb81fb0faf typos
13167e9fed Refactoring triggered security exception when running TCKs
8adc5732bc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51340 Fix thread-safety issue when parsing multiple web.xml files in parallel. Apache Tomcat does not do this but products that embed it may.
e318b275f0 Avoid possible NPE
ff39b678c2 Followup to r1133134. I think better not dataSource but dataSourceName.
5b26b09c7c Fix regression in welcome file processing
75b00c5891 Simplify as per kkolinko's review
bbca3fd0b1 Update changelog post valve changes
40fda349e5 Correct a regression in the fix for bug 51278 that prevented any web application from being marked as distributable. (kfujino)
638a4ec7d5 Enable for async requests. Looking for stuck threads - no special async support required here. When the asycn timeout is infinite requests may get stuck but that'll need a different detection mechanism.
adf30f3560 Enable for async requests. Async requests should appear as serial requests when requiring multiple internal requests so concurrency should behave as expected.
e8dd67f02e Enable for async requests. Depending on how async is used, may see multiple replication requests for a single async request.
28d5393b98 Enable for async requests Don't persist the session if processing an async request. Note: There may be some async states where the session could be safely persisted.
424cf6f0f0 Simplify markup: remove <br/>s from the end of lines. They are not needed inside the <source> tag.
47cb2e0c44 Align log4j configuration example with log4j documentation: start property names with an uppercase character. It is just a question of style: it should work either way.
7873f4dead Enable for async requests Only look for a change on non-async requests. There will always be one of these before any async processing on a request so no need to check if the current request is in the middle of async processing
2356bdc738 Enable for async requests (invoke just passes the request through so no issues with async)
8abf84c20b Enable for async requests
9c2e9b58f3 Followup to r1133122 if(flag) set flag:=false
ad615d6a42 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51264 Improve fix to return connections to the pool when not in use. Patch provided by Felix Schumacher.
f8eb1cadd6 Don't use a single quote in the message
6a6722f1dc 7.0.15 was broken
e1860f390d Prep for 7.0.16 tag
977dc09482 Don't overwhelm logs with TLD scanning messages but make users aware there is room for improvement and tell them how to get at the detail.
d5e975ed4b Add a few more exclusions
ba85768d66 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51324 Improve handling of exceptions when flushing the response buffer to ensure that the doFlush flag does not get stuck in the enabled state. Patch provided by Jeremy Norris.
22ae669a76 Revert r1132367. There is no issue. I got confused between AprEndpoint.SendfileData and NioEndpoint.SendfileData
06eb278ae8 Correct doc error reported on users list
d35928efda Only need 1 HexUtils class
1de7f1de67 Revert r1132487 and use Konstantin's suggested fix.
9ce82cdf43 Set svn:eol-style=native Fixes bug 51323 reported by sebb
baea30127e Parse port as base10, not hex
e3d536ab03 Create a new RecycledProcessors inner class and use it in the Processor implementations rather than redefining the same thing 6 times.
8abe7c8774 Fix Javadoc.
2e870273e1 Create an AbstactConnectionHandler and pull up the common JMX code from the AJP and HTTP connectors
b8274a23e0 Pull up the request and response objects since they are common between AJP and HTTP
f44450b6db Rename for consistency
c307f2366b Align some of the code between the connection handlers.
70d068a1b4 Consistent visibility with BIO
215c04cab9 Remove duplicated code
451eb41f8a Correctly handle range requests when using sendfile and the APR/native HTTP connector.
3f8d512ee6 Reformat - no functional change. Just to aid comparison
6c9754f18f Pull up parseHost
33903972a0 Align ssl test in parseHost in BIO and NIO & APR
81970ccb06 Removed ssl attribute from NIO and APR to align with BIO
ffbd0ebe9e Fully align parseHost  - remove unnecessary code from BIO  - improve comment for all
b27f513d5a Start to align the parseHost method across the Http11 processors
25c260b15d Pull up common getExecutor code
ecdc95138d Create an AbstractProcessor. Start to pull common code from AJP and HTTP processors to this abstract class.
e79871145e Javadoc fixes
4cefa25189 Update for next release
1f8bf2d100 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51251 Add web application version support to the Ant tasks. Based on a patch provided by Eiji Takahashi.
cfbfed84cd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51264 Allow the JDBC persistent session store to use a JNDI datasource to define the database in which sessions are persisted. Patch provided by Felix Schumacher.
b12908685f Fix TCK failure exposed by the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51278 A previous change to ensure web.xml had precedence over fragments and annotations was not complete. It handled filter definitions and servlet definitions but not servlet mappings.
e8997a900b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51278 Changes required to original fix identified by TCK tests Need to merge defaults before JSP->Servlet conversion since defaults define JSP servlet.
8a4bdd203f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51309 Correct logic in catalina.sh stop when using a PID file to ensure the correct message is shown. Patch provided by Caio Cezar.
5f85b50e1e More detailed information when waiting for a connection has timed out
222d474ef0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51249 Correct system property replacement code so properties of the form ${...}${...} can be used without error.
e9035a15be Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51278 Allow ServletContainerInitializers to override settings in the global default web.xml and the host web.xml.
54256f0047 Correctly cast to the right PooledConnection
0dae45b147 Fix typo
2ffcde0e3f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51310 When stopping the Server object on shutdown call destroy() after calling stop().
509fd7d21d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51294 Clarify docs for unpackWAR attribute of StandardContext
7d35a5d85e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51276 Provide an abstraction for accessing content in JARs so the most efficient method can be selected depending on the type of URL used to identify the JAR. This improves startup time when JARs are located in $CATALINA_BASE/lib.
23131ad46b Added 'layout' configuration for log4j loggers.
66f2733d5b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51277 Improve error message if an application is deployed with an incomplete FORM authentication configuration.
5c0921fc99 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51274 Add missing i18n strings in PersistentManagerBase. Patch provided by Eiji Takahashi.
dbf50c47b0 Fix NPE triggered by r1127962
52b26f5a04 Adding code signing keys.
4896e20a51 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51240 Replace the more generic CounterLatch (that has concurrency issues) with a more specific LimitLatch that (mostly) only provides the functionality required by the connectors to implement maxConnections. It also adds support for dynamically modifying maxConnections.
27f26175c4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51226 Add a findleaks Ant task for the Manager app. Based on a patch by Eiji Takahashi
e93e94b632 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=27122 Remove a workaround for a very old and since fixed Mozilla bug and change the default value of the securePagesWithPragma attribute of the Authenticator Valves to false to reduce the likelihood of issues when downloading files with IE.
e53ea5e4d5 Remove 6.1.x wish list If there is any interest in these, they can be added as enhancement requests in Bugzilla
4de34f547d Remove out of date status file. Remainign todos are in bugzilla
2d0c344315 https://issues.apache.org/bugzilla/show_bug.cgi?id=51185
64bfc4a520 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=35054 Check that a file is not specified for a Host's appBase and log an error if it is.
5db42d5a50 Minor clean-up
4ed91cbcdc More prep for BZ 33453. Include a comment header in generated Java files
c3813a42b2 Refactoring in preparation for a fix for BZ 33453
c80f8cf4d0 Fix copy/paste error
213b73efd3 Remove unused isErrPage attribute
bb6e91abdf Remove unused attribute
c7fa075300 Remove unused code. Made unnecessary by r618481
2965caa009 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51220 Add a system property to enable tag pooling with JSPs that use a custom base class. Based on a patch by Dan Mikusa.
41b796383b Ordering
26e2b18b0b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51182 Better organisation of listeners doc Add JAAS/JMX listener info Patch provided by Neil Laurance
d1945dbe4f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51221 Correct Spanish translation of text used in a 302 response. Patch provided by Paco Soberón.
4750180a62 grr
a5763b31c6 MOve to correct version
c3d39b97ac Fix broken documentation links for non-English locales in the HTML Manager application. Patch provided by Eiji Takahashi.
b6e7a10cb4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51229 Fix bugs in the Servlet 3.0 asynchronous examples. Patch provided by Eiji Takahashi.
d7ce0125ff Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51230 Add missing attributes to JMX for ReplicationValve and JvmRouteBinderValve. Patch provided by Eiji Takahashi.
7837a5982a make fields volatile https://issues.apache.org/bugzilla/show_bug.cgi?id=51212
e63cd0c315 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51197 Fix possible dropped connection when sendError or sendRedirst are used during async processing.
f15ac67168 If an error status is set during async processing, don't drop the connection and let the async processing handle it
1c2b14689d Add @deprecation comments
9f0cfa637d Add missing @since comment.
30220edd5f Add remaining attributes to documentation AJP-NIO now passes Servlet TCK - remove experimental label
72c30c7d1e Better align AJP connector code Fix some copy/paste errors
12c8c11725 webapps is relative to base not home
eb89f74820 https://issues.apache.org/bugzilla/show_bug.cgi?id=51208
010419827d Add Filip's additional patch to correctly handle infinite read timeouts
a4f3ebe2dc Fix Security Exceptions when running Servlet TCK with experimental nio-apr connector
48c483667c Tweak processor blocking so that it is non-blocking while no message is being processed and blocking during the processing of a message Align ajp nio protocol implementation with http nio Still some TCK failures to resolve
f8da0ab2b4 SHARED_SELECTOR is used with double checked locking so it needs to be volatile
df3d4f1fb3 Remove unused code
ddc6068275 Prevent infinite loop when readTimeout = 0
6582e3825e Improve handling for reading request bodies. More testing still required.
72fc8b5526 Minor clarification in http connector comparison table.
2a122258ad Minor enhancement and fix for NIO AJP documentation.
9e1ba76b65 Add docs for experimental AJP-NIO connector.
8a2095b024 Add new AJP-NIo connector to the changelog. It is working well enough to be classed as experimental. I'll remove that label once all the TCK tests pass.
e1a8302b9b Get Servlet 3.0 async requests working with new AJP-NIo connector
1e98834d19 Make AJP-NIO actually use non-blocking reads. Only the first read of a request is is non-blocking. Any additional reads will block. The first read of the first request on a new connection will also block.
ffb2d25238 Fix trivial docs tpyos.
9f5f58c2b7 Don't recycle the buffers at start of process() - this will break non-blocking reads (when implemented)
593462d4c5 Additional tests for coercing of strings in EL arithmetic for https://issues.apache.org/bugzilla/show_bug.cgi?id=47371 All of them pass successfully.
93fba943d6 Initial AJP-NIO implementation. Docs to follow once more testing has been completed.
7917feef1c Refactor keepAliveTimeout to abstract AJP processor
ef9a92d9bc Avoid NPE is lastWrite is not being used
0ca08640d2 Add release date
6eac21a913 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46451 Configure svn:bugtraq properties for Tomcat trunk Based on a patch provided by Marc Guillemot
96c5b40981 Prep for next release
b119114a76 Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=51177 ListElResolver should also return Object.class for getType()
feaf338c47 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51177 MapElResolver should always return Object.class for getType()
275143c188 Make adding the trailing slash to the session cookie path configurable
4207306b17 Review from kkolinko
bfde3a0238 Fix typo
7cb8f7594c Ensure session cookie paths end in / so that session cookies created for a context with a path of /foo do not get returned with requests mapped to a context with a path of /foobar
2ab996bd0b Port RemoteIpValve changes to RemoteIpFilter
b8e4510e24 Allow the localPort to be overridden for a request
ea5be2a401 Add additional configuration options to the RemoteIpValve to control ports. These are required by my TCK test environment since I have multiple connectors (with different ports) configured all using the one Valve. If this has the desired effect, I'll port the changes to the RemoteIpFilter.
0800ac55e7 Followup to r1095686: add missing colon in the message text
daf4f390de Followup to r1100829 It's better to have constants at the left side of ".equals" call.
ad1524e6fd Use the correct classloader This is the fix for CVE-2011-1582
bcd851d275 The 7.0.13 release was cancelled.
e6b1fd7993 Improve robustness. Custom components may use their own strings for event type.
0e9c622a40 Fix Servlet TCK failures with using the RemoteIpValve
7911aebe2c Fix TCK failure with mod_proxy_http and HTTP-BIO connector as SSL key size is not readable
897cc5d76e Stylistic improvements to MIME type sync script. Based on a patch provided by Felix Schumacher.
3c98f19549 Add .pl (Perl script) to text file suffixes. Needed for correct line end handling when packaging.
e7cbb410a9 Update for next release
e6c56152e0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51156 Expose session expiration option for apps defined in server.xml
d86139d6c5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51155 Add missing comments to @deprecated code Patch provided by sebb
1ff92e7d85 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51154 Remove duplicate @deprecated tags Patch provided by sebb
9c74f02b45 Update changelog
63cb74785f Use maxThreads value as the default for maxConnections with the BIO connector.
83068835aa Merge maxConnections and pollerSize for the APR connectors.
7d5cee6b7c Simplify the keep-alive tracking and fix a couple of issues with the keep-alive disable code
36cec7f4a3 Add disableKeepAlivePercentage attribute to the HTTP-BIO connector
d95d505e7f Ensure keepAliveLeft count is maintained with pipelined requests
7b5c8dbf9a Revert r830965 and restore the automatic disabling of HTTP keep-alive once 75% of the threads are in use.
3d41551cf6 Fix typo
b6eb99545b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47371 Correctly coerce the empty string to zero when used as an operand in EL arithmetic. Patch provided by gbt.
a58a34ad26 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50950 Correct possible NotSerializableException for an authenticated session when running with a security manager.
be79773366 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51099 Get loginConfigName working with non-default values Patch by fhanik (plus some minor code clean-up)
8dbcf85fb9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51119 Add JAAS authentication support to the JmxRemoteLifecycleListener Patch provided by Neil Laurance
4e76529888 Re-factor to try and determine if the root cause of https://issues.apache.org/bugzilla/show_bug.cgi?id=51124 is an OOME or something else.
984ae236ea Improve handling of too large packets in AJP connectors - Explicitly check the packet size rather than waiting to see if it fails - Provide a better debug message when it does fail - Once we know we have a bad request, don't try to process it
76620cab3b Make access logging more robust for 400 responses.
c83f6b8d17 Note that there is a minimum value for packetSize
d856264415 Blet and braces - make sure $1 is ""
a5c6c81a30 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51135 Fix auto-detection of JAVA_HOME for 64-bit Windows platforms that only have a 32-bit JVM installed.
dae191f983 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51136 Provide methods that enable the name of a Context on Context creation when using Tomcat in an embedded scenario. Based on a patch provided by David Calavera.
90be14d189 Update changelog.
b7bc7a4e88 Add a script to check web.xml and httpd mime.types for differences.
dfae419343 MIME types update (consistency with mime.types from httpd) - Part 6     Add mapping existing in httpd but not in Tomcat.
dd0b696b6c MIME types update (consistency with mime.types from httpd) - Part 5     Sort alphabetically.
d911cf1a2a MIME types update (consistency with mime.types from httpd) - Part 4     Existing mapping with inconsistencies between Tomcat and httpd     where the definitions for httpd seem better.
0d0b5de48b MIME types update (consistency with mime.types from httpd) - Part 3     Fix suffix for compiled WML Script (wmlscriptc -> wmlsc).
7ca02a3313 MIME types update (consistency with mime.types from httpd) - Part 2     Remove duplicate definition for hqx.
4ac1776469 MIME types update (consistency with mime.types from httpd) - Part 1     Move comment, so that file is easier to parse automatically.
5d2be7406c Fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=48817
4379c13c09 Line length.
2bde696c0c Expose a container event for changing the session ID
d6a5910d0e https://issues.apache.org/bugzilla/show_bug.cgi?id=48817 Add in setValidator to support dependency injection frameworks like Spring etc
a5dee1d475 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51095 Don't trigger a NullPointerException when the SSL handshake fails with the HTTP-APR connector. Patch provided by Mike Glazer.
44bee11a5f Misc code clean-up  - Eclipse warnings  - Remove unused code
216d304867 Ensure response is committed when AsyncContext#complete() is called.
22c75c8f07 Correct typo in an example in context.html Reported by Michael Jay on the users list
b44a419246 Fix TODO - take account of time waiting for a thread when calculating timeouts.
05aaac06ed Update summary for maxConnections
8b3709ff1f Move the maxConnections description to the correct part of the HTTP doc. Add it to the AJP doc.
8bf3ab6592 i18n for r1090763
874e5475e7 Fix some Findbugs warnings
cc31f26d71 bindOnInit is supported for AJP too.
be3ec1818e Fix typo
5b10dcf163 Fix some unused code warnings
5cca0bb095 Fix infinite loop in r1095367
a0aa90264d Switch JAR scanning to use JarInputStream rather JarFile for significant startup performance improvements
9fe256807e Move the unit test JARs to the end. Add a couple of JARs when running via the command line rather than Eclipse
29c38d2b3d Set jarsToSkip when running unit tests a) for speed and b) to reduce noise in the logs
bd3a7292ef Add some more JARs to skip (spotted via logging in unit tests)
1d60ad0e80 Update commons pool to 1.5.6
b65ca03407 Parameterise commons-pool version
0948002ec6 Make use of commons-dbcp.version
5c50490536 Minor optimisation reported by FindBugs
f3e26fe18e Use a single TLD location cache for a web application rather than one per JSP compilation to speed up JSP compilation.
b63293bee8 Add some common JARs to the list of JARs to skip
fe955a4e69 Log JARs scanned for TLDs where no TLD is found.
caa25b5cff Add missing @Override
1e7c4337b3 Align connector implementations with documented default for processorCache
84707187af Add missing whitespace
07be10902e Correct a regression in the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49916 that resulted in JSPs being compiled twice rather than just once.
65a2194189 Add note that antiJARLocking and antiResourceLocking should not be used together. Line length
01468edcbb Stop trying to check for >0ms processing time in access log. There are other tests that check for correct operation so no need for this.
81b4f047c5 Fix various timing issues with the access log aspects of the test. This fixes: - numerous failures on my desktop - Gump (hopefully) Given the wide range of responses on different machines, more changes may be required.
211c067944 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50173 Throw an exception and do not start the APR connector if it is configured for SSL and an invalid value is provided for SSLProtocol.
d89195516f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50158 Ensure the asynchronous requests never timeout if the timeout is set to zero or less. Based on a patch provided by Chris.
30551fcd62 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51050 Add additional common but non-standard file extension to MIME type mappings for MPEG 4 files. Based on a patch by Cédrik Lime.
8302f73bd9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51042 Don't trigger session creation listeners when changing the session ID during authentication.
25c1d98170 Additional test case to check access log and return code when error servlet does not flush the response.
a72fa0f65e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=51038 Ensure async requests are included in access logs.
3614f342fc Better comment
08e3ae39e5 Fix comment typo
5999ade5a2 Needs re-thinking
906406db2f No longer used
48b90f8ba1 Revert fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36362 JSP.8.3 does not limit the name of attributes defined in tag files
979510be9d Check tag file attribute names are valid Java identifiers
823d427c37 Improve error reporting by labeling line/column numbers
9b688d327e Consistent format.
401f170bbe bug 50306: Detect stuck threads complement to changelog
9218482839 changelog for r1090003 / StuckThreadDetectionValve
6833c9e9e7 Do not depend on system encoding settings when running Tomcat tests.
d71400972d Added warning messages when an exception is thrown while trying to delete files. Replaced duplicate code in removeGeneratedFiles with a call to removeGeneratedClassFiles.
c8025cf7de https://issues.apache.org/bugzilla/show_bug.cgi?id=50306 StuckThreadDetectionValve, based on code proposed by TomLu
a2da8fa60d Fix broken stylesheet URL in XML based manager status output.
bdb1a23951 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 Fix regression in processing of pipe-lined requests.
f72ffd39da Need option to use content length for correct processing of pipelined requests.
b3e036d9a9 Refactor to (hopefully) allow unit testing of pipelining support
f107794b9e Fix "bad character" complaints by modern XSLT processors https://issues.apache.org/bugzilla/show_bug.cgi?id=51028
773b1990a6 Will announce release later today
30c50c4310 Clarifying that pollTime parameter is in microseconds, and correcting the ms equivalent for HTTP connector use of it.
c6f9a10873 incorporate feedback based on http://markmail.org/message/gz7lm5dpdpdgcdzq
2840bf2e3d Try a workaround against TC7 tests running too slow on Gump: a workaround against Oracle JVM bug 6202721
023ff01d7e Implement display of multiple request headers in AccessLogValve: print not just the value of the first header, but of the all of them, separated by commas.
a057586e32 Fix display of response headers in AccessLogValve: 1. When no headers are there, display "-" instead of empty string 2. Do not forget "," between multiple values TC6 already does that but it was broken here in r767956
c6cb1a7d08 Change resource key name for a debug message in CombinedRealm
d1eb7be072 Followup to r1087392: correct text of a debug message
d1d93b68ef Followup to r1087416: Correct typos in messages and remove one e.printStackTrace() call.
eaa6bc55b5 Correct a typo and some formatting as a followup to r1087524
481de08647 Update download links in the appdev tutorial. Replaced direct links to the "download" pages with ones to the main pages of Tomcat and Ant. Download links should be easy to find from there.
2a7098b9e6 Clarify error messages in *.sh files to mention that if a script is not found it might be that it does exist but does not have the execute permission. http://markmail.org/message/k2ynjwbqjcver6ka
5a940c5950 Update a comment, for clarity
b109895b94 Configure Security Manager How-To to include a copy of the actual conf/catalina.policy file when the documentation is built, rather than maintaining a copy of its content.
a7d00a8bf1 Improve the logging documentation
a662842dbf Correct a Javadoc mix-up
92cb93186e Bump version ready for next release
4b8e1db21c Update the realm-howto: In TC7 the tomcat-util.jar is also needed on the classpath to call the o.a.c.realm.RealmBase class.
8e1df63b81 Correct typos in description of NIO connector in config/http.html, especially in TC6. An attribute is called "processorCache", not "processCache".
75c2a979cf Workaround shutdown issue in unit tests
5aef561814 Add additional configuration options to the DIGEST authenticator This is the fix for CVE-2011-1184
9782c9bc01 Better name
95f97cb982 Consistent naming
96cc730882 Removed unused code
f3068c0688 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=12428 Add optional support for preemptive authentication on a per context basis Based on a patch suggested by Werner Donn This includes the fix for CVE-2011-1183
b3df49ac58 Another context.xml tracking issue. This time if using just dir deployment. A changes in context.xml now triggers a redeploy rather than a reload (so the context.xml is re-read)
be20465ba6 Add credit
6eafaae410 SPNEGP part 3 - the final part for 7.0.12 Integrate with JNDI realm so delegated credentials are used by default.
0aa88dd409 Implement exception traps as suggested by Eiji Takahashi http://markmail.org/message/c7hrhky4jtgcto76
9dcdd6d85a Fix NPE that can happen during concurrency (connection being abandoned, misconfiguration in abandon timeout or lack of ResetAbandonedTimer interceptor) http://markmail.org/message/yhshyvyunddb5ngt
8c496cdc5e SPNEGO support part 2 Expose the users delegated credentials through a request attribute so applications can make use of it
375bf138b0 Switch SPNEGO authenticator to use file based JAAS config as this provides greater flexibility including making it easier to work with non-Oracle JVMs. Clean up the code, add debug logging and improve error handling.
f1c233baa8 Only register a DataSource with JMX if it is a singleton
c7146f7c60 Feedback on https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 No point trying to close a non-singleton resource
898f69ab52 Feedback on https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 Change the default
1f0a6d8536 Follow up to http://svn.apache.org/viewvc?rev=1086969&view=rev Ensure that when copyXML=false: - removing context.xml triggers a redploy but does not remove any other files - removing context.xml triggers a redploy and the context.xml is re-copied from the WAR
ff360fc2f2 Improve the logging documentation
bd4aec2876 remove repo inherited from parent
8b0735d0d2 Don't append the jvmRoute to a session ID if the jvmRoute is a zero length string.
5dbdc88a82 Add in parent reference Thanks to Sebb http://markmail.org/message/nb652iryypigjfso
a1bddb3c73 add in plugin to package
ad67d23869 delete eclipse files, these can be generated
ef09aa67fd Add in ability to build with Maven
9c10a86271 Requests after the connector has been stopped may time out or return 503s - varies by connector. Make sure the test passes with either.
ff9c08ce9c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50997 Relax the requirement that directories must have a name ending in .jar to be treated as an expanded JAR file by the default JarScanner. Based on patch by Rodion Zhitomirsky.
1e528309c7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50984 When using the Manager application ensure that undeployment is reported as failed if a file cannot be deleted.
6717e0c162 Fix reversed condition in r1086918
781d0dd048 Fix Eclipse/FindBugs warnings apart from those that trigger bug 50984
c4bbe1912f Followup to r1086950: Simplify code
bc774ad87e Correct a typo
be2751e005 Correctly track changes to context.xml files and trigger redeployment when copyXML is set to false
dbdc0cbea8 Implment Filip's idea for a configurable close method
5f0f8b09dd Correct fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 Stop resource after app has finished with them but before they are unbound
49642bc4a4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50991 Stop the resources after they have been unbound rather than before
53d44c1164 Protect the DefaultServlet against Filters etc writing to the response which will a) break partial get support and b) mean setting on content length will result in a truncated response. This also fixers some TCK failures since the TCK sometimes writes to the response with a filter.
495f719e1a Correct fix for http://issues.apache.org/bugzilla/show_bug.cgi?id=50928 Default for keyPass is keystorePass
e32caaac9d HTTP range requests cannot be reliably served when a Writer is in use so prevent the DefaultServlet from attempting to do so. This is kkolinko's patch that stemmed from a private discussion about a TCK test.
8ce6cfafc9 Update changelog for SPNEGO. Add note to docs about major todo areas.
56b9df6059 Fix some TODOs
a0ef3e1083 Part 2 of SPNEGO/Windows authentication support. Authorisation support. Works essentially the same way as CLIENT-CERT, i.e. the Realm doesn't actually authenticate the user but it does create the Principal and add the roles.
8fcf2699ba Part 1 of SPNEGO/Windows authentication support. This adds authentication support but not authorisation. Some Realm refactoring is required to get authorisation working. SPNEGO is tricky to configure correctly. Some things I know will break it, some I suspect might. There is a long list of questions in the Javadoc that need to be tested. This authenticator started off as a patch by Michael Osipov.
a984b179c5 Add domain configuration that is known to work
6163f534ea Protect against things going wrong during access logging. An un-handled exception here could trigger some unexpected code paths. Possible contributing factor to https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 ? This is part of the fix for CVE-2011-1475
9a5edb7115 Move the processor.recycle calls to just before the point where the processor is returned to the pool. This ensures returned processors are recycled (this could have been skipped on some exception paths) Possible contributing factor to https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 ? This is part of the fix for CVE-2011-1475
f8ce4d298f Always recycle unless it is an async request. Possible contributing factor to https://issues.apache.org/bugzilla/show_bug.cgi?id=50957 ?
595551dd8d Remove unused code
78785945a2 Remove constant only used by tests
f7b0994663 Update based on feedback Fix typos
ed4880cca4 Followup to r1085764 Add the pages to the index page as well.
86d571c3a2 Update the docs regarding the shutdown port number. It is a followup to r938430. As Steven Schlansker noted on the users list, disabling the port affects un*x systems, as kill -9 is not a clean shutdown.
08e904b82d Add some Windows authentication notes to the docs
8bb6ad929d Don't register Contexts that fail to start with the Mapper.
610a18497c Add another non-Java J2SE package. This is required for SPNEGO support.
3b53849bd3 Securely seed the SecureRandom instance used for UUID generation and report excessive creation time (greater than 100ms) at INFO level.
7d5ce805c5 No need to specify a default
57838232bf No need to specify a default
9454d3efff Include the seed time when calculating the time taken to create SecureRandom instances for session ID generation, report excessive times (greater than 100ms) at INFO level and provide a value for the message key so a meaningful message appears in the logs.
94f548bf97 Remove call to System.exit() reported by Veracode and related code clean-up
59d2f6cb27 Fix string comparison - reported by Veracode
872c709ba6 Re-flow. Add a note about failed requests
25633684d1 Add recent changes
e2fc77e33a Fix the main interfaces now Tomcat 7 is  stable.
5cfe6dad31 Remove unused code
890a5bc0de Resolve some TODOs for "swallowAbortedUploads"
c636a5b0bd Updates based on recent user list questions
0c02328c8e Rename, no functional change
c6d6c2d153 Rename, no functional change
1ea8afd38e Rename, no functional change
224a4493fd Remove unnecessary casts
88efd1bc85 Tweak wording, try to make clearer
489fc21c15 Remove unused code
384bab02b6 Add another false positive
956a734cd3 Fix an Eclipse warning
7e9b356ec2 Use standard approach for pre-loading classes
8c198fb068 Prevent the custom error pages for the Manager and Host Manager applications from being accessed directly.
e33ea033c1 Remove unnecessary code that makes switching to other authentication methods difficult.
722a353108 Make the CSRF nonce cache serializable to fix an issue reported on the users list. Custom serialization code could shave ~20% but the code isn't as clean.
af0eb49e0e Add a recent change
92db9f7eee Further additions to mbeans and docs for authentication valves
75d9affd42 Remove unused code
b9b338deb9 Sync with implementation
6eb14f89e3 Improve the logging documentation
e5807e1a02 Improve the logging documentation
629f26e7e1 Remove random "
1626314aed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50927 Better error message if SSLCertificateFile not set
2e694f18a0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50929 When wrapping an exception, set the root cause
367f90c8f4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50925 Update docs for keyPass attribute
8b1c28b9da Chain exception
baa1bc672d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50928 Don't ignore keyPass attribute
6bb333041f Handle the scenario where the client sends multiple JSESSIONID cookies. This patch trades a little duplication for simpler code. The duplication only occurs when the client sends multiple cookies and the request is to a context that currently has multiple versions.
4d1253566f Correct a typo in changelog for 7.0.9
c6661b4a63 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50903 If a connector is stopped, not not process any keep-alive connections. The exact behaviours are: - HTTP BIO - blocks until request line is read and then returns 503 - HTTP NIO - uses polling, so returns 503 immediately connector is stopped - HTTP APR - blocks until request line is read and then returns 503 - AJP BIO - blocks until request packet is received and then returns 503 - subsequent requests will timeout - AJP APR - no change - subsequent requests will timeout
03b8fa2ffb Followup to markt's r1081239: update the doc for CrawlerSessionManagerValve
4204f7f1fb Include clean-up under a single entry
9a9b550ab8 More FindBugs warnings
c9dad42ea4 Fix FindBugs nag
c4346964be Fix a couple of FindBBugs warnings
9545336632 Remove unused code Fix some Eclipse warnings
0cb9859407 Better comment
9f1cdd7caa Add recent change
761942bd09 The name for the default host does not have to be resolvable in DNS.
5fa37bc84d Fix typo
bf7aa3717c Fix typos, remove whitespace
04f797fa3f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50924 Clean-up HTTP comparison table
b3add07720 Remove whitespace
7437d06210 Couple of updates
2e7787798b Update to the current ASF bot pattern
57ec2620f0 Some bots (Google) send an invalid session ID
87b9679211 Fix typo
ef005a1fdd Don't log to standard out
a1c20ca23a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50887 Add support for configuring the JSSE provider used to convert client certificates. Based on a patch by pknopp.
4015a8bf79 Fix typo
a922b9ffb3 Align code and comments - no functional change
7a465fe3af Align code and comments - no functional change
9d4326c4d1 Prep for next release
0b870725ab Don't unpack WAR files if they are not located in the Host's appBase.
b2f6693b65 Better handling for invalid context paths in server.xml
9a9b4d1715 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50911 Reduce noise generated during the build of the Windows installer so warnings are more obvious. Patch provided by sebb
a6af1d3b42 Library updates
4f0afd1501 Will be released later today
082db9d441 Followup to r1079781 s/&/&amp;/ in HTML files
fe487dbc34 A pair of typos
fc79d0edd4 svn:eol-style, as noted by sebb
83afbf01fc Ready for next release
f3f8a1cbba status is always null, so simplify
a135da467e Correct a typo
f15bdc4555 correct message key
10aa11d48e Fix Async with APR and TCP_DEFER_ACCEPT
deb05a007f Fix typo
774a1bb165 Fix exception destroying a stopped connector.
1c06b846a8 Try and make test pass more reliably. This works an 8-core Windows box and a 1-core Linux VM
4a02428c2d Speed up unit tests on Linux
d15b2b973a Session attributes were only partially changed from Hashtable to ConcurrentHashMap.
f0d24b82ba Fix some unit test failures
d4b0dc8dfc Better overriding support
c733849ce7 Fix TCK test failure under a security Manager
4f1920a5f2 Fix some test failures. Don't use load() since that creates a whole bunch of edge cases that need to be handled.
bb0573ef56 Add forgotten attribute "sessionCookieName" to context config docs.
233cb10419 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50895 Don't initialize classes during compilation
9a426f12f8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50893 Additional information for extras package
0a5a19f0c3 CVE-2011-1088 Fix unit test failures
414af3e3a8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50854 Add additional permissions required by the Manager application when running under a security Manager and support a shared Manager installation when $CATALINA_HOME != CATALINA_BASE.
13fe121edb CVE-2011-1088 Complete the fix for this issue. The optimisation not to configure an authenticator of there were no security constraints meant that in that case @ServletSecurity annotations had no effect. The unit tests did not pick this up since they added an authenticator directly. Add an explicit unit test for this scenario.
74e9a9e3cf This was only a partial fix.
bed58adb06 Docs: Move "allowCasualMultipartParsing", "swallowAbortedUploads" and "swallowOutput" from StandardContext to Context.
fd84cecba2 Fix alphabetic order.
a18eb62fd8 Consistent Ordering. No functional change.
65b48b75cd Rename new method.
60c098b003 Reduce visibility of field with public getter and setter.
605ff438fc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=25060 When stopping naming resources look for DataSource resources with a zero-arg close() method and call it if one is found Works with Commons DBCP.
0397fa21d7 r1079367 was a little too enthusiastic. The "if (!initialized)" tests weren't required by the init() call are
45baae662a New context attribute "swallowAbortedUploads" allows to make request data swallowing configurable for requests that are too large.
19ff53fce7 Expose the global naming context for all Server implementations
c82fa14e81 Add release dates
a64cffcdab Add the CVE info for 7.0.10
cacb489b7a Align SSL init for BIO and NIO. Fixes https://issues.apache.org/bugzilla/show_bug.cgi?id=48208 for NIO. Adds support for keyPass, truststoreProvider & keystoreProvider
01aafa5093 Remove some unused code
c28adcfc5d Add the hooks (no implementation yet) for BIO and NIO to share the code that is currently in JSSESocketFactory
a0aa55a9ce Fix build failure and don't tie NIO connector to a single SSL implementation
56564af693 Better Javadoc
bddc2f5a62 Remove JSSEFactory. Now we no longer need to support older JSSE versions, this layer of abstraction is not required.
f005cd7a77 Don't swallow exceptions when they are not expected
9c3e62b16f Add missing message
b879924f30 Refactor to address https://issues.apache.org/bugzilla/show_bug.cgi?id=48208#c13 Don't configure a TrustManagerFactory instance if it isn't going to be used.
ae34ae4a9c Restore the ability to register the Tomcat jndi URL handler via the java.protocol.handler.pkgs system property.
bca2443ba6 Remove unused code
994764404c Fix some warnings
247c186ca5 Fix Eclipse and FindBugs warnings Removed unused code
dbfa335774 Code cleanup - remove unused code - fix FindBugs warnings - fix Eclipse warnings
887249d633 Fix Eclipse warnings
204d73511d Another FindBugs false positive
2b4d6fd471 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=26701 Provide a mechanism for users to register their own URLStreamHandlerFactory objects.
1507cbe811 Clean-up, mainly unused code
9c2ca3916d Remove unused code
9081f18199 Make more efficient / fix FindBugs nag
e06ab6724e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48208 Add custom trust manager support
3a437b54fd Refactoring for re-use
d73d6ad7a2 Update comments/test case name
885b3d9521 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50855 Fix NPE on HttpServletRequest.logout() when debug logging is enabled.
33cec0ad10 Fix threading issue reported on dev list
65065f7613 Prep for next release
3955e2b24e Add missing entry.
5a8c648313 Code clean-up  - fix FindBugs warnings  - remove unused code
fda297e5cd Now there is always an authenticator, need to allow for the extra MBean
e36ee3af36 Code clean-up  - fix FindBugs warnings  - remove unused code
abbf8f71e2 Avoid npe
0f95cb7401 CVE-2011-1088 @ServletSecurity Servlets added via addServlet() should not be processed unless created via craeteServlet. Need to delay scanning until urlPatterns are known
31d9e1aae7 Check metadata-complete=true leads to @ServletSecurity being ignored
325c069478 Check web.xml takes precedence over @ServletSecurity
af2d711db9 Add missing files and license header Add NOTICE/LICENSE to all JAR files
140f8a353a Test that individual roles are correctly handled
556a3d2c5e @ServletSecurity Refactor to reduce duplication in test code Add tests for method constraints
f08f575fa3 @ServletSecurity support Add tests for subclasses
63fd724e12 CVE-2011-1088 Fix typo
dbac5e2475 CVE-2011-1088 Start of fix for issue reported on users list that @ServletSecurity annotations were ignored. This fix is not yet complete. This first part: - Triggers the loading of the Wrapper before the constraints are processed to ensure that any @ServletSecurity annotations are taken account of - Makes sure the constraints collection is thread-safe given new usage - Adds scanning for @ServletSecurity when a Servlet is loaded - Ensure there is always an authenticator when using the embedded Tomcat class so that @ServletSecurity will have an effect - Adds a simple unit test to check @ServletSecurity annotations are processed Further commits will add additional test cases and any changes required for those test cases to pass
a3847ed7e1 Doco update
8de43a9d1e https://issues.apache.org/bugzilla/show_bug.cgi?id=50857 Timeouts have to be trapped, and properly handled
6ee0142a3a Speed up shut down when ThreadLocalLeakPreventionListener is enabled
3c7dc1d465 Remove unused code
4956b939ee Fix Javadoc
bdbd464269 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=27988 Improve reporting of missing files
276bec2598 Update change log
0362d09fc9 Better test for APR
4c448a5cb4 Correct issues in the SSL renegotiation tests
fdc7216bff Save a few cycles
c2fdf00616 Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48863 1) Be more strict when ignoring the warning: ignore only when it is the "lib" directory and when it does not exist 2) Warn about JARs created from expanding the GLOB pattern as well 3) s/new File(f.getCanonicalPath())/f.getCanonicalFile()/ for efficiency
fdb7b7fac9 Correct several typos
9434c22c8a Make sure we also validate the content that is sent and received
7b199164ff Implement renegotiation for SSL cert authentication
b62b768b2c Correctly determine if a buffer has data or not
47c5c66f89 propagate all exceptions through IOExceptions
60455b65bc Simple implementation of a forced and blocking renegotiation with a SSL client
05ff4a99b9 Move outside of loop as per kkolinko's review
1725155fb2 Missed a keystore in the refactoring
87a22d6960 Fix bug in unit test due to some Lifecycle refactoring
7a55dad30d Improve handling of SSL renegotiation by failing earlier when the request body contains more bytes than maxSavePostSize.
b28f61f4a8 Remove the init from references to handshake since the same fields/methods will be used for renegotiation
e9f1109bc4 Extract the client-cert tests into a separate test Check maxPostSize works as expected with client-cert
716aa73f25 Clear remainder of current FindBugs issues in unit tests
35aca22ac9 More entries
46ade57731 Remove unused code
64da1f20da Fix Findbugs nag Reduce visibility
8ac51bbdf5 Grr. This worked if 20 bytes were read in one go
e0dfca6ae4 Better fix, we actually need to read 20 byres for the test to pass
c996679ccc Fix FindBugs warning
4d0f0ea27b More explicit failure message - fixed FindBugs nags
67d8ab7931 FindBugs fixes - make constants static
5f50b593d8 Comment tweaks
9cf29f275a Revert SSL renegotiation for NIO - implementation is broken Reverts r1074675 and r1075030
f28b422a0e Start of an SSL re-negotiation test. Need to expand it to handle request bodies and the other issues highlighted by Filip. Switch to using a CA since it makes the code cleaner and it is easier to get CLIENT-CERT working than will all self-signed certs.
b24bf9b13a Should have moved the keys when I moved the SSL tests
b0a93cd76e Fix an Eclipse nag
9306ab15b8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=28852 Add URL encoding where missing to parameters in URLs presented by Ant tasks to the Manager application. Based on a patch by Stephane Bailliez.
4dc7a47f89 Clarify auth process for CLIENT-CERT
726384ab8f Prep for next release
7933ac2907 Improve fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48863 - consistently pass absolute paths to validateFile() - handle non-absolute catalina home/base
a692a8581c Fix Eclipse warnings Remove unused code
eacfde4b5a Clear remaining FindBugs issues from javax.*
928069d9ea Misc clean-up - remove unused code - suppress FindBugs false positives - add javadoc
f42b2b149c Another false positive
4b97f9dbaf Couple more false positives
6fc63576d0 Misc clean-up  - Suppress Eclipse warnings  - Remove unused code  - Correct Javadoc
487c2ccaec Remove unused code
8b208262fc Revert r1075050
bc2ef54842 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=31027 Trim whitespace from names and values obtained from $CATALINA_BASE/conf/catalina.properties to avoid hard to diagnose errors on startup.
5304885442 Block whilst waiting for data from client in NIO SSL-rehandshake rather than spinning the CPU
b8f29a599e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50836 Better documentation of the meaning of Lifecycle.isAvailable() and correct a couple of cases where this could incorrectly return true.
e563e35b50 Another false positive
ead379eb48 Fix FindBugs identified error in Servlet 2.2 jspFile handling
198b53d8b3 Fix what looks like a copy/paste error
83d10f093b No need to call stop if the app didn't start
9aff66496d Ensure a web application is taken out of service if the web.xml file is not valid.
97be77f7fa Fix FindBugs warning
c19f0e3358 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49284 Support SSL re-negotiation in the HTTP NIO connector There is a fair amount of renaming in this patch. The real work is in the new rehandshake() method in the SecureNioChannel.
d5ccaa87ba Avoid NPEs trying to re-negotiate with NIO
208c757fd6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50826 Avoid IAE when Tomcat instance is destroyed without every being started. Add a test case for this.
ba9e0d8d4a Don't start NamingResources multiple times
9d7536f603 Add documentation for the Crawler Session Manager Valve.
0001fcbe20 Fix comment typo
04ad77dc74 Avoid NPE if no u-a header
edc676f4c0 Restore the CrawlerSessionManagerValve Local testing with Jira 4.2.4 shows it works.
69a294afb6 Add security listener
51cc32f8f5 Add the SecurityListener (disabled by default) that prevents Tomcat from starting if configured insecurely.
6d301ddf49 Better handling in acceptor threads if server hits ulimit for open files
5cacd1ff3f doco update bug 50805
ee69f32a6a https://issues.apache.org/bugzilla/show_bug.cgi?id=50805 Make sure we only call borrowConnection once per connection per checkout
bee9b54f91 Test before generating debug log messages Fix FindBugs issues for File.delete() return value
9a29fdd795 Remove unused code, fix FindBugs warning
9bdfc7e976 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=21669 Add the ability to specify the roleBase for the JNDI Realm as relative to the users DN. Based on a patch by Art W.
eda10c0da1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=19444 Add an option to the JNDI realm to allow role searches to be performed by the authenticated user.
52b025e4c7 Refactoring to remove duplicate code
c3de1d2a07 Convert to Javadoc comment and add some additional info
924f48e61d Smarter solution for bug 48863
8facbfabe0 Servletapi-2.3 appears to have disappeared from the maven1 repo. Switch everything to maven2 repo
bea3b13dc9 Fix javadoc
b5500d4dda Fix indentation
7d4c974338 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48870 Re-factor to remove parallel arrays. Modify fix for 48863 to remove use of StringManager as it is not available in Bootstrap
06eb2a79d5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48863 Better logging when specifying an invalid directory for a class loader. Based on a patch by Ralf Hauser.
2c021d7abb Exclude a check
c4b863be09 Remove unnecessary code, fix a Findbugs warning
344fc40cd6 Remove unnecessary code, fix a Findbugs warning
55666e478f Remove unnecessary code, fix a Findbugs warning
6ed3655fc6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50743 Cache CheckStyle results between builds to speed up validation. Patch provided by Oliver.
4b4d3e99cc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50189 Once the application has finished writing to the response, prevent further reads from the request since this causes various problems in the connectors which do not expect this.
c3746ebf26 line length
6db4385f96 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50802 Ensure that ServletContext.getResourcePaths() includes static resources packaged in JAR files in its output.
ba640f1c98 Update ignore list with the full set
dadc723c4d ignore list
e5f8dba328 Update version numbers
d646c25b7a Correctly use the readFully method. Add a utility method to sort absolute order
ae71d8b2d6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50780 Fix memory leak in APR implementation of AJP connector introduced by the refactoring for bug 49884
e13280cbbb Remove unnecessary code. I don't see a code path that could result in the socket being in the map at this point
590b97f67e Remove unnecessary code. I don't see a code path that could result in the socket being in the map at this point
2b242fcd6c Fix NPEs on shutdown. Loop is prevented above when the child is removed.
d7c73d4faf Typo? Copy and paste error?
83d7ae7aac Fix typo
42fcd35080 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50789 Provide an option to enable ServletRequestListeners for forwards as required by some CDI frameworks.
b6b4ef1e08 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50790 Improve method resolution in EL expressions Add test cases for this bug
2619af6ba0 Remove duplicate code.
640d7ddee5 Prevent NPE in unit tests as a result of r1067718
e0c4aeb3d3 Fix test failure now r1069056 has added stricter checks for state transitions
9f1aae5cf6 Prevent NPE in unit tests as a result of r1067718
5742763f8c Prep for next release
220497f427 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50793 Correctly fire request init/destroy events for astnc requests
d7773312c3 Move test outside the loop
7c23b261ca Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50713 Remove roles command from Manager application
476ca76966 Fix Eclipse warnings
02ea0595c9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50700 Ensure that the override attribute of context parameters is correctly followed.
e3008353f0 Correctly test for no attributes
01436206d4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50771 Ensure HttpServletRequest#getAuthType() returns the name of the authentication scheme if request has already been authenticated.
e93e22c4a0 Followup to r1069836 Remove unused managerClassName attribute from mbeans-descriptors.xml.
97efa1f036 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50726 Ensure that the use of the genStringAsCharArray does not result in String constants that are too long for valid Java code.
5b92a630e9 doco and version update
f4720bc95f https://issues.apache.org/bugzilla/show_bug.cgi?id=50759 Update validation timestamp if using an external validator.
74d6fddfce Remove deprecated code
57a4c20f3d Remove deprecated code
37b565b5e6 Remove unused deprecated method
9797d040cb Add additional information to assist with tracking down the root cause of https://issues.apache.org/bugzilla/show_bug.cgi?id=50737
3768a73e2b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50751 Don't try to retrieve attributes if we don't need to. If anonymous bind is not allowed, the login will always fail.
599da812c0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50752 Correct typo
2d4b026f6a Fix Eclipse warnings
3b8f2ac5d5 Add unit test that demonstrates use of a custom SSL implementation that extends the default JSSE implementation.
a39fda4064 Add a test case (already passes) for bug50753
6676d3d614 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50720 Ensure that the use of non-ISO-8859-1 character sets for web.xml does not trigger an error when Jasper parses the web.xml file.
759e774ee2 remove retry from the API.
f722212aca Fix Javadoc warnings
c30627d144 remove unused import
da5e3e1948 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50721 Correctly handle URL decoding where the URL ends in %nn. Patch (for fix) provided by Christof Marti. Additional test cases added.
e8bfa31afe Ensure NamingResources follows correct lifecycle
28f0b310ab The bug number changed
ab6531ef64 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50747 Allow the content length header to be set up to the point the response is committed when a writer is used.
0c64bffa1a Correct the package name
ad323f8196 Add further checks that LifecycleBase sub-classes are correctly changing state.
d302c08fe6 add some arrows to the diagram
fc8228ce5a Better comments
3404f05352 remove loop that should not be used at all.
17b4bed386 https://issues.apache.org/bugzilla/show_bug.cgi?id=50667 Move the callback outside try/catch to avoid duplicate callbacks
3320595489 Prevent duplicate event messages
f08f08cf7b Followup to r1068549 - add annotations.
4b019d54fa Add release date. Move recent changes into the new version.
6bec90fc74 Start a new version, place fix in correct version
cdba7b91f2 Update changelog with latest tribes fixes
b4156f6227 https://issues.apache.org/bugzilla/show_bug.cgi?id=50667 Allow a replier to get confirmation if the reply message was sent successfully or if it failed
198a9f7170 Fix typo - thanks Konstantin
15f8e672de Remove ServerLifecycleListener
530d4318cd Make NamingResources implement MBeanLifecycle Environments, Resources and ResourceLinks are once again available via JMX
1fc01abef5 Improve comments
680843987b Remove for now since I can't get it working with Jira (my primary motivation for writing it) It will return once I find the time to do the detailed debugging with Jira to figure out why it doesn't work.
e0c79b4c1e Test a quick hack to get this working with Jira
7c64213396 Review from kkolinko 1. Matcher not thread safe 2. >1 UA header -> not a bot
55c47d6070 It isn't working. Add some debug logging.
5621087247 Fix the expiration logic
83cf617d19 First attempt at a valve to limit session creation by web crawlers. Docs etc to follow once it is confirmed working.
5629e9e3b3 Tweak defaults. Document.
653e392036 Move attribute name definitions to AccessLog interface AccessLog implementations need to be aware of attributes since they aren't always set (e.g. if request is rejected early in the connector)
8068634117 Initial attempt to fix RemoteIp issues observed with ASF Jira Docs, filter and changelog commits to follow once it works
7a43b39b32 Bump version
428e50339c Fix hanging Servlet 3 asynchronous requests when using the APR based AJP connector.
1c0d212b17 Do not send flush packet if explicit is false
2f2fa1811d Fix security exception when running under a SecurityManager
acf73db7d1 Follow up to r1067039
8b019a45cf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50709 Make ApplicationContextFacade non-final to enable extension.
1b159b5906 Update changelog
efa7bfdd9e Align server.xml installed by the Windows installer with the one bundled in zip/tar.gz files.
196997f7ef Fix NPE in CoyoteAdapter when postParseRequest() call fails.
29dae8fafa Reduce severity level. The ASF Jira instance logs were filling with these
2148e9cb51 Bump version number
1fba9a2306 Make sure flush packet is not send after END_RESPONSE packet. Should handle BZ49929
af76acd447 Hmm. Can't see a way (without changing the connector code) to test SSL renegotiation failure if the JVM supports RFC5746. Need to think about this some more. In the meantime, get the tests working.
13a9383587 Factor out support code prior to splitting up the TestSsl class
f262008e64 Move/rename to better location
efa7143dc8 Fix Eclipse warnings
3f817db64e Fix javadoc niggle
691fc5caff Missed one place where socket needed to replace socket wrapper in r1063774
a619ffc035 Clarify
35f1e6153a r1057694 broke display of ROOT/index.jsp in MSIE. Use JSP comments in the license instead of HTML comments, like we already do elsewhere.
e7161c0f23 Correct documentation for the PersistentManager class: there is no "randomClass" attribute, but several others were added. Move attributes defined in the Manager interface into the Common Attributes section.
d08884e6fb Followup to r1066310. Simplify: call stopAwait() unconditionally.
22d36a7f1c Followup to r1066310. Simplify.
79d8ea41bf Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=50673 Improve Catalina shutdown when running as a service. Do not call System.exit().
69ef147c44 Improve HTTP specification compliance This works-around the Oracle JVM bug that triggers a DoS. CVE-2010-4476.
ba55198dcf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50631 InternalNioInputBuffer should honor maxHttpHeadSize This addresses CVE-2011-0534
2d4ca03acc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50325 Use JVM provided solutions to CVE-2009-3555 if available (i.e. RFC 5746 support)
3cc85be4ad Followup to r1065089. Make the field final.
9220594e06 Add bug number to an already fixed issue. Arrange issues in ascending numeric order.
ee47307ca4 Fix breaking tests after recent comet fixes
c9302d0042 Implement debug logging in InternalNioInputBuffer. Log what we got with the first read.
0004cf180d When running the tests use log configuration specified by conf/logging.properties
f262f72bf9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50683 Scan annotations when unpackWars=false
446cc7dd82 Re-fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49978 Pre-existing dir should not break deployment
b3bdaea398 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46819 Remove redundant object instantiations in JspRuntimeLibrary. Patch provided by Anthony Whitford.
14a3fe62ed Remove unused file
a9aff0b699 Remove whitespace
443978f13b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50680 Prevent an NPE when using tag files from an exploded JAR file, e.g. from within an IDE. Patch provided by Larry Isaacs.
4bfca3e78c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50679 Update the FarmWarDeployer to support parallel deployment. This deliberately breaks the API since the meaning of a number of method parameters has changed (context path -> context name).
da51309c80 Don't need an INFO log message every 30s when the FarmWarDeployer is running
9f5c586c10 Not sure which recent Comet change fixed this but one of them did.
098bc1c876 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50642 Better fix for HttpClient keep-alive thread triggered memory leaks
87ffa0f0ea Typo
4fd6a766df Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50646 Ensure larger Tribes messages are fully read. Patch provided by Olivier Costet.
c1f30b7913 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50648 Correctly set the interrupt status if a thread using RpcChannel is interrupted waiting for a message reply. Based on a patch by Olivier Costet.
70b729839f Correct some old typo in context docs: move comment about docBase bahaviour with symlinks to where it belongs. No need to update 5.5 ones: they are OK already. CTR: docs
4004d689d9 Don't assume servlet 3+ async when processing long poll connections (it might be comet) Use socket rather than socket wrapper as key in connection list else comet sockets may be lost
da7da47557 This change also fixed an open bug
e46b7709ae Fix various odd behaviours seen with a debugger. Observed both multiple and zero (rather than 1) selection events for a single data receive event
5c4459811a Ensure correct cycling if input filters
24202a6355 Prevent multiple Comet END events
069bb61f91 Clarify what the units are when setting sessionIdLength property of a Manager. It was asked on users@ CTR: docs
9d39b32dd7 Remove old, commented out code
1f493b9168 Small simplification
318e4d9600 Remove unused import
64993e8d4c Use getName() instead of logName() in error messages in StandardContext.
32d14d684b Formatting - followup to r1061953
f953f1c34f Be consistent with locks on sessionCreationTiming, sessionExpirationTiming in DeltaManager.resetStatistics(): use the same lock as elsewhere. Corrected a pair of typos in changelog as well.
f97fe330db Fixed typo.
ed566ac4a1 Removed debug logging added with r1061929.
019a0320e8 Re-fixed bug #49711: HttpServletRequest#getParts() does not work in a Filter - Moved allowCasualMultipartParsing setting from <Connector> to <Context>
878906877a Reverted inadvertently-committed files from r1061929.
359e7ab2d7 Fixed bug #49711: HttpServletRequest#getParts() does not work in a Filter - Added <Connector> attribute allowCasualMultipartParsing (default false) - Requests that contain multipart/form-data will be parsed in the absence of @MultipartConfig when the above attribute is set to "true"
1b6bb81ae3 Fix possible thread exhaustion With a breakpoint in the servlet handling the timeout event, I was seeing a new thread being allocated from the poll every second or so
cb31cfd1b5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50629 Make StandardContext.bindThread() and StandardContext.unbindThread() protected to allow use by sub-classes.
bfccffa626 Improve error message & use i18n
d0f19f1386 Add missing entry
e25d6b6078 Add textual description to the attributes supported by DataSourceLinkFactory Correct a typo
dd6b70acd1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50441 Clarify when docBase can be set
026f1d95bb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50526 Additional JavaMail docs
d43db9d1f3 Fix copy/paste snafu
4018f93180 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50620 Exceptions calling session.endAccess should not prevent recycle() from completing normally
dfbf2b2ceb Update info - should probably just delete all these
220db41272 Fix http://issues.apache.org/bugzilla/show_bug.cgi?id=50606 Improve CGIServlet: Provide support for specifying empty value for the executable init-param. Provide support for explicit additional arguments for the executable. Those were broken when implementing fix for bug 49657
b65ac2d283 Use the new release(s,p) method introduced in r1050249
9a7581b702 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50535 Provid an option (disabled by default) to serve resources from /WEB-INF/classes/META-INF/resources
f42b7f47e1 Revert r1060927. It changed the API (which would have been fine if it the eventual solution needed it but it doesn't)
9e68dc4cb9 update version
0841162d23 doco update
d69f2b1d1b https://issues.apache.org/bugzilla/show_bug.cgi?id=50613 Fix concurrency bug around size calculation for the pool
b605036a0e Rename in preparation for https://issues.apache.org/bugzilla/show_bug.cgi?id=50535
37f05bb2e1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50601 Code clean-up Patch provided by sebb
ea0cae8654 Update the ipv4 loopback regex to cover 127.0.0.1/8. Fortunately, ipv6 only has a single explicit loopback address.
8c079b6d89 Remove reflection part of stack trace when Catalina throws an Exception - makes it easier to see what went wrong
abcef09e2d Findbugs
91f44025fd Expand the non-Tomcat settings section
1466e2e775 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=22278 Add a commented out RemoteAddrValve that limits access to the Manager and Host Manager applications to localhost. Based on a patch by Yann Cébron.
d2cee0fe39 Fix Findbugs and Eclipse warnings
64345d155a Fix the last of the high priority FindBugs warnings
a033610fea Correct a typo in documentation
7347ec0667 Documentation fixes: 1) role name: s/manager/manager-script/ (BZ 50599), s/manager-script/admin-script/ on 401/403 pages of host-manager webapp (a typo) 2) there is no property "debug" on the Context, nor on several other classes (realms, authenticators)
fa82320fb6 Correct a pair of typos in documentation
cbbbb1d768 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50599 Use correct names of security roles for Manager app
ab307d540a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50598 Correct URL for manager text interface
53bc201c40 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50597 Don't instantiate a new instance of a Filter if an instance was provided via the ServletContext.addFilter(String, Filter) method. Patch provided by Ismael Juma.
f121e4c68d Document the conflict between compression and sendfile, as was discussed on users@ http://markmail.org/thread/bp46zusxjsqqxydr
e943737e8a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50600 Prevent ConcurrentModificationException when removing WAR via FarmWarDeployer
7e57a24dde Clarify web application version ordering rules when both versioned and non-versioned instances of the application are running in parallel.
44df8c7a36 New classes need to be in bootstrap.jar
19e397b446 Fix FindBugs warnings
e451d99fc4 Fix FindBugs warnings
846cde260f Fix FindBugs warnings
806a52700d Fix FindBugs warnings
e5ecd5976e Add a new filter for fixes that require an API breaking change that need to wait until post 7.0.x
b5e4bc684b Remove unused code
35b1ce8092 Avoid deprecation warning without disabling warnings for the whole class
312ae70300 Avoid NPEs Remove FindBugs warning
6f9b7876b6 Rename variables to start with lower case letter to make code easier to read
c10d54c5ac Fix FindBugs warnings Remove unused i18n strings
65b84849d2 Fix FindBugs warnings
2b962afb5f Fix FindBugs warnings
d811dce5b1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50582 Refactor access logging so chunked encoding is not forced if bytes sent is logged
4770c79820 Correct a typo in RequestFilter, that would lead to an NPE in RemoteAddrFilter, RemoteHostFilter when "allow" attribute is empty. The RequestFilterValve class is not affected by this issue.
b7371ce0aa Update documentation for restrictedUserAgents, noCompressionUserAgents attributes of HTTP connectors, because they now use a single regex.
c601e5b013 Update JMX descriptions, tests, documentation and examples in documentation for using a single regex for attributes in RemoteIpFilter, RemoteIpValve.
cf75863a80 Update examples for RemoveAddrValve, RemoteHostValve in the docs
5f74ba2f2e Fix FindBugs warnings
b8b0d32cad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50591 Do not throw NullPointerException when ReplicationValve#filter is not set.
7f0631e621 Updated ReplicationValve examples in the docs with the new regexp syntax. Added *.jpeg pattern to the list, as inspired by the comment in BZ 31912 https://issues.apache.org/bugzilla/show_bug.cgi?id=31912#c2
24ef84c44a Update changelog
eab24d5cbf Refactor to make clearer what is going on
489979f89c Fix broken cluster membership recovery
fe94b3fc09 Fix FindBugs and Eclipse warnings Remove out-dated comments
9d592819eb Fix FindBugs warnings
eb3ea80b79 Fix FindBugs and Eclipse warnings
4f63f3a77a Remove unused code Fix FindBugs and Eclipse warnings Correct typos
d078aaf10e Additional docs on version ordering Add 7.0.6 release date
453b27bb1a Fix FindBugs and unused code warnings
18015be09b Fix FindBugs and Eclipse warnings
e7745b93e7 Add comments explaining false +ve
2cded3d5ac Fix FindBugs and unused code warnings
61cb38fb71 Correct a typo
95950cc99e Fix Findbugs warnings
5a1967d1e6 i18n
4d7345e277 Remove unused files
3820729db1 Typo
31df1bcc3e Remove unused files
27baa8baa7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=18797 Provide null/zero-length protection
88f2315843 Fix FindBugs warnings
25dd888697 Remove unused/unnecessary code
e2e055ca99 Fix FindBugs warning Remove unnecessary code Better error handling
31e133123f Refactor to simplify code and avoid a Findbugs warning
d18ec1af98 Remove unused code
510c22784d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=18462 Don't merge stdout and stderr internally
be939ac11c Fix Javadoc warnings
c8ce24c478 reset state when the connection is closed
04ce492cc1 fix warnings
5c776f33de Better class loader control when embedding
71e96101bf Findbugs
056c36a133 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=15688 Use fully qualified class names to avoid possible naming conflicts JSP 2.2 TCK passes with these changes
5e661d096d Fix odd line wrapping
cda3a41ded Additional improvements for https://issues.apache.org/bugzilla/show_bug.cgi?id=50205 Followup to r1057788 1) Simplify check for absence of value 2) Reuse Matcher instance across iterations
42b1a3e1b5 Typos
7e17ff977e Bring up to date
6316ce0295 Action review comments Store deployIgnore as a Pattern in the Host
efc499601b typo-fix
b96ca095ca Mask the password through all the JMX operations
a4b3bef9b4 Better handling of special case of  javax.servlet.jsp.el.ScopedAttributeELResolver
93b8a4ceb9 Re-build tomcat-dbcp on release so the manifest picks up the new Tomcat version
ff6a667659 Expand checkstyle license checks
ec8e800284 License should be first thing in file unless file format prohibits it
9f97993a0f Use standard layout ASF license header
4248ba45c4 Add missing license header
85c0ab6493 Add missing license header
227f980bce Get checkstyle to check Java files for AL2 headers
971f695036 Remove first blank line. REmove $Id:$
abb59b2404 Use standard layout ASF license header
2974773b2d Add missing license headers
33c7dbe1fe Use standard layout ASF license header
c7dfb4c1e0 Use standard ASF license header
c91c49a14f $Id:$ does not belong in license header
9f62adc953 Add missing line to license header
3f4bf21904 Add missing line to license header
a9ab952bc8 $Id:$ does not belong in license header
e33c3a4b1f Fix formating so Checkstyle header chekc will pass
ab0a884107 Followup to r1050117 Use StringBuilder to concatenate strings
cb44f614ba Correctly acquire the getConnection method for the right number of arguments
0e6a313ef1 Missing eol style property
139f7b4e70 Prep for next release
b1046689c7 Correction
c8a9a43183 Prevent XSS in Manager application This addresses CVE-2011-0013
ee6d0b4125 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50205 Add deployIgnore to Host Based on a patch by Jim Riggs
02b2f986ce https://issues.apache.org/bugzilla/show_bug.cgi?id=50333 dont allow 0 or negative max active values
96ddc76369 https://issues.apache.org/bugzilla/show_bug.cgi?id=49953
f1120dc328 Remove override annotations to compile with JDK 1.5
1d6ddc6ff7 Remove Host.liveDeploy that just duplicates Host.autoDeploy
a3c2b5507c Fix FindBugs warnings in StandardHost
787b456bdf Document a couple of long standing system properties
c78ab47aef Configure Checkstyle to allow limited static imports and revert most of r1056947
27705f1b19 Fix checkstyle warnings
5fba05e75d Fix a handful of warnings
c01e4ac8f4 Enable testcase for 50413#c6, now that the issue is fixed with r1056889. Update changelog.
07d1927873 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50413#c6 Serve the error page regardless of "Range" header in the original request.
f1eea7491f Added tests for https://issues.apache.org/bugzilla/show_bug.cgi?id=50413 The test that is currently failing is commented out and marked with a "FIXME" comment.
21ea5a843d The TestMapper.performanceTest() takes 3250 msecs to rn for me. I am increasing the timeout to be 4s. Also printing the actual value in case the test fails.
dada936ae5 Followup to r1055975 Move string calculation out of synchronized block
c3da2b86d1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=21157 Write cookie before response might be committed
9ddb2b79a8 Followup to r1056386. Add a changelog entry.
13f007966a StringBuffer -> StringBuilder for consistency
c6b5f61791 Correct typo in the method names in a test case, so that they match to what method is actually being tested.
5022c6ecd4 Followup to r1056553 There should not be "import com.sun.jndi.ldap.LdapPoolManager;" as we must not depend on that class at build time. Actually the import was used by JavaDoc comments only.
3b0686c839 Folloup to r1055989 Add qualifiers to the fields of DataSourceLinkFactory.DataSourceHandler class.
09f789a398 Provide two alternative locations for the libraries downloaded from the ASF web site at build time. Use the main distribution site as default and the archive one as fallback.
97ea9ad0eb bug 50556: improve JreMemoryLeakPreventionListener against leak caused by LdapPoolManager https://issues.apache.org/bugzilla/show_bug.cgi?id=50556
cda053b42d Fix security exception when running Servlet TCK
df911b4c75 Update daemon to 1.0.5
5edbccab38 Update tests now name only cookies are not accepted by default
b8be7756f7 Fix tests after regex changes
d75e50572f Put sleep in right place for test to pass. With acceptCount of 1 need a short delay else connections get rejected as Tomcat doesn't process incoming connections fast enough (on 8-core machine)
69de092009 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50496 Differentiate between content written (what the app writes to the output stream) and bytes written (what Tomcat writes to the socket) and use bytes for the access logs
70c88475af Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50552 Avoid NPE that hides error when using Ant tasks (schultz)
399097548f Fix some simple FindBugs issues
c394d2b83e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50554 Various FindBugs / Eclipse warnings Silence the false positives
cb66293fd3 Numerical order, fix indenting
44e7124283 Fix various warnings
a2cbc2965c Fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=50477
4d47f36212 Followup to r1055989 Do not use $Id if svn:keywords property is not set.
24e6a80ed1 https://issues.apache.org/bugzilla/show_bug.cgi?id=49543 Add the ability to specify a data source link, to use a shared datasource with per application credentials
a64a78922e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50550 Make sure PROPFIND,MKCOL,PROPFIND returns 404,201,207 rather than 404,201,404
4473a66635 Fix a couple of FindBugs niggles
b10ab0648f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47319 Don't return null for getRemoteHost() if the IP address cannot be resolved.
e5993efb17 Switch all configuration options that use regular expression to require a single regular expression (using java.util.regex<) rather than a list of comma-separated or semi-colon-separated expressions.
20e1d02e4b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50547. Add time stamp for CHANGE_SESSION_ID and SESSION_EXPIRED message.
010160259b allow system to start
f3acac9083 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50453 Correctly handle multiple X-Forwarded-For headers
0bed4ac661 Remove unnecessary code. Valves in this package can use the StringManager defined in ValveBase
f2a1672ef0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50467 Protect against NPE that will cause Poller to fail
9ff9ba9ad1 Simplify getContentCount. Prep for fixing bug 50496
29ed647ea0 Remove unused code
03dd2118bc Remove unused methods
5bbfa180be Remove unused constants (follow up to r1055377)
f844134572 Remove unused method
78f05c1229 Fix required after removing unused code
66a736cf0c Remove unused code
4a4b9af131 getContentCount() may return -1 so use getContentCountLong()
8d62a06cba Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50527 Improve error message
671a15fc4c Doh. Forgot to update the change log.
7ef6804d85 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49000 Make accepting name only cookies configurable, defaulting to disabled.
2a218f8545 Grr. Remove comment markers.
41888606c3 No need to instantiate a new driver instance each time, simply reuse the one we got
b0aa3a6323 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49000 Consistently handle name only cookies (which are not spec complaint)
31689751aa Re-fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49372 Don't throw an LifecycleException for an invalid transition if a connector fails to start.
ae00349f26 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50541 Add support for sizeLimit and timeLimit on the JNDIRealm
dacfa80f8d Fix typo
1156894880 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50488 Update classpath required when using jsvc and add a note regarding server VMs.
9f51597d1d Add a test case of no user name change
f0ed4f273e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50500 Use correct coercions (as per the EL spec) for arithmetic operations involving string values containing '.', 'e' or 'E'. Based on a patch by Brian Weisleder.
86b12fa4f4 Remove unused imports
fc78af35b0 one 0 too many on username test make sure the driver correctly checks url
78f7df559b Up the number of iterations the test runs
29f817687a version
1afdfb976c Increment version number
9cad49b00c add in ability to pass through credentials https://issues.apache.org/bugzilla/show_bug.cgi?id=50025
2e59a469e5 better count check
4149b0bd80 update link
5aab62277a Update Copyright year.
3f2742db16 Improve documentation of database connection factory.
2efaf03059 bug 49159: Improve ThreadLocal memory leak clean-up https://issues.apache.org/bugzilla/show_bug.cgi?id=49159
0cc5ce9e01 refactor latch usage, since its shared by all connectors
70319b1622 Fix classpath
4039c77592 Allow to set log formatter when running Junit tests
c6e84c005f Allow to specify the test on the command line ant -Dtest.name=**/TestMax** test Without the parameter, the default is all tests as specified before
090e495e6d make shared variable volatile
e7e63fc9ec Fix webappClassLoader.clearJbdc message key and message in LocalStrings.properties. Jbdc is corrected to jdbc.
d9a5b12a6d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50503. When web application has a version, Engine level Clustering works correctly.
a29e2cb1c0 Fix Checkstyle / Eclipse nags
e0548e6a68 Restore file accidently removed in r1044731
4f920a217d Fix Checkstyle / Eclipse nags
d935b878da Add in a default that doesnt throw a ClassNotFoundException that is simply ignored, and allow a fast way to change the console formatter through a system property when no config file is used.
0e5e16a2f8 Test can piggy back on the 'ant test' auto switch between connectors
2b7180ce8b Implement maxConnections for NIO connector
ac6912f1e3 Implement a maxConnection threshold for the JIoEndpoint, to be able to constraint how many connections the connector will accept
8c7844f8f6 Version numbers are defined in the properties file
f0c0af6454 Fix unlikely FindBugs warning
b6cad4a1ac Remove unused code
668d2937b9 Simplify based on StringManager changes
644ba38bae Typos. Sorry for the noise
4dba17f27e Fix remaining warning in o.a.el.lang package
cda9dfc004 Fix most of the Java, Findbugs and unused code warnings in this package
bd89a1ec0b Fix Eclipse warnings
d9e796af8a Fix remaining Eclipse warnings in o.a.juli
e948da3fe2 Fix remaining Eclipse warnings in o.a.coyote
93df08d1f2 Fix remaining warnings in unit tests (with recently documented settings)
1984d473b6 Fix remaining warnings in webapps (with recently documented settings)
8a751c0a3b Fix remaining warnings in javax package (with recently documented settings)
18138be2b6 Document the Eclipse compiler errors/warnings settings I am using
b8c5c7b379 Avoid a possible NPE that in turn was masking the root cause from JspC
4a15f8314b Fix massive memory leak in NIO connector. Http11NioProcessor objects were not being recycled.
7e59e7c8a5 https://issues.apache.org/bugzilla/show_bug.cgi?id=13731 Make variables in <code>_jspService()</code> method final where possible.
2248961245 Starting to work on maxConnections attribute for BIO/NIO connectors to allow administrators to throttle how accepting connections is handled. Implement a CounterLatch to keep track of the connection count while also allowing the acceptor thread block while the max has been reached
75d99bdbef bug 48822: Include contest name in reload and stop log statements https://issues.apache.org/bugzilla/show_bug.cgi?id=48822
160f64a958 bug 48822: Include contest name in reload and stop log statements https://issues.apache.org/bugzilla/show_bug.cgi?id=48822
4d44ec6b1e Fix Findbugs issues / Eclipse warnings. Some genuine issues Some changes to make code easier to read (for humans and analysis tools)
1dee92d003 Fix a FindBugs nag in the unit tests
18adbf0a44 https://issues.apache.org/bugzilla/show_bug.cgi?id=10972 Improve error message if the className attribute is missing on an element in server.xml where it is required.
5960fe3ccd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=10526 Add alwaysUseSession option to authenticators
427cfadd3a Whilst I am thinking about excluding stuff from FindBugs - add some exceptions for the generated code with issues and fix the remaining issues in the same package
e6fd50c463 Add a FindBugs filter config for known false positives
a0372be974 Fix various warnings (FindBugs, Eclipse etc.)
1b9fc38523 Fix another FindBugs niggle
d613f79d3a Remove unnecessary override
1328e7f6f6 Fix my stupid mistake.
cfaf13d2ff Fix a typo
b38834ecf8 Added documentation to parseBodyMethods and parseBodyMethodSet members.
55347c0ade Fixed bug #49125: toString on byte[] array probably is not correct - Added HexUtils.toHexString method - Wrapped output of byte[] objects with a call to HexUtils.toHexString
c8a911794b Log mis-configuration in context.xml
ea41d04fdd Aliases were broken if the context was reloaded
2ede8de7a4 Fix various FindBugs and Eclipse warnings
88eb4e5733 Using abstract classes means impl isn't clear in the startup log. Modify name so it is clear.
5e8cd61cb2 Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50201 - Use AtomicReference to guard against possible duplicate registration of   listeners when logAccess() is called by several threads at the same time. - Added install() and uninstall() method to AccessLogListener   to help register/unregister the listeners. - When defaultAccessLog is nulled, always unregister the listener as well.   The listener does not need to be reused, because now we do create a listener   when there is no log and it will take care of things.
872058df4f changelog for r1044987
b0e26d3c94 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50460 Avoid leak caused by using a cached exception instance
674a126554 Use i18n for the messages It is followup to r1042022 which was a fix for BZ 48973
e708cfb51b Add some tests for bug50449 but haven't reproduced it yet
75ea5171c2 Fix FindBugs issues in this class
37d500cfea Fix FindBugs issues in this class
97df155c87 i18n changes for r1044874
28ab52c66f Use the newly refactored session id generator when generating sso session IDs
e4a92bcdcc Re-factor session ID generation into a separate class so it can be re-used for SSO (patch for that to follow)
540d5630f0 Fix FindBugs issues in this class
53aacd9aaa bug 50459: StandardContext.bindThread() and unbindThread() are not symmetrical and not limited to current thread https://issues.apache.org/bugzilla/show_bug.cgi?id=50459
878824ba0d bug 50459: StandardContext.bindThread() and unbindThread() are not symmetrical and not limited to current thread https://issues.apache.org/bugzilla/show_bug.cgi?id=50459
9cdab2b135 TRy and sync up the deps in the POMs with what Checkstyle validates
d623bcb8a3 Tribes should only depend on JULI
b6aae62d7e o.a.tomcat.jni should not have any external dependencies OK for o.a.naming to have dependencies
0b868eb42e o.a.tomcat.util.net should not depend on o.a.coyote
fb613e6727 o.a.tomcat.util.net should not depend on o.a.catalina
3f1b856e29 Get the checkstyle configs to play nicely with Ant and the Eclipse plug-in
ef73336510 Add import-control checks to Checkstyle (these found the recent dependency issues) Move checkstyle config to res/checkstyle to stop it cluttering up the root
9abf18ad61 javax.el should not depend on javax.servlet.jsp.el
f2c788c321 Coyote should not depend on Catalina
99540dad55 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50448 Regression caused by http://svn.apache.org/viewvc?view=revision&revision=1036281
a8eacc6caa Avoid duplicate constant definition. Use Constants defined by the Servlet/JSP specs where appropriate Use Constants in preference to local Strings
ddd8ba2854 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50413 Ensure 304s are not returned when using static files as error pages
d814d12192 Missed file in r1044255
304cc32c0c Fix FindBugs / unused code warnings
add2464dbb Fix Eclipse warnings in package
ed0fedd752 Fix Eclipse warnings in package
f9add1ae59 Remove redundant interface definitions and fix other warnings (missing @Overrides) in same files
c6b9cb3861 Grrr. Missed a couple of @Override markers
f17dca4442 Fix missing @Override markers in Jasper and remove an unnecessary null check
104bdc1a68 bug 49159: Improve ThreadLocal memory leak clean-up https://issues.apache.org/bugzilla/show_bug.cgi?id=49159
ada22e4b1a Register the correct object after the refactoring
0555513e28 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Add an option to control when the socket is bound
34143d6fd9 mserver != null will never be true if the mbean was registered. Drop the check since the unregister method will handle things correctly anyway
9bd590ce2b Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Log the right message at the right point
de1e787948 ignore work and logs directories as discussed on dev list
a84b420869 bug 49159: Improve ThreadLocal memory leak clean-up https://issues.apache.org/bugzilla/show_bug.cgi?id=49159
f0865c9007 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Move ad-hoc attribute handling from the ProtocolHandler to the Endpoint and expose the Endpoint to ServerSocketFactory objects so they can retrieve additional configuration if required. All default components now use explicit configuration rather than relying on the ad-hoc mechanism. Ensure the hooks for alternative SSL implementations are in place (were partially removed). Remove the hooks for alternative ServerSocketFactory implementations (had been hard-coded / half implemented for some time). Make the sslEnabledProtocols attribute work with BIO as well.
343e5b6af8 - Fixed brace and paren placement - Changed Connector.isParseBodyMethod from public -> protected - Relaxed language claiming that use of parseBodyMethods may "violate" the servlet spec - Moved error message to LocalStrings.properties (Translations requested)
ea80ec8750 Removed a little more unused code
cd947df3fe Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 ProtocolHandler should register itself with MBean server rather than have the connector do it.
ec2613bdf2 Remove some unused code Fix some FindBugs niggles
50efe03f21 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up start()
8977b11ddf Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Move MBean registration from start() to init(). More MBean refactoring expected
dd7858ae4b Fix copy/paste error
34a7f15d4f Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up init()
46877359f0 Align BIO+JSSE with NIO+JSSE
327841734c Fix indents
773b7f5214 JSSE will always be available in Tomcat 7
1ffbb8b0ea Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Align the init() methods (JSSE still to go)
6f57f60fcb Nice idea, but need i18n for the actions so each needs its own string
b2c7681868 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up stop()
ed0f7459b5 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up pause() and resume() methods
3c19057851 Remove unused welcome file handling code
7f60894f5e Remove unused code
f2ec187542 Remove unused code
693c455ad3 Remove unused code. Make spacing consistent.
246bc619c0 Jasper should not depend on Catalina Re-use constants where possible Fix a FindBugs niggle
70db9a634a Another Findbugs niggle
bda259ee1c Fix some FindBugs warnings - all unclosed streams. These could potentially lead to locked files and maybe memory leaks. Fix some other simple FindBugs/Eclipse warnings in affected files.
f8c1150f63 Fix a couple of 'high priority' FindBugs warnings
a2a11bd212 Add checkstyle rule for modifier order and fix remaining issues in current code base
4123103e8f Fix modifier order in org.apache.catalina.*
ad72c8ad28 Fix modifier order in org.apache.naming.*
b290e96750 Fix modifier order in org.apache.tomcat.*
e6de0023ee Fix modifier order in org.apache.jasper.*
8007a346e3 Fix modifier order in org.apache.el.*
95630f0500 Fix modifier order in javax.*
2eaaf06ee6 Another day, another check
07db3aab25 Typo
b494a12e56 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up the concrete destroy() method - required a fair bit of refactoring Pull up the abstract init() method()
e0fa498e18 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Add the necessary plumbing for the AbstractProtocolHandler to perform the JMX registration
cd32ffe2d1 Fix auto-completion snafu
c839a23d42 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up JMX related methods Tidy up the remaining protocol specific methods
01f56a82ce Include root cause in LifecycleException stack traces
ee9dfc5ed3 bug 49159: Improve ThreadLocal memory leak clean-up https://issues.apache.org/bugzilla/show_bug.cgi?id=49159
64291a9abb Correct a typo
db41568659 Get the tests running again on the command line
31199b68f7 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up timeout getters/setters. Use -1 consistently for the default value of keepAliveTimeout
25eb130bdd Since the address is exposed to sub-components, expose the port as well.
a2429718dc Fix another mix-up of connectionUploadTimeout and connectionTimeout
6dcb73f70f Revert svn-ignore property changes made in r1042482
29c83bd99b Fix mix-up of connectionUploadTimeout and connectionTimeout Use connectionUploadTimeout consistently as attribute name Document connectionUploadTimeout
e3e11eb101 Remove unused code
ff4cd6d9a1 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Pull up more getters/setters.
695e16cdda Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Start to pull more getters/setters and the generic attribute handling. Note that the comments around generic attribute handling are aspirational in some cases but subsequent commits should align the behaviour to the comments.
796854ee4c Remove unused code
00c9559720 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Start to pull stuff up into the base class
189d1174f5 Re-factoring in support of https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Implement a common base class for ProtocolHandler implementations that will handle life-cycle/mbean issues (once more re-factoring has been completed)
83386f661a Line-length
73c8c84f07 Fix typo
4f7f8a2056 bug 49159: Improve ThreadLocal memory leak clean-up https://issues.apache.org/bugzilla/show_bug.cgi?id=49159 Renewing threads of the pool when a webapp is stopped
f47a9c1d8d Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50411
9f95beffc2 bug 50282 / fixed line length
6034a5e701 sort entries by ascending BZ number
73a75867b1 bug 50282 / fixed some typos in documentation
7b4f483772 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50411 Ensure sessions are removed from the Store associated with a PersistentManager.
5154adedd0 Address some review comments: 1. Avoid possible NPEs by using a local variable for the newDefaultAccessLog 2. PropertyChangeListener should be added to the Engine 3. Add the listener when the Noop logger is used so changes can be detected that could cause a different logger to be used.
2960705ab1 Mark 'basePackage' as final, to allow string concatenation to be done at compile time.
10c58cf9b1 Ignore all .* files rather than adding them one by one as they appear
7ca8d11ad9 Remove file accidentally added in r1042029
5fa25bcf75 bug 50282 : Load javax.security.auth.login.Configuration with JreMemoryLeakPreventionListener to avoid memory leak when stopping a webapp that would use JAAS.
9494b9b1a5 bug 48973 (enhancement): Don't create SESSIONS.ser when no session exists https://issues.apache.org/bugzilla/show_bug.cgi?id=48973
6d2a470935 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50408 Fix <code>NoSuchMethodException</code> when using scoped variables with EL method invocation.
94f7256428 Need at least one test per class dummy test for unit tests to pass
d191a97f91 Revert r1041120 but disable rather than delete new test
5f780b90be Fixed bug 48692: Provide option to parse application/x-www-form-urlencoded PUT requests
4e0a6f2c9a Bump versions ready for next release
487f560d8b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=8705 org.apache.catalina.SessionListener should extend java.util.EventListener
c52cf29b34 Add an embedded distribution to the release build
6c28033fd5 Fix Javadoc warning
b9112d130c Replace use of inefficient constructors Reported by FindBugs. Not all fixed.
c8c994d265 Remove unnecessary code Identified by FindBugs
37051731c8 Don't pass null to log messages. Found by FindBugs
83789d6464 Protect against unlikely NPE
0a33f73d66 Correct removal of LifeCycleListenters from Containers via JMX. Found with FindBugs
bc0653854e Better test case
b6efabc595 Fix error in r1041356
a937908721 HostConfig passed a context name to ContextName(String) - ensure that this is correctly parsed. ContextName(String) now accepts all variations of Context name.
73cc4979d1 Make constants static
25ee1823b1 Move changelog comment for BZ 50228 from Catalina to Jasper.
11e9a339bc Revert part of r1039051 Current node is not included in cluster.getMmebers() so previous test was correct
7f09ee49de Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50360 Bind/release socket on start()/stop() Register/deregister MBeans on init()/destroy()
98a49f0a1f Tab police
54ca066084 Fix typo (syntax error) in changelog. Should also fix recent buildbot failure.
51bc7ce80f Don't put anything in current dev since it will be picked up in the tag and could cause confusion
f1d49d1f39 Update release dates
4ec5005657 Don't set property that doesn't exist on any ProtocolHandler or Endpoint
fece6b76f2 Context name rather than Context path is passed in so construct ContextName object correctly.
f189513e0f Switch MapperListener to the new Lifecycle
f2204b62ee Fix typo in script comment. BZ 50383, addition to r1040546.
dd5f7aee9d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50383 Comment typo
8c325c12e3 Align tests with new ManagerBase code Update OSX figures - now comparable
2a4b25c3a6 Remove direct support for reading random bytes from a file Add support for specifying SecureRandom algorithm and provider
52a671a155 Updated Windows results (removal of digest)
4ac8d4a7ac SecureRandom implementations are self-seeding so simplify code.
a84aca27ba randomClass -> secureRandomClass Align (and tidy up) mbean descriptor
22c8c75ad2 Need required attribute or docs don't display correctly
8f21ec515c Fix Javadoc warnings
f8ac9a8e1f Add css to text file list.
5e6ba83794 Set svn properties.
f7efb46b8a Correct method names in log messages
a4abdebad9 Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=50352
c82f8ff5bc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50352 Ensure that AsyncListener.onComplete() is fired when AsyncContext.complete() is called.
6ba769bac2 Correct method name in log message
fc9dd8d4fd Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=50351
91c1ee04c5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50351 Fix the regression that broke BeanFactory resources caused by the previous fix for 50159
5a58a71214 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50358 Set correct state when stopping
50d6f4774d SecureRandom is self-seeding
0cec860816 Make SecureRandom the fall-back and use SecureRandom throughout rather than Random
1937285fdc Add a /dev/urandom vs SecureRandom benchmark
5f7488004f Update so this will run
1eb997fcb5 Remove attributes from PersistentManager too
5d6b6613c8 Drop the entropy attribute. SecureRandom has a sufficiently secure self-seeding mechanism.
d9aff289ca Using SecureRandom makes digesting the ID unnecessary. Dropping the digest gives ~20% performance gain on ID generation.
724957912d Make method name consistent with class name
44c9d5d329 Fix a couple of clustering issues:  - Don't try and obtain session data from the cluster if the current node is the only node in the cluster.  - Log requesting session data as INFO rather than WARNING.
d6415396bb Correctly validate context path so sessions can be viewed for ROOT webapp
f7527d5887 Update changelog
a0b6a55817 Don't use pid file. It is not removed on service stop and prevents the next service start. https://issues.apache.org/jira/browse/DAEMON-188 has been raised for this issue.
92e311308b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49142 Add missing serialVersionUIDs using Eclipse's auto correct and a little manual formatting
2051c21859 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48837 Extend thread local memory leak detection to include classes loaded by subordinate class loaders to the web application's class loader such as the Jasper class loader. Based on a patch by Sylvain Laurent.
4150b16115 Move to Catalina section
15bce728c2 https://issues.apache.org/bugzilla/show_bug.cgi?id=50106 Correct several MBean descriptors. Patch provided by Eiji Takahashi.
fded9a0e83 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49650 Remove unnecessary entries package.access property defined in catalina.properties. Patch provided by Owen Farrell.
10b767215b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50108 Add get/set methods for Connector property minSpareThreads. Patch provided by Eiji Takahashi.
6be2b5fd88 Add additional trace level logging to Tribes to assist with fault diagnosis. Based on a patch by Ariel. Fix Eclipse warnings in file
b8039e33ae Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50294 Add more information to documentation regarding format of configuration files. Patch provided by Luke Meyer.
0370d20531 Increment version number ready for next release
5f5502b90a host.removeChild() already calls context.destroy(). Don't call it twice.
b5526dfc74 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50201 Track changes that require an update to the default access log. It isn't perfect but should cover normal usage
9c714a8625 Don't swallow error
dd66ab9c8e NoOp logger is only used in StandardEngine so move it there Only log to containers that are available
f82b132288 Move configuration of trailer header size limit to the connector
3f7ba8e710 Add a test case for bug50015
737dbeb505 Roles are supported
9a696e7131 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50318 Avoid NPE when viewing session detail for expired sessions
64fd3b6a4e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50207
150ff40139 Make memory leak prevention code that clears ThreadLocal instances more robust against objects with toString() methods that throw exceptions.
51b4a9c2e6 Remove border-radius.htc until issue with this file is clarified.
f3f8e3f05e Impose a limit on the total length of the trailing headers. Otherwise the ByteChunk buffer in the ChunkedInputFilter might grow unlimitedly.
35bbfd78ca Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50316 Fix display of negative values
0e2c1a8b23 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50228 Improve recycling of BodyContentImpl.
afd4b3b390 Fix CVE-2010-4172. Multiple XSS in Manager web application
5f4370e50c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50308 Allow asynchronous request processing to call AsyncContext.dispatch() once the asynchronous request has timed out.
03ed047c31 Additional info for https://issues.apache.org/bugzilla/show_bug.cgi?id=50273 Add the error number to the message
78ddeccf51 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50273 Provide a workaround for an HP-UX issue that can result in large numbers of SEVERE log messages appearing in the logs as a result of normal operation.
cd25df08e8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50310 Ensure Servlet info is displayed in Manager application
44acfa4069 Update docs to new MBean names
f46174523f Use correct MBean name for Mangers Fix Eclipse niggle
f6ac0ebc0f Ensure MBean names are correct generated for version ROOT web applications. Fix ContextResource case that was using old path=... rather than new context=...
d74d581eb4 Add recent HTML manager app fixes
3f0ecccef0 Fix manager app - attribute removed message was not being displayed
0ee252c744 Fix primary sessions not always treated as such by Manager app.
4752838325 Simplify escapeXml(Object)
3b783f05a9 Fix ordering functionality for Manager app
8b99701ea0 Revert r1032232 It broke evaluation of <c:set var="v">value<c:set> https://issues.apache.org/bugzilla/show_bug.cgi?id=50228#c3
1393114126 Use image with tm (the same as tomcat.gif logo)
e787e8aa0e Images are not executable
27a93a22ba Add tm powered by logo
63b739660a Add tm
f464e60255 Add tm to logo
1ae2d92e30 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50303 Update JavaMail download location JAF is included in Java SE 6
4faf23f4c6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50293 Increase default resolver array size. (Jasper adds 5 resolvers.)
e348b559c1 Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49297 Handle tag directives in a similar manner to page directives
1639811c07 Add the final component of parallel deployment
bb89aaedcd The 60s timeout waiting for session info from other nodes will block processing of all cluster messages. As well as lost session updates, this can result in lost sessions if a fail-over occurs while the messages are being blocked.
2f321cb452 Parallel deployment One more place where contexy.getPath() needs to be replaced with context.getName()
a52d0e1d2d Changes to Manager and HTML Manager to support parallel deployment
c533134076 Add displayName to ContextName Fix some bugs in ContextName constructors Add a test case for ContextName
4f39af654e Fix expiration statistics broken by r1036281 Add session creation and expiration rate statistics based on the 100 most recently created/expired sessions Modify average session alive time to also use 100 most recently expired sessions Update benchmarks - new statistics add overhead but not significant in overall processing chain
7436a51220 Some additional statistics prompted by Remy's questions in the dev list
b960095199 Comment out release notes link since tribes has not been released separately
689d79eb9d Fix issues with tribes docs reported on users list.
1b2ea0c386 Narrow the manager-wide sync
bfa26537e9 Refactor the calculation of session manager statistics to the session manager as suggested by kkolinko
70d3422227 Add recent performance improvements to changelog
4fa90f1a62 Session manager performance Switch to a queue of randomInputStreams Significant performance improvement on multi-core non-Windows platforms
e614990151 Session manager performance Switch to only allowing changes to randomFile to take effect when the Manager next starts. This will simplify replacing RandomIS with a queue which is the next step in improving Manager performance on non-Windows platforms
f00defd645 Tab police - sorry rebuilt my laptop and forgot to configure Eclipse for spaces
9dd25959ff Rename attributes to align with getter/setter to make code easier to read
71794abe28 Reduce code duplication Initialise the random number generator once in ManagerBase
28694df44f Update figures
acc91769ec Increase length of tests to a) reduce impact of start-up overhead b) make it easier to profile
5527dd2109 Session manager performance Focused on Windows. Use a queue of Random's to generate session ID to remove sync bottleneck on random.nextBytes(bytes) Timings suggest some bottlenecks still present in default Windows code path
3346c46078 Session manager performance Focused on Windows. No need for DataInputStream, so remove it. Ensure randomIS is consistent with devRandomSource including when devRandomSource is changed whilst Manager is started Further reduce scope of syncs
d9c2dd7a8a Add some test code I used to check thread-safety of FileInputStream on various platforms
3d34c674d9 CoyoteAdapter.parsePathParameters: - do not reevaluate start/end, because we already have them in local variables - move warnedEncoding flag outside the loop, because otherwise it was always false and thus useless
67342b3b78 Additional results for reference
f6e5898e1d Session manager performance Move sync. No performance change but sync requirements for sub-classes are clearer. Still looking to remove sync completely.
19cd62ae10 Update the metrics - looking a lot better on Windows
07acfaef52 Session manager performance Big performance improvement for Windows. Don't try to create randomIS on every single session creation call
e049b9fa0c Session manager performance Switch to a queue of message digests rather than a single sync'd digest Small improvement but is part of removing the sync completely that should result in larger improvements
d2bfc3c079 Session manager performance Narrow sync - few % improvement
d18659c7ec Add some benchmark code for session creation. A performance presentation at JavaOne 2010 highlighted Tomcat's session creation as a synchronisation bottleneck for multiple production apps Some optimisations will follow.
c73e20f4b8 Avoid NPE when removing sessions
33f89b2dd8 Improve logging documentation. I completely rewrote the "Introduction" section of the page, to provide a lot more of details.
6adc34e2fe Wrap long lines in a properties file example.
b809f7dd08 Move <source> block outside of <ol> list to avoid indent, and thus reduce horizontal scrolling. Do not nest lists into <p>.
5adf82aa16 Reformat the document. Print default values on separate lines, for better readability. Correctly document the default value of org.apache.jasper.Constants.PRECOMPILE property. The value is "jsp_precompile".
2c95aa6f5f Remove unused methods Reduce visibility of methods where possible
ae0e1d10bc Opps. Encoded display text rather than link.
1fbed20711 Parallel deployment Add a version column to the HTML Manager output.
a07ac2a4c6 Align default with Context Javadoc.
894605e77c Fix wrong path in the "Tomcat Documentation" shortcut. The webapp is called "docs". ("tomcat-docs" was in TC5.5)
e3712c1ebe Do not remove HKCR key "JSPFile", because we do not create it.
3d9d116435 Remove "modern.exe" reference from Uninstall section. There is no such file. It was just part of an old example. E.g. mentioned here: http://forums.winamp.com/showthread.php?t=150064
3758ed979f Move 'FileOpen' command outside from the InstallRetry loop.
d64791a5ed Define a variable to hold a handle to the service-install.log file. Using $R7 was not clean, because it can be reused in different methods along the way. Append to the file, instead of overwriting it.
2434f9f8e3 Simplify logic
23aa6cc50e - SetOutPath creates the empty folders for us. Thus 'File /nonfatal' trick is not needed. - Simplify deletion patterns in the Uninstall section
423680ebd5 - Move SecMenu section back to its place, but extract its code into a separate method. (The "components" page of the installer lists sections in the order they apprear in the script file). - Fix processing of tomcat-user.xml, server.xml broken by r1034926. Using 'ReserveFile' was not enough. A 'File' statement must be used as well. - Fix control type for the "password" field. - Simplify several logical expressions.
02b122342e Rename 'Service' section -> 'Service Startup' in the installer, to make its intent more clear. It is port of r451508 from TC 5.5
3da400952b Move server.xml and tomcat-users.xml to the top of the installer archive (aka reserving them).
813b2ee92d When installing on Windows, do not leave undeleted stale files in $TEMP/src/res/confinstall/
aef891cd68 Reimplemented the Windows installer GUI using nsDialogs and MUI2 libraries, instead of deprecated InstallOptions. The *.ini files are no more used. All is specified in the nsi script.
c523bb85c4 Revert r1031709 Parallel deployment implementation is changing as a result of discussion on the dev list and this re-ordering was specific to the previous implementation.
bb1feb3926 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50192 Improve performance for EL when running under a security manager. Based on a patch by Robert Goff.
8f6d14fac7 Additional tests and fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=49297 Duplicate attribute rules for the page directive are slightly different. Based on a patch by genspring
9fbd297856 Re-organise tests for bugs 49nnn
5329a4232d Organise
0c73c0f1fa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50230 Add new DistributedManager interface that is implemented by the Backup Manager to remove circular dependency between tomcat-catalina-ha and tomcat-catalina modules. Also allows third-party distributed Manager implementations to report full session information through the HTML Manager.
9caa89e60c Fix broken links
50f2b80554 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50252 Prevent ClassCastException when using a <ResourceLink>. Patch provided by Eiji Takahashi.
68691425b5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50183 BIO sender was not scheduling tasks to the executor during normal operation. Patch provided by Ariel.
c0f6faf206 Clean-up
fcdc831c01 Clean-up
e9721d9787 Clean-up
a5e166455d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50169 Ensure that when a Container is started that it doesn't try and register with the mapper unless its parent has already started. Patch provided by Eiji Takahashi.
fab5ff79f4 Consistency.
086c7da666 Update changelog
1fca944aca Restore the ability (via an option) to edit the contents of WEB-INF and META-INF via WebDAV
28030ac875 Remove unused function. Update changelog for r1027504, r1033856, r1033882.
8d6f0bd9c9 Improvement for r1027504 Read PE header from jvm.dll to autodetect the target CPU architecture
8c63801cd7 Typo / line-length
5f5d899074 Simpler code / fix Eclipse warnings
23a3b21b44 Fix Eclipse warnings
e2d08e15fe Folloup to 1027504: NSIS docs say that using relative offset in Goto does not play well with macros, because those may be expanded into several lines. Use a label instead.
faa8dc4d47 Followup to implementation of https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Use local variable instead of array access.
576c20fc5b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50222 Pin the system rather than the common class loader in memory which will work better in an embedded environment.
59d3bf7888 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50242 Provide sample log4j config that is a closer match to the default config
9b442d8950 Update
133ac816bc Fix Eclipse warnings
f1541af06b Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Need to store headers in a separate buffer - the contents of the read buffer may not be static for the life of the request
986e633f06 kkolinko's additional test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Test for correct handling if read buffer is filled and then re-used
a1bc645903 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50184 Add an option to the RpcChannel to enable the Channel send options to be set for the reply message. Based on a patch by Ariel.
4f6f0cd69a Fix warnings
13b7cb5f36 Suppress warnings
a8b6c8d45c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50232 Remove dependency between StoreBase and PersistentManager and associated code clean-up. Patch provided by Tiago Batista.
52c6f57c45 Fix infinite loop reported on users list
6c92884119 Link to the local copy of documentatin (as in other places on the page).
c3580bc530 Write attribute names in bold.
9506d3d634 Remove obsolete link
01645e32c1 Align documents list with the menu. Two of them were missing from the list, but present on the menu.
71def0db41 changelog for r1032232
64971199e1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50228 Clear the reference to a writer when BodyContentImpl is recycled.
27596027d6 Parallel deployment Additional Context.get[Name|Path]() clean up
bf080400e0 Parallel deployment Re-order postParseRequest in preparation for patch that does the real parallel deployment work The order may look a little odd now, all will be clear with the patch
a32f250ac5 Parallel deployment Additional Context.get[Name|Path]() clean up
b5e3ce5f0e Parallel deployment Additional Context.get[Name|Path]() clean up
3da3dacde0 Remove unused method
db47dca98b Make attribute enabled changeable via JMX at AccessLogValve
63ff1b8740 BZ50219: Fix typo in jndi-resources-howto.xml.
3791e49ce5 https://issues.apache.org/bugzilla/show_bug.cgi?id=50168 Add a DESTROYING state and associated events and use them to ensure Contexts are only destroyed once.
cfd4655a13 Use the local copy of the docs
1a38166bad Typos.
bdb480794b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50127 Also fix all the other Eclipse warnings
fe1519b78e https://issues.apache.org/bugzilla/show_bug.cgi?id=50159 Add a new attribute for <Resource> elements, singleton that controls whether or not a new object is created every time a JNDI lookup is performed to obtain the resource. The default value is true, which will return the same instance of the resource in every JNDI lookup.
5e1b53f7da List bugs in numerical order
33ec4f4684 Allow for configest
77c11530f2 Ensure embedded jars contain all the necessary classes Re-order things so it is easier to check all are present
0663e8bcda Typos
cb999794ad Typos
89a11fa555 Improve handling of nulls in StandardEngine.logAccess()
e1d53d4d85 Log the right JSP.
8867eac719 Add logging and JMX support to JSP unloading.
2cde3a492a Fix some MBean descriptors: - "asyncSupported" needs is="true" for Valves - "containerName" is gone in valves since r940802 - "enabled" uses "get" instead of "is"
696cceb247 Fix MBean description.
cd6169abc2 The jspFile attribute is no longer available in the StandardWrapper as of r1003589.
be07446554 Review comment from kkolinko Make sure we initialize StandardEngine.accessLog
c0b5c087b8 Make Tomcat more tolerant of nulls when generating JMX names for Valves.
b11b70b4a8 changelog update
d6a52bef94 bug 49180
e72be7e400 redesign of home page by Pid (pidster at apache )
9085e62a32 Parallel deployment Fix regression that broke WAR deployments
5cfd03eb0c Parallel deployment - More work separating Context.name & Context.path - Review use of Context.getName() and Context.getPath() and use the correct one - Start to add webappVersion property to Context (many components not version aware - e.g. Manager app) - Set version when deploying apps if version is specified - Include version in Context.name if version is specified - New ContextName util class to handle all path/name/version etc translations
e53d29d369 Remove space char from the end of a line
26cceff324 Parallel deployment Start to separate context.name and context.path Currently name==path but eventually name may include a version element but path will not.
e9dbb3c728 Make sure, we mention the unit "seconds" for jspIdleTimeout everywhere.
c921e09fee Document jspIdleTimeout.
8f7440f90f Add new JSP init parameter "jspIdleTimeout".
206d195921 We will no longer continuously update the jspQueue order. Instead only update each JSP once between background task runs.
5216868cf7 Changes to FastRemovalDequeue: - Make queue thread safe and remove external synchronisation - Provide maximal size to queue - Include size checking when adding entries - Return handle to displaced entries when queue overflows   while adding a new entry - Explicitely invalidate queue entries on removal by using   new field "valid"
8af1bc15a1 Simplify JSP limiter:
9efdb8d5ae Rearrange placement of JSP limter code in JSP servlet wrapper. Do everything in one place:
eacdaf2188 Improve Jsp limiter:
d7592232c1 for resourceOnlyServlets allow whitespace in the comma seperated list.
c8f5e40b72 Add changelog entry for r1005802 Also corrected a typo
655cf3db88 Use correct arguments for an error message in TagLibraryInfoImpl. It is a followup to r937791
a2c9832ad5 Missing closing tag
a7fa686c74 Add new feature
85444e7d25 Provide configuration option to work around new welcome file mapping requirements of section 10.10 Servlet 3.0 that break a lot of existing apps. The default configuration retains the current Tomcat 6.0.x behaviour. Enabling STRICT_SERVLET_COMPLILANCE enforces the new requirements by default. Includes test cases.
6c0c3f3ecf Move Entry to an inner class of FastRemovalDequeue.
a379d42769 Reduce visibility. All those are only needed by the Queue implementation, not by the consumer of the collection.
1426f12fe4 Overhaul JspQueue, no functional change for Jasper.
9cdd009b9c Remove unused code
169be3b566 Add changelog entry for r1027893
adf9cede20 Upgrade to latest released Daemon 1.0.4
529d129078 Fix the javadoc and Eclipse warnings
d660f3746b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50157 Ensure MapperListener is only added to a container object once. Also  - Improve debug logging for MapperListener registration.  - Expose names of LifecycleListeners and ContainerListers for StandardContext via JMX.
855d5fbf73 Update ready for next release
3574a1a7a7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50140 Don't ignore a user specified install directory on 64-bit platforms Allow 32-bit or 64-bit JVMs to be selected when installing on a 64-bit platform
0d2640d94c Align default with Context default
b388c0b302 Trivial typo
e676584fbc Staled is not a word
2b3b0b45ea Fix a couple of other typos
41d7a6f6de Fix numerous typos. Patch provide by Luke Meyer.
fc8f018368 Improve exception handling in PersistentManagerBase.
5b3675b69f Followup to r1026784 Print a stacktrace if an exception (e.g. IOException) happens when calling store.keys() and running under a security manager.
f7b5d461f5 Fix the Eclipse warnings
f6568dd905 Remove unused DummyRequest Move DummyResponse to tests where it is used
678cabf41b Fix Javadoc warnings reported by Buildbot
7140ee9918 Re-factor to avoid IDE warnings re possible nulls. Includes a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50129
a9701ffa62 Fair amount of clean-up. Add it to the changelog.
1d07c99363 Update changelog
b1885ebb6f Enable Checkstyle import checks
09d4f73b44 Allow Checkstyle's unused imports test to be used with the o.a.catalina.core package (remainder) Fix some Eclipse warnings
2e2310325b Allow Checkstyle's unused imports test to be used with the o.a.catalina.core package (partial) Fix some Eclipse warnings
6108136f5b Allow Checkstyle's unused imports test to be used with the o.a.catalina.core package (partial) Fix some Eclipse warnings
f04fc540a4 Allow Checkstyle's unused imports test to be used with the o.a.catalina.authenticator package
872a92bfb6 Code clean-up
f3717963c0 Allow Checkstyle's unused imports test to be used with the o.a.catalina.ha package Fix some Eclipse warnings
2acd530beb Allow Checkstyle's unused imports test to be used with the o.a.catalina.ha.authenticator package Fix Eclipse warnings
59e78ad4d2 Allow Checkstyle's unused imports test to be used with the o.a.catalina.loader package
85c4b50f7f Allow Checkstyle's unused imports test to be used with the o.a.catalina.mbeans package
ce15fc9cea Allow Checkstyle's unused imports test to be used with the o.a.catalina.startup package
8737214b22 Allow Checkstyle's unused imports test to be used with the o.a.catalina.realm package Fix some Eclipse warnings
c9b68730fc Avoid NPE Don't use exception.printStackTrace()
c78d2a2175 Allow Checkstyle's unused imports test to be used with the o.a.catalina.session package Fix some Eclipse warnings
4b0ae3fc57 Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
e11dea6ea0 Fix Eclipse warnings
a1020f6187 Allow Checkstyle's unused imports test to be used with the o.a.catalina package Fix Eclipse warnings
7fc322a699 Allow Checkstyle's unused imports test to be used with the o.a.catalina.valves package Fix some Eclipse warnings
0c8f552852 Allow Checkstyle's unused imports test to be used with the o.a.el package Fix Eclipse warnings
59cbf13f76 Fix Eclipse nags
1546aab93a Revert part of r1026157
4dc6762876 correct typos
9f0606d38c Add release date
07ea9bde78 Allow Checkstyle's unused imports test to be used with this class Fix some Eclipse warnings
f8e4fe32b8 Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
764a6a56fd Fix Eclipse warnings
5908b1fa02 Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
4f53b5fc96 Clean-up
67f61874df Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings Align modifyAttributes() with WARDirContext
4d6fb8b621 Fix Eclipse warnings
0194c711e8 Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
0e57cd9d0f Allow Checkstyle's unused imports test to be used with this class Fix Eclipse warnings
f86f291d17 Allow Checkstyle's unused imports test to be used with the o.a.tomcat.util classes
a741490fe4 Allow Checkstyle's unused imports test to be used with the api classes
e53f3c24e7 Allow Checkstyle's unused imports test to be used with the unit testcode
08d2c64fda Remove unused imports from webapps
eaaf086170 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50138 Fix threading issues
544530a8cc Improve sending an access message in DeltaManager. maxInactiveInterval of not Manager but the session is used. If maxInactiveInterval is negative, an access message is not sending.
f44856727c Add support for maxActiveSessions attributes to BackupManager.
e84ef81b5a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=4227 Update comments to indicate this is no longer an issue
3b29d20d3f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=3839 Provide a mechanism to gracefully handle the case where users book-mark the form login page or otherwise abuse the FORM authentication process. Based on a suggestion by Mark Morris.
41ba2a82cb Clean-up
f5c8e47c41 Clean-up
55788d2331 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49991 Ensure servlet request listeners are fired for the login and error pages during FORM authentication.
33ef7f9b75 Re-factor ServletRequestListener events with an eye to https://issues.apache.org/bugzilla/show_bug.cgi?id=49991 and any possible future changes in the Servlet spec
b15c1d7a8a Minor clean-up
e61f4a4a3c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50084 Handle the case where the PID file is readable/writeable but the directory is not
57d0ce2fcf Fix indents
e8f948139c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49297 Enforce the rules in the JSP specification for parsing the attributes of custom and standard actions that require that the attribute names are unique within an element and that there is whitespace before the attribute name. The whitespace test can be disabled by setting the system property <code>org.apache.jasper.compiler.Parser.STRICT_WHITESPACE</code> to <code>false</code>
5c79907149 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50107 When removing a Host via JMX, do not attempt to destroy the host's pipeline twice. Patch provided by Eiji Takahashi.
7fe6147bd9 Make private
6cb04823b8 Remove unused imports
9a0b934b4d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50105 Use Enum.name() rather than Enum.toString() in composite expressions
84866ca926 Comment typo
4830a94609 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=22965 Typos, formatting, etc Based on a patch by Yann Cébron
2a099d856f Update
e2e0239955 Messages displayed to the user in the Host Manager (text and HTML) should be based on the Locale of the user, not the server
e1dd0a7b07 Update
1aeb8daf4d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49426 Messages displayed to the user in the Manager (text and HTML) should be based on the Locale of the user, not the server
32820b5869 Fix Javadoc warnings
d2d8b4522f Bump version
6b5f1a1111 Update
60be9fdf12 Enhance fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50078 Make cache sizes configurable
a381ad49ec Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50078 Thread safety in EL caches. Patch provided by  Takayoshi Kimura
0c2d3ee1a7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50087 Catch ClassFormatErrors when scanning for annotations.
a6db0edd03 Avoid NPE triggered when running TCK tests
e68d50cde5 Typo
e4f08c7b99 Add some more info on CSRF protection for the manager and host manager applications
1bcf9f51c7 Improve recycling of processors in Http11NioProtocol
0e2dd87de6 Followup to r946230 Do not fine-format integer values in debug output.
2119f3329a Followup to r1022303 I think that releasing the socket should be done before passing it away to a poller.
69292fb466 Fix warnings
6fb3492e30 Testing in 6.0.x confirmed this is the same issue.
e79e005029 Better clean-up.
3c5d96af13 Update change-log
b955f8bd8d Fix reading the request line via NIO for slow clients (such as me typing via telnet). Need to treat each section of the request line (text or space) as a separate phase.
7ed34ac464 Add changelog entry for r1022120
cad9cac287 Ensure work dir attribute is made read-only CVE-2010-3718
8f9e2bbfe2 Typo
074038d3af Re-implement the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49428
50e38d95ac Revert r964780 that was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49428
00dde1ee64 Better fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49922 Revert my approach and go with patch suggested by heyoulin. Extend test cases
ab5e6cf2a1 Restore credits removed by r1003846
69d8b8e24d Stop async requests hanging - side effect of r1006358
bf86b40907 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50044 for NIO connector
50e25ee9be Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50044 for APR connector
cf347e4f7c Only call asyncPostProcess for async requests
9c754f45b2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50066 Fix building of recursive tag files when the file depends on a JAR file. Patch provided by Sylvain Laurent.
045dc3b67c Improve error handling in TLD processing and handle the case when there is no web.xml
3f881bf6fb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50063 Fix apps with meta-data complete returning 404s
988622e026 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50027 Avoid NPE on start when a Context is defined in server.xml with one or more JNDI resources.
097a1def8e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50059 Always make JAR resources available
28aa235a0a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50017 Code clean-up. No functional change. Patch provided by sebb
2f16259db1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50016 Re-factor isUserInRole() and login() / logout() methods to support JACC implementations and to improve encapsulation. Patch provided by David Jencks.
ea85f60236 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50015 Re-factor dynamic servlet security implementation to make extensions, such as JACC implementations, simpler. Patch provided by David Jencks.
d3b5b0735c Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48716 Don't call reset if the default LngManager is in use
d4d0279427 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50013 Correctly package classes from org.apache.tomcat.util.file and add the tomcat-util.jar to the class path for the Ant tasks. Based on a patch provided by Sylvain Laurent.
3ef9c51bf7 Update change log
03f910a333 Add test cases for: - https://issues.apache.org/bugzilla/show_bug.cgi?id=49994 - https://issues.apache.org/bugzilla/show_bug.cgi?id=23950 Based on the original test case for bug 23950 provided by Eli Miller
914f7b3bba Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49994 Lookup of JNDI references should return a new object instance each time
a89f833814 Minor fixes to DefaultServlet docs
7bb9f45d20 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49987 Fix thread safety issue with population of servlet context initialization parameters.
da5977266e Fix some failing tests. No regression in Tomcat/Jasper, just need to take account of changes in test framework.
7cc0b19ae0 Fix some failing tests. No regression in Tomcat/Jasper, just need to take account of changes in test framework.
78865aa9e0 Add latest fix
97944a5eb2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49986 Thread safety issues in JSP reload process. (timw)
ea90f376cc Fix warnings
22c72cd79e Add bug reference - looks like this one was reported and fixed independently.
c1c7339d94 Couple of updates.
a69a69d525 Fix import order
f7076bdd81 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49978 Don't try to create directories that already exist
4fba45a5fd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49972 Address potential thread safety issues.
8f89ae758b Set not maxThreads  but minSpareThreads to corePoolSize, if AbstractEndpoint.setMinSpareThreads is called.
56805fac86 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50054 Correctly handle the setting of minSpareThreads in AJP connector. Other attributes (acceptorThreadCount etc.) are correctly set by this fix.
7233d5f0f6 Setting native line encoding. No functional change
35922e34dc Adding license headers. No functional change
1bdbe4b931 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49957 Correct regression due to Lifecycle re-factoring that cleared all work directories (with compiled JSPs and persisted sessions) when Tomcat was stopped.
8e8a2a5777 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49956 Handle case when @Resource annotation uses the full JNDI name for a resource. Based on a patch by Gurkan Erdogdu.
bcbf8d8cb8 Fix indent
c4b7db3137 Whitespace police
a83468ae83 Fix comment typo Better error message when a SCL can not be added since the listeners have already been called.
6e6020a9d7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49952 Allow ServletContainerInitializers to add listeners to a web application. Patch provided by David Jencks.
767340e13c 7.0.3 not released. Missing license header in src file.
712a89b076 Colleague at $work reported issues path parameters and extension mapping so add some tests. Looks OK.
b18400ab55 Adding unit tests for DefaultServlet and WebdavServlet to test basic serving/mounting behaviour and protection of special paths
cee07a57fe Making TomcatBaseTest.getUrl() work for get requests that return 404 responses
005a7702fc Correcting JavaDoc for HTTP methods. No functional change
9dfec8d9c0 More fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 Calculating complete resource path when accessed via RequestDispatcher.include()
1d1e5d2468 Remove @SuppressWarnings that is no more needed
a883050f30 Amending the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49669 Do not depend on the deprecated class. Use reflection instead.
6d61310a37 Turn the commented out test code into a unit test.
eb59844977 Simplify. Path is stored in MapElement.name
bf8a374172 Make sure copyright year is replaced for root webapp
fb95ea43ed Make sure copyright year is replaced for root webapp
ccab718d5e typo
3b0f17fd07 Correct fix fot 49669
39dd119cb5 Updating changelog with fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026
0cd83a3086 Add missing AL2 header
6ec70b306a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49945 More JMX improvements. Patch provided by Chamith Buddhika.
d172724a62 More fixes for https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 Calculating path prefix used in listings correctly so links in listings produced by WebdavServlet mounted to a subpath are correct.
14da8e13a5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 for WebdavServlet Factored checking of special WEB-INF and META-INF paths into service to trap requests for GET methods handled by DefaultServlet (which does not check access). Retained checking of special paths in handlers for copy, delete, move (copy + delete), and in enumeration of resources (propfind).
96c88b9c00 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50026 Always calculate path of resource to be served relative to the context root. This invokes the standard protection of WEB-INF and META-INF directories. This is a breaking change for the unofficial use of DefaultServlet to remount the webapp base under a new path.
f0d619becd Reduce code duplication. Convert file names to a context path in a single method.
8f0a8c49ac Remove duplicate method. Rename remaining method.
8b6d8d4a63 Remove todo for bad idea
48b339a9ff Use absolute time spend to unlockAccept and lower down the timeout to 30 secs
38501cc04e Mladen fixed 49923
40fbe3bf3c Fix 49923 by making sure timeouts can't be negative
df8251c292 Use better explanation
886d2afa1f Add log.warn if unlockAccept fails to wakeup the listening socket
9102f35c6f To avoid NoSuchMethodException, xmlValidation and xmlNamespaceAware are removed from the createStandardHost definition of mbeans-descriptors.xml. xmlValidation and xmlNamespaceAware are attributes of not Host but Contex.
37fa08b1b8 Simplify instantiating parent loggers. No need to instantiate all of them all at once since Logger.getLogger() will result in a call to this method.
7a2b72fe9d Tweak generics. fix a handful of warnings.
22890ac2ef Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49937 Use InstanceManager to create AsyncListeners so annotations are processed. Based on a patch by David Jencks.
5e0f4575fe ADd missing entry
6c92902118 Correct fix version. I think a few more of these need correcting. Checking now...
5de69839fe Improve handling of setting primitive values on beans.
7ba633ee67 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49922 Don't map filter twice if filter matches multiple mapping.
7d8985f803 Correct changelog entry for r1003923 7.0.3 was cut from r1003911, so this one will be in 7.0.4 as Mark noted in BZ Correct a typo in the bug number. It is BZ 49998
e1bfc44e92 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49998 Handle single quoted attributes in detection of jsp:root element in XML syntax JSP files.
a4dbece077 Bump version
0dd6b3b043 Fix NPE and TCK failures caused by previous fix for bug 49799.
9fbaf9d38d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49985 Make thread safe
75f670ca74 Revert r1003552 & r1003550 as it had a significant negative performance impact (orders of magnitude) on Windows during testing.
fd23a591e3 Create service-install.log file during installation with params that were used to invoke commons daemon
589868bbbc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49916 Switch to using an initialisation parameter to pass JSP file information from Catalina to Jasper. This simplifies the Catalina code as well as making it easier for Geronimo and others to integrate Jasper. Patch provided by David Jencks.
5c26bda0bd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49915 Make error more obvious, particularly when accessed via JConsole, if StandardServer.storeConfig() is called when there is no StoreConfig implementation present.
9bef079598 Update changelog
7e70c56a53 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49905 Prevent memory leak when using aysnc session replication
0974274d51 -e doesn't exist on Solaris
79559ab88e Add a TODO
b1e22fa7dd https://issues.apache.org/bugzilla/show_bug.cgi?id=49890 Detect when the JVM bug occurs and log an error asking for more information.
7c07a57c4d getKeyCount() didn't do anything due to local variable definition
1644e12cb2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49861 Don't use commas when logging RMI port values
3bf2ed1faf Fix Eclipse warnings
385a2a9dd1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49667 Ensure JDBC leak prevention code doesn't trigger the very memory leak it is meant to be fixing.
8c5725d33f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49860 Add support for trailing headers
2f6dd8bc44 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49856 Add an executorName attribute to Connectors so it is possible to trace ThreadPool to Connector to Executor via JMX.
272351c0bf Fix Eclipse warnings
199c739d56 Register and deregister Executors in JMX
8a14ea7864 Fix warnings in this package
dd1244c8f6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49730 Race condition in executor can lead to long delays in request processing
61d2b8893c Fix the root cause of the previous TCK failures (badly re-factored flush()) and restore the changes that were just working around the symptoms (poller stuff). Servlet 3.0 passes for the AJP/APR connector as of this commit.
7a32b0bb01 Fix remaining issues with AJP/APR and TCK. Note mod_jk log is full of warnings so there is still work to do here.
3d7ed6141c Fix some of the remaining issues with the AJP/APR connector post async refactoring. Still does not pass the TCK.
199bfb80d6 Avoid NPE when mapOwner is null.
59dc0861f0 Clean-up. No functional change.
67e4ea1864 Get AJP working after async refactoring. Some issues remain with AJP/APR connector which still has a handful of TCK failures.
906047838b Minor clean-up to align with AJP
9fc82cdad2 Tweak the refactoring
85f710eb5f Re-factor the async state machine into a separate class so it can be re-used for the AJP processors as well.
27b656b1d5 Rename local variable to make code clearer
28152491ec Refactor logging
5411f979ff Reduce code duplication in the APR connectors (prior to aligning with the Async refactoring)
c06f4694ab Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=50021 Don't reference ExceptionUtisl from Bootstrap - it won't be visible at startup.
b4270c3ac4 Fix error in fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Should use ExcpetionUtils from o.a.tomcat.util, not o.a.jasper.util Fixed with the help of Eclipe's organise imports that also removed a few unused imports.
c6f166ec38 Correct a typo in message
deda815a76 https://issues.apache.org/bugzilla/show_bug.cgi?id=50018 Minor javadoc corrections in Jasper.
743fa7b249 Be consistent with CATALINA_PID quoting and always redirect all streams to /dev/null cause we are interested only in return value
2a68b4ffa9 More review comments form mturk. Tighten up handling of ps output.
195bff3690 Respond to mturk's review. Make rm  more robust. Avoid potential issues with (...).
a2d3e18c70 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49195 Avoid error message when shutting down Windows service when the shutdown port is disabled.
540e055208 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49665 Better handling for missing TLD files. Report JSP filename and location.
5b412bf70d Update
a6c635140c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49728 Improve PID file handling, particularly when another process creates it and Tomcat is unable to write to the file.
4d78de63f4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49657 Correctly handle CGI executables with spaces in the name/path
bd8b9d031f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49625 Ensure Vary header is set if response may be compressed rather than only setting it if it is compressed.
dd765b8ae0 Add license header
69aff2d84f Moved all Eclipse specific files into res/ide-support/eclipse. Removed spaces from launch target filenames. Corrected launch targets to run in output/build instead of root directory (still not sure if they're a good idea) Added an Ant ide-eclipse target to prepare the working copy to be built with Eclipse and create Eclipse project files. Updated the Building docs to document new Eclipse setup method. Added descriptions of how to configure Eclipse to respect Tomcat coding conventions to the Building guide.
fbc05a1d05 Adding myself to active devs list.
3fafe2fa53 Update
cd647a9340 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49209 Prevent possible AccessControlException during undeployment when running with a security manager Patch provided by Sylvain Laurent
b5d110141e Update
99e3ab08d2 Remaining fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
8129e13437 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
2684e5d1dc Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
3db79994a8 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
e1686490d0 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
613685bbf1 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
07bb96ee5a Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
c3810a3e55 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Some Throwables must always be re-thrown
b0c886c9e4 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Don't catch Throwable
443fe5dff9 Fix comment typo
c8da89796a Corrected a typo s/vesion/version/g
6612c37592 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49884
426be68811 Change method name so it is easier to distinguish between async and comet processing. No so important here since comet isn't supported, but need to change it to align with changes to be made in NIO and APR
d6dae65e44 Remove some unused code.
6b161f193b More NPE avoidance. Keep process methods aligned.
5d972edad9 Fix a handful of Eclipse warnings
9d0c43175a Since SocketStatus is always OPEN or TIMEOUT for BIO, remove the test.
8a224fd88f Add some Javadoc. Use SocketStatus.OPEN rather than STOP since the BIO connector treats them the same way and it reduces code complexity. It also simplifies async re-factoring I have in the works,
ab090c89d3 Better Javadoc. If endpoint is shutting down, return false so connection to client is closed immediately.
481face74f Clean-up. Reduce whitespace, unnecessary comments
d4a4022435 Tab police
3db7457ca7 Fixing Tomcat startup class in building instructions.
1a9dd15e38 Fix Bz #49993 by checking the JAVA_HOME/JRE_HOME environment variables
87fdb46802 Reduce timeout from 60s to 3s to speed up async tests
792346d0a6 Add a comment. I guess it is too late to change it now, as the code is more than 3 years old.
ac37418032 Take care of line endings for the two files added in r1000392
7f282cd5c6 https://issues.apache.org/bugzilla/show_bug.cgi?id=49102
a99cf62a49 https://issues.apache.org/bugzilla/show_bug.cgi?id=49955
0b644b9778 Adding a description for build-docs task
8f3160a789 Fix Javadoc warnings highlighted by buildbot
1314b6d25f Parameterize the APR location for the unit tests
446a1021e6 Correctly define the ROOT context in unit tests
5451b82819 Add the missing onStartAsync event
0200030242 Improving the documentation for logging configuration in Apache Tomcat
b0a2bc80ec Fix typo
fdb105eaf9 Need ant-launcher.jar to compile JSPs with Ant rather than ECJ
61616158b4 Use *modern* types of nsis install/uninstall icons
47010ec9bb Add connector wait for shutdown to changelog
d87531fb5a Delete reference to option that was previously removed.
ce96c2a0c7 add release date for 7.0.2 beta, from announcement on tomcat.apache.org
6fcf466675 correct a typo
329eae3eec Remove unused code as identified by UCDetector
6f47431482 Remove unused constructor
6b9506c864 Re-factor JIO end point to look more like NIO end point. Moving stuff around, processing order should remain the same.
2c2a6a0285 Remove unused imports
8abb56b1aa More refactoring. This one very simple.
0226f215bb Code clean-up Use a single method for unlockAccept
25108675b0 Code clean-up Align end-point behaviours. Should then be easier to apply async chnages.
e0cdfbb35c Code clean-up. Align BIO and NIO to make Async refactoring easier
14c7e10e90 Nothing was reading this. Remove it. It can always be added back in later if we need it for something.
04b8573ed8 Also handle NPEs (seen during testing of new async re-factoring) and ignore them if the endpoint is shutting down.
2787729f77 Misc Eclipse and FindBugs warnings
3be8b84055 Remove unused import
3aad4b7a04 Remove unnecessary code. Superclass method does exactly the same thing.
3470227251 Code clean-up. Align BIO and NIO to make Async refactoring easier
ce4c5dd6b9 Remove more START/STOP actions and started attribute. They aren't adding anything.
0bc2f6591c Remove START/STOP actions and started attribute. They aren't adding anything.
a6f807c295 NIO and APR processors don't use START/STOP so this code is unnecessary
30e1d53ade Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49909 Re-enable JSTL. This was a regression in the fix for bz 47950
25a09e43c5 Remove empty dir
6c24d0f87d Fix niggle
7774751cee Include the suffix in the version number
38a2097d00 Fix Javadoc
02749d92dc Update changelog
92cefe4a4e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49584 Move the offering of a new thread on release from the abandoned connection code to the release code to eliminate the possibility of a blocked thread on release.
964c310353 Address a concern raised in https://issues.apache.org/bugzilla/show_bug.cgi?id=49584 Re-factor code to clarify con is never null when release is called.
f700d031a2 More re-factoring: AsyncContext will throw exception
2679f7e5a8 More re-factoring: expose the Executor
87762b13df More re-factoring prior to large async changes
c99e507978 Code clean-up and a little preparatory re-factoring prior to large async changes
a7ac60f205 Fix most of the warnings in this package
f6aeab1d29 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49924 When non-primary node changes into a primary node, make sure isPrimarySession is changed to true.
b9197f3d74 Add @Override markers to package
6867cabb47 Convert ActionCode to an enum. Shorten all the names by removing ACTION_ from the beginning. We have to use ActionCode.XXX to ACTION_ is just wasted screen space.
b821f3a258 Re-factoring the connectors. Remove large chunks of duplicated code in the Processors. Some minor changes elsewhere to support the re-factoring.
7b83311289 Code clean-up
59100c60bb Fix Eclipse warnings prior to working on bz49884 refactoring
187813b1fc Fix typos. Remove attributes that don't exist. Add a missing attribute.
09e93df8ba Further work for https://issues.apache.org/bugzilla/show_bug.cgi?id=49234 GSOC 2010. Enable the creation of Services, Engines, Connectors, Hosts and Contexts via JMX from a minimal server.xml that contains only a Server element. Based on a patch by Chamith Buddhika. I added the additional changes to pass the parent class loader down the hierarchy.
8ccce0ed04 Update commons pool to 1.5.5
1daff2a8e5 Update changelog
ad325219f4 Fix an issue where <Context .../> elements defined in server.xml did not use the configClass specified by the parent <Host .../> element
ecaee4ee27 Revert r996112. At least some of that config is required.
e53fabaaa2 Remove unnecessary digester configuration hostConfigClass and engineConfigClass were removed before 6.0.x
0251bfb70a Remove pointless comment. Schema validation moved to the context
2e1e2d605f Code clean up
b04e862689 Refactor log messages to use logger from concrete class
228fcf62bf Shorten the debug output
9642fb9ce5 Update change log
a26e81929d Trim whitespace from interceptor class names, property names and property values.
8fed81f8df Update changelog
c10bfc56b1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49892 Correct JNDI name for method resource injections Based on a patch by Gurkan Erdogdu
f9c06414eb Fix @Override warnings
0b2976b4fe Update changelog
e7b8bb0cbb Document new validation class (https://issues.apache.org/bugzilla/show_bug.cgi?id=48817) Patch provided by Matt Passell.
4bbf75d64b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49831 Make sure pooled XA connections are properly closed when the pool shuts down. Based on a patch by Daniel Mikusa.
677bba5deb Remove some unused code
4a7a9a1a0c Update changelog
656ac8d8c9 Update to latest Tomact 6.0.x and DBCP 1.3.x release
af154c284b Bring changelog up to date
06a2d47b92 Fix warnings in the host manager package
9ca4c77d93 Remove unused attributes. This all moved to Context.
e897153f51 Remove unused attributes. This all moved to Context.
97c791251c Additional debug logging to investigate https://issues.apache.org/bugzilla/show_bug.cgi?id=49884 - logs hashcodes for current request, coyote request and request processor - logs thread name - makes debug stack trace optional (enabled with trace level logging) - adds debug statements to additional methods
be00f91fbd Reduce visibility, remove unused/unnecessary methods prior to fixing bz49884
e4d32d83fa Add @Override to test code
db10404964 Avoid NPE when a parallel request invalidates the current session
53d35d2bd2 Couple of trivial Eclipse nags
7f1e5124b9 manager -> manager-script
3c1a7938a0 If a ping message fails, removed the failed members from the map rather than propagating the exception
2671c4f474 Extend fix for bz49883
92947c9daf Fix typo
7b9ad39b6b Switch to a JSP for the Tomcat home page and make the version numebr dynamic as the hard-coded version number in the static page can cause confusion in when using CATALINA_BASE and switching between multiple CATALINA_HOMEs
90a6624fdb git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@992981 13f79535-47bb-0310-9956-ffa450edef68
2fd0b2064c Misc code clean-up.
78726f7d05 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49883 Return a name for use in log messages rather than throwing an UnsupportedOperationException
562b546a69 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49802 Allow the connectors to be stopped via JMX.
cca215810c Make sure async timeout thread is stopped when the connector is stopped. Correct copy and pasted comment Also fix @Override warning for the method
d45d1c3e2e Make sure acceptor threads are stopped when the connector is stopped. Also fix @Override warnings for the method
7dfe4b186e Fix an Eclispe nag.
3f49bb5eee Remove debug code that was added in r991959
a5f9969136 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49865 Allow Tomcat to start if catalina.properties is not present
17e12c1bd9 Use shutdown instead close for hard closing the socket which is inside Socket.accept call
f0ffe99150 Hard close the accepting socket if unlockAccept failed
2cc49e6767 https://issues.apache.org/bugzilla/show_bug.cgi?id=49876 Generics warnings in the copied Apache Jakarta BCEL code. Based on a patch by Gábor. (markt)
97b4b3e622 Remove some unnecessary code and fix an Eclipse warning
6f5349bbeb White-space clean-up Reduce sequences of three or more blank lines to two blank lines
7d541a6117 Add @Override markers. Auto generated by Eclipse. Checked manually.
93c4d9220b Trace through some unused code and remove it.
4bfca43339 Update merge info
597807263e Sync with Jakarta. Add generated serialVersionUID's. Don't use the same values as Jakarta since the code has been structurally modified (to removed unused elements)
5a1f6882ac Keep MBean names consistent with Tomact 6.
d706762c1b Make destroy method returning when the worker thread finishes instead separately calling destroy followed by join
710d801ae6 Call join only for alive threads
ead0519246 Add wrapper over Socket.destroy which will make sure we don't call destory for sockets already closed by the parent pool cleanup
b78a1de364 Remove method that no longer exists
b2b34d6fae Expose current state of Lifecycle components via JMX beans (where a component has one). Mainly useful for monitoring web application status.
30c5ed903f BZ 49869: Javadoc Fix.
50d861e682 Join poller and sendfile threads on destroy. This requires to change the Poller and Sendile to Thread instead Runnable for simplicity.
51a7108a4d Make sure we exit the thread if not running. Otherwise the thread will block in run until the VM shuts down
01149943c7 Store the Acceptor instances in the array like we do for other threads
e0c79b3afc Trim trailing spaces. No functional change
1bf25a89c0 BZ 49865: ExceptionUtils throw NoClassDefFoundError during startup. Add TODO markers.
71364251f2 Followup to r991959.
3a03cf1b2d BZ 48967: Replace strings "catalina.base" and "catalina.home" by globally defined constants.
fb27257d3d Fix warnings
4d59c093c5 Update the Servlet, JSP & EL javadoc links and add spec links.
2611fcd518 Add a comment as a reminder
c1a1dcff31 Remove setting distributable on the Context from the docs. It gets lost on webapp reload() e.g. when triggered from the manager app.
efeb3ba01c Remove excludes for files no longer in source tree
d9d877cbc5 Re-factoring. Reduce code duplication. More still to be done.
5d288a23ab Re-factoring. Preparing for Http11AprProtocol to extend AbstractHttp11Protocol
965ba9c0da Clean-up
b244494601 Some Lifecycle clean-up
51442b17d6 Fix warnings
9c363282a1 Fix warnings
edb23cb953 Clean-up unused attributes
1c29c40f6c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49799 The new omit< attribute for <jsp:attribute .../> elements now supports the use of expressions and expression language.
ecccc5f211 Remove some unused code
91536e9be9 Fix likely cause of Gump failure. Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49698 in r990342 was incomplete
c07736026b Fix warnings
3de9f7b3fa Remove the debug logging since we got to the bottom of this failure a while ago.
78d448862d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49698 Allow listeners to call complete when a async request times out Add a test case based on pero's previous timeout test case
2e63ff1a4f BZ49828: Remove deprecated J2SE/J2EE terminology and replace links to Sun with links to Oracle (for those Oracle links that look static).
159a35edf4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38113
822c3993eb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49749
a40221d4f9 Trivial code clean-up
530fb117f6 Minor clean-up. Merge methods.
e80959151e Simplify APR version requirement checks by calculating compound versions and doing a simple compare
9209f2685e Remove empty package
1e91ce75ac Fix memory leak on context stop
2763a39cf2 Fix some edge cases in the NIO connector when handling requests that are not received all at the same time and the socket needs to be returned to the poller. This should fix the current Gump failures in the NIO tests.
2949028f62 Fix logger visibility
b5a2ec44d4 Notes on a couple more checks
820a676b30 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48738 Workaround a couple of long standing JDK bugs to enable GZIP compressed output streams to be flushed. Based on a patch provided by Jiong Wang.
745d71f5c4 Correctly handle anchors in URLs with the CSRF prevention filter.
a08a967c57 Fix typo
8cf0e9d55c Remove methods already defined by Container
f334eadafa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49669 Another Java class triggering a memory leak. This time javax.security.auth.Policy
c2f70905e5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49670 Fix SSO - broken by Lifecycle refactoring
d259fdb51c Update changelog
77f03cfcd7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49721 All JARs can be resource JARs. Although the spec defines no order, use ordered JARs in order then the remaining JARs in any order.
fc6ccf8280 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49726 Specifying a default content type via a JSP property group should not prevent a page from setting some other content type Includes test cases
c6df001cdc Fix the Eclipse warnings in o.a.c.loader
5c2cf9ffad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49750 Align WebappClassLoader.validate() implementation with Javadoc and ensure that javax.servlet.* classes can not be loaded by a WebappClassLoader instance. Patch provided by pid.
aaafcf5ce1 Fix Gump build
2acefbd810 Add support for LAST_ACCESS_AT_START system property to DeltaSession.
784ce7ee25 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49758 Fix generics warnings exposed by a fix in Eclipse 3.6. Patch provided by sebb.
6860802930 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49779 Improve handling of POST requests and FORM authentication, particularly when the user agent responds to the 302 response by repeating the POST request including a request body. Any request body provided at this point is now swallowed. Clean up the FormAuthenticator test case and extend the coverage to include bug 49779 and the remaining combinations of request methods.
134e1c6dfa Correct test name since this turned out to be a side issue
f0cea53852 Provide 100 Continue responses if required during FORM authentication Side issues from investigating https://issues.apache.org/bugzilla/show_bug.cgi?id=49779
c12ff5e007 Add support for parsing a session ID and the 100-continue expectation
a80cbba0cb Extend the simple MapRealm use for testing to support roles.
30fdc6d96a Code clean-up. No functional change. Extend Checkstyle checks to import order. Use Eclipse tooling to fix current code base.
b6d8948cad Fix tpyos.
d110ca6d58 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49757 Correct generics warnings and a couple of other warnings whilst I had the files open. Based on a patch by Gábor
70413c0f9f Fix import ordering - no functional change  -javax.* packages
55a86850f6 Update changelog
d21cbdbc09 Fix POM reference error ID'd on users list
f9879737e3 Add a message to the exception
f8d993868d Link the MBeanFactory to the Server that creates it as some MBeanFactory methods need the container to be set.
13db0b5c57 Fix spec version numbers in comments
404eee4df0 Correct a typo
e1ddf16055 Small fixes to TC 7 build docs:
def30fa761 Fix broken docs link.
f3b22ed37f Enable off-line building of extrsa - moves commons-logging libs to standard Tomcat lib download process
dd3513904e No need for autoconf
48880f3210 Add Null check when CHANGE_SESSION_ID message received.
5f23dbaa79 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49714 The annotation process of Jar doesn't influence distributable element of web.xml.
f517375899 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48817 Add Validator interface and allow users to configure a Validator class name
8bba3790f4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49585 Update for changes in Commons Daemon packaging
918d4cc649 Extend fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48545 to aid back-port to 6.0.x by better aligning behaviours
9a5bb63d3b Code clean up in o.a.t.until.net.jsse  - @Override  - import order  - unused code  - unnecessary code
766a36f4a9 Skip repackaged DBCP in validate target (Gump was running it). Any build where the deps are downloaded inside the svn checkout would fail in a similar manner
c702bfb329 Couple more whitespace checks. In both cases went with the nospace option since that is what the majority of the current code uses
7d836e3549 Tried to add GenericWhitespace test - has to be disabled due to a bug
93ab41a20e Remove redundant imports  (Bugzilla was down)
aac1162dfe Extend checkstyle to include checking * imports Fix all current * imports Fix a few other issues along the way  - Missing @Override  - serialVersionUID
8405d04b49 Fix Eclipse warnings in webapps
f436d21cb3 - Remove duplicate entry - Fix typo
87a4ef3909 Let's be more explicit in logging, what the actual jar file is.
c09e2004e0 Move stuff that didn't make the 7.0.2 tag
f04a9c5128 Update the changelog
d668763c6d Fix class name of default jar scanner in docs.
d00da75e4d Remove domainReplication attribute from ClusterManager.
fc0f6c848a Add default --PidFile (new with daemon 1.0.3)
175991b8e3 Use new admin-gui and manager-gui roles for the user
2aa791bb78 Bump version number
db47654201 Spread out some glob patterns for the commons JARs in jarsToSkip.
63faff88a6 - clean up Javadoc of new class - localize log messages - remove unused imports and members
34879004bf Allow glob patterns in the jarsToSkip configuration and add some debug logging to the jar scanner.
9226ece171 Add SKIP_IDENTIFIER_CHECK system property to control checking of EL expressions
62b14033a4 Further places where our JDT version is hard coded.
0d9f05f7dc Upgrade the Eclipse compiler
bba4b58a9d Fix typo
f091f84b1e Fix multiple copies of RUNNING.txt in full-docs.tar.gz
297ea68224 Update changelog
b7d8c4de31 Provide Javadoc for Servlet, JSP & EL Provide external links to JAX-RPC Javadoc
9c994e8561 More Javadoc fixes that were missed earlier
3318ff6f71 Fix the remaining Javadocs except the external links to JAX-RPC
fd84771500 Update to commons-daemon 1.0.3
7253c0b3b6 Handful of Javadoc fixes
72867d48bd Correct Javadoc copy and paste error
f870817d73 Extend Checkstyle to most text files Fix tabs in remaining files
1788718dfe Tab police
a3eae823f0 Tab police
29fbf06655 Tab police
2357c25743 Tab police
0ffff456ce Tab police
074a0fb962 Tab police
1a5cbd0c8a Tab police
b96f5ac2c4 Tab police
8543b828ea Replace UTF section sign in Javadoc by HTML entity.
a8b1e4d687 Use source encoding ISO-8859-1 for javadoc just like we do for javac.
21a59b2a84 Javadocs fix: @returns -> @return.
562160c820 Javadocs fix: @Link -> @link
d7618aff73 Tab police
5feb282b3c Not ready for this check yet
3d27a23ad0 nit
c1dd8ffe1a Javadoc fixes
a232c60562 Fix running with a security manager
63fc66419b Fix svn properties: - java/org/apache/tomcat/util/http/fileupload/InvalidFileNameException.java   Removed mime-type and added eol-style and keywords.   Already pinged upstream about that.   Used the same keywords as the other files, slightly   different from TC conventions. - We should add tag, tagx, jspf, jspx to our eol-style   subversion configuration for native line endings.
8c47806cec Add an explicit test case for bug 49655
3a595abc8e Bump version post 7.0.1 tag
e3bda1fe37 Update packaged re-named Jakarta BCEL
e9f774ac9e Tab police
4a8c184021 Missed prop update
b799835482 Update to commons-fileupload 1.2.2
e90480647f Switch back to standard commons file-upload layout - simpler to merge updates. Part 2.
803236225a Switch back to standard commons file-upload layout - simpler to merge updates. Part 1.
bbd430beb4 Revert r966596 - pollTime is in microseconds, wait is in milliseconds Add an additional wait that prevents a JVM crash on shutdown detected in TestAsyncContextImpl tests
da9213dcd8 Fix possible threading issue in unit tests. Adding some Thread.sleep() calls in the right place can cause the tests to fail. This is probably one of the causes of the current Gump failures.
995decbb49 Add optional support to the HTML Manager application to display Proxy sessions. It is disabled by default.
f568fd009e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49407 Make BackupManager and DeltaManager handle primary and backup sessions consistently
2348e27b21 Enable the HTML Manager application to differentiate between primary & backup sessions. Both can be invalidated Attributes can be viewed in both Attributes can only be removed from primary sessions
e6440a4f85 Update the changelog with a note on the session manager refactoring
cba29aba01 Follow on to r980418 Need to move registration with context to ManagerBase too
330970afa9 Refactoring Change BackupManager to extend ClusterManagerBase rather than StandardManager - The functionality being inherited from StandardManager (persistence over restart) was being bypassed - Further reduces code duplication, mainly in BackupManager
36c7da419d Refactoring Move propertyChange() implementation to ManagerBase to reduce code duplication
54c01c420c Refactoring - reduce duplication Handle maxActiveSessions, rejectedSessions and processingTime in ManagerBase
3bbfa06f87 Revert part of r980399 - attribute is present and used in ManagerBase so will be inherited
f81975f4e3 Fix an Eclipse nag
8c73738cf4 Remove deprecated method
aeab7bd8b7 Rejected session count should not be writable
26316c4caf Remove unused property
8f10f1617e Remove deprecated defaultMode attribute Clarify current behaviour of maxActiveSessions Clean-up cluster-manager docs
b169f655ae Remove unused SimpleTcpReplicationManager and associated ReplicatedSession
4e36d62227 Fix copy/paste typo
ad5e2976d0 Make life easier when debugging failing tests
dea2ea9df8 Fix a failing test with the APR connector. Handle async requests that timeout.
48009d5e56 Reduce log level for debug messages from error to debug
54aa330b13 Only download Checkstyle if it is going to be used Add note the Checkstyle is LGPL Add option (off by default) to fail test target as soon as one test fails.
983066fdf3 More unit test fixes - better handling when APR/native connector is not started
f7be388f74 Code clean-up Remove deps on o.a.catalina Fix a couple of Eclipse nags
03c6671364 Fix unit test failure. Ignore exceptions when destroying APR connector if APR was never initialised.
497ce59222 Fix unit test failure with APR. SSL renegotiation will not work by default for this connector.
96c36ea9a2 Fix unit test failure with APR connector. Make sure MBeans are de-registered when connector stops.
6eb2f13633 Only need to wait a single pollTime, not one pollTime for each poller.
18b4bfcfce Prevent JVM crashes caused by shutting down the APR library too early.
8f91c9820f Provide control over which connectors are used to run tests - helpful when (as now) only one of the connectors has issues
69c233dd3c Update changelog
a75ec407fe reverting, since 1.8 requires an indirect
f00ac6126b no reason to do indirect here
7bced51d0f Add additional tests known to pass - list provided by Marc Guillemot.
f227f3fcef Remainder of tabs to spaces changes Enable check in checkstyle config
7609f9afd2 Ignore config for checkstyle Eclipse plugin
42f72c283c Extend checks to webapps Tab police for /test and /webapps
dc4f60603a Check the tests too.
7de96ef14d More tab police
2ec96e1ff1 Tab police in org.apache.catalina
a2c9a7c6ec Update to require Ant 1.8.x+ to take advantage of the new property expansion for if/unless and then use it control if the validate code is executed.
9790fb5016 More tab police - misc packages
1845526871 More tab police - javax.servlet.jsp
9bce19235c Tab police: javax.servlet.http Thanks to Checkstyle and Eclipse source formatting
a362580b7f Tab police: javax.servlet (remainder - not sub-packages) Thanks to Checkstyle and Eclipse source formatting
f80004d8d5 Handle the edge cases where resources packaged in JARs have names that start with a single quote character or a double quote character.
3047f29d39 Fix the paths used for JAR resources
f6dc301860 Revert part of previous clean-up. Jar needs to remain open
fa09c44cf8 Code clean-up. Fix Eclipse warnings. Implement TODOs.
a6087e4e00 Tab police: javax.servlet (partial) Thanks to Checkstyle and Eclipse source formatting
8834f0a0d7 Tab police: javax.el Thanks to Checkstyle
43fef449fc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49268 Add necessary plumbing to enable Checkstyle The config file is deliberately empty. The check will be uncommented once the source code has been fixed (~200 files contain tabs).
830c4af718 Use specific imports
a763a7f0ca Fix regression in previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49555 Use TCCL to load webapp classes
a9b5291a60 Fix copy/paste error
678267a434 Fix some Eclipse warnings, remove some implemented TODOs
ee70e0681c Implement some Servlet 3 TODOs
da3c6c0f55 Extend Lifecycle state machine so global listeners can start before everything else without impacting the context and TLD config listeners
15858e54ef Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49613 Improve performance for multiple calls to Request.getAttributeNames() when using SSL. Patch provided by Sampo Savolainen.
c2e44726ca Remove some TODOs that have been implemented
cd5041913c Run all unit tests will all connectors
762fc28d58 Poll time and wait are both in milliseconds
04d61a1b40 Fix possible NPE
fae7bb880d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49567 Better handling of calls to complete() from a separate thread. There are still a handful of TODOs around this which will follow shortly but I'm committing this since it passes the unit tests and the Servlet TCK (with BIO)
91c6376741 Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49600 Based on a patch by Marc Guillemot
58f704c35d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49600 Return a consistent exception for 'Not Found' resources.
00e89ecb79 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49617 Correct the ExpiresFilter documentation after changes to the submitted patch
cf51066202 Return copies of the URL array rather than the original. This facilitated CVE-2010-1622 although the root cause was in the Spring Framework. Returning a copy in this case seems like a good idea.
abff3927bb Correct explanation. mapSendOptions=6 is synchronous, not asynchronous.
96ac67f840 Add note about message processing order.
4a6a57c6de Eclipse sample files need to have correct (platform specific) line endings in src distributions.
770df1b305 Restore pero's timeout fix for the BIO connector. Add configuration of the timeout.
2c82c92a37 Trivial - align comment
5fee13e2b1 Expose executor. Required so Servlet 3 Async implementation can use the container thread pool when a new thread needs to be dispatched. (e.g. from AsyncContext.start(Runnable)
9f9612fe82 Clean-up. No functional change.
3b39da14fc Remove unused code
9f99a6b386 Make the bean Serializable so I can use the example to test/demo session persistence on restart Add required getters/setters Indent using 4 spaces Fix FindBugs warning
3244a6ceaf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49428 Add a work-around for the known namespace issues for some Microsoft WebDAV clients. Patch provided by Panagiotis Astithas.
2a3880902d As suggested on the users list, add redirects to the HTML interface to the root of the host-manager and manager applications
e333082cf1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49598 When updating the session cookie header, actually update it rather than adding a new header without a name.
ffaf7fed1d Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49598 Multiple invalid session cookies
48ef56577d Remove the ExpiresActive option. Just comment it out if you don't want to use it.
6e4d77cc2d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48998 Add the ExpiresFilter, a port of mod_expires Patch provided by Cyrille Le Clerc
ca64b95852 Fxi https://issues.apache.org/bugzilla/show_bug.cgi?id=49127 Don't swallow exceptions unnecessarily
6c2690ce65 Fxi https://issues.apache.org/bugzilla/show_bug.cgi?id=49128 Don't swallow exceptions unnecessarily
7678605d44 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49130 Better describe the core package Patch provided by sebb.
910a679afa Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49182 Align setclasspath comments with reality. Based on a patch provided by sebb.
30ca4cd867 Add myself to the list.
9f38149a03 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48960 Disable exec by default in SSI and provide an option to enable it for both  Servlet and Filter
1719488921 Sign the pom. Make sure source jar signature doesn't overwrite the non-source jar signature.
8157797595 Avoid NullPointerException, when copyXML=true and META-INF/context.xml does not exist.
557fffe779 Hard code the snapshot version for 7.0. 7.0-SNAPSHOT will always point to the latest snapshot. I'll clean out the snapshot repo before I do the next update
f93767bd14 Prepare for the next release
60f15a4f9a Make the fix for bug 49555 more robust
15ada9bc71 Remove unnecessary code since Class.getCanonicalName() is available
b7a1109991 Eclipse warnings for annotations
10d2d19944 javax.mail is a dummy implementation - mark it as such to stop Eclipse complaining about empty methods and unused parameters
220befc1e7 Trivial cleanup no functional change
c71dbfbfa1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49442 Trivial code clean-up. No functional change. Based on a patch provided by Sebb.
c77f2c4e76 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49478 Add support for user specified character sets to the AddDefaultCharsetFilter. Based on a patch by Felix Schumacher.
93de0eac2f Typo
db2f7c759d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49570 When using the example compression filter, set the Vary header on compressed responses
5d3e3cc94f Make the random source used for nonces user configurable
ecb4f11fb1 Align implementation with docs. nonceCacheSize should be configurable
1a118abd30 Add CVE-2010-2227 test case
54101eb8fe Improve CSRF protection filter by using SecureRandom rather than Random
355244eff3 Align docs with reality
dce6c6fdca Add release date
d0723f239c Documentation improvements: - Explicit version number in <title ../> - Add version and date to every page - Remove duplicate "Apache Tomcat 7" and promote real page title - Automate copyright end date
c9b4688d70 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48297 Use the HandlerInfo to initialise the HandlerChain, rather than adding to it which clearly isn't correct. From looking at the javadoc, I believe this is the fix required but I don't have a test case.
bdce8db591 GSOC 2010. Continue work to align MBean descriptors with reality. Patch provided by Chamith Buddhika.
29b65288c4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49555 Correctly handle tag libraries that use functions defined in static inner classes
978f588b39 Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49555 Fix to follow shortly
88e7626f5f Tab police
e143c23b12 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49503 Revert the protocol handler component of r940656. Subsequent lifecycle fixes have resolved the issues that required this change
c654fec802 Update post release of 7.0.0 beta
707a99e174 Include session ID in error message logged when trying to set an attribute on an invalid session.
7f7a88db0d Improve logging of unhandled servlet exceptions by including the context name. For JasperExceptions, the JSP snippet will be logged (if enabled). Previously this was not logged and only displayed in the error page seen by the user.
946ccc565e Fix some Eclipse warnings
bd456e7c84 Better error message
af446598cc Improve fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49217 Make sure identifiers meet the requirements of the JLS
fdc69cf15a Side effect of fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=49217 Make the examples and the unit tests spec compliant
a084c1c5c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49217 Prevent use of Java keywords in identifiers
21cb2591f2 Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49217
d335536c65 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49551 Allow default context.xml file to be specified using an absolute path.
a7ae631742 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49550 Trivial code clean up
7daaf2f70c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49528 Previous fix was incomplete. Improve test case and fix TCK and test cases pass with this patch
ba807fb458 Clean up
f1fb011e2e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49528 AsyncContext.start() uses an internal dispatch but this should not have the same side-effects as calling dispatch() TCK and test cases passes with this patch
6a536949ee Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49528
771884d7f6 Remove *.rtf from fixcrlf patternset.
9c23bb4777 Revert r958362, r960083, r958406, r960069. r958362 broke the TCK tests and the other commits were sufficiently tightly coupled to it that it was easier to revert all of them than try to unpick them.
e60d8a1b82 Revert r960283, r960316, r960318. r960283 broke the spec and the other commits were sufficiently tightly coupled to it that it was easier to revert all of them than try to unpick them.
813cbb0644 no functional change. reformating and fix some checkstyle warnings
a34ca403f3 Fix indentation...
d22f3bd484 Fix NPE and add small test case to check VirtualWebappLoader.
737a55db47 Fix Bug 49528 - HttpServletRequest.isAsyncStarted() returns false when a Runnable is started Add isDebugEnabled statements.
50e0b305ab A few more FindBugs issues
5c94bd0ada Fix FindBugs niggle
6dac71083b Test NIO AsyncListener timeout.
c03896f343 Further MBean improvements. Patch provided by chamith buddhika
d7e57ec936 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49530 Make sure children are stopped if they are running when the parent stops.
3bf21e2d62 Make new timeout thread a daemon thread so Tomcat will shutdown properly
2ab8e26f76 Additional debug logging for manager selection
266dbf30a2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49536 Ensure a 404 response for an unmapped request when no ROOT context is deployed. Most of the change is getting the mapper to use the Host object rather than the ObjectName or an empty string
cb46bce765 Fix typo
395ca6595e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49525 Cookies for ROOT context need a path of /
55ac875942 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49522 Just use host and path in NamingResources MBean name rather than full Context MBean name
efcccc445a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49518 Correct typo
71748589d9 Improve default security settings. Enable the LockOutRealm by default.
15563cae41 Improve handling for method invocation in EL, in particular the method used to identify the method to invoke. This reverts r953440 and implements a more comprehensive solution. The method identification code attempts to mimic how the Java compiler works. In a few cases it finds methods where the Java complier reports an ambiguous method. The EL spec is sufficiently vague on method selection that I don't think this will be an issue.
f608f33b84 Re-factor to make upcoming changes easier to understand
6752f7f18d Correct broken link on the index.html page of the jsp examples.
4c2bd7fae8 Fix typo
692608fc18 Arrange filter logic. This is the fix for CVE-2010-2227.
026d6d2900 Implement support for using *.jar pattern in VirtualWebappLoader to specify all JAR files in a certain directory.
5a7475283f remove second fix entry. Sorry!
db33198237 Start JioEndpoint timeout thread, to handle timeout a AsyncListener.
283e834532 Simplify code
89a3f90750 Better way to keep Eclipse happy
3572a182e8 Fix some Eclispe / Findbugs warnings
077887d8cd Remove unused code
87cc90dfb6 Improve fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49414 Just look for presence of CoyoteAdapter class
ee6c1303fd Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49030 When initializing/starting/stopping connectors and one of them fails, do not ignore the others.
0982d982d0 Update changelog
2d773f6bf3 Add a check of the edge cases for bug 49488. As expected, they all pass.
d83c738ad8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49414 Try to differentiate between request threads and threads started by applications
a95d9284dc Switch the Host Manager app to the generic CSRF protection Don't allow starting of hosts that are started Don't allow stopping of hosts that are stopped
f779137016 Clean-up
4fdf6440e2 Typos
5132b6c951 Fix the Eclipse warnings and as a result better handle directory creation failures
9f21dc6e1b Remove unneeded classcasts
445a605d2d Must get in the habit of updating the 7.0.x changelog
4f5ceece82 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49476 CSRF protection was preventing access to session expiration features Also: - Switch Manager app to generic CSRF protection - Add support for multiple nonces to CSRF filter - Improve 403 page - Don't open JSP pages in session expiration in a new window - makes CSRF prevention a real pain
650292eb94 Trim the value before adding to the list Review feedback from kkolinko
1dee35067c Improve the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49230 Don't log an error about loading Sun class on non-Sun JVMs. Use i18n for message.
ac614a39ed Fix some old copy/paste errors
21bf1f21f4 Add fix of 49475
6908e72173 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49475 Use new role name for manager app access
074c9358a5 https://issues.apache.org/bugzilla/show_bug.cgi?id=49122 Update ROOT's index page Patch provided by pid
be3380315e Update version number
03257fab94 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49230 Enhance JRE leak prevention listener with protection for the keep-alive thread started by sun.net.www.http.HttpClient Patch provided by Rob Kooper.
66badc6079 Add useful test JSP. Not used in unit tests yet but I expect to use it in later commits.
38b8027f5d Add support for additional 500 error codes. Allow responses to include blank lines
cf117ce0fa Reduce code duplication in connectors: Move initializeFilters()to base class
ffee83b221 Fix Eclipse warnings in this package. No functional change.
bc26ecf9fb Reduce code duplication in connectors: Move addFilter() and addInputFilter() to base class
cb9b077f8c Reduce code duplication in connectors: Use AbstractOutputBuffer with APR/native connector
bb5cae170f Reduce code duplication in connectors: Use AbstractInputBuffer with APR/native connector
eea48b859c Add entryPoint support to the CSRF prevention filter.
2989df717b Alphabetical order
971e505d5a When using a Loader configured with searchExternalFirst="true" failure to find the class in an external repository should not prevent searching of the local repositories.
b0efb1dc9f Update changelog
fae0165471 Fix Gump failure
7b4f5fa521 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49443 Use remoteIp... rather then remoteIP... consistently
8523977cb8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49436 Correct default for UserDatabase's readonly attribute
2cdf467d8b Strictly speaking, the webapps are in ${catalina.base}, not .home, as well as it is shown by examples below those lines in the policy file.
6faa4c76e3 Update the doc. It is a followup to r954435
2bc7818768 Typo in previous fix for 44285
804db3faad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49445 The change in session ID is notified to other node.
97fc17fa91 Update changelog
4403953367 Remove an unused method
a482681bf2 Fix problem with JSF convertors - restore behaviour prior to r894720 that only checks a subsets of types for validity
a9a6e753ae Update changelog
fdb2e443e1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49213 Add permissions required by Manager application
f767d9f8a0 Previous cleanup missed one string
f076ad04df Cleanup. Make consistent, remove duplication, correct names.
1e15e75aa4 After deprecating the Embedded class, move the package access/protection initialisation to Catalina
722612d28a Remove all references to Jikes since it won't work on a 1.6 jdk
a2a446892b Modules are separate - should have own changelog etc.
5b8071b294 Update changelog
75ac4f9ee9 GSOC: MBean clean-up Patch provided by Chamith Buddhika
00f920c984 Fix an Eclipse warning
4699daa76a We already have the exact types. Don't try and derive them.
34a0f1eddc Test method invocation with super classes
5a6b4a1607 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49424 Avoid NPE if no input data is provided in a chunked POST request
b92ad0819a Test cases for bug49424 based on a patch by Earl Nolan
0ab3ca825f BZ49410: Missing tomcat-juli.jar in tool-wraper CLASSPATH.
12743c7a13 Cleanup JDT vs. ECJ:
f1fd1ae1e0 s/jre5/jre6/
d26cb39ff6 Remove unneeded phrase from a comment. It should be evident that someone should unwrap the line.
89b33f0378 Do not evaluate the "execute.installer" property, because it is never used in this build file: "skip.installer" is used instead.
47b7bf9473 Make 'info' fields in these classes static and final, like in other places in Tomcat.
db9a2f0710 Make constants final.
5aa9b54548 Remove unnecessary comment
20be5ca632 Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49372 Avoid invalid Lifecycle transitions on failed start due to already bound shutdown port
cc70365188 Make syncs consistent Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49372 Avoid invalid Lifecycle transitions on failed start due to already bound shutdown port
d7865b2b3c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49376 Correct package names in info properties
8f5fa1a21e Final part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New property LAST_ACCESS_AT_START
d16cad9ee8 Use the constant rather than re-reading
dc3b187a00 Additional fix required for http://svn.apache.org/viewvc?rev=951926&view=rev
ce047dd7ab correct a typo in a comment
67cbd7a020 Part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New WRAP_SAME_OBJECT property
9c77cf0e3c Copy/paste error. Sorry for the noise.
bb5f498dfd Typo
e17aad5576 Part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New GET_RESOURCE_REQUIRE_SLASH property
f17d7cbbe7 Part of refactoring STRICT_SERVLET_COMPLIANCE so it just changes defaults New ACCESS_SESSION property
64abc42326 Put the comment in the right place
2539e3f24c Use STRICT_SERVLET_COMPLIANCE to override the default for ACTIVITY_CHECK to align behaviour with other system properties
0218a17d6e Remove the warning. The bug reports received indicate that folks are using this, generally successfully.
70ddd6b26c Add AccessLog interface to JDBCAccessLog
6a5c0cb3ec Rearrange tomcat-juli permissions, for better readability.
35d9353124 Update in-document copy of the default catalina.policy file
eeaf86b499 Wrap long lines, so that this file could be copied to security-manager-howto.xml as is.
820c0743c3 Correct wording in a comment. It is a followup to r950596
94fc5a7833 Use provided parameter
c4a6dd6bec Remove code duplication by used abstract base class
20462f6560 Correct Javadoc Fix whitespace
7c4cc6ecf2 Started is only used in BIO connector
056a30906e Extend access logging to requests rejected in the Processors
23e9eaa6e8 Refactor the hooks from the CoyoteAdapter to the access logs - cleaner interface - handles AccessLogs at multiple levels (but not multiple AccessLogs per container)
371a8b415d Expand the common pattern as an example to users
14a112bf82 Enable access logs by default for 7.0.x
0573297593 Re-order so it is easier to check all objects are re-cycled
b5a0e8ba43 "this.channel.removeChannelListener(this.rpcChannel);" call is replaced with "this.rpcChannel.breakdown();".
dcf60cea78 Clean up FastHttpDateFormat initialisation when using a security manager as prompted by Konstantin
e9ba281fe3 Fix an Eclipse nag
4a1819201c Include major.minor version numbers into the name of the registry key used to autolaunch Tomcat Monitor at Windows startup. This allows Tomcat 7 monitor to be installed and run in parallel to the Tomcat 6 one.
c5b980b40f Prevent possible deadlocks in AprEndpoint.Poller and AprEndpoint.Sendfile, caused by missing Object.notify() wakeup, which is similar to https://issues.apache.org/bugzilla/show_bug.cgi?id=48843
48fde85e7c Followup to r950587 which was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49099 Fix lookup of the root context: its name is "", not "/".
652de91052 Followup to r948043 that was a fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49095 We should not use PrintWriter(OutputStream), because that implicitly uses the platform default charset. Specify the charset explicitly.
aa5775729e Add whitespace between words. It is trivial followup to r950164
864a9fe944 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49178 Using ${catalina.base}/lib will require an additional permission
d556891002 Improve comment
a66cd53709 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49099 Hooking the CoyoteAdaptor into the existing AccessLog wasn't as invasive as I feared so go that route to log requests rejected by the Adaptor before the request/response reaches the AcessLogValve
baf4607fc9 Fix Eclipse warnings in the o.a.c.tribes.test package
31322dc118 Fix test failure. Need to explicitly configure stopping timer threads
9aa575f763 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48971 Make stopping of TimerThreads optional and disabled by default
fb1949d826 Fix EL issue reported on users list by obtaining class information directly from the values rather than via getType() which is likely to return a more generic type that the actual type of the value.
4d2aee690e Add some checks that nulls are handled correctly.
0aade40803 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49345 Second parameter for new ValueReference should be property. There is no guarantee that the property will be the second child node.
32acc59521 Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49345 Fix to follow
b718505a81 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49360 Managers will be restarted on Context reload
d1ace5f472 It works (I fixed it for 6.0.20) but it still needs docs.
c03e331bad Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49340 Simplify the mapper listener registration/de-registration process
7d6b133671 Fix APR AJP logic.
ea3c045ae6 Extend to test deferred expressions. Need to use request scope attributes since page scope ones won't be visible to the tag file when evaluating the deferred expressions.
d1023d91b5 Fix for BZ49343. When ChannelException is thrown, remove listener from channel.
897512be65 GSOC 2010 Expose additional cluster attributes Patch provided by chamith buddhika
00aa928f81 GSOC 2010 Expose additional cluster attributes Patch provided by chamith buddhika
fc54581dae GSOC 2010 Add the container although it isn't much use yet. Patch provided by chamith buddhika
140ebb937e git-svn-id: https://svn.apache.org/repos/asf/tomcat/trunk@948248 13f79535-47bb-0310-9956-ffa450edef68
83a3dfa491 Make test more exact. Want to spot any change in the number of MBeans.
b88ea00b54 Restore the naming resource MBeans
e6e18093e5 Clean-up
4ad1e4268a Add missing classes.
94145182c9 Remove unused imports
95a50f6255 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49196 Avoid NPE on PageContext.getErrorData()
45852e9329 Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=49196 Patch to follow shortly
af8c385fbf Tabs to spaces
e7a42d31d4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49095 AprEndpoint does not wakeup accepts with deferred accept or BSD filters Based on a patch provided by Ruediger Pluem
430dff4515 Remove duplicate code
4dbb879a5b It would a lot of work to have it switchable in APR.
befa3af54f Missed 2 files - older version of the protocol, will update them when I get to the new proto.
94ecf71381 Matching test fixes. Seems to pass ( maven can be used, but will build/test against tomcat6 ).
061bbe1219 Various changes to better support coyote, remove integration package, prepare to replace jsse with apr, etc.
681ccd6aa7 More coyote support.
74aeb4e197 Moved the JSSE code to separate package. Added a bunch of workarounds to support harmony/android, there seems to be a problem with the ciphers. Probably the code will go away after I add APR support - too many problems, in particular SPDY can't be implemented as it relies on SSL protocol negotiation. For now it mostly works on android.
830fe2e220 Broken, not used. Source in o.a.t.util.buf was removed as well.
c0aad6f995 Remove the 'integration' - ObjectManager and wrapping of DI frameworks. Lite is just a library/connector - doesn't need it, instead will integrate it with existing tomcat JNI model. I may add it back for an example of using tomcat-lite standalone, but for now it's better to avoid confusion.
6d7d5a93f3 Removing the mini-'servlet' code from lite. The goal is to implement connector and http client, this creates confusion.
2bb7704f1f Correct a typo
32c166aa1a Fix some TCK failures with the BIO AJP connector when using a security manager
e43b846119 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48976 Document JAVA_ENDORSED_DIRS
45944a3fce According to Konstantin's review comments: - eliminate line breaks in descriptions - change capitalization of attribute from "uRLs" to   "URLs".
1f53a11b7b Restore -dev suffix post tag
f5dfdeafe8 Prep for RC3
f968471d3b Don't add HostConfig as a listener twice. It breaks the Manager app and probably other stuff too.
3fed8a3690 Align host-manager role names with manager role names. Add a 403 page to inform users of changed role name.
45d7b85624 Add a 403 page. If the user tries to use the old manager role, they'll get a 403.
7bacced6fa Tabs to 8 spaces. No functional change.
516c8e9fca Improvement suggested by Sebastian Bazley.
f192e7297b Tabs to 8 spaces. No functional change.
457df4af16 The SSL gets cleaned too.
40160cc9ae Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48840 Port the fix from catalina.sh to tool-wrapper.sh as well.
23a271cb2d Oops... Minor errors.
db3e2b5639 Arrange APR logic.
5ef037c51c Needed to test APR.
69acba1f0f Prevent core due to wrong synchronisation.
6a07d703d6 Add the certificate and key for the APR tests.
0f8e7cde47 Minor clean-up. Result is always converted to String so just do it once.
355b0e3301 Remove unused code identified by Eclipse
18993526f4 Fix lost session path parameter on redirect
d4abaf3e7b REpurpose the duplicate pathPath test to test the redirect process
8eb958dcc5 GSOC 2010: ResourceLink Patch provided by Chamith Buddhika
456387222b GSOC 2010: Further improvements to o.a.c.connector Patch provided by Chamith Buddhika
42549887ba Allow to test with APR.
d9402b32b2 Add method TomcatBaseTest#getTemporaryDirectory() Use mkdirs() to create tempDir directory in TomcatBaseTest#setUp() Fix issue with TestRegistration test failing when ${tomcat.output} ant property had non-default value.
c9c5cfc89a Complete correction of name
ec8bc463e7 Enable debug logging to investigate Gump failures
fe282cfaa2 Additional change required for debug logging
2a9c347735 Add some debug logging for investigating the Gump failures. I may remove it once those have been resolved.
b05e96e192 Corrent name
f96df4c8ce Typo in a comment
6deefe1fac Do not try to find compiled class files of test classes by looking directly into "known" places, but ask the classloader where it loads them from. This fixes test failure when ${tomcat.output} ant property has non-default value.
a95d5b649d Typo
946bb97928 Move encoding outside the loop
d6fd5fd226 revert r946149 Those "blank lines" must be there, because they separate sections of the manifest.
2020e3e18f Remove blank lines
9fb9b723b8 Sync Windows installer config files with 'normal' versions
40cefbeff6 Otherwise it will fail with java 1.6.0_18 +.
6fbcad20ac Clean-up
a371d93c7c Make Log and StringManager instances private to the class. This fixes: - messages for one class being logged via the logger of another - messages not being found since the class is in a different packager to the super class
6d17d28ea6 Fix Eclipse warnings, line-length
377d4b7e95 A simple testcase that prints version info
c1962bd889 re-add all-in-one testcase, in case if it matters for the failure that was observed by Gump
f735b2b2f4 Add missing keyword
89abae3bf3 Make list of user roles immutable Modify a copy in getRoles()
f484bd0673 Only redirect stdout
8825d730c4 Fix an Eclipse warning
dee7e5679b Document recompileOnFail
1c53aa5fa9 Clear results of SCI scan on reload
c0073a506a Only register the MapperListener once per component and remove it as soon as it is no longer required.
7087133813 Re-factor test to get a clearer idea of why Gump is failing
bc89fe39cc Do not abort testing after the first failure, but report about existence of failures after all the tests were run.
62c7f08667 Fix tests for a pure Ant run
a23c2b0f36 Fix Eclipse warnings. Reduce line length.
6b8025357b Simplify test
01895f69b3 Fix Eclipse warning in webapps
32f635a4e4 Return version to 7.0.0-dev
f9715a8682 Prepare for 7.0.0-RC2
79b236b111 Don't recommend a version that hasn't been released
e3a4709606 Fix a bug in ByteChunk.indexOf(String, ...)
a22f1e77b8 Tests for ByteChunk indexOf/find* methods.
a179fed6e3 Fix some Eclipse warnings
88870625d3 Remove the dependency on MBean notifications for the mapper Unit tests pass. Fixes an issue with the TCK and welcome files.
a868c5db04 cleanup code added in r945074
c6d5d375c4 More clean-up: - findCharXXX to findByteXXX - whitespace - make code consistent where possible
32f39ae167 Wrap debug message is usual tyest
9d9c1573fc Add some debug logging for state changes
04af57fe55 Correct example
1dc55c1aeb Align comment and example
b61109e516 Fix comments
ea8f8f492d findChar is inconsistent in that it only supports characters in the range 0-127 while all the other methods support all single byte characters. It isn't used within the Tomcat codebase. Make it's behaviour consistent with the other character search methods.
30f206f6af Improve comments, make param names consistent, clean up formatting. No functional change.
07a78d6f3b Revert r944918
5c971e4510 Refactor XML validation error handling. Error reporting in web.xml and web-fragment.xml now includes source info.
2602f621ca Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49299 Implement the requirements of section 7.1.1 of the Servlet 3.0 spec that require the path parameter to change name as well. Remove the option to set the default via a system property for the sake of simplicity.
9f9953faca Role name change. Be explicit about the URL that the role is used with.
941e18c9ec Code clean-up
6f31bcbf42 Code cleanup. No functional change
31fdba3bf3 Tabs -> 8 spaces Format long lines
e3c3a5a5c1 Code cleanup.
ad1f591c31 Minor code cleanup. No functional change
696ceffb29 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49290 Allow Tomcat to start when using a JarScanner with scanAllDirectories=true Patch by Larry Issacs (with minor tweaks)
a40b3e602d Fix auto-deploy issues caused by Lifecycle refactoring.
0ab71be8d3 Revert r944511
93ae934f02 List array elements in the JMX proxy output of the Manager application.
f6a3294650 TCK failures: Fix remaining failures with APR/native and a security Manager
51af8cd7f4 Check whether context is null.
9cf1c25ce8 Better handling for public ID when validation is enabled
d8533c4cd1 Better comment
2802802e0a Remove whitespace
86b4492425 Add the new contextName property of WebappClassLoader to its toString() and expose a read only via JMX.
8be8d285dd Add Token Poller protection to our list of special leak protection. It initializes Java Cryptography Architecture early during startup to prevent the occasional Token Poller thread being started with the web app class loader as TCCL.
bc1a6600c5 Preparation be fore adding a new leak prevention feature: change order of features to alphabetic like in listener docs. Makes checking easier.
7e728fe555 Fix change fragment absolute-ordering at web.xml with manager redeploy! (Add test fragment samples)
37bd31d693 Fix change fragment absolute-ordering at web.xml with manager redeploy!
d1a5ebb1a7 Warn to be used wrong fragment name at web.xml!
2d2a2d5374 Fix copy/paste error Add whitespace to aid readability
b987f670a5 Whitespace tweaks
83c003eb16 Essentially revert r943726 Children may be added prior to calling Context.start() and they *do* need to be started in that case.
8274d13114 Update to JSTL 1.1.2 to fix numerous XML validation issues with TLD files
67f1dec38f Identify source of TLD validation errors to aid debugging
3fa5da8fc4 Simplify xml validation configuration. It is now configurable per context and can be set per host using a host-level context.xml file so remove the attributes on the host. If running with STRICT_SERVLET_COMPLIANCE, enable validation by default.
4b37bd3446 Remove some stuff we have already done.
8fd0ee5304 Remove completed item
10540e6ffe Fix HTML niggles.
5e7d943a00 Wrappers are started when added to the Context (since the Context is already starting). Don't try and start them twice.
f6f753eab4 Fix TCK failure Restore initialisation of logger that was triggering an NPE
c72cd3ab8b Remove unused imports
f6098c8c90 Multiple TCK failures. Child containers are started during the STARTING_PREP state so if a child whilst the container is in that state, it must also be started.
ccdb39cad5 Fix remaining issue described in https://issues.apache.org/bugzilla/show_bug.cgi?id=49218 doLookup should return null if the resource cannot be found and should not throw an exception Fixes a potential infinite loop in VirtualDirContext
07204e1902 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49221 Ensure case conversion behaves as expected Patch provided by sebb
1f7bd95c90 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49224 Only try setting the username and password if they are non-null Patch provided by Matt Passell
98b1bb8b37 Fix remainder of https://issues.apache.org/bugzilla/show_bug.cgi?id=49181 Add additional check to prevent adding Servlet context listeners once the calls to the Servlet Context listeners start
ec98fd98e3 Change role name for Manager GUI access to manager-gui to align with planned changes to Tomcat 5/6
d7f236b296 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49226 Ensure case conversion behaves as expected Patch provided by sebb
586b008491 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49227 Ensure case conversion behaves as expected Patch provided by sebb
c26e0af3c8 https://issues.apache.org/bugzilla/show_bug.cgi?id=49228 Use English Locale since other Locale's may give add results
304de0c8ee https://issues.apache.org/bugzilla/show_bug.cgi?id=49235 Fix handlesTypes with annotations. The annotated class should be reported, not the annotation class.
d0e062b8ee NPE protection
448e4b785f Fix typos
ad39d5639b No need to remove LifecycleListeners from destroyed components
ad5077b12f ContainerListener != LifecycleListener. Use the correct one.
c2ca3fa320 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49240 If a class can't be loaded, don't scan HandlesTypes for it Also handle NoClassDefFoundError Patch provided by pid
9a174c6986 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49269 Set maxIdle to maxActive by default to prevent warning on start when maxIdle > maxActive Patch provided by Matt Passell
80a11debd5 Extend Lifecycle/MBean refactoring to ContainerBase
fee6d06ff9 Make sure Tomcat instance is closed down correctly (prevents warnings in the logs).
22c5c59f2a Allow the transition from NEW to DESTROYED for objects that are never started.
060f0ebd0b Fix FindBugs warning
53a7ce4db3 Stop the tests failing
7ac1ecc424 Fix JULI configuration so JULI is actually used. Fix FindBugs warnings
2b56479aa0 Clean up experimental (from Tomcat 5) MBean registration feature of StandardEngine prior to Lifecycle/MBean refactoring for ContainerBase
ebde48ec08 Add a simple CSRF prevention filter. It has been tested with the Tomcat 6 manager app and a back-port proposal will follow shortly.
3fc9c06b11 IBM has agreed to re-license the affected files. A patch was provided by an IBM employee with a CLA on file under https://issues.apache.org/bugzilla/show_bug.cgi?id=49259 The files can now therefore be treated the same way as the other BCEL files. The updated files have been applied to BCEL and I have copied them across to Tomcat 7 and made the same set of changes as I made previously. The various LICENSE and NOTICE changes made in r934220 have been reverted. Thanks to Kevan Miller and his IBM colleagues for working to resolve this so quickly.
ceada7510c make sure the entropy can be converted to a String.
5932f33f4b Descriptions need to be on a single line Fix attribute alignment so file is consistent
5437fe181c GSoC 2010: Add missing attributes, use alphabetical ordering Patch provided by Chamith Buddhika
c6db88f8bd GSoC 2010: Make some JMX attributes read-only Based on a patch provided by Chamith Buddhika
8d9043508c Typo
74c6b3d731 Document comet package move
f805bcbb07 More anchor handling improvements: 1) escape '#' character as well as spaces. See virtual-hosting-howto.html for an example. 2) allow to explicitly specify anchor name, using anchor="" attribute on a (sub)section. See default-servlet.html for an example.
a93fb24dea Correct a sentence
902ff11dec Replace spaces with underscore in HTML anchor names. To preserve compatibility each (sub)section will now generate two anchors: the old one and the new one, if they differ. It is port of r936982 from tomcat/site
7f60a4e03d GSoC 2010: Add missing JMX attributes Patch provided by Chamith Buddhika
f51aa3caa1 Re-factor Realms to use LifecycleMBeanBase
a7914f3bdc Fix copy&paste error in script comment.
245e49d707 Rename Eclipse files so they become samples Align the svn ignores list and the excludes list for the src tarball. The sample Eclipse files will be included, the 'real' ones will be excluded. Add ALv2 headers to sample Eclipse files
a2d5d1bcdc Re-factor Valves to use LifecycleMBeanBase
455fec869b Move ManagerBase to new Lifecycle/MBean implementation Fix a bunch of Eclipse/FindBugs warnings
10c651a6da Remove unnecessary code
9df6a6e3c5 Fix the tests the Lifecycle/MBean refactoring in r940634 broke.
d157ad12e2 With the benefit of some sleep, refactor the MBean support for Lifecycle (still some components to convert) Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49134 Thanks to Marc Guillemot whose test case for 49134 provided the basis of o.a.c.mbeans.TestRegistration
9dd42ea6ad https://issues.apache.org/bugzilla/show_bug.cgi?id=49241
00abf45a64 Remove classes that are no longer in the source tree
31d96e3f95 Better error message
7315215f4c Search to more jars and fix testcase!
e14e9fac83 Simplify the connector. Keep a reference to just the Service rather than the Service and the Engine.
7caf5895fd Clean-up prior to MBean changes
0f79d34e8f Increase the threshold to try and catch if MBean registration breaks and MBeans don't get registered.
2dbb18ad72 Add a setDomain() method to LifecycleMBeanRegistration since not all components (eg Exectutor) retain a reference to their parent. Implement this new method where required. Implement MBean (de)registration for Executors using the new interface.
8648b51ab1 Just log multiple calls to destroy rather than throwing an Exception.
5e3ff0399f Add LifecycleMBeanRegistration Align init() and destroy() Executors and Connectors need to handle their own (de)registration
e32a2fd8c8 Make sure Server calls destroy() on subordinate Services
d9f0bdc167 Register the MBeanFactory Make sure all the objects registered are unregistered
4d96c2289f No longer need ServerLifecycleListener
904929ac0c Add call to destroy() that should unregister all the MBeans
c0376f9067 Add init() and destroy() support
d8aa4aa9ff Align test with expected behaviour (currently fails). Will fix in following commits.
ed8237c508 Remove invalid auto-generated import.
58eaafc85a Add new interface to StandardServer to enable MBean (de)registration on init/destroy
003fb81ccf Line lengths. No functional change.
c312250004 Add MBean registration and de-registration to LifecycleBase The new interface will need to be added to each component to get this to work.
b8868589ce Clean-up post init/destroy lifecycle refactoring Allow Manager objects to be restarted
a6fd607c7f Clean-up post init/destroy lifecycle refactoring Allow Loader objects to be restarted
4f4cea7139 Clean-up post init/destroy lifecycle refactoring By default, remove children on destroy, not stop
386a285714 try to fix async for APR.
df27c026e7 Revert... Editor seams display problem... Sorry!
cf5f4e03e2 Add License Header
fc0f641aa0 Remove the controller - MBean registration will always happen in init()/destroy() after Lifecycle refactoring Fix a handful of Eclipse/FindBugs warnings
dde4e27807 Log any unexpected errors that might occur during server shutdown from the shutdown hook, and do not forget to shutdown (read: flush) the logging subsystem.
2e62159b6a Make md volatile to be sure there are no threading issues
bd0efa41b6 I can't see any reason why a Realm shouldn't be re-startable by default. Individual Realms can always override this.
61ec4eabeb Another fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49092 Make constant final
a7ee39d3db Minor clean-up having reviewed the diff between current code and the code prior to the Lifecycle re-factoring
256e7ac0da Get the shutdown hook working again. Now LifecycleBase uses synchronized methods, Catalina can't extend it else the shutdown hook can't function.
03d0096134 Clarify
43481f91ec Clean up start code. Catalina no longer implements Service. The model is now: Bootstrap sorts out the class loaders, Catalina does the remaining plumbing and holds a reference to a Server object which in turn contains 1 or more services etc. Still need to fix the shutdown hook.
06869c5629 Document must destroy state
07f0b05b21 Add init() and destroy() to the Lifecycle interface Note that this commit breaks the shutdown hook. I'll fix that in a following commit.
f0c6758999 Fix wrapped and thus broken $Id$. Use $Revision$ instead, because it is shorter.
5955ec0c9e Space to tab
134d2ded0f Add second resource jar and testcase failed again :-( You can switch assert resourceF and see that also resourceB test failed..
1d14775ed3 Fix NPE if no encoding parameter exists at request!
f7a9acc9fd web.xml or fragment must merge with annotations s. Servlet Spec 3.0 8.2.3
3067dbd854 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49236 Do not use indexing when packing Tomcat JARs.
5f581cc661 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49218 The test runs successfully if JreMemoryLeakPreventionListener is present.
f08d134700 Log unexpected runtima and IO errors in ApplicationContext#getResource() and ApplicationContext#getResourceAsStream(). This is inspired by BZ 49218.
41f469cda4 Per documentation: http://java.sun.com/javase/6/docs/api/javax/security/auth/Subject.html Therefore all concrete Principal implementations associated with Subjects must implement Serializable.
95613381cb Fix to correct JarScanner (StandardJarScanner) default!
6a8ed0db25 Set svn:keywords=Id where there is unexpanded $Id$ keyword in the files
468e19866c Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
b6761dd04a Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
2e69791899 Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
d796e9901d Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
61db996f9b Replace $Date$ with $Id$ because of its i18n and timezone issues (http://subversion.tigris.org/issues/show_bug.cgi?id=2332)
b1bb8b91f8 Remove MultiMap class. It is never used. Note, that its implementation was incomplete, e.g. MultiMap.Field#name and #value fields are never assigned.
241a968a99 Move and rename the aliases support test.
bc0be9697a Tests for Servlet 3.0 support of bundling static resources in META-INF/resources subdirectory of a jar file. It is a separate web application, because the old "webapp-3.0" has metadata-complete="true".
29d69caaf2 $Date$ was wrapped and thus broken in r939212
c770ce8d25 Fix my IDE and use spaces. - No functional change
a7207e73a6 It isn't practical to list every single commit that implemented Servlet 3.0.
afe73bf942 Follow up on pero's review comments.
6852bfda71 web.xml and fragments overwrite annotation parameters (s. Servlet API Sepc Nov 2009 Section 8.2.3.3 pages 80-84) not yet complete -- filter support is missing!
7c9c758090 web.xml and fragments overwrite annotation parameters (s. Servlet API Sepc Nov 2009 Section 8.2.3.3 pages 80-84) not yet complete -- filter support is missing!
288e20b559 Implement support for running the tests when the build output directory has non-default value.
cb9e7e3333 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49207 FilterMap#filterName was null when it was configured dynamically with addMappingForUrlPatterns() Patch provided by Pid
6d4747bcb8 Mark StandardContext#aliases as private, because there is a getter method.
0537e65a5e Use a helper class to manage the filter mappings. Fix ArrayIndexOutOfBoundsException in addFilterMapBefore as reported in re: r937975 thread.
b1c37640bc minor tweaks for versions
2fa0a60d4d java 6, not java5
968bcd7661 s/2.1/2.2/ for jsp spec version
8958fad0fe Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49073
48dddb866f If the class implements both interfaces then call addApplicationLifecycleListener only once.
4d92df9acc Simplify code
d3bc26dace Include .project and .classpath files to src distribution. s. http://ant.apache.org/manual/dirtasks.html#defaultexcludes to not include scm files!
5408f7a5a1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49184 Prevent ArrayIndexOutOfBoundsException Patch provided by Pid
fd048edeb0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48689 Access TLD files through a new JarResource interface to make extending Jasper simpler, particularly in OSGi environments. Patch provided by Jarek Gawor.
91e3a28fd5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48358 Add the ability to limit the number of JSPs loaded at any one time.
8cf64624a8 Fix leftover bug from changing the design
e586b3f664 Fix SCI when there is more than one JAR on the classpath
cf6ac9796b Update ignore list now ecj-x.x.x.jar is used directly
c9e1aaa310 Allow time for the OS to do a context switch.  Otherwise this fails 100% of the time on my Windows 7 box
494d20407f Update
463eb32565 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49181 Patch provided by Pid
d2bba0da56 Trigger a DBCP rebuild if src or bin is missing Should fix buildbot
3f517d0c2b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48222 Provide src JARs for Maven
9fecc0bf8c Build script improvements:  - build src jars for every jar  - use ecj-x.x.x.jar directly  - add an embed-release target
8fae1e4f4f The release build doesn't run the tests
2d5d80025c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48644 Don't silently swallow Throwables that need to be re-thrown Patch provided by Charlotte H (with a few tweaks) Patch developed during the London GDC OS Jumpstart 2010
56de6138f0 Restore global JNDI support broken in r937542
a194de848e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49132 Need to start JNDI before listeners are called
99902a5948 Add test case for bug 49132. Check JNDI is available when ServletContextListeners start
1109ecbfbc Remove unnecessary instanceof tests ID'd by FindBugs
59290497f6 Remove impossible tests ID'd by FindBugs
d0d9bbe366 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49140 Use appropriate iterators and for-each where possible
a02cc32108 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49143 Threading / initialisation issues. Not all were valid. Make them volatile anyway so FindBugs doesn't complain. Fix some additional issues - use of valueOf() - found along the way
6ba023f2e1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49144 Not an issue but stop FindBugs complaining Also fix one other FindBugs report for this class.
5e9519088f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49164 Improve unit tests by propagating failures from spawned threads to main thread. Patch provided by Felix Schumacher.
1b04638740 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49171 Fix IDE warning Patch provided by sebb
02dc481199 Servlet 3. Implement ServletContainerInitializer support
59996a792a Context aliases: - add a little to the docs - disallow an alias for "/"
cbb1d5d381 Respect configurable search order in getURLs().
4ab9f9604c Update changelog.
abef67c6b0 Add docs about VirtualWebappLoader.
5d6f1915fb Expose the new WebappLoader flag in the VirtualWebappLoader, but allow alternative name searchVirtualFirst to make it consistent with the "virtual" terminology.
b153c01b54 Add property "searchExternalFirst" to WebappLoader: if set the external repositories will be searched before the WEB-INF ones. Default (false) is unchanged behaviour. Expose the new property via JMX and document it..
7605505e00 Expose properties of VirtualWebappLoader and WebappClassLoader via JMX.
7d183976dc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49170
949c95b8d6 Complete review of spec. One additional requirement
f1c6eedc98 Update
20273b7ec1 Add support for loading static resources from /META-INF/resources inside JARs bundled with a web application
747fbbafe2 typos
02697fc6d6 Fix Eclipse warnings
31ee283032 Fix typo in overridden method name
6372b7b4d9 Fix CVE-2010-1157. Prevent possible disclosure of host name or IP address via the HTTP WWW-Authenticate header when using BASIC or DIGEST authentication.
26fe8127fd Fix for 43642.
ed7d2fd3f2 Minor fixes
2d678e07e1 Remove mystery method
3035a8a0d5 getCookies is a httpServletRequestMethod, not a httpServletResponseMethod
890e71e4d8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49141 Stop Findbugs complaining
482a2d6698 https://issues.apache.org/bugzilla/show_bug.cgi?id=49158 Session cookies should only set one header
1f820c17fe Add test case for bug 49158
01872a4320 Additional patch for https://issues.apache.org/bugzilla/show_bug.cgi?id=48589 Do not access JNDIRealm$User class fields directly, but use the getter methods, as (theoretically) those can be overwritten in subclasses.
c07073b229 remove null check.
37c5fe3ee0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49151
7cbe56c73d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49150
6f689df7cb Improve the ChatServlet comet example. 1. Fix possible deadlock in ChatServlet$MessageSender, similar to BZ 48843. 2. Properly wake up ChatServlet$MessageSender when the servlet is destroyed. 3. Filter special characters when printing the message in ChatServlet. 4. Provide an explicit charset everywhere. 5. Fix frames layout. Fix redirections. Use target="<name>" attribute in HTML to send request to a particular frame. 6. Fix DTDs. Use frameset DTD for the page containing frames. 7. Add "xxx joined the chat" message at startup. 8. Rename chat.jsp -> index.jsp, so that the entry point to this example is more visible. 9. Corrected the link that opens a new chat window. It referenced an undefined JavaScript function. Now it is implemented just by using target="_blank". 10. Added submit button to the form pages. 11. Minor message tweaks.
bbacf68fcf More checking against the spec
9a85c48412 Get build working with relative base.path
b305634f8b Remove unused dependency on o.a.t.util.collections.MultiMap. An indication here is that MultiMap$Field.name and .value fields are never assigned.
5be952788d Fix asyn with APR.
6e4b60aed7 Review section 4. More stuff to do.
4190d9133a Clean up a bit
e2cd8c5f9d Add in statement cache
fe3896907a Correct a misprint (s/provide/provided), wrap the long line.
8880fb95a4 Followup to r934220. Set svn:eol-style=native for the added files. No change in their content.
b70eb44e6c Section 3 of spec checked
4bec0c75b2 Implement SRV.3.2. Non file parts should be exposed via getParameters() Cache results so multiple calls to getParts() work
3aa6761fea if error, next request
6d46802220 Section 3.2 of the Servlet 3 spec says getParameter should still work for parameters that do not represent file uploads (it doesn't at the moment - patch to follow)
ccc3c64cd1 Update release plan.
184891b93e sessionCounter and expiredSessions declares as long instead of int.
20e2c364b2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49024 Enhance the RemoteIpFilter docs Patch provided by Cyrille Le Clerc
900079f642 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49129
b2fed7e9d9 https://issues.apache.org/bugzilla/show_bug.cgi?id=49118 Use StringBuilder rather than concatenation
af36554861 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49110 Make inner class static to prevent possible memory leak - found by FindBugs
f291c64cfc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49109 Remove unused authenticate() method with a broken default impl
34924dc035 https://issues.apache.org/bugzilla/show_bug.cgi?id=49106 Remove unused import
b952f78536 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49105 Misc Javadoc corrections.
962377321a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49104 Generics
27517b2fcb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49103 Add @Override where appropriate
41336eead6 Two BCEL files have IBM copyright and EPL licensing. Update LICENSE and NOTICE files accordingly.
3749c66145 CPL allows us to elect to distribute under a later version of the license so elect to distribute under EPL as we are already using EPL for Eclipse JDT.
e05aab400a Don't include modules in the src release
c59cf28f05 Parametrise current year in all embedded NOTICE files Don't use the same property name for different output files
925b851f7c Add license headers to NSIS files
c64864835c AL2 header
f52a5cf07b Tomcat 7 needs Java 6
4ab202fc72 Add info on API stability to the release.
edaf211bce Fully fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49082
7f67b92420 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49045 Add support for adding Services and Engines via JMX Based on a patch by Chamith Buddhika
45a7f1bee5 Alternative fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=49089
7566b20208 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49116 If session is already invalid, expire session to prevent memory leak.
8be06490dc Fix download location for native binaries
852767d9d9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49086 Add Javadocs to javax.servlet.annotation Patch provided by Pid.
f2107700b4 Make constant final
0154bca5ed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49091 Reduce visibility
400658a11e Make public constant final
5e7566faee Partial fox for https://issues.apache.org/bugzilla/show_bug.cgi?id=49082 java.home may not include the final path separator
c419f8080e Add some additional tests
cd6d648138 Re-factor to allow easier addition of extra tests
606b6e714a Back to -dev
25f85bf03a Prepare for RC1 release
c376aa8501 TCK failures: EL TCK with security manager
33c084b2b5 Use spec compliant session expiration in STRICT_SERVLET_COMPLIANCE mode.
f76ad4e616 Reduce failures of new API when running under security manager.
5ad736629a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49081 "#${1+1}" should evaluate to "#2" Note that all files apart from ELParser.jjt are generated by javacc from the changes to ELParser.jjt
1034733c0e Add test cases for https://issues.apache.org/bugzilla/show_bug.cgi?id=49081 "#${1+1}" should evaluate to "#2"
2ed5b6412b Allow JioEndpoint to switch context class loader under security manager. Code copied from standard session.
8fd6536fac Ignore request handling time in session lastAccessedTime when acting servlet spec compliant.
23b3526592 And another property for the policy.
bec3cc04a6 Add another property access to our security policy.
4cb38fe010 Add permission to read the STRICT_SERVLET_COMPLIANCE property to our default policy for the security manager.
8b9bd93aa8 Add missing class.
9725207db9 TCK failure (with security manager): Preload required class.
66f79bef65 Javadoc update
d87b272fe1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49075 NPE protection if roles is null and roles needs to be modifiable
e2bd1a911a Update EL & JSP versions Minor tweaks
62ec103b97 Use chunked encoding for http 1.1 requests with no content-length (regardless of keep-alive) so client can differentiate between complete and partial responses.
132135a2b1 Further corrections to SSL session timeout attribute name.
80b80c1756 Fix typo
a5bbbbffb5 Start working on a statement cache. Add in disconnect event for interceptors, make the statement decorator extensible
d17d369b38 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49018 Fix processing of time argument in the "Expire sessions" action in the Manager web application
1255300960 memberAlive is not called if member has not already existed in membership.
b408c4afb6 Revert accidental commit
cb5d1bdfaa Fix the immediate problem described in https://issues.apache.org/bugzilla/show_bug.cgi?id=48648 Still need review remainder of bug report
bc5e23d2d9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49014 Add test cases for the RemoteIpFilter Patch provided by Cyrille Le Clerc
315dd5d0f0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48983 Additional debug logging for when RemoteIp(Valve|Filter) is not invoked
017a4f1463 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48914 Invoke should use parameters provided in expression in preference to parameters provided in invoke() call
f0de194088 Modify unit tests to take account of https://issues.apache.org/bugzilla/show_bug.cgi?id=48914 Invoke should use parameters provided in expression in preference to parameters provided in invoke() call
44ba8f84c9 Cleanup. Remove field that is never initialized and never read. req.getResponse() is used instead of it when needed.
9c6005dafb TCK failures: If a servlet/filter has any mappings in the main web.xml, these override rather than replace the mappings defined in the fragments. The same goes for fragments and annotations.
e4c3b2bdff Fix copy paste error
cf3ef0b820 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=49030 Failure of one connector should not leave some connectors started and some ignored
834d5c1fc6 delete test file
ac9c956c1a commit access test
a7c7d17a41 delete test file
13cb969877 commit access test
e141b25342 When changing a session ID, use the internal add cookie method in the same way as when first creating a session cookie.
f9b0d3c1ba Clear up state handling a bit
967995ddc7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48895 Make clearing thread locals optional and disabled by default since it isn't thread-safe
dfb3831b3c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48840 If CDPATH is set, cd may result in output to stdout. Swallow the output. This is safe since the script outputs the value used for CATALINA_HOME so any issues will be visible then. Patch provided by mdietze
0ef86e2f68 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48839 Correctly handle multi-line headers with the NIO connector Patch suggested by Richa Baronia
5aa31b3c0f Test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=48839 Fix to follow shortly
c6e5e3ee81 New installer side graphics. Artwork provided by Adela Turk
c649d56e2b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48717 When a node joins a cluster and it receives all the current sessions, ensure the sessionCreated event is fired if the Manager is configured to replicate session events
eeadfbf96a Language tweaks
0f5f61960d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48662 Make extraction of context.xml files configurable and disable it by default for Tomcat 7
a9a7a8293c MUST_STOP is also a valid state from which to transition to STOPPING_PREP
1881fd1dce Use both single and double quotes in the test, for diversity
969424ec57 Add in some debug, what is causing some TCK failures is a request/response pair not being recycled properly
73dd083fdc Adjust startAsync().complete() behavior
53e0de24d1 Clean up  - Eclipse warnings  - Unnecessary code  - Line length  - i18n message names
a4603f30f7 Adjust examples to the latest implementation
30d9952f9f Mark example servlets as async
49becebd51 Mark ResourceEntry.loadedClass as volatile. That is because WebappClassLoader#findClassInternal() uses double-checked locking to initialize this field.
8b958974d3 Missed a file in r927850
1a2ac44d4c Improve log message when deploying from configBase to make it clearer where xml file is read from. Javadoc tweak
66dde900f5 spec says that "started" is defined as started until the thread has returned to the container.
683651abb1 Remove tests rendered unnecessary when context.xml files were moved from appBase to configBase
c53a3ab76c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48992 Fix XML tags in examples for CombinedRealm and LockOutRealm Based on the patch by Fumiyuki Shimizu
cb0a09116b Obey the rules on quoting
7db97d8ef0 Re-fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45015 Regression in recent parsing re-factoring
569db65492 Add an additional test case for bug 45015.
f46f9cee47 Remove unused imports
a3c1eba8bf prevent duplicate threads processing the same socket
948ee573b4 Ignore setenv.* so I don't accidently check it in
b51a71186d Update project name
8b09b8ecf4 Address various class-loader deadlock / sync issues https://issues.apache.org/bugzilla/show_bug.cgi?id=44041 https://issues.apache.org/bugzilla/show_bug.cgi?id=48694 https://issues.apache.org/bugzilla/show_bug.cgi?id=48903
75ee619368 Clean up. The setAsync can be done in a single bottleneck, instead mixed into the processor
27f7b3e9a7 TCK failures: Make valve Async aware - with some help from Filip
292c3abf69 recycle properly
4a1bb74973 Enable async behavior for the AJP connector
b06ef82289 Prevent looping by correctly setting the socket wrapper async state
19504bc307 Make sure start() and stop() are called on Wrappers. This was a regression in the recent Lifecycle changes.
08f8b4c88e Use context path in debug log message
1721b71b1b Add in a slightly different behavior for dispatch. dispatch() will return immediately, according to spec. But if dispatch is called from the tomcat worker thread, then the dispatch will not happen until the worker thread has backed out of the call. This prevents multiple threads being launched into the same request/response and causing potential concurrency issues. The Async state machine guarantees that multiple dispatch can not be called.
395087a388 Tracking down a memory leak. Add some debug logging to the mapper.
e63ac0c274 Add support for detecting Spring Security user names in the manager app
77cf08eb45 Simpler fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48790 based on a patch by kkolinko Make maxActive thread safe. Probably unnecessary but technically a bug.
3836a1263e Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48790 in preparation for a simpler solution
95bea65d05 TCK failures: Fix session expiry on cross-context requests. Need to test the local session is valid before calling access() which will make it valid again.
c92e280393 TCK failures: Don't delegate dispatcher type to wrapped request as it may well be different.
930da49d2a TCK failures: Look for the right element
6bc6f71af3 TCK failures: Make sure FilterDefs where async-support was not defined are set to the default of false before being added to the context
66386691c2 TCK failures: Servlets do not support async by default
33e1ce0a9b SRV.9.3 says we must throw a FNFE
acfdd2d587 Provide the method expected by the digester for adding security-role-ref elements
fa05207b96 More async stuff, implement timeout handling
39377b8efb Make method names consistent with the names the digester looks for
1c5ce3986f Fix some TCK issues. The behaviour is undefined in the spec, so go with the TCK requirements
bcf743b3aa Fire listeners in reverse order for requestDestroyed
068652e464 Servlets added through the new ServletContext.addServlet(...) methods may not be initialised
e89eb0f538 It is valid to call startAsync() inside a dispatched request
8151dc7a07 Always use the InstanceManager to create listeners, filters & servlets
242fa0befe Arrays indexes start at zero so no need for "... + 1"
5a938c1564 Doh! Return the newly created registrations rather than just creating work for the garbage collector.
7d6ffdb0c0 Fix various exceptions that prevented one of the TCK web applications from starting
3e6ba65b39 Fix a couple of ASync issues that were causing Servlet 3.0 TCK test failures. 1. <quote section="2.3.3.3" page="17"> The complete method can be invoked by the container if the request is dispatched to a servlet that does not support async processing, or the target servlet called by AsyncContext.dispatch does not do a subsequent call to startAsync. In this case, it is the container's responsibility to call complete() as soon as that servlet's service method is exited. </quote> 2. <quote section="2.3.3.3" page ="13"> public boolean isAsyncStarted() - Returns true if async processing has started on this request, and false otherwise. If this request has been dispatched using one of the AsyncContext.dispatch methods since it was put in asynchronous mode, or a call to AsynContext.complete is made, this method returns false. </quote>
faa812270d More async stuff, only timeout left
4cd437a1cf https://issues.apache.org/bugzilla/show_bug.cgi?id=48934 The wrong sender was disconnected, should only be the sender holding the actual TCP connections.
90e0e6a796 Use better variable name.
b5ba6cb5a2 Use TEMP environment for storing the autoresponse file, and make sure the file was created
aa245a89e2 correct a comment
08f18f5544 Use real exit value if shutdown via stop
10b9d5f9a7 Suppress anoying Terminate batch job prompt when hitting CTRL+C. Note however that it leaves the file named yes in the bin directory
11593ce885 Re-work the script to make it more Gump friendly
b56d033895 Alternative fix for bug 48795. Add a new property to control if the next request always triggers recompilation after a compilation failure. Defaults to false and only applies in development mode
f27c0af12a Mark the min(a,b) method as static. Inspired by https://issues.apache.org/bugzilla/show_bug.cgi?id=44265
38f44c747c Revert 921464 for rework
5247157ce6 Update to NSIS 2.46
d296840ab1 Fix download of commons-daemon-1.0.2: The "destfile" parameter has to be specified for "downloadzip" task. It specifies the file which absence triggers the download of the archive. Thus, without it the archive was redownloaded again and again with each build.
52ad9548a6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48795 If compilation fails, always try to re-compile the next time around
c41fe38707 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48793 Make catalina.sh more robust to different return values on different platforms Patch provided by Thomas GL
b14ee19c6c Remainder of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48379 Allow session cookie name to be configured per context With this option, the servlet 3 options and system property there were just too many places this was being configured so the system property option has been removed for Tomcat 7.
b864fba0b9 Remove some changes that have since made it into 6.0.x
4a547fb29c Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48379 Allow session cookie path to be configured per context With this option, the servlet 3 options and Connector.emptySessionPath there were just too many places this was being configured so the Connector option has been removed for Tomcat 7. Based on a patch by Brane F. Gracnar
b66fdb32f5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48258 for TC7 Allow session cookie domain to be over-ridden by context configuration in the same way httpOnly may be Based on a patch by Donn Aiken
6937c6b3c4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48790 Make maxActive thread safe. Technically a bug but seems like overkill.
a8324f44dc Move the 48nnn bugs
2a144b42c8 Too many 48nnn bugs in context root
3a59427e76 Bug 48701 test cases
4b95d17d06 Complete fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48701
cd8f0b34a4 Make StandardContext aliases work with ServletContext.getResourcePaths()
7c4e56aa3e Re-org some JSPs
ec696535ae Create a directory for all the bug 45nnn JSPs to make things more manageable. I'll do the same for other groups of bugs as the numers grow.
1b79959f64 https://issues.apache.org/bugzilla/show_bug.cgi?id=48007#c5 Improve exception processing in CustomObjectInputStream#resolveClass(), to help find the cause behind BZ 48007.
e00cbd59ea Review feedback 1. getNameFromAttribute() returns the attribute name, not the variable name and 2. This is a translation time test so the attribute value is not known
9077141705 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48701 Add a system property to allow disabling enforcement of a requirement of JSP.5.3. The specification recommends, but does not require us to enforce it.
83a60a1365 Correct description for STRICT_QUOTE_ESCAPING system property C-T-R
cf1cd36532 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48760 Remove potential race condition that can result in multiple threads trying to use the same InputStream
195a5efc9e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48737 Don't assume paths that start with /META-INF/... are always in JARs. This is not true for some IDEs Patch provided by Fabrizio Giustina
498fb317b6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48729 Return roles defined by both userRoleName and roleName mechanisms Patch provided by 'eric'
077979f2d8 Remove unnecessary duplication
967303130b Eclipse warnings
f04ec69b0b Updated the tests because r920110 was reverted in r920608.
753089b7bc Revert r920110 Compatibility with JSP 1.2 tag libraries had to be covered by JSP 2.0 specification, see "Backwards Compatibility with JSP 1.2" in the Preface part of JSP 2.0 specification, and there is no provision for this feature. Discussed in the Re: r920055 thread on dev@
b6af848708 Amendment for BZ 48668 fixes. Use setter methods that accept String value to set pageInfo properties. Throw an exception if tagInfo is not available for a tag file or requiredVersion is not parseable. (Both of that should not happen).
50b2152820 JavaDoc correction C-T-R
19739a23e7 Revisit https://issues.apache.org/bugzilla/show_bug.cgi?id=48701 Allow TagVariableInfo as well as VariableInfo to introduce objects later used by <jsp:getProperty> - JSP.5.3
8fe08f4315 Whitespace
e196ecc3f3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48661 If the response has been committed, include the error page like Jasper does
bc1dff3c5d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48629 Make nested role search work with username as well as DN Add roleNested to the docs Patch provided by Felix Schumacher
810b1a97f8 Use the Lifecycle state to dtermine if the context is in the correct state to allow configuration
27230e02ae more work towards making the JIO connector ready for async
132119976c Add context name to leak detection log messages
6f9f36bf56 Handle component failure without throwing a whole stack of exceptions Adds a new permitted transition from NEW to STOPPED that does not fire any events
4472a540d8 No need for separate ant download
5eb1c1eb85 Update change log
22a35c0866 Lifecycle refactoring - ContainerBase Adds a new CONFIGURE event to allow Context to fire the START event at the right time Context fires START a little later ReplicatedContext takes advantage of LifecycleBase ensuring start() is only called once
235e56c73f Fix intermittent test failures
5c012ad801 isELIgnored depends on library version and web.xml declaration
5a4735d47b Rename no-el to el-as-literal Add tests for 2.3, 2.4 & 2.5 webapps with Tag libraries that require various JSP versions These currently all work and I think some should fail - looking into that next
75eea2db17 Test that tags from libraries that declare various JSP versions have EL and deferred EL enabled/disabled as appropriate. This currently triggers a failure - fix to follow shortly.
3aa14371b2 Extend the no-el test to cover deferred expressions
295fb6db84 Both TLD and web.xml determine if deferred EL syntax is treated as EL or as a literal
afb97eac51 Line length
70bd671bcd Make getVersion(), getMagorVersion() and getMinorVersion() return consistent values
2d1c0a4750 Ensure result of getVersion() is consistent with getMajorVersion() and getMinorVersion() With the current code this fails. Patch to fix this to follow.
59ece6ca2b Remove the TestAll suite. Ant doesn't use it, IDEs don't need it and it is often out of sync with the tests
8ad1e1f7c3 Check all versions are correctly parsed
dbdeaa75cd Add a test the EL doesn't work if the web-app is a 2.3 web-app
fc4b34863f Rename webapp to allow tetsing with webapps with different servlet spec versions in web.xml
d040ef9c16 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48668 Fix remaining issues in BZ48668 The idea behind this change is to make ELParser aware about isDeferredAsLiteral option. Before this change ELParser was used to parse an attribute regardless of isELIgnored or isDeferredSyntaxAllowedAsLiteral values. With this change we do not use ELParser when isELIgnored is true and ELParser does not parse '#{' in expressions when isDeferredSyntaxAllowedAsLiteral is true. It simplified the code in many places. Also, servlet specification version from web.xml and JSP specification version from TLD file are now taken into account when determining the default values for isELIgnored and isDeferredSyntaxAllowedAsLiteral. As far as I understand the code, previously only isELIgnored was determined by the servlet specification version.
5e3c4351dd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48668 Honor isELIgnored and isDeferredSyntaxAllowed in the Parser
8eb75f0625 Additional tests for https://issues.apache.org/bugzilla/show_bug.cgi?id=48668 The TestCase currently passes: the parts that do not pass currently are commented-out: - in bug48668a.jsp: those that prevent JSP from being compiled - in TestParser.java: also those that provide wrong output.
f69cc4abc4 remove extra newline character
b8778144c1 Shave a few seconds of the rebuild time if the manifests don't need to be updated
fdc99c27f4 Add comment to the tomcat-users.xml template used by the Tomcat exe installer on Windows.
221672f426 Add comment about the "manager" role (copied from TC 5.5)
c3f9f14763 Add a comment about comment to tomcat-users.xml
71feb115cc trivial: correct a link on an image on the jsp-examples index page
3ba50e8b4e Lifecycle refactoring - Manager Lifecycle.START event fired too early in a number of cases Added toString() for use in Lifecycle error messages
99a362df89 Line length
48f177ef59 Lifecycle refactoring - Store Added toString() for use in Lifecycle error messages
a44413d3b4 Fix two message strings where natively encoded chars had been lost and replaced by '?'.
8e4c2486ae Correction
b81af89001 Lifecycle refactoring - Cluster Added toString() for use in Lifecycle error messages
4c60713412 Fix utf-8 encoding in message string properties.
9b56ba69a1 Lifecycle refactoring - Executor The LifecycleState.STARTING event was being fired too early
2df8ed774d Fix some Eclipse warnings
583f403f5d Tabs to 8 spaces - no functional change
2a279c6c42 Lifecycle refactoring - Valves Most valves were firing the LifecycleState.STARTING event too early Make the toString() consistent for all Valves Some copy and paste errors in i18n start/stop messages are fixed as a side effect. Some unused messages were also removed.
2b57605a1f Fix some inconsistencies identified during lifecycle refactoring for valves - don't start a basic valve when adding it to the pipeline if the pipeline is not started - if pipeline is started when adding a basic valve, register the basic valve
8aa5dd6457 Add some additional debugging information when components are started or stopped multiple times
88f0daf798 Arrange the french translation submitted by Henri Gomez.
6c5fa7dc56 Lifecycle refactoring o.a.c.loader - Note WebappClassloader only has a stubbed Lifecycle implementation
d1f65888f4 Revert r919347. On error , we don't need the read lock.
8d5e0dc023 Ensure read lock is obtained before write lock is released on an error condition
01a4a5c61d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48861 for Tomcat 7 (missed a couple)
1e25369bd9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48861 for Tomcat 7. Still an issue for Tomcat-lite
80d10ca9a6 Lifecycle refactoring Realm: Note most implementations were firing the start event too early
d49c61d92b Fix svn properties. Patch provided by sebb
881be90e07 Lifecycle refactoring StandardPipeline (and turn Eclipse compilation warnings up to 11)
03856377ff Lifecycle refactoring StandardService - Note use of LifecycleState.MUST_STOP in Catalina to ensure shutdown
0efce851c6 Fix eol-style
738df71a8c Make toString() consistent with other components
17672f1408 Lifecycle refactoring StandardServer - relatively straight forward
35f403e038 Lifecycle refactoring Connector - relatively straight forward
63f8534476 Lifecycle refactoring. In an effort to reduce code duplication and improve consistency, provide a base Lifecycle implementation. This will be used as the basis of the refactoring of the components that implement Lifecycle
7122871b77 Lifecycle refactoring. Part 1 of many. Better define the start and stop methods as well as the overall component lifecycle and the relationship between start/stop, component state and events. Add a getState() method but it is commented out in this checkin to prevent compilation errors. It will be uncommented once the method has been added to the components that implement Lifecycle.
00b2797693 Add in and document more XA support
88d6e5c1c2 Revert r917784 and r905722 - changes associated with the invalid bug 48050
5f2c1a2596 Move source/target JDK versions to the main section of the manifest, because these values belong to the JAR file as the whole, not to some subset of it.
b304b18650 If subsection name is not unique, prefix the anchor name with the name of section that contains it. This is especially useful for the Tomcat configuration docs, where names such as "Introduction" or "Attributes" are not unique. See e.g. config/filter.html config/valve.html
c07806db9e svn:eol-style, no functional change (followup to r918682)
8021d3b2fa Fix 1. of https://issues.apache.org/bugzilla/show_bug.cgi?id=48831#c3 Ignore the reset() call from java.util.logging.LogManager.Cleaner, because we have our own shutdown hook that will take care.
54e219d795 If CATALINA_BASE is not defined we would try to read directly from /bin/setenv.sh file
3a54fadc52 Use eval instead direct call or exec command so that arguments with spaces are properly handled
c4f30072b3 Mark JNDIRealm.User class constructor as public. The class itself remains protected.
75c06a862b Followup to r918594 Be more strict with try/finally when locking
9c159602d7 Followup to markt's r918594 Replace tabs with four spaces. No functional change.
a389bba418 Fix 2. of https://issues.apache.org/bugzilla/show_bug.cgi?id=48831#c3 When resetting a logger do not close handlers that do not belong to the current class loader.
b38e1bfed5 Revert previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47977 that caused regression https://issues.apache.org/bugzilla/show_bug.cgi?id=48827 and implement an alternative fix
82768e7c66 Add tests for bugs 47977 and 48827
61d361ba30 Echo tags are not expected to have bodies. Has the happy side-effect of providing a tag that can be used to test bug 48827.
fb17df123b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48831 Address issues 1 & 2 by using a ReadWriteLock to control access to the writer. This ensures messages won't be written while the writer is null. Note there is no (easy) way to not close the handler. Address issue 3 by re-enabling the JULI shutdown hook if JULI is being used and Tomcat isn't stopped via a shutdown hook. Address issue 4 by making ClassLoaderLogManager#useShutdownHook volatile
fe7a1a3305 Implement review feedback
cb6b4351f1 Add generated TOC, replacing manual TOC if it was present earlier
a9df546c01 Add generated TOC, replacing manual TOC if it was present earlier
f9c81891c0 Replaced manual TOC with generated one and corrected tags nesting.
915e584d71 Added "r" to the text of revision number links generated from <rev> tag. As of now, those are used in changelog.xml only.
5ae8b67091 Better fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48660 As per Konstantin's comments, ensure a single Vary header is used and take account of * if present
0679d303da Implement support for automatic generation of Table of Contents. It is triggered by <toc/> element. Section header is not included into generation, so the complete code fragment to add will be <section name="Table of Contents"> <toc/> </section> The html-manager-howto.xml provides a usage example for this. Also corrected minor issues with tags nesting, reported by w3c validator.
0f2030e1b1 As per Remy's suggestion use the new ABI only if present
f6a2dcd7d8 Use definitions list instead of unordered list. Add information about extras and sources. Add charset information to the <META> tag.
82f7044448 Fix typo
ac0ecadf98 With unsafe reneg, minimum required is 1.2.21 caused by API change
04581e9363 Port SSLInsecureRenegotiation from mod_ssl
117894a41d Do not mention Tomcat version unless necessary. Especially, do not mention Tomcat 6 in Tomcat 7 docs.
e6bc1bbf7e Amend the documentation
5e2cf5ac20 Correct fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48050 NamingContext.createSubcontext method returns Context with wrong name
4f65eb2be7 Amend the messages displayed by Find Leaks diagnostics in the Manager application.
6d7a6925b7 Move sessionDetail.jsp sessionsList.jsp of Manager webapp into WEB-INF/jsp/ Those are not supposed to be callable directly.
e634a351aa I suppose no one needs my home dir :) Revert to default
f02358ef4f Update to Commons Daemon 1.0.2 and use procrun from upsream distribution. Axe our binary spins
d7c901a0cb correct download location
1bbf20fbd7 upgrade location and version of H2, this location should not change as frequently
7740e954f6 correct a typo
d136e2122b Correct the number
91621eb2dd Improvements for JspC: - allow the encoding used for web.xml files to be specified explicitly, - allow the addWebXmlMappings option to be specified on the command line
6ce738a404 Remove unused public methods
cbd8db265b updated the JavaDoc
4a83d28123 fix for #mergeIntoWebXml() Note that the "inserted" flag was never set to true in the old code.
c49db1db24 https://issues.apache.org/bugzilla/show_bug.cgi?id=48392 Add an interceptor to be able to wrap existing statements and result sets to prevent code from accessing the connection Patch submitted by gsfernandes@gmail.com
52ce48f4c3 Moved utils to connector ( the servlet part will either go away or be a separate package ). Make it compile again on android. Few sync issues found while load testing. SSL fixes. Separate build target for connector.
d6281d9b38 Fix thrown accept error on shutdown
1f2e9d882a Add remark about reliability of System.gc() to manager diagnostics docs.
8b067595e7 fixes for #getElement(): - avoid infinite looping on unexpected end of file - fix XML comment reading
74fbd8be08 Update version of native bundled in distributives to 1.1.20.
90455c68a3 Remove comment. jvmRoute replacement happens elsewhere
4be8c69cd7 Remove comment - odds of session duplication are so small to be insignificant
1b8f2f3843 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48783 Correct defaults
73eb20b268 In some drivers, the call to setTransactionIsolation should be the very first call
c61c57cebd Comment typo
864671913d Make sure we favor the values from AjpMessage.processHeader. If the signature is invalid len can be any random number in that case
dc2fec907b More (minor) lifecycle clean-up
1e23c87a5e Improve logging behaviour when shutdown occurs via a shutdownhook. If present, use Catalina's shutdown hook to shutdown Tomcat and JULI. This enables them to be shutdown in the correct order.
93f783526d Hold off on update until archive syncs (should be no more than 24 hrs)
2127da6561 Update to latest native connector
f00ff3111c More lifecycle clean-up
5ad7ba93ce Remove unused imports
e292577a7e Add Lifecycle to Container, Server and Service Remove casts instanceof tests and any other code this makes unnecessary
8b1c1a2a5c Provide slightly more efficient implementations for ScopeMap.size() and ScopeMap.containsKey().
a98d854cb6 Fix a bug in ImplicitObjectELResolver.ScopeMap intruduced when applying generics there: the get(String) and remove(String) methods were not overwriting the ones of AbstractMap, because those are declared as get(Object) and remove(Object), thus using ineffective implementations provided by AbstractMap.
1214df0876 Apply my patch from https://issues.apache.org/bugzilla/show_bug.cgi?id=48616#c20 This patch - Reverts r905145, - Provides an alternative fix for bug 48616 and bug 42390, - Replaces Vector -> List, Hashtable -> HashMap in the affected API.
9c182659fb Revert r904914. https://issues.apache.org/bugzilla/show_bug.cgi?id=48629  now proposes a better solution
9d475c2f45 If the memory leak occured in the ROOT application, display "/" instead on an empty line
6a708ad8c0 Manifest improvements - automate copyright year - add manifests for el & annotations - improve default NOTICE - add info to bootstrap manifest
98a79b7695 correct a misprint
4270b1baac Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48589 Make JNDIRealm easier to extend by making the User class protected Based on a patch by Candid Dauth
f0fb518083 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48582 Avoid NPE as config may be null but ctxt won't be
3058d2a059 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48580 Prevent AccessControlException if first access is to a JSP that uses a FunctionMapper
61a88a9d4e Additional test for BZ 48616
f74a7d2344 Workaround Java 6/7 bug described in https://issues.apache.org/bugzilla/show_bug.cgi?id=48498 Avoid the ArrayIndexOutOfBoundsException
dd79504e97 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48545 Truststores don't have to have passwords Based on a patch by 'smmwpf54'
1fbbafb61b Spacing
4f9c001431 Update to dbcp 1.4 release that supports JDBC4 and compiles on Java 6
f7f1583b71 Use the Context interface rather than StandardEngine
f49111ce66 Use the Context interface rather than StandardContext
807ddad6e3 Use interfaces in o.a.c.startup.Tomcat and update tests as appropriate
35501132f4 Add missing test
cc5d2c92a8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48384 Add a per context xslt option for directory listings Make the fallback options work as described in the docs
bf0bd3b8cc Address review comments Don't use toString() to try and co-erce any old object to an Enum - the spec only mentions String
3533554386 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48371 Skip comments when working out where to insert generated servlets and associated mappings
20b639542f JavaDoc correction
b86b2176a2 JavaDoc correction
4ad380ffbd reverted Filip's r909673
f26a36ca2d Change a few variable names to reduce potential confusion - no functional change
58db3908db fix compilation error
89237f6d5e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48318 Handle case where WebDAV resource is in directory listing but is not accessible
1627a24de3 Update for new Eclipse lib Align with new trunk build script
ea22218cd6 Add listener before child is added else listener won't get called on first load
2f0421b797 Document new findleaks command
b9d7442efc Add a find leaks option - with a suitable warning to the manager app (html & text)
320c117c1c Make class loader registration more robust
37b06c9812 Looks like the ResourceBundle leaks are triggered by a GC bug - only seems to affect Sun JVMs. The fix is also Sun specific so only log a debug message if the internal field can't be found on a non-Sun JVM (it isn't there for IBM for example)
26f5b90aeb Remove quotes from example - they break it
c8bd799a8a When the key is null (i.e., a stale entry), it cannot be removed with an explicit remove(key) call: you'll get an NPE. Those can be removed with expungeStaleEntries() call. Also, simplified the code: Reference.referent can be accessed by calling get() - no need to use reflection for that.
772477ca82 followup to r908002 Use the debug message (added in r908002) for debug output
ab1e808ce0 followup to r909134: correct a misprint
d1faac43d2 Add rudimentary detection for PermGen memory leaks on web application reload. Only available via JMX for now. Next step is to add it to the manager app.
fa874e93d0 Improved memory leak prevention for resource ResourceBundle
5b4c80f77d Revert simple ResourceBundle fix On reflection (no pun intended) a reflection based will be better since - it can be implemented at a single point - it can easily be ported to Tomcat 6 - it will be able to handle any exotic class loader structures created by apps
b9cb85be7e More memory leak prevention - ResourceBundle
facad21908 Convert my ApacheCon securing Tomcat presentation to a how to
efa211f296 This is no longer security related as unsafe usage is blocked
cb3fc270c5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48726 Prevent OOME when uploading large files with the deployer Patch provided by 'adam'
59ecf42b5f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48716 Provide an undocumented 'shoot yourself in the foot' option to disable the JULI logging reset
984c4b3e74 Update logging docs
785bfdd8c6 Part of fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48694 that is not in trunk
2023051ec7 Another copy/paste error
e90a1d03f3 Clean-up
88e35c4ed9 Javadoc police
0e358e0218 Improvements for building jasper-jdt.jar: - Rebuild jasper-jdt.jar if jdt.jar was updated or redownloaded, or the build file was updated - Purge target directory before unjarring, to avoid repacking stale files - Clean unjarred files after the build as they are not needed
ef3b674110 - Update JDT compiler to version 3.5.1 - Use JDT Core Batch Compiler download instead of JDT SDK download. It lessens the download size from 40 MB down to 1.6 MB. - Implement support for two alternative download locations of a file.
e761db2570 Update to latest version of JDT compiler
6e7be372d5 If the ThreadLocal is set to null, there won't be a memory leak but GC is required to clean up the keys. Continue to remove the keys if found to reduce the volume of data that has to be looked at when tracing memory leaks.
767c4c8370 Split out the download target so only dependencies for the current target are downloaded rather than everything Move the bayeux download to the bayeux build file
4cc7fb0d8f Speed up a clean build slightly and provide Eclipse with a permanent location for the web services libraries
f615d8734b Fix parsing bug spotted when reviewing r907538 Allowing #{} expressions to be parsed even when they are disabled breaks ${} expressions if they are intermixed with them. See the testcase added in r907860, r907862.
a2f47173c5 Additional test from review of r907538
6054f56ba7 Additional test from review of r907538
6f2bb14486 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48170 Remove unnecessary syncs that cause issues under heavy load
d2e468f25e Tab police and line length
a143e8e2a1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48109 Extent try catch block (diff is a lot simpler if you ignore whitespace) to ensure InputStream is closed.
eb695bee19 Log when a valid shutdown command is received. This may help in tracking down "Tomcat just stops" style reports.
243f9987de Allow the global naming context to be reset. Useful when running multiple embedded instances in series since it allows each instance to configure its own global naming context. Doesn't help with multiple instances in parallel - but that was broken anyway.
37a0ddc85e Get logic right way around
229cd6697a Avoid adding the package twice
de44523b78 Ensure appBase is valid. Prevents spurious stacktraces in tests
25a1765d58 Make the tesst easier to debug
0dd29696ef More memory leak protection on reload. Use of java.util.Timer
0b58e6924a Protect against NPE whilst running the test
9283d64763 Add a test case for TimerThread thread/memory leaks on reload as I have some ideas on how to safely terminate those threads
e688b0e004 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48660 Compression should add to Vary header rather than over-write it
a1f1380702 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48665 Correct package in Javadoc Patch provided by Cyrille Le Clerc
ae96204681 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48668 Don't look for EL matches (which swallow the EL match string) if EL is not enabled
aa797bb05e Update with recently added tests
c06469976f Add test cases for bug 48668
572bf84307 As pointed out by bug https://issues.apache.org/bugzilla/show_bug.cgi?id=48672, the host-manager application docs do not exist. Make this clear.
a466113037 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48643 Clean up
7181ade83e Avoid NPEs
329b4c0752 Get URI and location the right way around
4e5291860f Actually used the new jspConfigDescriptor
0a02ac00e7 Skip null publicIds
8d3a88a09b Get javax.servlet.http passing TCK API check Removing use of @Deprecated Use better comment for this in java.servlet
af06ba3b92 Get javax.servlet passing TCK API check Mainly removing generics and @Deprecated
66551cfdad Restore the JSP mappings
0cf3be55dc Servlet 3.0 Remainder of ServletContext plumbing Plenty of scope to clean this up Only lightly tested so far
e49aba3099 Followup to r907355. Correct a misprint
8740eccd4f Oops, changed the wrong one
b04e5b190a Remove hard coded dll paths that Gump doesn't like
eb83354ced Cosmetic changes  - fix eclipse warnings  - tabs to spaces
84f32596ec Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48678 StandardService already defines server. Having two in the type hierarchy just causes confusion
3180222f96 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48658 Save test output in files; allow single test to be run Patch provided by sebb
a301d6271e Remainder of Pipeline clean up. The Pipeline interface is now used in place of StandardPipeline throughout the code base.
b119b9f651 Remove the Pipeline interface from ContainerBase Access valves via getPipeline() rather than directly on ContainerBase
cea58cdf21 Get global naming resources working if naming is enabled
a8fde1b36a Add a test case for global naming resources with embedded
f059a2d1bf Move firing the events to StandardPipeline. This way calls to container.addValve() and container.getPipeline().addValve() will both trigger the event. Custom pipelines (unlikely but possible) would not trigger the event. The javadocs for Pipeline will be updated to note that they should in a following commit. Part of removing the Pipeline interface from ContainerBase
046a7e5d20 Prep for removing Pipeline interface from ContainerBase
8a4a3a6186 Invert the logic for building dbcp/jdt a) makes more sense b) should keep gump happy
c385a863a9 Clarify that the exe is for 32 and 64 bit
0d430d8a91 remove a println call
7c6f016d16 Fix for a bug with processing of double quotes in AttributeParser#parseEL()
d50aebeffb Test for a bug with processing of double quotes in AttributeParser#parseEL
3e55b6bed9 Be a bit more specific in our tests: check for <p></p> surrounding the printed text
31e235377b Servlet 3.0 Effective major/minor version support
4ff1caf570 Refactor
5b2645ec78 Servlet 3.0 plumbing
006111932a More servlet 3.0 plumbing Fix some Eclipse warnings
2f9b5bc00c Don't build dbcp or jdt unless we have to. This allows adding download as a dep to compile. You can now do: svn co... ant release
f27be1e259 Enable direct building of the javadoc
fe500d68f3 Fix Eclipse warnings
743eedfe9a Filter URL so it displays correctly.
2b68b61d97 Fix Eclipse warnings
292a2640e9 Correct fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48039 Return immediately if already started
7fed8e120a Revert previous fix
2265cc8d77 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48050 createSubcontext method returns Context with wrong name Based on a suggestion by gingyang.xu
6c85025539 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48039 Return immediately if already started
d65f7e18f1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48551 Use entrySet() rather than keySet() + get() Patch provided by sebb
53c6800367 Typo
dbaa8eb207 Update post merge
985f2af03d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48653 RemoteIpValve : request.secure and request.scheme are not forced to "false" and "http" if X-Forwarded-Proto=http Patch provided by Cyrille Le Clerc
411ef382b0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48647 RemoteIpFilter : request.secure and request.scheme are not forced to "false" and "http" if X-Forwarded-Proto=http Patch provided by Cyrille Le Clerc
073a09aee2 Merge dist.xml into main build script. Fix dependencies. You can now do:   ant download   ant installer or any other target
f71928bf84 Minor cleanup
3bb30c4ea4 More post merge clean-up, mainly using jarIt
4bb0a8691c Clean and create dirs in right order so we have temp dir else strange things start to go wrong
3e194dfc24 Use jarIt macro to build dbcp and jdt jars Index JARs by default Better patterns for tomcat-api and tomcat-util
0bfdfb4148 Remove separate extras build script
401b03a816 Merge in extras.xml Still need to look at making greater use of patternsets, jarIt etc for the extras
9073862304 Clean up the main build file in preparation for merging with dist and extras  - Add some headers  - Remove stuff that isn't used  - Get tests working  - Fix dependencies  - Group build targets together  - rename tmp to manifests
9e98e0de45 Update cookie tests. Remove obsolete test
e481c990ff Fix test failure
706259a20c Make the default manifest more useful by adding the full version number
1582f0f73b Update JSP spec version
c4b5de7bad Remove some unused stuff. Set eol at start of every target that produces a release artifact
cb687d6c36 Trim stuff that isn't used (prior to merging into a single build.xml file)
be10b25c75 Don't swallow the exception
c3e75df5f3 Sync docs and APR/native connector config
6c7766aa93 Tweaks
a64ddf9cf3 Remove unused attribute
78bd29a8da Align the HTTP and HTTPS documentation with the code. Move the APR/native configuration into the standard config directory.
36a2c66be7 Minor correction to the JavaDoc for AttributeParser class
0604c8bf48 Typo
64db2f32ae Update info on zip distributions
62cba8ba6d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48616, a regression caused by the fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=42390 The requirement for variable declaration also depends on whether or not a fragment helper has been used for the parent tag (if any). Where such a helper has been used, the variables must be redefined. Test cases for both bugs and the JSP TCK pass with this patch applied.
47bd9b51cb Restore the current 6.0.x implementation so patch to fix 48616 will apply cleanly to 6.0.x
fd5ff2a809 Add minimal version of test case provided by 'agharta' in for https://issues.apache.org/bugzilla/show_bug.cgi?id=48616
ad7a3ec84c Add test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=42390 JSP & tag file provided by MicroNova YUZU Team
048ea8ca74 Align implementation with comments. Unit test now passes.
df62bdd64d Test case for RequestUtil. Current implementation does not agree with comment.
4cddc3b204 Align url decoding for bytes with url decoding for Strings. No functional change (for Tomcat) since the methods that use bytes are not called directly
d0a314e331 Make it clearer how unsupported encodings are handled No functional change for supported encodings Log attempted use of unsupported encodings, removing some empty catch blocks in the process
8bfa34e4e6 Be clear in Javadoc about how unsupported encodings are handled. Add a debug message for this case.
58cec96af8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48645 Use specified encoding rather than null
4a8ebbf4f9 Revert r804734 (https://issues.apache.org/bugzilla/show_bug.cgi?id=42390) while I look for a better fix Tab police
37804e4569 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48627 Don't convert literal attribute values to EL since attributes may not accept EL
b16344c11b Test mixing ${...} and #{...} in the same expression
fcc3013e2d Add tests for AttributeParser and deferredSyntaxAllowedAsLiteral
9c2c0b2445 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48629 Get nested role search working when {1} is used in roleSearch Patch provided by Gabriel
4ac4b2dec2 Changing line endings isn't limited to source files.
7e6e1f9865 Add a couple of debug messages
e391920abf Minor cleanup
7b7f8c7fdd svn:eol-style for a new file
d0f9294941 Fix comment typo
9efc5bd2af Add a test case for bug 48627
5c7ab22902 Fix according to https://issues.apache.org/bugzilla/show_bug.cgi?id=48613
3a1db4ded2 Revert r903928, because it breaks Connector#setProtocol(): Apr connector is not auto-selected when TC-Native library is available
7f57d1417a https://issues.apache.org/bugzilla/show_bug.cgi?id=48613 APR should not attempt to initialize if the listener has been removed from server.xml
a84141ed92 Change default to -1 since Sun packages for StreamEncoder do buffering Also, make sure the default is properly read
cda6339e91 Set svn:mime-type property on the stylesheet.
6dee28a5f9 Add <?xml-stylesheet PI instruction, and set svn:mime-type property.
79c85118b2 Followup to r901507 svn:eol-style and svn:keywords for the new files
723a0bd6a1 Servlet 3.0 implementation Implement some more of the new ServletContext methods
400f1bef15 Sync with recent rename
bc5dc19649 Rename
17a116160f Wrong method name for modeler.
7e053ff4bd Fix local source paths, accidental commit.
61e75e4cab Few more fixes after running the load tests, more monitoring. The connection pool is now a top level class, a lot of fixes to handle spdy and http mixing. Added support for header compression in SPDY requests, reduced window size. Got it to compile again on android ( the UTF8 in getBytes - will add it back, but using the char-byte convertor )
7a6e51de24 Use CRLF line ends in conf/* files installed by the Windows exe installer
21b1cd4ba4 Remove broken link
e66d50e4b3 Servlet 3.0. Implement ServletContext.addFilter(String,String)
95c2df47c5 Followup to r899796 Removed TODO markers, copied JavaDoc from the parent class
a6d6f55baf TCK failure: Can't use the string representation to test for equality as whitespace must be ignored. Use the parsed nodes instead.
a047fc4d2a TCK failure: Must check to see if property is resolved and throw exception if not.
da37c41f93 Fix bug in Enum to Enum coercion spotted during code review
01f4e8bdd5 Add some test cases for Enum to Enum coercion
73588be173 TCK failure. Wrong exception on failure.
dab18977f4 Make a distinction based on type=javax.sql.DataSource or type=javax.sql.XADataSource, some components, like JIRA actually do an instanceof on the object to determine what it is instead of relying on the configuration. Make static methods non static for easier extendability
f70a7b7172 TCK failure. Make sure we throw an ELException, not an IAE.
41c9034a2c TCK failure. Invalid index should throw PNFE.
99a9d640f4 TCK failure. Make sure an ELException is throw if the conversion fails.
2ffe2952fb Fix TCK failure. Trying to assign an object of the wrong type to an array should throw a ClassCaseException.
6866116f99 Fix TCK failure. Trying to assign an object of the wrong type to an array should throw a ClassCaseException.
3a5ef565b2 Re-factoring. WebXml is a better fit in o.a.c.deploy
13b9355816 revert r899395
9ae55b5d4e Fix the remaining TCK signature test failures.
7e5408cf05 Fix signature test failures in javax.servlet.jsp package Move deprecation javadoc to end of block
930e96e09b The spec has a spelling mistake. Align with the spec until it is fixed.
f55b6a3c59 Add the bug url
c15abf4676 API uses Set rather than EnumSet
5f605db3bd Simplify
5333e42a8f Simplify
3713782e13 No need to supress these warnings. They cxan be fixed.
42f910ba40 Updated the generated code after r899450
8347773655 Remove the Suffix interface and get the Parser to create a MehtodParameters object which allows a cleaner implementation.
36711064b1 Add a test case for the final part of the EL 2.2 implementation
0e2235d02e Line length
bf5dbfbc16 Fix TCK failures with security manager due to fix for bug 47774
d8a4ed65f2 zip is for non-windows platforms
0a23d4a6d6 Skipping installer shouldn't break package-winzip target
70cdf88dc9 Need to fix line endings for zip distro if building on non-windows
b0fa51fcee Add missing extension for line-ending conversion in src releases
fa39bc17db Allow compliance with SRV.15.2.22.1 to be controlled separately from STRICT_SERVLET_COMPLIANCE, and turn it on by default.
8673e10060 Revert examples app patch of r893496 Setting org.apache.catalina.STRICT_SERVLET_COMPLIANCE=true also provides this feature, and, I think, better than this patch does.
f485a42bad Implement the new ValueExpression.getValueReference() method. Add some plumbing for MethodExpression.isParametersProvided() Add some more generics where we can without breaking the code generation
0d9a251894 Add a test case for the new ValueExpression.getValueReference() method.
9826c94bd3 Fix javadoc warnings
3592596fcd Up the version num
2975af0c68 Force a unconditional disconnect when an error happens, like dropped connections to a firewall
9ae51c831f Implement remainder of EL 2.2. API changes
88d51d652f Jasper Parser change so methods with parameters aren't mistaken for functions
0abe39e278 Tab police, fix Eclipse warnings, add @since Javadoc
47fb1a2ef9 Remove a dependency on Java 6 that accidentally got introduced
efba04c3f1 Updated autogenerated code after r898864
16c7b83609 Implement method invocation with parameters
d17d402336 Add a test for method invocation with parameters
a85a6e6cc6 Up the timeout. 100s isn't always long enough when stepping through why a failing test.
ef003842e8 If the method is found, mark the property as resolved
d3c368fc80 Following changes 1. Default bufferSize is 0 - rely on system behavior 2. bufferSize of <0 will automatically flush the writer on each write 3. autoFlush for printWriter is false, otherwise we are duplicating the effort 4. date is a volatile variable so that a write to the variable gets propagated properly
b0677c0735 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48532 Better documentation of the SSL connector defaults
e8581fc674 Add TODO
32a03b864a Moved the connection pool to a top level class and started to add more code. Still missing is evicting kept-alive connections and queueing to limit the number of active requests per host ( and probably more ). Started to make spdy more like a part of a http request - i.e. upgrade if supported by both ends, etc.  Now load tests seem to work - no more OOM. Due to compression spdy it's using more memory per connection, current tests don't enable compression ( it's accepted for incoming connections ).
d32e8db5d4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48516 Fix possible NPE when user does not exist in directory Patch provided by Kevin Conaway
d710b45248 Improved fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47774
ed4029a1d4 Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47774 Better fix to follow
62f089e34a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48530 Add info on the Server Status page to the Manager How-To Based on a patch by Arnaud Espy
c897efd376 Fix bug 48004. Allow applications to set the server header.
533505a0cd JULI needs to be on class path
0b59c437f0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48421 Clean up a web application's logs and handlers when it stops. This involved modifying the fix that prevented log messages being lost in shutdown.
1546fdee6f Make logging consistent for HTML and text interfaces
6cd7dc41b7 Use string manager for log messages
e68bc6b62f Fix the Eclipse warnings for the host-manager
0394d2fe97 Update the comment. We don't want or need another full EL parser.
6b5e5be9e2 Avoid NPE if bundle is missing
fca0954ee6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48524 Remove unused keys. Fix case issue for jsp.error.usebean.noSession.
ad74391772 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48523 Resolve duplicate keys
8215057711 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48517 Reduce scope of @SupressWarnings and document reasoning Based on a patch by sebb
75133371c5 Make the check case insensitive. A strict reading of the specification requires case sensitivity but be pragmatic.
0736889003 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47977 Using a body with tags specified to have empty body content should cause an error
eeb2234060 Rename TCN_RECOMMENDED_MIN -> TCN_RECOMMENDED_MINOR to match the naming of TCN_REQUIRED_MINOR and to resolve ambiguity, because "min" usually means "minimum". This field does not exist in tc6.0.x code.
b9b8ff484c Using localhost should allow this to work with IPv4 and/or IPv6
32059a0e63 By default use released 1.1.19
cba1a739ce Update generated code after r897728
4c137f7d90 Remove the BADLY_ESCAPED_STRING_LITERAL - it could cause mistakes to be silently swallowed
66c119b923 Fix the remaining Eclipse warnings in the non-generated classes
6dc8b67122 \$ and \# are not valid escapes. The Parser will throw an error before this code is ever called but remove them anyway for clarity.
7a50c4f35d Update generated code after r897629
8c360ff201 Fix a bug found during review. Whilst the old version is what is defined in the spec, the definition in the spec does not agree with the description and associatedcomments in the spec. I have raised this as https://uel.dev.java.net/issues/show_bug.cgi?id=10 Modify the parser on the basis that the textual description and comments in the spec are correct and the production for StringLiteral is wrong
83947abff7 Add tests for a bug found whilst reviewing the ELParser
258bf5505e Rename
35574f539e Fix generics warnings
73c1725879 Add a test case for bug36923
e7a0832adb Add mising tests.
d5e31e7738 Better coverage for JSP attribute parsing
e972ad03eb Re-work EL attribute parsing. The underlying issue was complete independence of attribute and EL parsing. The attribute parser would generate the same result - ${1+1} - after parsing ${1+1} and \${+1} and the EL had no way to differentiate between the first (that should be treated as an expression) and the second (that should be treated as a literal). The attribute parser has been modified to output any literals that would be mi-interpreted by the EL parser as EL literals. ie \ is output as ${'\\'} or #{'\\'}, $ as ${'$'} or #{'$'} and # as ${'#'} or #{'#'}.
a4ecba566c Rename to fit expected naming convention
0c1af46888 Update documentation
492cbd2ad0 Followup for r816252/r891328 Allow to disable buffering in JULI FileHandler The previous implementation did not work as expected because of buffering performed by OutputStreamWriter
09e694fb7f Trivial: move first line of the resource file to be below the license header
d4eb66927e Correction for the README pages: Tomcat 7 requires Java 6
f1f262d9f5 Now the EL parser doesn't unquote stuff it shouldn't (r896589), remove the attributeValueWithEL() method as it is causing more problems than it is solving. There are still a couple of test failures but the solution I have in mind for them won't require this method.
10baaea6ab followup to r896892 Additional message updates for JSP 2.2 Commented-out the untranslated strings in the French file, so that the English ones could be used
40d079e341 Add another edge case
dc19f7d93a Add another test case. This one passes at the moment but would fail with some of the ideas I have had to fix the tests that currently fail.
51fe1caf2e Correct tests. Remaining failures shoudl now be Jasper/EL bugs
e1679ef6a6 Add the tag library definition so the tests actually do what they are supposed to.
cee5cca542 Remove comments
43ce4eddad Add missing license headers
00cfe6e9e7 Add various EL test cases, mostly extracted from local test JSPs I have used for individual issues. Thanks to kkolinko and the numerous bug reporters that provided the basis for many of these. At present, although this is Tomcat 7, the tests only cover JSP 2.1 functionality.
2357750f91 Update for JSP 2.2
dd6e3e1c5f Prevent NPE in emebedded case when no web.xml is provided at all
a578dd62ac Add a test case for bug 48112 (note this passes - need to check when used in a JSP)
705fc5aeaf Ignore the imtermediate file for the parser generation
5b10486e18 Fix the remaining test failures
cd552f3ae2 Fix some test failures. '\' should not be skipped in lierals. Align the definition of LiteralExpression with the EL 2.2 spec otherwise parsing errors result.
32603f02ff Don't edit the generated files at all - makes regeneration simpler
7139053836 Additional tests for the specific escaping (of "${" and "#{") for LiteralExpressions
b5181618e1 Fix the test case failures. There is at least one bug still present - more test cases to follow.
3fbdd81943 Start to expand the EL test cases
4ac93eca55 Fix indentation.
c6c9d4ed51 Cleanup tabs and trailing whitespace.
f93ae4bb25 Tab police.
f3cc7ecefa Move declaration as per Knostantin's review comment
90b1bc97b8 Fix typos / inconsistencies Rainer's review comments on r894580
7bae045dc2 More work on tomcat-lite connector: more experimenting with spdy, few more tests and fixes.
eac93aa7c7 Correct default
c2de86048f Not used any more ( were part of the mini-servlet on top of coyote )
c632b843d7 Remove the mini-servlet on top of coyote impl - can be reverted if anyone finds a use for it.
38e4c09c31 Improve JavaDoc generation Based on the proposed patch for https://issues.apache.org/bugzilla/show_bug.cgi?id=48299 Also ensure the clean targets clean up fully
4554ef1b4a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48424 Based on a patch by Ivan Ensure that the ObjectNames for the Connectors are always generated using the same method
c6b51656d8 Remove empty dirs
7c4a389398 Fix schema location
b430b92364 Update version of tomcat-native included in TC binary bundles and Windows installer to 1.1.18.
9bf67d002c Guess that's safe.
0a6d7f91a8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48464 Provide an option to specify the command window title Patch provided by LiuYan
a9ca1eb103 Fix odd whitespace - no functional change
35c92ebe3c Suppress some invalid compiler warnings
02e39db753 Remove some declared exceptions that are never thrown
9808940121 Remove some declared exceptions that are never thrown
4c382fc5db Remove unused methods
46ebaa0344 Mark the implementations of deprecated methods as deprecated
10aba40856 Don't use deprecated methods. Use recommended alternative.
d0cdfb2929 Followup to r895191 Fix calling Tomcat Windows scripts from a directory containing '&' character, and allow to use this character in the names of CATALINA_HOME/CATALINA_BASE directories. https://issues.apache.org/bugzilla/show_bug.cgi?id=48464#c4
f72c13578d Mark the implementations of deprecated methods as deprecated
24168d9198 Replace copyright year in nsi and html file with the YEAR tag. It will be automatically updated via our ant version filter.
ea532660d7 Borrow a few things from the main Tomcat build.xml: - use general version filter - automatically set year to the current year - use patch version property without dot.   The dot is added when combining it into a version number
0d567851db Allow to patch the current year via our ant version strings filter.
6dc8c3ba40 Update copyright year for TC trunk.
c0c58cd64b Change license header in tomcat-lite java source files using the copy2license.pl script.
e856806a8e Fix calling Tomcat Windows scripts from a directory containg spaces, as noted in https://issues.apache.org/bugzilla/show_bug.cgi?id=48464#c4 by LiuYan
0dbef52b04 Change license header in two tomcat-lite java source files using the copy2license.pl script.
a4353f1e69 Change license header in bcel java source files using the copy2license.pl script.
13b19e84ce Followup to r895045 Per JavaDoc format, the tags (@deprected, @see etc.) should follow the main description, not precede it. Otherwise the description is swallowed by the tag.
b368d00b6b Remove unused imports
95664b4275 Mark the implementations of deprecated javax.servlet.jsp.el classes as deprecated
c7a1624324 Fix some trivial Eclipse warnings
0d98722886 Add some missing deprecation markers
bbf02d713c Update javacc from 4.1 to 5.0. Update generated code.
c85f89efa8 Followup to r894586 Correct some lines in the French translation, modified in r894586
7703027655 A little more JSP 2.2 EL impl
2e35e66a0d Correct location. Spotted by Christoph Beck
6c6b64e344 A little more JSP 2.2 EL impl
5d7ef845b1 Fix src build. - When <include .../> is nested in a <patternset .../> each include can only specify a single pattern - Reference existing <patternset .../> in <fixcrlf .../> rather than defining a new one
f9a87f12b1 Add the Java EE 6 schemas to support validation
0ab58ede09 Re-order constants to match DigestFactory usage to make it easier to check for consistency
6f669152da Update X-Powered-By header for Servlet 3.0 / JSP 2.2 and add additional information as suggested by the Servlet Spec and https://issues.apache.org/bugzilla/show_bug.cgi?id=48006
08fa550294 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43819 Implement ExpressionFactory.newInstance() and ensure that Jasper does not refer to org.apache.el directly JSP 2.1 TCK passes with these changes applied Based on a patch by Christoph Beck
9b81b884dd Fix an problem highlighted by the JSP 2.1 TCK. Only provide merged 3.0+ web.xml for 3.0+ apps.
696e54374a API changes for JSP/EL 2.2 changes. Dummy implementations where implmentation is required.
ef8306135d New helper class to provide web.xml to those Jasper classes that need to parse it. JspConfig was not consistent with TldLocationsCache. These are now consistent. JspConfig now has access to the merged web.xml generated by Catalina from web-fragment.xml files and/or annotations.
7530c9d708 Get Jasper to use same web.xml (including merging if appropriate) as Catalina by default. If no merged web.xml is found, fall back to previous behaviour.
0dc2b018dc Prevent definition of duplicate URIs for tag libraries and improve error messages for all duplicates
b1e4f46548 Fix indent
e0bd1641bc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48345 Patch provided by Keiichi Fujino
9e48d03fee Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48417 Correct French trabslations Patches provided by André Warnier
6e12e0780d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48454 Give the stderr reader a chance to finish before terminating the CGI process. This avoids "Bad file descriptor" errors. The period to wait is configurable. Based on a patch by Markus Grieder
94e5d4d8d6 Update to 3.0 schema
8059d4026f Fix some Eclipse warnings
1f74281061 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48443 Correct FileNotFoundException on ROOT context start when annotation scanning is enabled Patch provided by wujunchen
6ada0c0797 Add support for http-method-omission
4130ff95ec Don't override method that has a more complete implementation (handles more edge cases) in RealmBase
9d3bb5e8cc XML output tweaks Fix some NPEs in the merge of session-config elements Fix a copy and paste error in the merge of session-config elements
de44093b03 Add support for configuring session cookies and session tracking in web.xml
41fb90c2d9 Add support for the enabled attribute for servlets in web.xml
bfea505c0c Fix copy/paste error
f69a635393 Make handling of ServletDef.asyncSupport consistent
98000dd42a Add configuration option that allows the effective web.xml to be logged on context start. Expose the effective web.xml through a context attribute so other components (eg Jasper) can use it.
73662dbaec Interface and type are separate
fe9d9a628f Expose string array of dispatcher names
7a4d5482df JSP 2.2 - Add support for the new jsp-property-group elements to the web.xml parsing
c0363bcb1b Revert r893208. Catalina does have a requirement to access the full  jsp-property-group info
16fa6a7aae Allow all kinds of data sources to be mapped to the connection pool
c8a84c0bb0 Make naming consistent with elsewhere in Tomcat
a1c448c180 Clean up i18n resources after JarScanner changes
760740e96e Move StringManager to the tomcat-util jar
7eba47c2c3 Have one list of JARs to ignore when scanning for config and make it configurable
7444015381 Move JAR scanning into a new JAR used by both Catalina and Jasper
3d526cb907 JSP 2.2 - Update to JSP.5.1 - Sync only required for session and application scope
dcd3ba72dc JSP 2.2 - Add omit attribute to <jsp:attribute>
9091e8f219 Allow null usernames and passwords to be passed in, so that one can call DataSource.getConnection()
cc475d87eb Fix how we detect what class is being invoked so we can multiplex the method invocation correctly
81717fa60b Enforce presence of charset in content-type header of textual mime-types in the Examples webapp a) by using a filter, b) by adding mime-type mappings for htm/html files
1042f494fa Properly close <head> tags in tagplugin documentation pages.
fe85f147db Restore alphabetical order
be3c3f42e0 Apply r893375 to extras.xml as well. This changes format of md5 files generated for the extras from "checksum" only to "checksum *filename". So, those md5 files will be in the same format as the ones generated by dist.xml.
c0c70d74aa Fix EOLN issues in md5 files generated for our releases.
f9b243cb3c Slight correction to the list of file extensions used to enforce LF/CRLF conventions in source distros. 1. Replace *.default with *.properties.default, to be explicit about file type. 2. Add *.htm  We have such a file in TC7, though not in TC6. 3. Add *.tagx.  Though we do not have examples of tag files in XML syntax yet, but I think we better have this pattern included.
26118cb5c7 Fix regression (JSP TCK failure) with fix for bug 47453
599811ba9e Fix MD5s for windows zips
1f6792670e Review file extensions present in src distro and amend list of text file extensions accordingly
4ce6c7db84 JSP 2.2 implementation (partial)  - JSP 3.3.9  - Default content type  - JSP 3.3.10 - Default buffer size  - JSP 3.3.11 - Error on undeclared namespace
77a3ff7825 Catalina only needs to know about JSP URL patterns. Jasper will take care of the rest.
4c30ddf7ae Confirm that this was a typo
eed18478d6 Confirm that this was a typo
fa9b197af0 Fix second part of Comment 8 in https://issues.apache.org/bugzilla/show_bug.cgi?id=47413#c8 Coerce result of composite EL expression (${a}${b}) from String to the expected type.
a612330980 Add a page that illustrates EL Composite Expressions ("${a}${b}") to the Examples web application
9891c781fb Only unload JDBC drivers this web app loaded.
1e55752a10 Fix some comment typos.
b5e5a69e38 Second followup to r892341 Small improvements, based on sebb's and my comments.
d3cf04321f First followup to r892341 Replace tabs with spaces in the lines changed in that revision. No functional change.
8801049829 Remove unneeded line from the method that normalizes decodedURI.
fa2d324474 Fix comment typo
4b0e7e7a9f Various related (un)deploy improvements including:  - better handling of failed (un)deployment  - adding checking for valid zip file entries that don't make sense in a WAR file  - improved validation of WAR file names  - make sure error messages match the action  - the return from File.getCanonicalPath() may or may not return a final separator for directories
632b63d8be Review comments and minor typos
4ec43368c7 Followup for rev.892612 Better fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47963 Tab character is also allowed in the reason-phrase Also, use more traditional method of iterating over a string.
eda1aee091 Comment typo
8d3b025640 Better fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47963
28452fdb8c Tab police. No functional change.
c6387414d9 Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47963 pending a better solution
427d4aa98b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48399 Make locks final Patch by sebb
4a44a20e6d Fix javadoc
6c694199d4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48413 Correct translations Patch provided by André Warnier
0afd205fe8 Fix typo
b8c148fb88 start not -start, stop not -stop
50178d6283 Followup to rev.889716 The new AuthenticatorBase property needs a setter. Also, corrected a javadoc misprint.
382c8a6bee Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47930 Make swapIn thread safe so parallel requests for the same session don't result in multiple session objects for one sesison.
c5db6cb44f Add in support to link up the connection pool to a DataSource or XADataSource through JNDI
5c2746808e Correct version is needed
efd00b4385 Fix some Eclipse warnings in the tests
fd2a380b88 Fix the redundant superinterface warnings. Just cleanup, No functional change.
8508643b70 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47963 Anything that could end up in an HTTP header must meet the requirements of RFC2616.
0bdbaa54cd Clean up duplicates and unused strings
4e897ce635 Move test for null outside of classloader fun and games so we can exit earlier if there is no session
7b79769a47 Followup to rev.883362, fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=48113 Rename method argument. The method prints bytes as unsigned values, not as "int"s as the old name implied. Based on the patch by Quintin Beukes
c1b047bec0 Fix unclosed tag.
00072f1fa0 Followup to rev.883125 Additional fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47609 Add patterns for textual files without extension Remove an extra comma
ca0e7b2b0f Make SSL config JVM neutral. Based on a suggestion from Ivan.
c967880c1c Fix bug 47841: CombinedRealm fails to switch to other realm https://issues.apache.org/bugzilla/show_bug.cgi?id=47841 Handle failure of sub-realm during combined realm start
8bca175221 Side issues from bug 47841 Override getInfo() log messages that use it have useful info Add support for a connectionTimeout attribute
283252c5dd Side issue from bug 47841 Overrides getInfo() in Realms so log messages that use it have useful info
419a374cf2 bad Fido, bad Fido
54f457acd5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47774 Ensure any session listeners are called with the Thread CCL set to the web application's class loader
20cf44c770 Session timeout is now set via a String
00453f95d6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48387 Make configuration attributes consistent between Filter and Valves Patch provided by Cyrille Le Clerc
e8bd5aa5f7 Fix TLD scanning in JARs for JspC. This copies the DefaultJarScanner from Tomcat. Less invasive than the alternative refactoring that will have to wait for another day.
eeacc9376a Add extra jar required for JspC
22b3cd9860 Correct TLD URIs
813539c61a Fix copy/paste error in log definition
8a610093b7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47769 Reword JNDI docs in an attempt to make clear why resource-ref elements appear to be optional
fa07b00439 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47744 Prevent medium term memory leak when ussing SSL with a security manager Based on a patch by Greg Vanore
b5bb12f6bc Pre-load a class required for apps to obtain the SSL key size when running under a security manager
956ffee7fa Test for null rather than waiting for the NPE ot be thrown.
eae27e30fa Only apply filtering to the files that need it else non-text files will get corrupted.
340e6a2aaa One more week of (almost 20%) hacking on tomcat-lite: - protocol handler is almost useable with both tomcat7 and 6.x. It's missing most options of the other connectors - will need to select what fits with 'lite', SSL is not hooked - run the old watchdog tests ( in junit form ) - they seem to catch few problems, improved a bit the runner to make eclipse happy. - few load tests - and associated fixes.
c1c8c8a67a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48381 Add a note about case of host name
ef0e0f5677 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43656 Correctly coerce null to zero when Number is the required type.
1f76b44c9a Remove empty dir
a3bfe66c08 Make init param name consistent
7cd08c357f Ignores if building module in Eclipse
8090bdc8d5 Cleanup of unused method and parameter
837ab95214 Address session fixation by changing the session ID on authentication. This is enabled by default. This should be safe since this also happens when sessions migrate between nodes in a cluster. If an app can't handle a changing ID, then the feature can be disabled in the authenticator.
6d097fd883 Remove docs for valve that was replaced with filter
27f2f73de6 JARs without any web.xml fragments should not impact the status of distributable
1f2a20aea1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47656 Add information on system property replacement in config files.
b7b8b42b00 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47537 Return an error page if a forward during form auth fails rather than a zero length 200 response.
cc997ceada Use the right class for the logger
6bfc026225 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48373 Patch suggested by wujunchen
9bc5e2a369 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48370 Remove some unused imports
73ec690b6c Update procrun to 2.0.6
e786a9cda0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47507 Document the UserDatabaseRealm, in particular the readonly attribute of UserDartabase resources.
24e70df142 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48324 Correct JavaDoc. Patch by sebb
070f9feb7e Include the version on the homepage.
471cbd4cd6 Correct TODO - thanks sebb
a256c1ded2 Fix a couple of potential NPEs
e71e7bca03 More post-refactoring recurrsion protection
8f2dc4984f Add missing part of recurrsion patch
edf87d79b3 Shutdown the handlers used by webapps otherwise log messages in the buffer just get lost.
24045af064 More clean up
f49b29993e Remove remains of generic package More clean up
1584cf4a4a More BCEL pruning
36734e2862 Add support for WebFilter Remove wrappers to implement isAsyncSupported() having found the setAttribute() code It is individual filters rather than the whole filter chain that need to be considered for isAsyncSupported
e2084e78b7 Add annotation support for WebListener
a2fbafad1e Add annotation support for WebServlet
e658ee298e Add async-supported impl for Servlets
cf48903336 A little more cleanup. UCDetector claims there is no more to clean. I'm not yet convinced.
8498c03ace Typo
cd6bd0e0b1 Last cleanup of unused code for today. Still more todo.
0e3e559a79 More unused code removal. Still not complete.
cc2b41bcb8 Remove unused code identified by Eclipse / UCDetector. Not complete - still more to remove.
a368753efb Remove some unused classes identified by the unused code detector
c05da25e8b Don't need the Vistor and associated support
dcc6394c20 Remove the verifier
0cc98eceb8 Import a package renamed Jakarta BCEL trunk to do the annotation scanning. There is far more functionality here than is required. The excess will be removed as development progresses. The import has been done via svn copy so future updates should be easy via svn merge.
a2780e98b3 Import a a package renamed Jakarta BCEL trunk to do the annotation scanning. There is a lot of fat still to be trimmed. This was done as an svn copy so future updates should be simple via svn merge.
8f4a6fc70a Fix the Eclipse warnings
4dcb24b846 Need to strip /hostname/contextpath before trying to list resources
481d8c3905 New Jar in Java 7
990aefa2bf Adding the plumbing to get inputstreams for class files. These will be passed BCEL for annotation scanning.
ff9ade54a3 More accurate comment
88462db030 Fix typo
f6e71f434b Added the tests - but then tried few more changes and broke them again. Fix it back.
fb6de3a483 One more iteration: - added few more tests - moved the http/1.x code to HttpConnection - easier to test, allows protocol upgrade - added an (experimental, hello-world-style) implementation of spdy ( a new binary protocol and possible replacement for jk ). Tested with chrome and the unit tests - the tricky part seems to work - detecting and 'upgrading' the wire transport.
00467bfb1f Update web.xml to servlet 3.0 Mark as metadata-complete
606cd77952 Add support for the MultipartConfig annotation
9dd81aed35 Only log missing class as an error on Sun JVMs. Likely to be an non-issue for other vendors.
b1842b3b81 Remove use of deprecated code
3d492ab7fb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47502 Don't try and replicate attributes we know to be non-serializable Patch by Tim Funk
c03789b5ab Better descriptions
d82e9b7d0c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48296 Generics and JavaDoc fixes Patch provided by sebb
17d5202dcc Remove deprecated commands
c90fe30aa9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47453 Handle void return types. Patch by Tim Funk.
644458ffa3 More memory leak protection. Adds support for:  - optionally stopping threads started by a web app - this is dangerous last resort option for dev environments - not for production  - clearing ThreadLocals created buy web apps  - clearing unintentional references in sun.rmi.transport.Target
6ff14554b8 Move from a global system property to a per Context attribute for clearing static references. Change the default as this should no longer be an issue with modern JVMs and the other memory leak protection provided in Tomcat 7.
891969bbee More memory leak protection - this time for the GC Daemon thread.
b9ea7c3caa Provide a simple way of enabling all cipher suites when testing.
7787479909 Add code that logs threads started but not stopped by the webapp. I have some highly experimental code to shut those threads down but it a) needs more work and b) needs to be made configurable before I commit it.
156ecbae2b Refactor prior to adding some more clean-up methods.
1d120572c1 Better logging of what is going on on Context reload
6b8dfb5a4c Add logging when a context fails to unregister a JDBC driver. Don't unregister the jdbc-obdc bridge driver that is loaded by the system classloader.
268c574fd4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47342 Make sure replicated context is initialised before accessing fields Patch provided by Keiichi Fujino
02c9f388c9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48289 Javadoc / generics fixes Patch procided by sebb
e60083a080 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48288 Supress some warnings Patch provided by sebb
dd5b928b5c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48287 Eclipse warnings Patch provided by sebb
4edc4662e3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48285 Add handling of Async dispatcher types
5067ba4d7e Further simplication - delete unused constants
4ec2106173 Take advantage of revised constants to simplify code
6a6efff535 Re-order the numbering so each dispatcher type always refers to the same bit so we can use bitwise operations
841635b421 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48282 Correct possible NPE Patch provided by sebb
6ff00094c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48267 Generics Patch provided by sebb
2ef081bb66 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48297 Missing french translations and some weird sentences Patch provided by Marc Paquette
f338347df8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48295 Correct French translations. Patch provided by Marc Paquette
3088c75c32 Double-check getResource() works as intended after report of issue with Grails (http://jira.codehaus.org/browse/GRAILS-5038) All seems OK. Maybe a Grails issue?
00afc30c71 Remove unused class
47c4d5eec1 Shouldn't do last-minute changes before a large commit...
43ca4298a4 Added eclipse files, remove unused build helper file
4bbd2fc829 Tests. Note that you need to have watchdog checked out and built (if it can still be built... - probably should checkin the binaries ). There are a bunch of useful tests in watchdog - I'm not running watchdog, but turned it into JUnit test cases, we just need the web apps and golden files from there.
7695187e68 For downloading deps - used Ant Ivy. The actual deps are declared in a maven pom.xml ( Ivy is supporting it just fine ).
2bc8f15806 Few change to the ObjectManager ( intended for integration with existing frameworks ). The 'sample/if no other framework around' SimpleObject manager no longer depends on IntrospectionUtils, refactored it ( and parts of modeler ) to DynamicObject.
71ef47534d Moved the old coyote-specific servlet api impl to coyote/servlet Added (10% working) coyote connector that uses the new http impl
0e6713711b Removed the 'addons' package, moved the interfaces close to the packages that define them, also some code move around.
8f11a450dc Based on the code in tomcat.lite, but using the new http connector instead of coyote. Also the ObjectManager and properties are no longer used.
4b45b19b18 Proxy service - CONNECT doesn't seem to work ( probably because it didn't have a test ), the rest works pretty well. Also includes a small socks server I used while testing. Almost all work is non-blocking and done in the selector thread.
6965560ca8 The http implementation - it may be hard to recognize the original connector code from tomcat after many iterations. Changes compared with coyote: - both server and client mode - HttpRequest/HttpResponse implement most of methods in the HttpServletRequest - with the addition of setters, for use in client mode. They don't implement the interfaces - or 'servlet framework' specific methods - but should look familiar to people using this as a library - mapping is moved in this package, also support running HttpServices in the selector thread (proxy will run this way) - MimeHeaders are gone, so are the parameters - replaced with the MultiMap, which is based on MimeHeaders but adds a HashMap instead of linear scanning See tests for examples.
374f368344 This is the first draft of the refactored coyote connector. Lots of big changes: - MessageBytes is gone - BBuffer, CBuffer are used as buffers, BBucket/CBucket are used for wrapping bytes - C2B/B2C are gone - replaced by nio charsets in IOReader/IOWriter. CBuffer is still needed (instead of a StringBuilder ) to have access to the raw chars and avoid copy - speaking of copy, IOChannel uses a list of buffers instead of growing a buffer. For proxy we should be able to move buffers from in to out.  This works a bit better with the char conversions, etc - Nio code heavily refactored - I didn't add APR but shouldn't be hard if anyonew wants. - Ssl is barely working - needs improvements
fc77093d70 Reduce visibility
d72f24ed0b More memory leak protection. This one is particularly nasty as profilers don't appear to show the GC root associated with the leak.
fdc6dfa305 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48266 Generics and unused imports. Patch by sebb
fbc57921f6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47836 Don't keep TLD/listener info between reloads
7c3cbe0a47 Explicitly close the stream.
0f9fdf08be Rest of fix required for https://issues.apache.org/bugzilla/show_bug.cgi?id=48113 Based on a patch by Quintin Beukes
9519b34812 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48233 Reduce visibility of loggers Patch provided by sebb
978f29cc2d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=482 Use volatile since field is accessed by multiple threads
3c04dc6fb7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48239 HexUtils exposes public array Based on a patch provided by sebb
0997dad198 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48248 Use volatile since field is accessed by multiple threads
03cedd25de Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48249 Use volatile since field is accessed by multiple threads
0b24b8a774 Add missing property
823c577699 Fix failing SSL test Prevent NPE in NIO connector when using SSL and the default keystore password
ef5bdf237c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48257 Patch provided by Guillermo Gutiérrez
2cc0fbe8a7 Cleanup Javadoc as well as code
66741a1cdc Use correct attribute name now all the renaming code has been removed
cdbc059828 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48049 Correct copy and paste error and call correct function
f60263cbc1 Clean up
321957d1f6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47799 Unable to configure domain in Membership and DomainFilterInterceptor Patch provided by Keiichi Fujino
4f7ffa7cce Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47462 Need to be able to override metadata complete if set in the global web.xml Patch provided by Keiichi Fujino
1be876db44 Fix some Eclipse warnings
ed5efe7a7b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47997 Process changes to the naming resources for all JNDI contexts, not just the global one. Patch by Michael Allman
235335b28f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47718 Correct file descriptor leak on context reload/stop Patch provided by George Sexton
20ecb7d36e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47609 Implment fail-safe EOL conversion for source disributions Based on a patch provided by sebb
d9bc06edcb Remove old comment
c150eafc7a Add in DataSource supprot Add in XA support
821eefb4c7 Complete the FileUpload implementation and use it for the html manager app.
31c641c3b5 https://issues.apache.org/bugzilla/show_bug.cgi?id=48252 Fix potential recursion
a15e6b379f Start to hook-up the commons-file upload port to the Servlet3 file upload API  - Make sure the upload config is available when required  - Start to migrate the HTML manager to the upload API
33c901348d Fix error in previous commit
df9633116b Improve workaround for CVE-2009-3555 On the plus side, it doesn't rely on an async event to close the connection On the down side, I haven't yet found a way to log client initiated handshakes before they get closed
855b5fe10a Fix SSL for BIO post refactoring Make attribute names consistent Endpoints are now responsible for configuring the SSL "engine" Basics work but still needs more testing NIO & APR to follow
da96ca6a36 Fix Eclipse warning
0b4e58d382 Fix SSL config error as a result of attribute refactoring.
609f6110ba Fix the Eclipse warnings - no functional change
72571b3a93 Remove unused code
27181b7585 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48234 Align Javadoc with code
5b2e0bd44c Static so sync on class object
40bb0f483a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48233 More loggers to private static final
64573a841e Fix copy/paste error
9806231e11 Fix theorectical sync issue and soem Eclipse warnings
741d520031 Fix NPE
77ca758b89 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48172 Potential threading issues, make fields final where possible
3f69b138a2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48197 Reduce visibility where possible Fix javadoc Based on a patch by sebb
695726b437 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48230 Remove unused imports. Patch provided by sebb.
1ed2d96943 Fix copy and paste errors
5cacdab55b Fix more typos
061874af25 Fix typos
ac77c55aa6 Being *really* picky. It is a single web app.
00766564c9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48217 Make logs final and private; add missing @Override markers Patch provided by sebb.
efedb4dd70 Fix typo
65d89582b1 Updated to match the latest catalina.policy file Updated the section about implicit permissions
39f11e5b94 Wrapped long lines. As the text of this file is copy-pasted into security-manager-howto.html, it will make it more readable.
9dd96abe2a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48196 Reduce visibility. Patch by sebb.
68ce53ef2e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48176 Make fields final. Patch by sebb.
1ded2d043b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48175 Make loggers final. Patch by sebb with minor modification as original patch broke compilation
3def954cd3 Use standard modifier order
654c30ccc7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48174 Use final
7be16cd7b4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48173 Use final
2a6dd77704 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48151 Add missing AL2 headers
996971fa5f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48150 Correct JavaDoc typos. Patch provided by gingyang.xu
78cb3a6fda Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48149 Correct JavaDoc typos. Patch provided by gingyang.xu
99cef73845 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48148 Correct JavaDoc typos. Patch provided by gingyang.xu
e56826e077 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48147 Correct JavaDoc typos. Patch provided by gingyang.xu
693480eea7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48146 Correct JavaDoc typos. Patch provided by gingyang.xu
a5c30d8a6f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48143 Javadoc updates. Patch provide by sebb.
fe1434e108 Generics
be8e227223 Consolidation of protocol attributes into a base class
6299be70ac Add @Override annotations
7ba59344f6 Remove unused imports
9827140683 Remove some more deprecated code
dbaed729ba Remove deprecated code
43de166974 Add support for multipart config in web.xml (partially complete) Review and fix issues in WebXml merge code
45ac7a0d2f Fix an Eclipse warning
b8f18ab01d Better handle edge cases when allowing = in cookie value
1db0db6373 Test some edge cases with = in cookie values (current code fails these tests - patch to follow shortly)
07fee80270 Update re-packaged commons-fileupload to 1.2.1 Done using svn copy from tags in commons so merging future updates should be easier Changes made/required:  - All classes in a single renamed package  - Removed unused Util methods (so even more classes were not required)  - Removed some deprecated classes There is almost certainly more to be done in terms of pruning to the minimum required. Will so that once Servlet 3 file upload has been implemented.
19f431fbb1 Update comments and examples in catalina.policy file Especially replace ${catalina.home} with ${catalina.base}
c3646ecf07 Update to commons pool 1.5.4 (fix another regression)
5fe9217da6 Update Javadoc to reflect changed default for useEquals
3cf2c2aa76 Make the file handler thread safe
0d141e77ca Update throws declaration for Servlet 3 file upload Do the easy part of the implementation
e77fe21c0b Implement request.authenticate() This required re-factoring the Authenticator interface to use HttpServletResponse. It would be nice to refactor to use HttpServletRequest as well but at the moment the authenticator requires too much access to the request internals.
b9de02365e Remove code that doesn't do anything
57e6938559 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47495 Exit immediately if Catalina.load() failed to create a server instance.
5ea9c2b4ac correct a comment
766cfbb71a Clear the values in username and password fields when they are read-only
ed6cbdbfe1 Reduce visibility (thanks Sebb) Remove unused code
b4bcb7a371 More cookie refactoring  - new support class for common elements of parsing and writing  - better consistency between parsing and writing  - remove unused code  - reduce visibility of methods where possible  - auto-switch to v1 for any attribute that might require quoting  - better names for constants  - allow v0 cookies to break http spec (disabled by default)  - update test cases and documentation
fc71c9c39f Correct comment
5f77e61499 Add TODOs as per discussion on dev list
d899eb1945 Do not offer default value for Tomcat administrator login Also change/indent some labels
04e7e7e814 1. Correct some computations in "configure" Function: a) Always set initial value for $R5 b) $R4 and $R0 have to be consistent when Silent mode is used 2. Correct some messages. Do not mention Windows NT etc., as Win98 is all history now.
9521d53bed Add suspect test and also allow connections to be unwrapped
ebb583e168 Implement suspectTimeout to allow JMX notifications and log events to take place if a connection is checked out for too long. But don't abandon/close the connection.
e55939de1e Use a safe default of the useEquals, works on any VM.
f4b847fb40 Add Apple J2SE runtime jars to those we skip when scanning for TLDs and web fragments
02f23ddcb5 Fix NPEs on startup with relative ordering and provide somewhere to store results of annotation scanning when that is implemented
000e30d3a8 Make handling of / as a separator consistent with the rest of the cookie code. This actually relaxes treatment of / in cookie generation.
2d3443613d Make TODO comments consistent to make them easier to find
e0e1ea7360 Servlet 3 implementation. - Add support for relative fragment ordering and some test cases - Re-order fragment and annotation processing to match spec - Implement login/logout - Provide a method to retrieve the Authenticator in use by a Context - Add methods to Authenticator interface to facilitate the new login/login methods - Enable Authenticator.register() to be used for logout as well as login
b7ec7c462e Followup to r.817822 and r.833545 You have to specify explicit encoding in a fixcrlf task
4f5379e0d6 Make the location of stdout and stderr output configurable. Leave the default as it always has been. Currently, one can reconfigure the location of all logfiles except this one.
dcc2c32a32 Add similar SSL tests for NIO connector.
dd0737072d code formatting
2585e6db73 Use new attribute name
d936b9029c Document allowUnsafeLegacyRenegotiation
760036e851 Rename attribute
4bcbb07c44 Prevent stack traces when closing ssl sockets after unwanted renegotiation attempt.
393c95f3cb Use a connector attribute rather than a system property to control renegotiation Fix some trivial Eclispe warnings in the test Don't try and invalidate the session in the client - an attacker probably won't do this Add a test that checks the connector attribute can be used to enable renegotiation
6731f7f6d5 Fix some minor Eclipse warnings
f9d627ec74 Invalidate the session - so it can't be resumed. Not sure what else we can do using this hook - we could switch to SSLEngine, but that's pretty large change.
40531c2e7e Test case for the MITM/ssl re-negotiation, also a unit test for a simple ssl request ( to check the fix didn't broke anything and ssl still works )
8d229eb3f7 Fix for the SSL midm - disable client re-negotiation, connection will be closed.
39fd3af137 Add merge code for the remaining elements in web.xml
9527668548 Align all three StringManager implementations
00a09f3942 StringManagers should be static final
2e691ed102 StringManagers should be final
f9048dce9b Unused code
65f381d23d Loggers should be final
295760b67c The assumption that contexts will always be file system based or that resources will always be extracted to the work does not hold true, particularly for custom DirContext implementations. Don't make the assumption and clean-up up the redundant field that is no longer required.
9806222471 Remove unused inner class
1f7f03ccc9 With rev.834080 WebappClassLoader#findResourceInternal(String,String) is always called with AccessController.doPrivileged(), thus there is no need to wrap #findResourceInternal(File,String) call that is inside it.
c4dc67a1a5 Remove unnecessary code
f1942b9980 Patch provided by Cyrille Le Clerc * fix NPE in log statement if protocolHeader has not been defined and the servlet container does not support request.getHeader(null) * fix mismatch between javadoc  and code for filter parameter name "allowedInternalProxies" -> "internalProxies" * finish javadoc refactoring "XForwardedFilter" -> "RemoteIpFilter" Also fix some Eclipse warnings
0da397712a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48097 Patch by Mark Thomas.
2472ca62e8 Revert r.831830. A better patch for issue 48097 was proposed.
215a014b24 svn:eol-style
3b94e795dc svn:eol-style
cbff223cdb Fix CVE-2009-3548. When installing using defaults, don't create an administrative user with a blank password Note: This is already public - it was discussed on the users list. The formal announcement will go out shortly. The patch also includes making the Manager and Host-Manager applications separately selectable with the addition of an administrative user only enabled if one of the manager apps is selected
4389849fac Add support for displayName
4fe6e118ff Cookie is now serializable in Servlet 3.0 Fix some Eclipse warnings
c81bf540d0 Use correct default manifest Use specific notice and license file for jsp jar
9ad40bbfaa Add JSP 2.2 XSD
03bdfaa0d7 Add the JSP 2.2 schema. Note election to use CDDL.
8bc75e42df Update schemas to latest draft as of 2009-11-05
f9e42113c1 More web.xml / fragment merge code
9b0c32bc5c More inheritance
a261b4fb7d Use inheritance as it makes merging easier Fix a handful of Eclipse warnings
4e8dbdb5b8 Fix Eclipse warning Override equals (and therefore also hashcode) as it is required for fragment merging
c3217f4c2e Restore original line ending after switching for windows installer
58d5b05aba add stubs and remove / add some @overrides to allow compilation
a876d2b82e fix typo - thanks Sebb
1c4bf3dfa8 Comet didn't work at all under a security manger. Need to allow web apps access to the comet interfaces so move those interfaces to a separate package so we can grant access.
110859ac9b Additional permission required for JSPs to work
ecd86dc3cd Remove class that was remove in refactoring. Will probably need to add replacement.
62747c2638 Make a differentiator which stock ticker is running
a08e76e21b Fix line endings
e7bdf1b938 svn:eol-style
a5e1a04c0b Apply Filip's suggestion to improve concurrency
d0036efb6e https://issues.apache.org/bugzilla/show_bug.cgi?id=47330 Add RemoteIpFilter Patch provided by Cyrille Le Clerc
0e9831b807 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48139 Correct javadoc - patch provided by sebb Also fix remaining Eclipse warnings
bf9187837c https://issues.apache.org/bugzilla/show_bug.cgi?id=48137 Fix javadoc typos Patch provided by qingyang.xu
37be8ccf69 https://issues.apache.org/bugzilla/show_bug.cgi?id=47495
324557dc75 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48135 Also add generics where possible and other Eclipse warnings
51f56242a7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48133 Spelling errors in javadoc Patch provided by qingyang.xu
2828d7c126 https://issues.apache.org/bugzilla/show_bug.cgi?id=47330 Add RemoteIpValve Patch provided by Cyrille Le Clerc
14387fa25e Use Eclipse quick fix to remove unused imports
688a796b3b Add other @Override annotations identified by Eclipse
363ffd8ed9 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb This is the final patch for this bug fix.
0f7fa08c0b Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb
e53c3a8a33 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb
c316ff0094 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb
d30d4d61a3 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb
5ff202900e Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb
76bd641cb2 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb with some additional issues reported by Eclispe
0aad93157f Add a few annotations missed by recent patches
193a954217 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=48132 Patch provided by sebb
276485b4f3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48131 Patch provided by sebb
6ea8c321c3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48123 Spelling errors
e060267de4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48121 Spelling errors
07a206f552 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48120 Spelling errors
fd2c539c2b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48117 Spelling errors
10dec73861 revert based on https://issues.apache.org/bugzilla/show_bug.cgi?id=47512#c4
9775143119 Bugfix typos from 48119
cc6b0960e0 Bugfix typos from 48118
f1e72b8ee7 Add a comment
745aa51573 Binding java.lang.reflect.Proxy to JNDI directory raises java.lang.ClassCastException https://issues.apache.org/bugzilla/show_bug.cgi?id=47512
2264de8fc7 https://issues.apache.org/bugzilla/show_bug.cgi?id=46947
8ca75edb28 Remove unnecessary argument
b0e2f29bf9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48066 Be explicit about including Ant on the compilation classpath
e5fed2911b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47918 Fix copy and paste descriptions
7dc85ae085 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48102 and https://issues.apache.org/bugzilla/show_bug.cgi?id=48103 Typos in Javadoc
0df8d991f6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48104 Align Javadoc, usage message and code
b6880399ef Port r671153 and r671459 from tcnative branch 1.1.x to Tomcat trunk:
8737df0b07 Trivial typo fix in comment.
be16cc7f49 Remove Thread class from jni. It does not exist in TC 6 and is neither used not especially functional.. We keep it in TC 5.5 though.
f940e82cf1 Remove Buffer class from jni. It does not exist in TC 6 and is not used. We keep it in TC 5.5 though.
7d4261e673 StringBuffer -> StringBuilder for o.a.tomcat
69d7246ecc StringBuffer -> StringBuilder for tomcat-lite module
6f42a20313 StringBuffer -> StringBuilder for jdbc-pool module
48922c5a7e StringBuffer -> StringBuilder for bayeux module
a0604cbc9a StringBuffer -> StringBuilder for unit tests
cf7c12cb11 StringBuffer -> StringBuilder for webapps
4f78273d3e StringBuffer -> StringBuilder for o.a.naming
06af8fa7c0 StringBuffer -> StringBuilder for o.a.juli
801ab6422b StringBuffer -> StringBuilder for o.a.jasper
4ffadc4db7 StringBuffer -> StringBuilder for o.a.el
d58fb30ea9 StringBuffer -> StringBuilder for o.a.coyote
8d776e9d8e StringBuffer -> StringBuilder for o.a.c
377f506c58 StringBuffer -> StringBuilder for o.a.c.valves
2514f45619 StringBuffer -> StringBuilder for o.a.c.util
45db520b12 StringBuffer -> StringBuilder for o.a.c.users
ce7874c59d StringBuffer -> StringBuilder for o.a.c.tribes
13e510475d StringBuffer -> StringBuilder for o.a.c.startup
375f8e602c StringBuffer -> StringBuilder for o.a.c.ssi
6848118b77 StringBuffer -> StringBuilder for o.a.c.session
3bc2ddfddc StringBuffer -> StringBuilder for o.a.c.servlets
9ed9441098 StringBuffer -> StringBuilder for o.a.c.realm
dd2963006c StringBuffer -> StringBuilder for o.a.c.mbeans
787995e436 StringBuffer -> StringBuilder for o.a.c.manager
65a459d9fc StringBuffer -> StringBuilder for o.a.c.loader
0f7973f1b4 StringBuffer -> StringBuilder for o.a.c.ha
b99fd2deee StringBuffer -> StringBuilder for o.a.c.filters
32b7ffbffc StringBuffer -> StringBuilder for o.a.c.deploy
4efd4b5ab5 StringBuffer -> StringBuilder for o.a.c.core
d3fee1cb6b StringBuffer -> StringBuilder for o.a.c.connector
c1b31d616e StringBuffer -> StringBuilder for o.a.c.authenticator
deda762a40 StringBuffer -> StringBuilder for o.a.c.ant
a8d221390b StringBuffer -> StringBuilder for javax.servlet
115c777efc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47881 Fix processing of "startd" and "stopd" arguments, when they are not alone. Patch by Qingyang Xu
f5a23a7427 Mark JspCompilationContext#removed as volatile, because JspCompilationContext#isRemoved() is called from JspServletWrapper#service, and that access is not synchronized.
a3feb4b742 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48097 Make SecurityClassLoad to preload o.a.c.loader.ResourceEntry class
4d9f63e372 Make WebappClassLoader to do not swallow AccessControlException See https://issues.apache.org/bugzilla/show_bug.cgi?id=48097
45a9b5aac3 Pack servlet 3.0 classes into servlet-api.jar
3e5c8fb39a Include root cause exception into the one produced by ApplicationContextFacade#doPrivileged()
e22e09488f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47331 Uninterpreted tags are essentially template text so apply the rules of JSp.2.2 there too.
18c83459b1 As per Remy's feedback, auto-switching cookie version is OK and we should also do it if a comment is specified
a2d9c653e1 Opps. Missed this file in cookie name/null/length patch
73cf98591d Add unit tests for blank/null cookie names
0f63121913 Don't allow null or zero length cookie names.
78cfa7fc6f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47451 Don't trigger an NPE if headers with null or zero length name or set or if a null value is specified. Silently ignore any such calls in the same way the calls are ignored if the response has already been committed.
a33146761b Trying to merge filter maps is a bad idea.
09b696e257 Fix bug in display name merge
896edfff0e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47364 Document that HttpServletRequest.getAttributeNames() does not return the names of all attributes (internal Tomcat attributes are excluded)
3b121728ca Fix ReplicationValve crossContext support
6ae7c213c3 Add another feature to the Tomcat based unit tests.
1957ce8ca3 Add a new new cookie option to allow the use of equals signs in cookies. Includes test cases and docs.
f757660f01 Add an explicit configuration option for cookie version switching and update test cases and docs to include it.
c45b21fabd New cookie unit tests and associated refactoring to get ant test target working.
28abbdd6ae Refactoring to allow easier re-use.
8351149784 Re-add code that was incorrectly removed in recent changes
8a259bb0d9 Fix a documentation bug: To enable SSL in TC 6.0 and later you set SSLEnabled=true, not secure=true as it was in TC 5.5.
3365b7a796 Apply Konstantin's review comments
db175bf831 SSL should be based on SSLEnabled, not secure flag
d9def81b8f Add an option to strictly enforce cookie naming rules. I'm not wild about the implementation but since we can't change the API, this was the best I could come up with. Suggestions for improvements welcome.
f34a16afaf Add system property to control treatment of / as a separator when processing cookies Modify ALWAYS_ADD_EXPIRES so STRICT_SERVLET_COMPLIANCE changes the default to a strict interpretation of the specs
fdd4453f90 The single quote character ' is not a separator so it is allowed in unquoted values.
d70fed950e No longer required since all connectors now use acceptors
9b96c927db Make leak prevention listener more configurable
a3674810d3 Clean-up - no functional change
00c98abd29 Add a workaround for a common cause of locked files.
85b7340f8f Ensure thread ratio calc is valid
3e82a58275 Add FilterMaps to the web.xml file merge process
7ab621569b Add some test cases for ordering.
256fabe1b9 Re-factoring to make testing easier
c0207dda7f Remove empty test class to avoid no tests found errors when running all tests for a package in Eclipse
fe3d4e40f5 Make base class abstract to avoid no tests found errors when running all tests for a package in Eclipse
7a5f455fc6 Corrected a misprint
660020eaf0 Add leak prevention listener to windows installer
0051756ed4 Document new listener
9d1efbf8d4 Add back the setters for remote host and remote address and provide an implementation. They will be needed for the mod_remoteip port (bug 47330)
fb5ae2973f Update copyright year Clean up unused elements
66141f6c02 Remove unnecessary casts
2ab71fca2a Remove unused field
1e0ef42bdb Remove unused imports and methods
38381c0a67 Fix Eclipse niggles in the examples
205386fe0d Merge code for a few more elements
9ff2f6bb63 Implement merge rules for a few more web.xml elements Required some refactoring as some of the rules depend on all fragments and the main web.xml
b2a01fcf0f Add support for absolute ordering of web fragments and the start of the fragment merge code
71a9e3a403 Clear the remaining Eclipse warnings in the examples
2e5d87706e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47987 Limit size of not found resources cache
80a770638a Revert r828212. The cache limit was applied to the wrong field. Thanks to Remy for the catch.
a6afb01f0a Refix https://issues.apache.org/bugzilla/show_bug.cgi?id=37848 Don't output info messages if there is no terminal Patch provided by Eric Herman
a55becd988 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47987 Limit size of not found resources cache
55c0124b92 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48009 Add a check in case the file is in the middle of being renamed. It isn't perfect (it can't be) but this should cover most cases
5803503a93 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=48019 Be more careful to skip over all of nodes we aren't interested it
3ceda0e837 Somewhat ironically, the call to java.beans.Introspector.flushCaches() that is meant to prevent memory leaks now causes a leak on reload due to a change in 1.6.0_15 onwards. Add a listener that prevents the leak.
e4a2736c93 Update to the latest schemas. Note the stated election to use the CDDL
8bfe4b88f4 Update example for updated Servlet 3.0
aec6fd076d Update spec classes for latest Servlet 3.0 API as of 2009-10-15. Update internals so Tomcat builds with the updated spec. Lots if stubbed impl marked with TODO.
6027f3913a Fix Eclipse warnings
f714bd15c4 Part 2 of CSRF protection for the host manager. Use POST and require valid nonce.
9aae973e18 Part 1 of CSRF protection for host manager. Move text interface from / to /text, add extra role for /text. Port 401.jsp and 404.jsp from manager.
a8e7cfdb62 Change of name for role
8ba819ec75 Change name of role for scripts
bfbb7c803d Use string manager for i18n.
81ca737bd1 simplify example
9023277b85 Add some modifications to the state machine. Timeout and error are an async dispatch, and its unclear what the state should be. Since both those actions should stop the event, we set the state to COMPLETING
ba50ce148d Add a simple asynchronous stock ticker. Some more refactoring around common code
0803d21457 Typos
e99c2e98b6 Update copyright
fc005907ed Fix misprint in a comment
963db42c2e Add an explicit test for JSPs. Grails - that is using a variant of this - seems to have issues with JSPs. Looks OK here.
29c1534bde Replace StringBuffer with StringBuilder
74d947876d Set svn:eol-style = native
27ae065393 No need for sync
0acf264298 Use a nonce to provide CSRF protection
eeb7a3bc3d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=40001 Use POST rather than GET for all operations that are not idempotent Partly based on a patch suggested by Daniel Naber Remove the "Are you sure?", partly due to lack of i18n support and since as (based on my recollection) as many people disliked the feature as liked it. Provides a (very) small measure of CSRF protection but lays the foundation for using a nonce with POST.
d6c71cc95e Refactor upload into its own method in preparation for moving some commands from GET to POST.
304849493f Fix the Eclipse warnings, add some additional comments. No functional change.
7f34709acc Explicitly mark all our valves so that we can track down which ones we need to fix and make async aware
51a640fa27 Just like filters, valves will have to be async aware in order for it to work properly.
e5e408a18e Add license
110b576db5 Abstract out code for output buffer, much easier to read
8725aafb3a Add a local bind otherwise for box with multi IP httpd may use the wrong port.
774b2ef5b7 propset eol-style
c6fc94ae95 consolidate two input buffers into one, no functional change, just abstract out exact same code used in two connectors
2185fbba9d Refactor the BIO connector to align it better for async support, this means a "poller" style for timeouts etc. First step is to allow the connector to do keep alive on more connections than we have threads. More changes to follow, good chance that NIO and BIO can share tons of code
ba7e3f48fc remove not needed entry
f9501f0b7d Remove Javadoc for method argument, that was erroneously added in r684270.
b24542c5ca Upgrade to pool 1.5.3
c2c72529c5 More docs tweaks based on Rainer's and Konstantin's feedback
a598cf0acd Ignore duplicate entries on the classpath. Patch could be smaller but change variable name to make new behaviour clear
3a69f7051d Fix BASE/HOME swap and add note re security manager.
50ac25dc74 Update tomcat-docs.xsl It is port of rev.821208 from tc6.0.x
5fedccb190 Use proper method to construct an URL string. File.toURI() takes care of absolute paths, trailing slashes in the names of directories, encoding of special characters such as '%'. Based on a suggestion by Rainer Jung.
6e02daa26e tomcat-coyote.jar (former tomcat-util.jar before rev.389946) is not needed by bootstrap classes
3cf789dfd6 Add port in the message.
ccd184ed9d Do not reuse sessionsList window to show sessionsDetail. It adds more sense to the "Close window" button on that page.
ac6c94a40c Do proper nesting of HTML tags and add DOCTYPE declaration.
d875a60948 Correct wording
1f7dee92ba Do not include ASF License comment into generated output
886da4efee Fix display of sessionList and sessionDetail pages in IE 6 and IE 7: do not include ASF License comment into generated output.
62ae3e1db8 Correct a pair of misprints
9558cd13d2 timeout can't be negative...
7456e8a498 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47324 Fix submit IRL when behind a reverse proxy Patch by Maik Jablonski
b26b229656 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47320 Don't rely on the platform default encoding being suitable to parse the session ID
581fa0ca7b DeltaManager needs to replicate changed attributes even if session gets invalidated. Otherwise session listeners will not see the right data on the secondary nodes.
dd53f91b52 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47499 Don't swallow BindException
6397651c94 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47267
842971b14e Use the re-factored JAR scanning code to scan JAR for web-fragments and parse any that are found. Discovered fragments are not yet used to configure the web app.
1cd860bc3c I refactored the location and missed this one in the previous commit.
0e746bd102 Remove the system properties the refactoring made unnecessary
b1b8f5d49e Refactor the TLD JAR scanning. This a) reduces duplication between Catalina and Jasper b) allows the Jar scanning to be controlled by configuration rather than system properties and c) (hopefully) allows the scanning code to be re-used for web-fragment.xml scanning The JSP TCK passes with this patch applied
6d281e537c Remove old Tomcat 6 file
23a1dbded0 Separate out Manager app roles Move /manager to /manager/text to simplify permissions Allows the future addition of extra security measures to one interface that might not make sense for another (usually these will be added to the HTML interface but that might not always be the case).
1d2981eca1 Fix copyright
88c040d66c Don't mark every servlet as the JSP Servlet
d4472efb94 Update test to use a resource that does exist.
426829809f Fix possible NPE when embedded
e2f1af7f91 Add a test case for https://issues.apache.org/bugzilla/show_bug.cgi?id=47866 Fix a couple of places where expected and actual were the wrong way around
c1ebca9287 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47231 Improve the SSL docs. Based on a patch by Sebb. Remove duplication of configuration parameters - it is better to reference the config docs to prevent the two lists of attributes getting out of sync.
39ccee758a Eclipse 3.5 has a new dead code detector. Fix various debug related logging issues found. Update copy of IntrospectionUtils in test suite (it was quicker than porting the individual fixes)
db3e7b3f60 Tabs -> 8 spaces
3f8717d7af First part of the Servlet3 web-fragment support. This patch inserts a stage into the web.xml processing. web.xml files are now parsed and loaded into an instance of WebXml and then that WebXml instance is used to configure the context. This will allow the subsequent addition of parsing and merging web-fragment.xml files. The hooks are in place to add this functionality but it has not yet been written. With the patch applied, the Servlet 2.5 TCK and JSP 2.1 TCK pass with the exception of the Servlet version number checks.
3808ad5d89 Add my new key
a4827ccf21 Replace parseException instance field
9794405b60 Enable the ability to disable the buffered writer. This does bunch of copying when writing using an async thread there is no need for such a thing
d8eae9432d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47225 Buffer length is end-offset
343084aefd Update to Maven deploy process. A SNAPHOT deployment of trunk should now work and include extras and embedded.
f59bbb93f2 Correct the SNAPSHOT version number
4534de60e5 Add the extra JARs, update version numbers and add a note about some issues I saw on Windows.
d72c5df03a Add a bunch of additional poms.
f2a9218421 BZ47852: Javadoc fixes. Patch by Sebb.
ab02c2b84a Use defaults where appropriate for jarIt macro A couple of minor packaging tweaks
3fc83420e4 Remove all traces of maxSpareThreads
e1cb9e4816 Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47161 Correctly report maxThreads Note 6.0.x will need a different fix as it still uses threadpools
f47f960e5f Fix Tomcat side of https://issues.apache.org/bugzilla/show_bug.cgi?id=46950 - adds new setVerify() method - uses it before renegotiation to change the cert verification level for the connection - increments minimum tc native version to 1.1.17 as it requires the new setVerify() method
1ecd1b29d0 Fix NPE if no filters are configured.
e0de7d5539 Make the setter do something.
8f31693fba Update the ignore list
f87024d1d5 Update version.
d0f1fd8726 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47828 Change Tomcat.setSilent() to setSilent(boolean) so it can be turned on and off
653e8d3992 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47827 Be more specific about the exception that is thrown
97aeb433fc Side-effect of fixing https://issues.apache.org/bugzilla/show_bug.cgi?id=47827 No need to declare throws Exception here
fa7a22ae93 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47820 Add non-static versions of static methods
5d72d4db28 Fixed https://issues.apache.org/bugzilla/show_bug.cgi?id=47819 Add source jar generation to embedded. Based on a patch by Dave Syer
820505d701 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47792 Some parameters documented as longs, are actually ints Patch provided by Phil Steitz
e1cc079e22 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47791 Update h2 download location Patch provided by Phil Steitz
8117a7c6cb Don't flush each time if we use a buffered output stream. It flushes for you
e3dea5f099 check for return from the queue
34b380f4e1 Refactoring of async logging handler. Much cleaner code achieves the exact same functionality. The fact that the queue is bounded means that we never have to worry about the size
c58d964069 Add in behavior and properties around async logging. Thinking about it, I think the exact same functionality can be achieved in a much simpler manner by just using a blocking queue. Will attempt that refactor next
21f9ef0a59 Allow buffer size to be configurable instead of accepting the default
dddc7045d1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47834 As well as the JAR as directory feature requested, this adds looking at all files to see if they are JARs rather than using the presence of a .jar extension. These features are optional for the Servlet spec but required for RFC66 in an OSGI environment. Both options are configurable with system properties and default to off.
bfd526e660 Unlikely, but handle it in case.
9b242e218b Another typo, spotted by sebb
392c37b8f3 Trivial typo correction
893e9f46e6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47425 Document the crlFile attribute
5ff3f5f4fd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47826 Broken debug message
4b004e2b33 Clean up unused imports and variables
f5f29c872b Trivial - fix an Eclipse warning
528209ba0e Switch to volatile for status flag used by multiple threads during cluster context startup.
b9fb7985b3 Put deps in right place - hopefully keep gump happy
d206b1dc1b Create a single embedded logging jar for log4j that just replaces the juli logging jar
4438a67b92 Clearer naming for embedded jars
e1094d8355 Since individual jars are made available for download, really should have LICENSE and NOTICE embedded in the JAR files. This patch enables per-jar NOTICE, LICENSE and manifest files with most using the defaults.
79739ddbb1 Add the Servlet 3.0 xsd's
3ecab0dba2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47824
01a27be864 Checked first 2 chapters
ee6358ae86 No functional change. Add new classes that will be used to store the results of parsing web.xml and web-fragment.xml files. The merging and ordering rules can't be handled in the digester so we now have to parse to a temporary store and then merge.
45da25fdb9 Remove TODO. Spec now includes ayncSupported in web.xml
5920f37844 Fix some niggles with icons in web.xml processing. Nothing that will cause a problem, just errors spotted whilst preparing for Servlet 3.0 fragment proceessing
348df6b75f Fix additional issue related to https://issues.apache.org/bugzilla/show_bug.cgi?id=45785 Exclude directories named *.jar for the extension validator Also simplify isDirectory() check as that includes exists() Based on a patch by Rolf Wojtech
902eb3dd19 Add additional permission required by JULI. Looks like the j.u.l.LogManager impl changed
553a783b0e Fix getter access of boolean attributes
574e25c755 Fix typo reported on users list
03c0dabcea Make the JDBC leak prevention play nicely with a security manager Don't use a fixed size buffer to load the class.
b7dfd51126 Remove reference to deleted class
09022d97b7 Add an method that enables JNDI and a test case to make sure it works
6312be80a3 Fix typo
3032abee6b Fix spelling and other minor niggles
5c30301ef1 Remove attribute duplication - pages were often out of sync
d30549f8e9 Fix typo
d83ce3377c Add a couple of TODOs
6f2dc07339 Add a TODO
fe6014ea28 Add a note about the classpath changes
a2e4587fdb Allow per instance selection of log4j or JULI logging.
5f78640b21 Remove version number reference so I can just copy this to 6 as it is updated
8d3533d5a4 More logging docs improvements: - remove some whitespace - reduce width slightly - add note about preventing zero length j.u.l files when using log4j - logs dir is relative to catalina.base, not catalina.home
1fa55afbed An attempt to improve the logging doc: - discuss java.util.logging first as it is the default - remove duplicate output from log4j config - stick to 80 char width where possible
b9374f29b0 Allow per instance log4j.properties, jar files (eg JDBC drivers) etc
336f75ed20 Make the PID improvements Solaris friendly. Add some more error checking to the stop command
b8b777ea63 https://issues.apache.org/bugzilla/show_bug.cgi?id=47705
34251aaf08 Allow welcome files without a physical backing. Inspired by this bug https://issues.apache.org/bugzilla/show_bug.cgi?id=47378
e0d6fee894 Fix regression in previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=38797 Update list of introduced variables before the tag body is processed in case they are used in the tag body.
159e86aaab Add in option to resize thread pool
8e4b0f8025 Abstract out most commonly used properties
df0b3fdfb7 First round of refactoring connectors. Remove the worker based thread pools Enable local or injected executors Add in a resizable executors interface to be used in future revisions start abstracting out and using a base class. There was one, deleted, since its not used anywhere
428ba8e869 Extract the SimpleHttpClient in to a separate class and move it to a more logical package since it will be reused. Don't override method unnecessarily. Add test case for bug 46243
476d3c8b40 Add a simple Hello World Servlet that can be used for testing.
dbeef435ee Add the Servlet 3.0 schemas
1a85bf9b15 Add CDDL election notice to imported Servlet 3.0 XSDs
b4596d12d6 Add another Servlet 3.0 XSD. This are the originals copied from the Glassfish repository. I'll add the election to use only the CDDL in the next commit.
87899415e6 Add the Servlet 3.0 XSDs. This are the originals copied from the Glassfish repository. I'll add the election to use only the CDDL in the next commit.
eeb96fce1b Replace the RequestDumperValve with a RequestDumperFilter. Merge the RequestDumperFilter from the examples with this new filter. Adds: - thread name to start of output line to make analysing output easier - request timings GSOC 2009 Based on a patch by Xie Xiaodong
fc2de960d2 Add a new logging formatter that just echos out the log message. Useful for the request dumper, access logs etc.
ec5c00d724 List filters alphabetically
4268784247 Clean-up / simplification.
1b1334a946 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44041 Remove previous sync that didn't fix the issue Make loadClass synchronized like java.lang.ClassLoader I was concerned about possible performance implications but I saw no detectable change in start-up time with this change.
7e1e6a357e Fix NPE if something tries to access resources accessed during a stop. This was seen when unpackWARs="false" and the JDBC clean up code tried to load the leak prevention class during a context stop.
7f23069d2a Don't sleep if there is nothing to sleep for. Update the usage text.
c646b54df2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47699 Better handling of PID files
1741caa9e7 Restore fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=42390 I have done some more testing with tag files, simple tags and tags and can't find any regressions. The TCK also passes.
0e52d54389 Fix some typos
ea61c38c77 The problem at sourceforge was solved. Revert to the original configuration, but leave a comment there.
69b803654a Return 'false' if nested copyDir call failed. It is part of the patch for issue 45403 that was applied in rev.804462
fe1ef9b54d Replace syncs with threadlocals. Improve the logic that determines when to generate a new format string
64629675c6 Apply Konstantin's new patch for https://issues.apache.org/bugzilla/show_bug.cgi?id=45403
4ea8cf44b1 Revert r701358 for https://issues.apache.org/bugzilla/show_bug.cgi?id=45403
c926dd0ec2 Deserialize with the webapp classloader as the context classloader
1e8cdcf0b2 Removed unused method ID'd by the unused code detector
ccbc5176f5 Make error message more meaningful
d4af49086f Add filtering of Comet events to the request filters Based on a patch provided by Xie Xiaodong as part of GSOC2009.
c2c586eebb Improve the JMX remote docs before proposing a backport
99dc7861d2 This todo was fixed
f00f35b0ec Expose filters via JMX. Filter config is now available via JMX in read-only form. Based on a patch provided by Xie Xiaodong as part of GSOC2009.
1c3213538f Typo
4b44cbf72f Remove another broken external. Not required. native sources are downloaded as part of the build process.
068185cbca keep track of which bits of the spec have been checked
8b30082140 Couple more unused imports
b63d32f81b Remove catalina import from spec classes
01adf0c471 Fix some Eclipse warnings
d562228867 Complete implementation of SessionCookieConfig
f050aa78e1 Minor code clean-up
2ece8d5920 Get SSL session tracking working again. If you use http you'll get new session ID on every request If you use https you get the SSL session ID
2cc6783fe8 minor refactoring, simplify initialization
6b99a251db Refactor location of AsyncContextImpl to o.a.catalina.core
cabcfe6caa Remove unnecessary tests and casts
517b8aacd0 Removed unused imports and an unused local variable reported by Eclipse
ea52d05fdb Fix some Eclipse warnings. Could remove the unused parameters but that would break the pattern of method signatures
856a23ecf3 Modify the embedded target so the extras package can be used if log4j logging is required.
e33e314001 Need to figure out how to set the context class loader here
526392a00f clarify name
ffeca1c51f Add in handling of async supported for filters during regular invokation and a dispatch
8c1b725985 One more use case
83af957ea7 If dispatch is called on a worker thread, simply execute it, instead of throwing exception. No need to hand off to container
11bfe0982c Another use case
5c5af42066 TLD handling improvements - make non standard behaviour configurable - add a few more log messages - sync method names
81a68a3c73 Minor tweaks that will make a later proposal (will follow when I have done some more testing) easier.
1d783ab30a remove non used import
dae006dc0e Fix links
2f8fb4cb3a path adjustments
55b4120e50 Start by working on use cases
7841605dcb more work on the complete
731b0405df a little more on the timeout part
e0340f7849 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47612 patch provided by sebb Abstract classes, private-> protected for subclass access
aeea2e3d6a patch by sebb for https://issues.apache.org/bugzilla/show_bug.cgi?id=47577
d23b076f24 apply patch from sebb for https://issues.apache.org/bugzilla/show_bug.cgi?id=47452
eac739e9b8 Add in support for XA drivers and connections. Update version
e89fbd95f6 Having fixed the typo, fix all the places it was referenced
6f33ed3d6b Fix the typo Costin spotted
f4b796c2a2 Correct JavaDocs. Patch by Xie Xiaodong (GSOC 2009)
661cc20d18 Remove unused imports
3e9a0cc58c Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47583 Fix timing related failures. Patch suggested by sebb
baac8c47c3 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47577 A handful of generics fixes.
a9cd71a23c Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47577 Cosmetic fixes. Main benefit is noise reduction in Eclipse error list
85c679f8f1 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47577 Imports / casts
360f42159c Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47577 Remove unused imports.
da1996f24e https://issues.apache.org/bugzilla/show_bug.cgi?id=47576 Fix exception name in Javadoc Patch provided by sebb
35073694ba Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47569 Use the new base class so tests clean up after themselves
4de55d1f49 Move the instance creation and clean-up to a base class so it can be re-used.
bb2863db6d Add missing test Re-arrange to try and make it easier to see what is what
1d10541dd4 Fix warning
677a1971ab Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47568 Create the tmp dir where intended Remove it when we are done
7e9a3967a7 Follow up to https://issues.apache.org/bugzilla/show_bug.cgi?id=47567 Add descriptions to the extras build script
ea2a4a0b34 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47567 Add some descriptions to the build file.
f6a316f9d8 Add thumbnail databases to svn ignore for all trunk (and related) folders containing images.
61daa522e3 Add missing files to distribution
720b06bba5 up the version
ab330e13b1 Remove a non occuring condition
c48798ccfd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41824 Need to use canonical rather than binary form when writing code
d5404df1a1 Temporarily use a mirror, while there is a problem with downloads.sourceforge.net https://sourceforge.net/apps/trac/sourceforge/ticket/2628
c0c0deac2f Update to NSIS 2.45 https://issues.apache.org/bugzilla/show_bug.cgi?id=47566
55c067ac4c update test cases
fed23ec7d7 Add in Linux special case for performance optimization around locking. Set default queue to be the fair one Remove unused code
e1b8c82b2c Correct build.properties.default file name in more build files and explain more explicit how the customization files work.
2fa5f097a4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46907 Debug logging should not cause the input stream to be swallowed There are better, less intrusive ways to read request bodies
53633875d4 Preparatory work for https://issues.apache.org/bugzilla/show_bug.cgi?id=40881 As proposed on the dev list, remove the Realm from GenericPrincipal
918e498616 Fix unused import
e251869d6a Correct the file name
e867e0e9bb Moved and renamed TestELParser class. Some more EL tests to be added later.
e8024347f5 Add proxy caching configuration information to valves docs
52aac801c7 fix recursive loops
04089827e0 Restore the @Overrides. Eclipse on my Mac wasn't configured right. Sorry for the noise.
1e6901cd57 Reorder the start sequence
0618fead6e Document Linux performance/overhead of using multi lock mechanism
019493ad34 Allow to run perf test as a one off
d9a28f191f remove not used classpath entries in the default setting
1cf50c5603 We can call dispatch after we dispatched.
5697fcfa06 More @Override complaints on Mac
eff86b70ef Mac compiler doesn't like @Override on methods implementing an interface.
6ac1f0d186 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47518 Fix reference to old method in Valve Javadoc Patch by Christopher Schultz
e78978d6ce Sync up the Catalina and Jasper TLD scanning code prior to adding some optional extensions for the embedded use case. A couple of options from the Jasper side have been removed as they were only ever used with one value. The JSP 2.1 TCK passes with these changes.
f8497549cf Why do I always spot comment typos 2s after I commit a change?
9bbcd9a544 Make sure the duplicateUri flag is reset each time a TLD file is parsed. This was causing seemly random TCK failures depending on the order the tests were run in.
2c666b26b7 Revert the TldConfig part of r795860. It appears to have introduced intermittent TCK failures.
47e26f2f32 Sync the TLD file scanning code for WEB-INF between Catalina and Jasper - Based on the Jasper algorithm - Uses additional checks from Catalina (Jasper now ignores TLD files in WEB-INF/lib and WEB-INF classes) - Adds comments noting the need to keep the two implementations in sync
7f74a87c74 resourcePath doesn't end in / so need to use exact match to ensure on WEB-INF/lib gets excluded and not WEB-INF/libxtz
2370e74971 Add a note about keeping processing order in sync.
fec57786ec Align the processing order. Need to scan WEB-INF before we scan all the JARs in the class loader hierarchy
ec30a2a7cd Better method name
f0f48c84c9 If TLDs are defined in web.xml, duplicates are expected so only log at debug
c221f23c62 Align tag library URIs in web.xml, TLDs and JSPs. Note that the inconsistencies didn't break anything as the TLD scanning found all the various URIs
513f0ee302 Tab police
fb682f899e Use an import
ba0e97374a During a release, arguments are null
fb244f7a3a Add missing interface. Invalidates the 1.0.6 tag
c3caa67f83 start implementing concurrency around the state machine startAsync and complete() are to be thread safe operations
6915871d00 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47413 First part of a composite expression "${a}${b}" was not coerced to String
662676f709 Rewrote (reworded) the Javadoc comment for JvmRouteBinderValve class.
0f9d8ef662 Fixed https://issues.apache.org/bugzilla/show_bug.cgi?id=41564 Updated Tomcat6 to Tomcat 7 I couldn't see anything obviously obsolete so I removed the warning.
3cd1a38807 implement AsyncContext.dispatch and AsyncContext.start methods
a4486c86d0 the dispatcher type should be ASYNC when we are doing a dispatch
35bbbc374c Add notes
cb720160a5 Async patches phase 1 - Async means the container thread can back out. This means that valves need to be async aware. For example, access log valve, can no longer log upon exit of the method since the thread can back out based on async behavior.
f99ca8f9fd very simple async example
fde8ea6384 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41661 Thread safety issue with JspConfig.init(). There is one JspConfig object per context and as per 41661, issues have been seen with this on real systems.
d19c1961c8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41059 Reduce one possible source of errors if using ENABLE_CLEAR_REFERENCES=true Patch by Curt Arnold
a0e8fc41c6 Part 1 of a series of commits to align the Catalina and Jasper TLD scanning code and to provide additional features when embedding. This first commit modifies the Catalina code to: - better match the spec - improve logging The JSP TCK passes with this patch applied
28a17876b0 Make info message less harsh
19d6701031 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=40551 Enable the JvmRouteBinderValve to work with PersistentManagers as well as clusters
6e84813493 Add the docs I forgot in the previous GSOC commit
a2de4ca833 More GSOC work from Xie Xiadong Initial implementation of RemoteHost and RemoteAddr filters.
f1b05af5e1 Refactor the dispatcher types from int and Integer to the one supplied by the Servlet specification.
60b786355b Make clear this isn't the complete list if tag libraries for the app.
ee3a31808c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47515 Patch submitted by Ryuichi Yoshihara
7605a75133 Constants should be just that.
65d294adbe Remove commons logging reference - this copy of the digester doesn't use it.
c611a66bf5 Remainder of fix in trunk for 47444 Update references to Jakarta in Javadoc and JspC
d9277345ee Remove Jakarta references from the docs. Update those sections of the docs as necessary.
e016aa9af6 Tab police
8bcf2d0861 Remove commented out reference to the balancer web-app. This is not included in trunk.
8d557b7d53 Partial fix for bug 47444. Update taglib URIs in examples, removing Jakarta references
e0316d5866 Start working on async, fairly similar to comet but much more convulated. I'm gonna do checkins in fairly small chunks so folks can tag along and help out. Instead of doing one giant checkin
96ee9c8d2c JNDI lookup errors often only include part of the name being looked up. Provide debug logging that includes the complete name and how it was requested.
bfc7b16dae Add experimental new queue, runs faster but is not yet complete and needs some work around concurrency, iterators and remove operations
d4f45cd60d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=40380 Correct synchronisation of expire() Should now only run one per session
f39cc0a567 Implements, doesn't override
02a9cfd276 Fix typo
aafd407113 More doco
a00ef846d6 more javadoc
4c335e8311 Patch by arielandres@hotmail.com Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=47524
8abcc8a575 Allow encoding to be specified for JULI FileHandler, and its subclasses (AsyncFileHandler).
4a6a6fdbd2 Some initial implementations for the 3.0 dynamic registration methods. Moving back web.xml config to separate package - with annotations requiring scanning of all files it needs to be done at deploy time - so it'll be better to just load a .ser file at startup.
71ab89d9c8 Fix
64f278ec5a Fix test case
fbe742981c more javadoc and corrections
7da00bd39c 1. Ensure that any user defined CLASSPATH variables are not used on startup (as is already implemented since rev.303663), but now allow them to be specified in setenv.sh, in rare case when it is needed.
9d5c1057ca remove not used methods
f79b995554 Add tons of javadoc Remove the finalizers, they behave way differently in the new JDK, so let the programmer be responsible for closures
0c9b852127 Replace o.a.catalina.util.StringManager with o.a.tomcat.util.res.StringManager Catalina depends on o.a.tomcat.util already Reduces duplicate code (which was also out of sync with latest updates) The svn log for o.a.catalina.util.StringManager suggests this was the plan
5586494b40 Prep required for the o.a.tomcat.util.res.StringManager to replace the o.a.c.util.StringManager Adds handling for when classloaders common != server != shared
1d94b0fe1a Remove unused classes identified by the UCDetector plug-in
f74b497577 Update to commons pool 1.5.2 to get latest fixes
09dba9e9b6 Explicitely return value 0 if we return without error from setclasspath.bat. Otherwise errorlevel in catalina.bat is not reset.
6d3e6e79e9 Track the TLD URIs processed for each webapp and don't process duplicates. Because this tracks duplicate status in the RuleSet, each digester needs its own RuleSet rather than sharing the static one.
660ccd458a Clear props - stops weird TortoiseSvn behaviour
b2dc206bd8 Add some ignores
bfbd1a35c0 Create a package file for the JavaDoc main package
9a48e38b52 Alternative fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=39194 Only add tools.jar to classpath when using debug option Remove references to undocumented, half-implemented javac option Remove unused environment variables
d0c2e03f2e Revert r791331 that fixed https://issues.apache.org/bugzilla/show_bug.cgi?id=39194
210a5d7b1f fix assertion
e4370b811e Some more concurrency testing
ac0c48bfe5 Fix a concurrency issue with connections being released and then trying to be reconnected
09d785b50f javadoc
c75ccaa46e correct dependency
91bda69225 javadoc corrections
6dacea9763 remove dbcp add classpath to javadoc start documenting DataSource
ce1c1e1d82 were not using DBCP anywhere
22a38a4595 correct counter behavior.
600c17cf82 Better notes for future reference
111653589b Revert r792945 - JSP.7.3.6.1 explicitly states locations without a leading '/' are to be treated as relative to web.xml
b119bd04b8 Added some comments and more thread safety around the size of the pool
c49465d40c Add documentation and clarification around JMX
8ebc7b981d Correct location of taglib element varies with spec version. WebRuleSet was using 2.3 and earlier location. Update it to a) support 2.4 and later as well as 2.3 and earlier b) complain if taglib definition location is not consistent with declared spec version.
f15822429f Add manifest to binary JAR Fix XML error in doc
d27317fb77 Add new jar to TLD exclusion list
d4006af78e Servlet DTD and JSP spec are both quite clear that a <taglib-location> is <quote>a resource relative to the root of the web application</quote>
d44d88ab10 Fix infinite loop. Spotted by GSOC student Xie Xiaodong.
6bc31d58df Needs to be volatile as it is used in double checked locking
a42b2ca7ca Remove unused properties: build.xml uses them, but dist.xml and extras.xml do not
245e16c9d6 Remove build-webapps-precompile target from dist.xml Discussion: http://markmail.org/thread/ymgbgqm3lav6rnjh
52cef62359 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47149 Explicitly specify encoding for the source files
7dc814c904 Reduce coupling between StandardSession and JAAS as per Filip's suggestion
ac6985cab8 remove dependency on the modeler so that the pool can run outside of tomcat and still have jmx query notifications.
5f218ac0a6 Add a manifest template for an osgi bundle
bdfaffd0bc Document a missing option
db44783161 Improve shutdown time for NIO connectors, to block in a minimal fashion, yet leave the pollers time to close out their connections
ddd0e88cdb When shutting down, to so immediately
863bca4c8e Add milliseconds, seconds is not granular enough for log entries
ba55d27b10 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=39231 The JAAS contract for LoginModule says we have to call logout(). This won't always work (eg if there is no session) but is a reasonable effort.
7c73fa2140 Remove standardSession strings not used by DeltaSession
7b03959ed1 Upper case was a red herring. Thanks to http://greenbytes.de/tech/webdav/webdav-redirector-list.html
0d6b985231 Typo
4c8e4d69b0 XP 32-bit SP3 works with the re-direct
ebf94bbc0b Make webDAV fix filter more sophisticated. Eventual aim is to provide fixes tailored to whichever broken client is trying to connect. Once I figure out how the client is broken of course. In the meantime, log when we know things go wrong. First up XP x64 SP2.
42d0a5d97c Fix copy and paste error
31e2a58798 Convert the WebDAV fix valve to a filter. Based on a patch provided by Xie Xiaodong as part of GSOC 2009
8f3d285a19 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47478 Patch provided by Keiichi Fujino
97671088e5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=39194 Align classpath for all platforms:  - only add tools.jar to the classpath when required  - document optional javac argument for catalina.sh|bat  - make sure javac without generating warnings on start Include a patch for setclasspath.sh by Jason Brittain
ab51f26b3d Add the CLAASSPATH to the output (will be useful while working on 39194 as well as generally useful to see if it has been modified from the default) Fix a minor alignment niggle with JRE_HOME in cataina.sh
fccd3da89c As of JDK 1.4, JSSE was no longer a separate download No need to include it in the startup scripts
95f6b03000 missprint
92724c1876 add indent
87693d1e39 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=39089 Add a know issues section to the Jasper docs detailing the error described in 39089 and providing some possible workarounds
e708985645 Improve error message to include TDL uri when there is a problem with a tld so user knows which TLD to look at
a2f3800dd8 Remove deprecated methods that are no longer used
1dad3155b3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38797 Revert previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=37933 and implement an alternative that doesn't have the side effects described in 38797
638065047e Revert generics changes that require changes in spec classes
4e3bf7bc55 Specify explicit encoding when performing replace task.
638bcbd4e3 Fix generics warnings
8d22f8b08d Added **/*.rtf to the list of exclusions and sorted it alphabetically. (We have a License.rtf file)
e4c2cd2a21 Deprecation fixes
c3349b3674 Remove some unused code
1a0eab9fed Fix generics warnings
ccec11a398 Explicitly specify encoding for the source files Fixes https://issues.apache.org/bugzilla/show_bug.cgi?id=47149
95dabb5259 Move everyone MarkMail says hasn't committed to trunk to retired. Crude, but results match what I expected.
622d34390a Add me. Needs more cleanup for TC7
6d5716e234 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47443 Point to wiki for support rather than non-existent Jakarta page
758566b31c break out javadoc into its own target
c7ae231ed6 Add some doco, make shared variables volatile
b80d78b720 Since testing is an optional feature, as Sebb said, we don't need the licenses defined
218e8e4f91 Be consistent - use singular rather than plural
cb83a7ecf2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=37984 Strip {MD5} as well as {SHA} from digested passwords
62b99d9148 Remove unused import
378569cae7 Remove some obsolete (and partially broken) message strings.
93a32db4b9 Correct url
a4ee8d2eaf Revert r784853 - it broke most of the links in the left hand navigation menu for the docs
4b4bbdec89 Apply patch by sebb from https://issues.apache.org/bugzilla/show_bug.cgi?id=47458 Store db properties in build.properties using a prefix of testdb
5b7ccd65f1 Use statics to reduce number of instances to one per thread rather than one per thread per access log. Also make thread local final as per discussion on dev list.
f255d8d5a3 Remove all usage of GPL or LGPL downloads. Use H2 for test database (EPL1.0) as it can be downloaded and easily embedded. Derby didn't work, too slow to populate test data with. Add Javadoc per Sebb's suggestion. Add EPL and CPL to LICENSE since we use it in the unit test cases.
046d918eb4 Add props changes missed in r789389
5a41b8d05d Fix the JDBC driver clean-up. This was broken with the latest 1.4.x, 1.5.x and 1.6.x JVMs as they checked if the classloader of the caller, which for the WebappClassLoader was the common loader. It's not pretty, so there are plenty of comments explaining what is going on.
0772013d83 Make alphabetical
d93cbcc336 Make properties configurable and resolve https://issues.apache.org/bugzilla/show_bug.cgi?id=47440
dab0c7615e Better error message according to https://issues.apache.org/bugzilla/show_bug.cgi?id=47439
3aad68d5f9 Adjust Main
8ff004b6ff Adjusting the tests
5cf5816a7d - added new methods stups from servlet, so it compiles - removed all deps on coyote, it can now run with the new async connector from sandbox ( still need to update ). Coyote is still the default - various cleanups in the simple/example integration support - still passes all watchdog servlet and all but 7 jsp tests - more separation between the servlets/filters and the engine - and few tweaks to allow file servlet to be used in other containers.
064599f9dc Very minor niggle
42dac8fb35 Ant doesn't merge two zipfilesets
34a2cdbfb1 Do not evaluate the same string twice.
72be9fd976 Updated the changelog
5e94b1b698 Updated Jasper runtime and JspC to use "1.6" as the values for compilerSourceVM, compilerTargetVM options by default, as Tomcat 7 runs on JRE 1.6+
de769ec538 Revert r787678. Needs a rethink as Catalina TLD scanning did not require a URLClassLoader whereas the Jasper code does.
556f5da2c5 Use correct encoding for error/debug messages include parameter bytes
cfffa344a7 Fix the if/else. Thanks Konstanting for spotting that
52a8caa6b3 fix typos
b6d8c87e3f Use correct return values from FindCpuType function
e6ed706e2d shorten timeout
86fddba913 Only test timeout
a1ef3d4948 Fix slow query report to keep stats if we set the count to larger than 0
1cc6aaddd6 Wrapped and shortened lines, to lessen horizontal scrolling. Replaced tabs with spaces in one of <source/> fragments, because tabs result in misalignment of box border in Firefox 3.
f578fb96e7 Dont try to run the base test
03468809f6 Fix halfway test
e68380e8e5 Fix message
bc01f300eb Align TLD scanning code between Jasper & Catalina (make Catalina like Jasper) - Still two copies (no easy way to avoid that) but at least only a single algorithm - Adds support for JAR URLs (useful when embedding) to TldConfig - Add comments to remind people to keep code in sync - JSP TCK passes
113a2fdcb5 Exclipse download location changed. The previous now returns 404
0c8ded01b5 Make a default build target that builds automatically without need to know what.
0242bdcae9 Remove call that doesn't do anything.
d0e3b44fc4 Fix typo
2c4297e272 Remove a couple of unused classes
724e8803cc Clean up the debug logging impl
ca93ca6dd5 Remove some unused code, some of which appears to date from Tomcat 3.
16afe9acb6 Only copy the original parameters is debug is enabled. Otherwise, live with the corruption but tell user how to get non-corrupted data
69612898d6 Use correct CPU names
0a5cc49ae7 Use correct directoy names for exclusion
c0476bb6ab Implement new windows-[cpu].zip ditribution packages
dc10592001 Don't create the test table during the run
ad786734d7 Add in test runner
498a0e2fc1 Refactor to be more independent, so that one can build from source archive without too many hooplas as suggested by sebb
fb1ec04eff A more sensible default to avoid too many  character array allocations
9364e0b6b4 Minimize thread local access when possible, since thread local does a map lookup. Idea by kkolinko
0e2798b247 Fix a couple of Eclipse warnings
f19d274552 Don't call silent by default. Add the life-cycle listener to the silenced loggers.
84c0f23069 Remove unnecessary code that just leads to a warning in the logs
646cfd2979 Simplify, simplify. Thanks to sebb.
c97c67253d Can't use queryMB as that isn't the only source.
71f67c1c1d As per http://www.apache.org/dev/crypto.html#inform add a crypto notice to each of the releases
be5720460b Switch to ThreadLocal where possible. This removes all the syncs apart from those related to accessing the log file.
112ce34e2c Add two more implementations for the second test. a) using a single ThreadLocal instead of multiple ones b) also using StringBuilder instead of StringBuffer Also, replaced class.getName() with class.getSimpleName() in the status message.
234b7c7fef As per Filip's suggestions: - reduce object creation - better use of ThreadLocals
0d0825d262 shortened
dc52eb5909 correction
65eba3c2cc Remove duplicate code - my bad from r781779. Thanks to sebb for spotting it.
60fa3eff7a Correct per sebb/markt
47699fe0c4 Update to pool 1.5.1 - fixes regression in 1.5
aa4ccd1567 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38352 The JSPLoader needs to have read/write permission to the context's temp directory, as per the spec.
25a5d62b38 Headers should be compared ignoring case. Reported by Tim F.
6d495e4d42 Add a header case-sensitivity test for 37794 test case (as reported by Tim)
fcc920c400 Added toString() call to the StringBuffer. The tests will run a bit slower because of that. Added two other implementation variants for the first test.
2320f1ff80 Add an additional volatile from a review of the associated benchmark tests. Add a sync to deal with the issue filip reported in the 5.5.x status file
d276e015ee Rewrote the benchmarks, to allow more than 2 different implementations to be compared.
3513434210 Undo accidental commit of files that should not have been included in r786471. These will follow separately with the correct comments. Sorry for the noise.
2668f66f7b The servletapi gives us a perfectly good constant for 'javax.servlet.context.tempdir'. Use it.
aac5c66ecc As per review comments: - use StringBuilder - add comment to explain one possible cause - better logging using original data
5c99d39312 Minor improvements - as per Sebb's comment on the dev list - need to add a volatile - correct the log message
1d1a41f3cc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47308 Patch provided by Keiichi Fujino with one change, default is false
2f35e2f500 Fix demo
5e8ddd9390 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47389 patch provided by  Keiichi Fujino
cb0673cc22 Add volatiles as suggested by Tim to align code with AccessLogValve. No significant change to results (on my machine at least ;)
c36241916e Expand sync within rotatable block to fix a couple of issues:  - fileDateFormatter is a SimpleDateFormat which is not thread safe  - the rotationLastChecked needs to be volatile to ensure we don't execute the sync'd block multiple times Although this is a sync on 'this' in log which gets called for every request:  - a similar sync occurs in getDate() for every request with minimal performance impact  - microbenchmarks suggest that a sync on 'this' has similar performance to using ThreadLocals
7e39d733e5 Add some micro-benchmarks that enable the differences between the Sync and ThreadLocal approach to be compared
dc70315430 It is followup to rev.785768. Updating the comment in the web.xml to align with the docs. We know that this version of Tomcat cannot run on JDK 1.4.
de1e9f8fb8 Disable the code that detects the value for compilerSourceVM, compilerTargetVM options, because we know that this version of Tomcat cannot run on JDK 1.4. Update the doc.
83fb56f18d trivial: corrected spelling errors in docs
c8a13ad12f Add common FindCpuType function. The problem is that environment variable doesn't always set AMD64. This is true only for amd processors. If present and not IA64 the %PROCESSOR_ARCHITEW6432% must be x86_64
6006f676d7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=37794 Handle chunked POSTs. If maxPostSize is exceeded, a 500 results.
56983ccd93 Better comment
85bd060643 Test case for bug 37794. The generic code will move out of this class if it turns out to be useful for other test cases
8d9e00d987 Exclude windows binaries from the .zip and .tar.gz packages
90e2527198 Fix tomcat installer script by using the correct files and new locations. Also decide which version of tcnative-1.dll to install according to the CPU architecture
d23078757f Exclude service.bat from package-zip and package-tgz. It is now part of package-native, since it is only usable together with service wrapper
34079973e7 Add package-natives target
6453a64789 Fix nested tasks for download
767ab0fd93 Download IA64 tcnative-1.dll as well
2dd736aed8 Merge tests into main build.xml as an optional target. Hopefully start to use Tomcat class as basis for test cases for bugs.
4558484f78 Default appBase change was causing errors. Use the old value for this test case.
013d0ae09d Fix comments
200e871e0e Add missing pom
7271375f48 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47369 Patch provided by Keiichi Fujino
b570a0255e checked in the raw license
229492973a Fix documentation
affb231272 Fix copyright year
9d6c2cc08b Correct name
ad272ac494 Add in NOTICE and LICENSE file. Fix the links in the documentation.
b4bc9abb19 Add in relative path to the left side menu. It's . by default so no changes. But this lets one generate docs and point to a location.
8a99d1917a Sorry for the noise - finger trouble
5fc5d61180 Opps. Shouldn't have renamed this.
507c2fffbd Opps. Shouldn't have renamed this.
2d63a78772 Partly address bug 47124: Name unit tests consistently. All JUnit test cases are named Test*. There was at least one class named Test* that was not a JUnit test case. These were renamed *Test. Helper / stub implementations are named Tester*
05a575cb6d Remove some unused Jasper code.
2b10a2459c Align programmatic web.xml defaults with conf/web.xml Don't set anything that is already set by default Switch to a context listener for the defaults so they get applied on re-load
7f17157631 Remove more unused, deprecated code in Jasper
15c2f06d20 Remove unused, deprecated code in Jasper
dce0e6d0b8 Remove deprecated Ant tasks
04a2afe1ff fix misprints in comments and javadoc
a164ed791c Do not increment access counter. The valve updates access time, but it should not increment access counter without decrementing it.
ccfbd464ae Remove case insensitivity option. It was a workaround for a change in Tomcat 3 and has security implications if used on case insensitive file systems.
2e0656d96b Enhancements to fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=43343 based on kkolinko's review
e918e23adc More error checking
4fd291a722 Fix typo. Add aliases to changelog
1bca774433 Implement alias resources. Key features: - configured at the context level in the same way as the other resource related attributes - maps paths to directories or WAR files (single files not supported)
97fd78b53a Code clean-up.
34e35e2109 Code clean-up.
8ff18eb2be Code clean-up. Fix a few warnings.
17ab63020f Remove unused code
f81a761c02 Fix typo in the docs.
10961f08c2 There are no 64-bit GUI binaries. (see rev.779927,-28,-30) The 32-bit version can manage both 32 and 64 bit tomcat(X).exe Updating the build scripts accordingly.
755cbc8f28 Remove some experimental code
ed8a203d8d Provide documentation for deployer.
d96356cbe7 This was moved to the context
9b681f3ab5 Document emptySessionPath behavior
8b96ac0304 Experiment with the UCDetector (Unused Code Detector) plug-in for Eclipse. Remove all the code from the class that isn't used anywhere in Tomcat.
7b2ab0cbc0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47343 Regression in https://issues.apache.org/bugzilla/show_bug.cgi?id=42747 context.xml can now be edited without resources being deleted
c4b20ef8e4 Fix download task dependency for commons-pool and commons-dbcp.
4496c0ae58 Log context deployment consistently at info level, regardless of war/dir/xml
59c364ab81 Provide a little more information in the logs when parameters are invalid. Speeds up the process of tracking down the broken request in the access log. Don't show the stack trace unless debug is enabled.
dc96bb5db7 Update commons pool to 1.5. Pool 1.5 fixes a number of concurrency bugs and introduces fair allocation so the first thread to ask for an object from the pool is the first thread to get it.
2b0151b71b DBCP no longer requires commons-collections. Removed used lib from build.
3ad24c3b99 Add the executor to be part of the JMX output
e840b3fc75 Revert my previously not so clever implementation. If there is an executor being used, then one shall expect that the executor is reporting the numbers of threads itself, and it should no longer be the responsibility of the connector
bfffea1b38 Better fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47318 Process include preludes and codas for top level JSP pages only
febb581b3b Revert r782166 as it introduced a regression of its own.
1ee5ca6dd0 As per kkolinko's comment - remove old comment
892bbda47d Restore correct mime-type for MS Word
0a176f2ee6 Put a short timeout on the unlock accept
0029416c27 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47237 There is no need to associate the Http11NioProcessor with a socket in between requests unless there is a comet.
ecc2fb6f2e Take into account that executors can be provided, standard and non standard thread pool executors through config or programmatically. Hence we want to expose the correct values for curThread and curThreadBusy
f49f5daaa1 Revert http://svn.apache.org/viewvc?view=rev&revision=763566 The code is not the same as it was before. The patch applied, while it looks the same will grow the pool the max threads even though it doesn't need to
918479c696 Use a more sensible default. Patch suggested by Ian Darwin.
264cb793bb Remove a deprecated method
c0cf6e9a32 Create for bash
4794e35423 login -> authenticate
4403d147bc Add default
bb66bef6e4 Update types
1120c8adab Fix copy and paste error
44a5e33eb9 Cosmetic changes  - make since tags consistent  - Add TODOs were required  - Fix copy and paste errors in javadoc
1830ea3e69 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47318 Process include preludes and codas when processing directives and whole pages.
5a5fc74187 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47299 Simplify fireContainerEvent method and enable it to work with implementations that extend StandardContext. See http://svn.apache.org/viewvc?view=rev&revision=287710 for why it was written this way originally.
6f971f0f48 Differentiate between APR having been initialised and being available. Changes the meaning of aprInitialized so will not propose for back port.
fcd0135a59 Fix the logic for the min version tests
717c804ef7 Allow trunk to work with native trunk (1.2.x) and the 1.1.x branch. Update recommended version to latest. Note minor version number changes are meant to be binary compatible with previous versions.
eb4eb098ef Fix wording on version warning message
bdf91c875f Simplify logging.
53e078b42c Don't try an init APR in the connector. Let the listener do it. Prevents unexpected enabling of APR just because the DLL is present.
17ada32b49 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47158 Thread safety issues
45eeb1ad47 Order mime-mappings alphabetically. Makes finding dups a lot easier. Remove older of ms dups were present.
b15df6ab51 Consolidate directory creation from doing it in multiple places with no indication of failure and only for xmlBase to create directories during the startup phase for both appBase and xmlBase
a2bd929a99 Update to 2.0.5 tag and remove 64-bit GUI binaries
236641ce75 Fix bz41564 by adding /user option to service.bat which respawns the service.bat using runas command. This pops-up a new window with elevated security on Vista+
0823694b7e Remove a few lines of redundant code
daa6e41cca Fix case B in bug 43343. Don't try to swap out a session that is being accessed.
fa07a94af1 Stop access count going negative when session is swapped in. This fix is required for the fix for bug 43343.
c600bc09ca Reduce visibility of parseHost as discussed as a side issue to bug 47216.
bdc4a42958 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47228 Correct French spellings. Patch provided by Sebb. (Trusting that his French is a lot better than mine)
eb4a51724e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47235 Remove use of auto-reconnect flag from MySQL examples
4bdfd7e7a8 Remove ServerFactory class
af1e9b7612 Remove unused import
e8fb20d564 Remove last reference to ServerFactory
18b3e22ecf Clean up imports
333f8a1d66 Doh. Commit complete patch to remove ServerFactory rather than previous half-finished version.
ace5c3db3b Some more ServerFactory removal.
002ad4861a Remove unused methods, and with them a few more references to ServerFactory
11e398e1f5 Yet more ServerFactory removal. Make exception handling consistent.
8bedc668ea More ServerFactory removal
ebe0b14eb7 Remove another ServerFactory reference
dc11c9ffe8 Remove another reference to the ServerFactory singleton. Remove unused engine attribute.
942fa67a54 Remove some unused code. Tested the basics and all seems OK.
f1f0099296 Fix copyright. Patch by kkolinko.
76e4685d94 Revert patch for 42390. More tetsing required.
9b42d2f2ad Fix JavaDoc aspects of bug 46985. Based on kkolinko's proposed patch.
f74ebc9d9c Removed some casts. Patch suggested by kkolinko
cefaf980d9 Stop build process adding extra blank line to end of files in .tar.gz src distro - missed a few in previous commit
433ddb0f47 Stop build process adding extra blank line to end of files in .tar.gz src distro
d6859f08a2 More missing svn properties.
62a5120281 Subversion property cleanup.
6ffcb64b99 Make a few methods static so they can easily be used from other classes (like LifecycleListeners) Add a note about manual context configuration and reload.
91742f0a58 Add missing keywords svn property. Already applied to tc6.
6bc5b8ad49 Consolidate the use of service start time into one local variable https://issues.apache.org/bugzilla/show_bug.cgi?id=47234
ef21207556 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44943 Reduce copy/paste issues caused by different engine names. Applying the same fix to exe installations of Tomcat.
cdf2fa7e6b Build files: Calculate current year automatically by using <tstamp>.
711b9850a1 Update to NSIS 2.44
9013b8f90a Build files: Apply explicit encoding to all operations that perform filtering. Those are: 1) <copy>, when filtering is used (has filtering="true" or has a nested <filterset>), 2) <fixcrlf>
096e9502b8 Fix typo
b3945d074c Fix the other getServer() - sorry for the noise
b7b049c477 Slightly better approch
8a918bb756 close stream after error
789639b0c5 More ServerFactory surgery
9602d23eed Remove some unnecessary code
ad8dbe3e76 Start process of removing o.a.c.ServerFactory. Need to do this so: a) The current o.a.c.startup.Tomcat tests pass b) We can start to use o.a.c.startup.Tomcat for some new unit tests This removes ServerFactory from the Realms
ab855a0eb5 Update test cases with a dummy driver
ca92650e36 Added in blank dummies for tests
09554b15a5 Make connection objects non reusable. Once release has been called, it can't be reused. This makes the sizing algorithm easier C3P0 leaks connections during the fairness test, reaches 20 connections even max is set to 10
012a56cf11 Put tests in right package
e0b2ed94e0 Clean up inspired by https://issues.apache.org/bugzilla/show_bug.cgi?id=47111 Remove unused code.
4835da2221 Tab police and other whitespace issues
56773b89e8 Move file for consistency. May ultimately move test.xml inside build.xml
3505393f77 Changes as a result of https://issues.apache.org/bugzilla/show_bug.cgi?id=47124 Add JUnit to build Provide TestSuite to run all tests
ed73e9a6f3 Add all of the Tribes tests to the test suite. Some of these fail.
272cfb6001 Implement a hard limit, the 'optimistic' sizing limit is way to optimistic, and can let the pool grow a bit too fast. A hard limit stays hard. Clean up pooled connection a bit
eba879d187 Fix logger level to not show up by default Add fairness tests to all
3e087d536a Fix closure of connections in test cases
f2775468db Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47086 Include the 64-bit windows binaries in the distribution Update the Windows installer to:  - auto detect the platform and install the correct binary for x86/amd64/ia64  - look for a 64-bit JVM on 64-bit platforms  - write the service registry information to the 64 bit section of the registry (rather than Wow6432Node) on 64-bit machines
b37e95bf9a Update file names for TC7
70342ffbd0 Fix 47080: NPE in RealmBase.findSecurityConstraints when uri is null https://issues.apache.org/bugzilla/show_bug.cgi?id=47080
910aed0cb4 Add generics, remove unused field
accd240551 Tab police
2bca9a2117 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47050 Remove unnecessary filtering
1c2d385044 Prepare for next build
8c3d1ac1a3 doco
f13603f5e2 Add the following features - max age for a connection kept alive - an ability to reset the abandon timer when queries are executed - an abandoned test, abandon when a percentage of the pool has been utilized
1fff9a2b5e Add an experimental embedded build target to use with o.a.c.startup.Tomcat
59d8cfaf1f JMX expects service name and engine name to be the same.
03e8d62fa7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=47046 Unregister all MBeans, including when non-default engine names are used (which changes the domain of some of the MBeans)
206a24a5eb warp is long gone
9d3a85a995 Remove Reloader interface that is never used.
64cb67714b Reduce scope - partial application of patch by Jens Kapitza from bug 46999
83683dd52c Delete deprecated class.
8972a2adef BZ 46925: Improve search for nested roles in JNDIRealm by replacing recursive search with iterative search. Patch provided by Stefan Zoerner.
21cc32a064 Reduce dependency on URLClassloader. Allow custom Loader elements to use ClassLoader rather than URLClassLoader.
e2ee356399 WebappLoader expects loaderClass to be an instance of o.a.c.loader.WebappClassloader so add that to the docs
8b5cd22033 Another unused method
59e5c4fd66 Remove unused / deprecated code
a50418eb78 Add c3p0 as a comparison in the fairness test
27d3888236 Dequeu is a Java 6 API
9bbb7cfe8d Update for April draft of servlet spec. Some 3.0 stuff that was complete will need to be re-done
6f9c466ebd Added in c3p0 to the performance tests, it doesn't even perform as well as DBCP, which is contradictory to what the internet is claiming
ad065d29bd Configure fair queue by default, its faster. Implement logic around when/how connections are treated as abandoned. First one is by pool utilization, abandonWhenPercentageFull, the second one is to add a ResetAbandonTimer interceptor, so when successful invokations take place on the connection, it resets the time
fce0f6dc40 Allow the factory attribute on the ResourceLink element. Make sure that ResourceBase properties are transferred to the ResourceLinkRef
26d238e73f Add dependency to tomcat 7 now
6a1d8d386a not sure what went wrong, my SVN is going ape #!$
5f2ccabf40 The fair queue outperforms the j.u.c blocking queue implementation. lets use our impl as default
36d3a4f978 narrow down the interface for extension purposes
1df6856076 Add source to the path of dbcp, and remove the module paths from the main project
79bfc93830 fix typo
98029504dc Ran Native2ascii over i18n files Fixes to French files - Spot checks only
ee21f80974 Ran Native2ascii over i18n files Fixes to German files
4849107d09 Ran Native2ascii over i18n files Fixes to Spanish files - checked by hand in full
b31dc85317 Ran Native2ascii over i18n files It makes sure files end with new line
994c8cfefd Allow pluggable property replacement object
4d4b354fca Update Servlet 3.0 classes to spec snapshot as of early March 2009. Still not final.
3716e20ec9 Remove code that was  marked for removal in r300602
e4cdac6345 Revert r765727 (fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=46538) - it fixes the reported issue but introduces other issues.
f859d2753e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46538 ETag must vary between compressed and uncompressed versions. Based on a patch by Oliver Schoett
0592484296 Drop unused fields
d12722a4e0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=37929 by restoring r357410 that was lost in r379417
2290552452 Clean up some deprecated code
5f4ea31156 Fix formatting before I make some other changes
32a0c1faab Remove unnecessary tests
7e645831d7 Remove unused method that introduced an additional parameter that was then ignored.
4ba7a295f2 Typo. Why do I always spot them just after committing a change?
0370d7f73f As a result of https://issues.apache.org/bugzilla/show_bug.cgi?id=46924 make the documentation clearer about what Tomcat will do if a WAR/DIR/context file is deleted or updated and auto-deploy is enabled.
77e34cf225 Remove unnecessary code
274aef1fab When using the fair queue, use a much more efficient idle connection handling by using a FILO queue so that connections are reused properly
31cb448577 JMX needs to be handled a bit differently. Random object names are not all that great. In this way, one can control the JMX registration completely from the outside.
e04a0755a7 Fix stupid error
9abe1f12d2 Fix secondary issue reported as part of bug47013
de34377d34 Code clean up prompted by Eclipse:  - mark unused parameters as unused  - remove code that doesn't do anything
837ca88248 Add a TODO to review the synchronisation around background processing
a243f6c9f1 Oops it will loop without that...
edd72950f7 Add default tomcat pool JMX descriptions
bb07d82ea4 Add the Tcp code... Still need the code in httpd-trunk to test it.
a30a4b5e11 Drop some unused methods
cefbd2259a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42390 Correct JSP compilation error with nested tagfile tags with variables with "AT_BEGIN" scope Patch provided by Konstantin Kolinko
3720323602 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42579 Handle both relative and absolute search results Patch provided by Brandon DuRette
8ff953919a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46354 ArrayIndexOutOfBoundsException when using org.apache.jasper.runtime.BodyContentImpl.LIMIT_BUFFER=true Pathc provided by Konstantin Kolinko
bc8470ac65 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46984 CR & LF in middle of method name should cause a 400 So client sees 400, stop processing the request once we know it is bad
0f91f4baa2 Move the multi logic to MultiCastSender with the idea to TCP sockets and a list of proxy too.
70e6e3f82e Remove accidental whitespace
f2184bd63b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46961 Avoid tripping over http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6434149
4b7a80cdbc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46909 The ';' should really only be used if there is a following parameter
6d2de60e45 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46562 Close the reader when we are done
ce5189d057 Remove old thread pool code
4e7ab4a329 Remove the org.apache.jk package as per discussion on dev list. Do this early in Tomcat 7 development to increase chances of identifying any issues with org.apache.coyoye.ajp package
fa521247e8 Java uses 0 rather than -1 for infinite socket timeout
4791082144 Update the docs for the protocol attribute
ef4b81fb0b Switch to org.apache.coyote.ajp.AjpProtocol rather than org.apache.jk.server.JkCoyoteHandler
e40d1b43dd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46998 Reduce scope Patch provided by Jens Kapitza
7efac060a6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46997 Code clean up Patch provided by Jens Kapitza
11f795d3ca Move the class from cluster to ha.backend
31302c3dd0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46509 Use correct link on error page in JSP security example Patch provided by Michael Moody
970846fb29 Fix NPE when not using cookies for session IDs
7fadb09cd5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46991 Update the counters before we recycle the request
28424bad64 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46990 Various sync issues.
0a7bac3362 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46988 Make constants final
b0fc5e076f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46986 Find bugs was complaining although these have not been reported as causing issues for any users.
e456b857c4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46985 There is still some optimisation possible but I think this is a good balance between clarity and oprimisation.
ef121596dd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46967 and make behaviour consistent when running under a security manager. Based on a patch provided by Kirk Wolf
9fe43fdc0e Remove class that was deleted some months ago.
c2f7f3d1ba Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46958 Allow XML status to work irrespective of context path
63f268db01 Remove unused constants
b4bfce8944 Fix unlikely NPE
be49d21bb3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46933 Simplify StringManager using Java 5 features. Based on a patch by Jens Kapitza. Include a test case to ensure simplification is OK for null input
d5c5961ba8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46982 Use DST offset not current offset (which will be 0 when DST is not being used)
3e86276536 Add missing dir that stops me running Tomcat directly from the build dir
4adfad6921 Fix typo that meant .exe and .pdf files were corrupted in .tar.gz source bundle
b35a5c73d0 Fix annoying loss of executable bit when building on Mac
f0daa78407 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46599 Document known DAEMON issue
868451512c Update native
92a6fa48ab Remove changlog entry backported from trunk to TC 6 in revision r762499.
6301b5d2a5 Arrange the code according to Rainer's comments.
4f34036b29 First support for httpd-trunk heartbeat logic.
018b3d7e24 Update package name
dd473027d2 Added a getter and the css mapping.
acbb3f5185 Files changed/added in tomcat
af3ab22e5b Build and one example of embedding tomcat-lite ( I'll add more when I get time, I only picked spring for its limitations - it's easier to use tomcat-lite in a framework that supports existing-object injection ).
74144806cf Unit tests, including the Watchdog converted to Junit.
c8c26c4fac First batch, based on sandbox. The main change is adding the ObjectManager to abstract configuration/JMX/integration, and replace some filters with explicit interfaces, as was suggested. This has dependencies on coyote and tomcat-util, and some optional servlets/filters/plugins to provide various features from the spec.
5a096c0f94 Fix a handful of failures when using the litmus WebDAV testsuite. Still other failures but these appear to relate to the lack of PROPPATCH support.
e9fbcd6161 Fix litmus test failure: MKCOL with weird body must fail with 415 (RFC2518:8.3.1)
ce3f6c86fe Misc code clean-up. Remove unused parameters / exceptions etc.
e63c796235 Tabs -> 8 spaces
a05dc3ed0d Align build script with recent re-packaging
5e7f92ff72 Add filter encoding suggested by Remy to ant's copy task attributes for the properties files.
4694fb1e54 Removed commented out code / unused classes.
ef7b91bd5c quote the name
de16bbfcec Move classes from org.apache to org.apache.tomcat
0f68f5b1dd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46923 Fully document protocol options for AJP.
eb45eb5303 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41606 Prevent double init() of JSP Patch provided by Chris Halstead
76493128f6 Some things you don't want to expose
6dc8ffff5c Allow a user to configure a pool name through config
b3c8d04217 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46915 When resolving ResourceBundle properties, don't claim to have resolved the property unless we really have resolved it.
8a6477fd18 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46822 Avoid redundant object creation Patch provided by Anthony Whitford
06c12f511c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46866 Better init of Random
520f1e9477 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46875 Add try/catch to session access in case session has been invalidated
0af5090400 Stop Eclipse complaining
730947466c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45332 When reading tomcat-users.xml try to ensure the digester supports the java encoding names. The windows installer will often use these names. The JVM does this by default. If the endorsed mechanism is used, an alternative parser may not support the Java encodings. This fix will only work for xerces.
eae44bad66 Allow the type to be the exact name of the data source
2f5d908094 Fix bug when initSQL is used, then we should always execute it upon connection creation. Bug report attributed to Torin McCabe
452771c2c5 some basic skeleton addition, more to follow
a2ede2a1b1 Display IP address in range 0-255 and not -127-127
f586d6e1e6 Small cosmetic fix
425b103e6c Fix dependencies path in .classpath file. Thanks to Gregor Schneider.
836bf52111 Delete unused code
f181ac455f Fix some Eclipse warnings
72d208c48c Fix typo
c6b32f02ee force 1.5 at this time, don't inherit parent value of 1.6
da3c06718d BZ45026: Never return an empty HTTP status response phrase. mod_jk and httpd 2.x do not like that.
2c4153129d Implement delegate methods that will let us expose all this under Tomcat JMX since Tomcat uses dynamic reflection to figure out what to expose
8a3734e121 Document r757708. Remove when backported.
b1dbe21dee Allow bigger AJP packets for request bodies and responses (by setting packetSize on the connector).
c17d9ad367 Use some existing constants instead of inline numbers in AJP connectors.
d5edc4ce7c Setup datasource so that one can extend it more easily
5b5a76e11c Use a filter rather than a valve to add a default character set.
0d4cfe5776 expose the poolname through a public method, this will allow one to retrieve the actual connection pool through JMX as well
b9630cca31 Remove the Catalina dependency from Jasper.
ec9c38447d Followup to r756926 (forward remote port via AJP13). - Use a more private attribute name and   define it in the Constants class. - Do not set the attribute on the request,   only use it for the remote port.
64da86eb14 Add missing attributes tags
04b3da412b Fix a handful of Eclipse warnings
ba0f77b5ca AJP13 misses to forward the remotePort.
e4c608e9b2 MulticastSocket.setLoopbackmode() works reversed. The argument is named "disabled", so true is for disable.
d548784ea6 Don't try and save a read-only database
93c1737a2e Remove two validation related fields no longer used in the digester
1a11f83de6 Get validation working properly. This will still throw two errors on start-up due to errors in two of the tld's included in standard.jar in the examples app.
a16a7034ed Change default xmlBase to prevent exceptions on start up and errors every time the background thread checks for descriptors. Remove unused code block.
9339aef7cc Fix line endings
3534fec413 Allow xmlBase to be configurable, just like appBase.
c442579c41 Add missing and new schemas to resolver used by digester.
9f4aa8fd85 Add missing XML Schemas for Java EE Deployment Descriptors Unlike the existing schemas, these files are CDDL licensed.
1f63f2bf4d Add a system property that lets the startup phase exit if the server encounters an exception during the initialization phase. The default is false, which means the behavior from today remains unchanged.
cad16a3ed0 When adding a logger, its better to always add the parent loggers, all the way up the chain. The cost of this is relatively small, since the number of packages compared to classes is relatively small. This feature allows extensions of the JULI framework to change log categories during run time, as opposed to changing them for every single logger in a category
bfbd435fde - Add xiph mime types, after reading a blog.
156b15f372 Fix infinite loop.
5f70a690e1 Make a distinction between AM/PM by using the 24 hour format
06399c8b9f Experiment with enabling per context configuration of xml valiadation for web.xml and tld files. Should make fixing tld validation (which I can't get to work right now) easier.
ea3a6a340e Tomcat uses Platform MBean server. Adjust listener accordingly.
223fbd5734 Revert previous commit. Plan to rework valve so this hack isn't required
06ca34d407 Fix Eclipse warnings in this package
a65b002116 Clear a bunch of generics warnings in Eclipse
dbf7159d94 Some generics fixes
843ec620bb Allow the AddDefaultCharsetValve to be effective when a writer is used
90f3e3fbd8 Add AddDefaultCharSetValve
dd396fe1f1 Remove jk jni code from Tomcat 7. It is deprecated in mod_jk and will almost certainly have been rmeoved by the time 7.0.x has a stable release. Shout if I deleted something I shouldn't have.
a3796c212e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46816 Align mbean descriptor attributes with implementations
fffe120eee Make UserDatabase read only by default and log an error if someone tries to save changes.
ead27c1b50 Fix remainder of https://issues.apache.org/bugzilla/show_bug.cgi?id=46807 Make it clear that enablePooling is a compilation, not a runtime option.
24d7c34fc8 Partial fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=46807 Correctly document org.apache.japser.runtime.JspFactoryImpl.USE_POOL
7aa6396b07 Fix svn keywords
5362bf0459 Fix XSS in examples web application. This is CVE-2009-0781. Security page updates and formal announcement to follow.
640f95bf3e Split LOGGING_CONFIG into two options, LOGGING_CONFIG which points to the file, LOGGING_MANAGER which sets the log manager This makes it much easier to handle directories with spaces
427eef92c5 Make LOGGING_CONFIG a variable that you can set, just like all the other script variables
16878ceba1 Make the useHttpOnly a Context attribute
1485132126 Update docs to reflect changes for bug 44988
ad507bdab3 Document undocumented valve
57d4a2c87f Fix broken metadata-complete element
6d7af23b4a Fix possible NPE
8fb0a56308 Fix various Eclipse warnings.
e82b62d9e4 Add directory for tomcat-lite.
506fb4db89 Remove unused code. Deprecate NOOP method
d7f32d2b14 Address Bill's security concerns in previous patch to get TCK to pass under a security manager. TCK passes after this patch with and without security manager.
0aa73d0052 Engage brain rather than mindless copying.
541543e9c5 Doc updated - ported form tc6.0.x
c3ee7d09cc Update Eclipse files. Stop trying to keep license info. Eclipse keeps re-writing the files without.
6baac34f87 More typos
82a25bea5f Fix spelling
90e18de37c Change to ThreadLocal to prevent potential sync bottleneck on cookie creation
27af179f38 Documentation
74ec1702eb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46666 keepAliveTimeout should always be used regardless of setting of disableUploadTimeout
4bf375db7b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46696 Add missing license headers
94362fca74 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46695 Patch provided by sebb
f23a4d56bf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46683 Correct typo in filename
0da9ee1467 Port r742915 to trunk. Make sure the 400 is returned to the browser. (like other connectors).
81d5468194 - Fix apparent bad cut & paste from the HTTP connector for parseHost, and use the code from the org.apache.jk connector instead.
6964ed8d0b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=39396 Exclude TRACE in OPTIONS response by default. Include it where we know it is enabled.
de73ee71c4 Revert previous patch. It won't work.
af77b54d2e Only perform validation test when allowLinking is enabled
a321b9ba4a Correct typo
a7debf0c59 Fix various Eclipse warnings. Convert tabs to spaces.
697c2515ea Fix various Eclipse warnings. Convert tabs to spaces.
13f56469f0 Fix various Eclipse warnings. Convert tabs to spaces.
058bf22dbf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=39013 When testing for invalid docBase, test for an exact match with the appBase dir
6bb1e6650c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38570 When checking docBase against appBase, make sure we check for an exact match against the appBase
43da813b65 Make sure thread starvation doesn't exist during reclamation of connections
6423b74a1c Remove serialization from Container. Old experiment that didn't work.
d59273c718 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38553 A lack of certs is normal if the user doesn't have a trusted cert. Return 401, not 400 in this case.
11f592d449 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=38197 Take account of jsp:attribute elements when naming tag pools
a9b1a0cee9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46606 Max max depth limit configurable
e3cdf0e332 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46600 Correctly document maxKeepAliveRequests
af2c199bce adjust for first tag
0451b6e5f8 fix sizing issue when db is restarted fix JMX domain name fix exception handling
12092e23cc even not used anywhere in our code, make it thread safe
cd1e45632b Minor clarification as a result of bug 46498
2ddfef9559 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46564 Encoding test should be case insensitive
abc46a7c46 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46563
f864f7f6ca Initialize connection pool upon data source creation instead of request for first connection
9d1d6cc4f7 Remove duplicate check
749eb6c490 Fix all the static Eclipse warnings
e276b19211 Removed unused code from o.a.t.util.buf
f56985f646 Add some changes from December 08
f000ed8934 Align the installer license files with the main one.
b2496f0c10 Remove 3 of the essentially 4 duplicate normalise implementations. Minor tweaks where required to use the new single implementation. Remove unnecessary normalisation calls. This includes the fix for CVE-2008-5515.
3add187c0a Remove unused variables identified by Eclipse
6a60b938e4 Remove some unused methods and related code
71bd271737 More unused imports spotted by Eclipse
f45f544f53 Remove unused imports idnetified by Eclipse
986baee9c2 Remove unnecessary casts reported by Eclipse
5dd1ef0b06 Fix generics warnings
220eaed779 Code clean-up. Remove unnecessary ;'s id'd by Eclipse
42c6ab4326 Clear TODO markers
ba03ef8742 Implement dynamically adding servlets and filters. This compiles but is untested.
abb962fdd5 Implement the simple stuff
68f561649a AFAICT only, dummy implementations are required here.
d371dfadfc Fix Eclipse warning
47302899c7 Fix possible NPE reported by Eclipse
887ebec89d Remove 1.4 impl since we must be using a 1.6 JVM.
41c6cad1c2 Version updates for the docs
9d77d51973 Use a snapshot of DBCP source that includes the JDK 1.6 fixes. Remove the DBCP 1.5 hack Update Tomcat and Servlet version numbers Update year to 2009 Force 1.6 compile since Servlet 3.0 requires it
e04c6c1dc9 Version updates
3e617cdcc1 Revert r733072 after feedback from EG that original INVALID for https://issues.apache.org/bugzilla/show_bug.cgi?id=46339 was correct.
185385a793 Update SSL Session handling based on Filip's comments. HTTP session invalidation is now separate from SSLSession validation. The hooks remain to invalidate the SSL session if required.
0f9e011785 Servlet 3 requires a 1.6 JDK. *Really* need to fix DBCP...
1f48d49d01 Misc code clean up to keepo the Eclipse error count trending downwards.
53671f505c Generics changes after updating the spec api and also those enabled by the min 1.6 JDK requirement. Add deprecation to the internal Tomcta methods that implement deprecated methods.
767a898f86 Deprecate wrapper methods that wrap deprecated methods. The assumption is that the EG will accept the patch to do this too. If not, it should be reverted.
658062daa0 Correct error in generics
d98c456f96 Apply generics to javax.servlet.* on the basis that the EG is in the process of accepting a patch to do this.
22a304bfb3 Support for setting SessionTrackingMode Most of this commit is to support invalidating the SSL session by the session manager. I'm not sure yet that support for SSL session tracking is a good idea. There are quite a few limitations (see the ssl howto doc) and the changes to do it are fairly invasive. The option remains to remove this at a later date and not support SSL session tracking in Tomcat 7.
1e86644762 throw exception if we know we exceed max packet size
9904f4ca92 Already support httpOnly - update comments
399e5da697 Implement SessionCookieConfig
2644970faf Code clean up
110d492e6c defer the deserialization of the message to an async thread to be able to handle more incoming, still I can send more than I can receive
ce8ff10cd2 Implement the ability to broadcast a message using multicast and bypass all TCP, simple fire-and-forget behavior, yet no change in how messages are sent and received for the consumer
bf8d7cc7aa Correct field names
ca0738bb72 Some minor clean up
118cdd691a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46339 Before the invocation of a fragment, AT_BEGIN and NESTED variables should be copied from the current JspContext to the JspContext of the fragment (*instead* of the JspContext of the calling page or tag file). Patch provided by kinman@a.o TCK passes with this patch applied.
ab73390e7f Fix various Eclipse warnings in o.a.jasper.compiler. Remove unused and unnecessary code, correct use of deprecated methods.
8b6fd8fae9 Remove unused code
0cad0716dc Remove e.printStackTrace()
a6c680750d Add download information for the extras components
a5b53cc404 First attempt at updating the javax.servlet package for the 3.0 spec It compiles and runs but 99.9% of the implementation is stubbed out and marked with TODO SERVLET3
49099ec706 Reported as part of https://issues.apache.org/bugzilla/show_bug.cgi?id=37515 Add options for Java 1.6 and 1.7
1d0137f069 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46471 Use the URL of the JAR as well as the path within the JAR to identify a tag file to keep tag file definitions unique.
1111c1fca8 When deployment succeeds but the context still fails to start, provide instant feedback
6af7ffccac Add comment as a result of bug 37515
2ed490cbcd brain farts
9511a0b904 update version
2e0ecb939d correct array math
707475f703 Make system compile with JDK1.5
85af0be4a5 Handle invocation target exceptions and throw the original exception when it happens
2d3f5e1e34 Fix https://issues.apache.org/bugzilla/attachment.cgi?id=23066 Sync issue leads to NPE in rare circumstances Patch provided by Konstantin Kolinko
c54b9f5507 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46462 Limit the package test to org.apache.jsp.* rather than org.apache.jsp* to allow use of packages like org.apache.jspwiki
46b0553e6b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=36923 If EL is disabled, treat it as template text.
f36b933aed Every fault needs to be done at least twice.
931cfdc6e5 Port r730523 from tcnative trunk to tc trunk. Add Thread.java and Buffer.java. Change SSL.randSet() javadoc to the tcnative one. Add Socket.sendib() and Socket.sendibb from tcnative.
ff711c1313 Port r706574 from tcnative trunk to tc trunk. "Fix API function name recvFrom -> recvfrom." Function is actually not used in TC trunk.
f7e67042a9 Port r708867 from tcnative trunk to tc trunk.
60c41ebe3c Add missing AL2 headers.
122254656b Fix svn properties. Patch by sebb
1f4ba3c3ca Fix porting error
f842326000 Make sure that the packaged up binaries have a MD5 sum as well, to verify download size
34ac5d3572 Don't attempt to shutdown when port=-1 in server.xml, instead print error message
9657d659f6 Cleanup name
b9a016ea06 Adjust to Java 1.5 level
dcd6e56cc8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46223 Add a simple co-ordinator provided by Robert Newson
c3202f590c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46223 Throw NoSuchElementException if next() is called on the Iterator when hasNext()==false
e7130a8248 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46298 Throw an exception if the driver doesn't support the supplied URL Based on a patch by Owen Jacobson
e7e08a795f Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46344 Put the org.apache classes in a separate jar Maven changes need validating.
c89d2de8dd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46351 Simplify build scripts. Patch provided by Marc Guillemot
c4e16578a1 Add a draft release plan for Tomcat 7
6c6883bb59 Generics changes for o.a.c.ant Fix various Eclipse warnings (use of deprecated code etc)
d766415dea Generics changes for o.a.c.authenticator Remove unnecessary casts identified by Eclipse
70936ffcbe Generics changes for o.a.c.connector Fix various Eclipse warnings (unused code, casts, etc)
99fa470ee8 Generics changes for o.a.c.core Fix various Eclipse warnings (unused code, unnecessary casts, etc)
e7eab52a84 Generics changes for o.a.c.ha Fix various Eclipse warnings (static methods, unused code, etc)
7a9c7c592f Generics for o.a.c.loader Fix various eclipse warnings (remove unused code, fix possible NPE)
b338d1b70a Generics for o.a.c.manager Fix various Eclipse warnings (unused code, etc)
1bf27553d3 Only report query executions
721fc9a4eb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46261 %2F in context paths should be treated literally, not as / - that is what '#' is for.
a4ad24b413 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46381 Needs testign with the TCK before proposing for 6.0.x
c5352b9fd5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46357 Correct test for host's parent must be an engine
0932f8136f organize imports
c216954e17 Refactor the query report for multi purpose
6d9696d7b3 Revert part of previous commit that caused errors on startup
26d58950b2 Revert what looks like an accidental commit so extras will build
280e6ce610 Generics changes for o.a.c.mbeans Remove some unused code identified by Eclipse
fbe4c993b6 o.a.c.realm generics changes Also fix some eclipse warnings
ca444437c1 o.a.c generics changes Also fix some Eclipse warnings
505f056d22 o.a.c.security generics changes
82dbaf33d2 Fix various Eclipse warnings in o.a.c.servlets, mainly unnecessary casts.
8814afe09f o.a.c.session generics changes Deprecate methods that implement deprecated methods Fix assorted Eclipse warnings
966b492a13 o.a.c.ssi generics changes
e1e50613bb o.a.c.startup generics changes Various other fixes (casts, unused code, comment typos etc)
fe199f3b23 IF the application is shutting down, we don't need to print the WARN message
3b4c0986da Remaining generics for o.a.c.tribes   Change the Comparator in Membership to align with AbsoluteOrder Fix various Eclipse warnings (unused code etc)
1c99e4d69d Generics for o.a.c.tribes.io Fix various Eclipse warnings (unused code etc)
3a2495b75b Generics for o.a.c.tribes.membership
0f0c7154e3 Some more simple generics and other Eclipse warnings
28d8d432b8 Generics for o.a.c.tribes.tipis  - Note that there may be more to come but AbstractReplicatedMap is a tricky beast for generics so these are just the 'easy' ones Fix various Eclipse warnings (unused code etc)
6fba704fb9 Generics for o.a.c.tribes.transport Fix various Eclipse warnings (unused code etc)
98c02f7c98 Generics for o.a.c.tribes.transport.bio Fix various Eclipse warnings (unused code etc)
db32441eeb Generics for o.a.c.tribes.transport.nio Fix some other Eclispe warnings (unused code etc)
5b1c0f1501 Generics for o.a.c.tribes.util
fd666c82ea Fix a couple of Eclipse warnings
17509ae3b9 Add some unit tests for the EL parser based on some recent bugs
6c648ff7e8 insure that classes are loaded by trusted code in a sandbox
0e85264a3f Fix file descriptor leak
940ae3ea8d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46397 Don't pool tag instances that implement JspIdConsumer
eb62a14dc6 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46403 By default, always send the expires parameter with cookies to fix know IE6 and IE 7 issue. I don't like doing this but I can't see a better way.
1a2586025f update version
3ab2c20686 Implemented a way to get a delegate using standard APIs rather than custom handling
284564fd12 Fix performance aspects of 46304. Note it is possible (depending on connector config) to have a servlet/filter responding to comet and non-comet events - hence why the array used in the methods cache has been extended.
06c57573c6 Fix non-performance aspects of https://issues.apache.org/bugzilla/show_bug.cgi?id=46304 Should use Principal when calling doFilterEvent
b3810f4c41 Removed calling to a JDK 1.6 method if its run under 1.5 and still take advantage of the JMX features
224719eb37 inc version number
9eb5423104 Fix property parsing
c69707f5f0 Documented interceptors a bit better, implemented setters for interceptor properties
17fb7660d8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46408 Don't make assumptions about exception type
b7c9fbd674 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46366 Need to use environment variables to set catalina home/base
1fde707fba Stop command -z not found complaint
e6f0336aaa Catch any exceptions since we don't handle them later in the chain
1df69c8553 Refactor JMX name into a constant, add a notification during init
e574ce67f2 Implemented JMX notifications when connections fail
03db946b0e Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46125 for NIO and APR connectors Change the exception if the headers are too big to force a 400 status code rather than the current 200
5fa5eed850 Implement JMX notification of query times and query failures
97c0fbf2a7 Fix last bug, time for JMX integration
2bb951aa4f move initialization to poolStarted
e226246eee Implement startPool method to inform interceptors that pool is started
a0030bc17c Refactor slow query report so that it is extensible and one can override the methods
4c6037ad95 implement a toString for the CometEventImpl
cdd59b6fc8 clean up JMX reg
73eac66605 house keeping
ce3ff465fc minor cleanup
dda7f22a56 Implemented closure notification. Turns out generics only work on an instance level, so you cant use static methods without having to use reflection.
2402877e5d Refactor interceptor instantiation a bit
28c3a9f40b Refactor a bit
25054ae31d remove more code not needed
8956e6e358 get rid of closeListener, it turns into spaghetti code
49f8a2a07e refactor the slow query report a bit also add the ability to remove a listener
a81f11a258 Make sure we check if the attachment is null
e5252197e2 Reset the key to let go off references
82343470df implement timeout on sendfile write as wellimplement timeout on sendfile write as wellimplement timeout on sendfile write as wellimplement timeout on sendfile write as wellimplement timeout on sendfile write as wellimplement timeout on sendfile write as wellimplement timeout on sendfile write as wellimplement timeout on sendfile write as wellimplement timeout on sendfile write as well
7a7984f61e Remove methods so that the caller knows what action is being taken
995fab0794 oops, must return false, or a leak will happen
5ba3fdde80 cleanup methods not used, and correct methods that used the old thread stats
02abfd3379 Implement an execution that adds the task to the queue if rejected, and allow to try to add for a specified time
e52c954cb5 correct the import statement
b3c4772dae Refactored the thread pooling when using an executor, this gets rid of duplicate code in the NIO connector as well as in the org.apache.catalina.core.StandardThreadExecutor package. I provided a ThreadPoolExecutor with a small extension to the java.util.concurrent The connector method setExecutor still take a java.util.concurrent.Executor as an argument to provide the most flexibility
60885807c1 Implement keep alive timeout, and while doing this, I realized that keepalive is either on or off, but there is no counter
94a0cfd171 Implement keepAliveCount in a thread safe way, and as an estimate
a743580ab9 implement a bit cleanup and a rough estimate on the size of a poller
4c70277bc2 Remove the synchronize/notifyAll based thread pool, and use only the built in pool
490076e300 Set line endings for a couple of new files
d547df2e2d Add the ability to configure a job queue size, and a timeout for how long we want to try to add something to the queue.
0042b016ef A few more properties
e8effe59d3 Query collection stats
1f2164d2a0 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46247 svn property patches for trunk Patch provided be sebb at a.o
a9a3ebb4e1 https://issues.apache.org/bugzilla/show_bug.cgi?id=46232 Don't override the endorsed dir if the user has set it Based on a patch by Russ Tokuyama
651585d388 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44285 Provide support for configuring the JSSE SSL session cache size and timeout
d0fdbe8c79 start working on the interceptor for query stats
f30cf26c5d fix build script
27f85ada52 Add comment and cleanup
60e62c077f Generics for o.a.c.users and o.a.c.util
24c24dc20c Generics for o.a.c.valves Fix a couple of other Eclipse warnings as well
6c5ef2c7a0 remove some not needed test, add compile version
54734316a3 Add fairness test to build.xml
7198c85701 update version to next rev
873e736aec implement cancellation ability for future
a21312ef1e Add log formatter that outputs on a single line (except stack traces)
546b1716b8 Generics changes for o.a.el
70e3dac77a Allow webapps to access org.apache.jasper.el package. I have looked through the package and I believe this change is safe although more eyes would be good. Without this permission, a handful of TCKs fail if tested with a security manager enabled.
492ba75eef Generics for o.a.coyote
1af164ee07 Lots of EL failures with a security manager without this.
387a66eefc Fix some TCK failures when using a security manager.
5811a8d69f Generics changes for remainder of Jasper.
2ad8232097 Add doPrivileged block required for Servlet TCK to pass when running with a security manager
5959cf38a7 Generics fixes require change in code generated for JSPs
9f5372ba82 Use same (more useful) jpda defaults as catalina.sh
479163f935 Tabs -> 8 spaces
3a39f85057 Add the ability to configure multiple pollers and default them to number of CPUs
9e53a6da88 First attempt for SSL send file
f4fd2ab9dc increment version number
d7f13e014d Add the ability to retrieve connection object asynchronously
0c048ccea3 Remove the Driver class, its not used anymore, and if it was used, there needs to be a way to instantiate from a properties file or similar
c517da5ca9 we don't have to wrap it anymore, since the extension implements the interface directly
708bb58da6 Clean up a bit
3e462e0bfe Extend the fair blocking queue to allow asynchronous polling
353600e29f Pool should throw a SQL exception, never return null
7a50bfe899 Add an extended key manager to handle a forced server alias on the tomcat NIO connector
097c6dff82 Implement setter for keyalias, not used yet
166747055b start to add back in features
cc38e3d349 print out some useful test data
6d90bf3bb6 make sure the test is time based
5df5eb1dd8 Fix fair blocking queue for now, we will add back the ability to not have a timeout later
a907f85575 use same method names everywhere
7e8f21f7ed eclipse autocompletion is gonna kill me
8dac9caacb fix bug
d92194b919 fix sample code
33e9b08a01 implemented use equals attribute everywhere
9dd2c3699b implement useEquals for the connection pool itself, does not apply to interceptors, they can manage that on their own
dbb6867c8a Add doc, update version number
e15bdaa42d Add in framework for comparing on either reference or string value
6bcf73bf03 update changelog
a629bf7d19 document how interceptors work and how to configure them
d3d6359ced properly throw exception
ac005ea730 Fix NPE
bd2da5a1af Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42077 Don't include nulls in iterator. Based on a patch by Mathias Broekelmann
bbc2328d60 Tab police
387b25a8a3 Fix generics in o.a.jasper & o.a.jasper.compiler. Also a few knock-on changes in other jasper packages.
c913879fca Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42693 I want to do some more testing before proposing this one
655914815e Generics fixes for o.a.jk
530ab88df0 Add ability to customize wait plan
a73094c950 o.a.juli generics
9ec7e94c47 Remove deprecated code. Some code made private rather than removed based on code comments. Calls to deprecated methods changed to use appropriate replacements.
902d124ec0 add async call template, not sure how it will work, but I will know soon make sure that timewait is a positive value, 0 being the lowest
1ac2f80af8 Fix dynamic thread resizing
32ccc1eaa5 Make size of all threads pools dynamically configurable
d0b565faf1 Remove deprecated code in digester (it was this bit that broke the build previously). Modify all classes that overrode deprecated methods to override the new methods. Add a note to the change log about backwards compatibility or lack thereof.
3e2efb6736 Make private / remove deprecated methods
3b7bb819fa Clean up Replace deprecated method calls
638db63907 timeout of 0 means we return right away
c6e57483be Revert r718819 that completely broke Tomcat.
06376bcc4e Generics for o.a.naming.* A little messy in places due to differences in env handling. Properties, Hashtable<?,?>, Hashtable<String,Object> and Hashtable<String,String) are all used and in a few places it is necessary to cast from one to the other.
992e8c2d88 Relax generics checks otherwise an call with a Properties object will not compile.
05a37b72e1 Fix SEND_FILE bug, with Java NIO you can only change the key interest ops on the poller thread, so we have to make sure we fire off an event
56577e95f6 Fix generics and use of deprecated field
c8a95017da Deprecate class that is no longer used.
7fd7113e7b Deprecate classes that are no longer used.
5cbe8ed9b5 More generics fixes
c3e3aeba49 fix NPE risk
8fde2ff1f4 keep the correct default value
2c3595a5fc Tab police
dc5aa84e00 remove debug stuff that should not be there
81117244eb Remove deprecation. Generics changes removed the issue.
ef757826af Remove deprecated methods. (In a few places public methods become private) In the few places they are used, replace the call to the deprecated method with an appropriate alternative. Should be no functional change.
80ad49ced2 Knock-on generics changes from digester commit
b691f9e721 Remaining generics changes in o.a.tomcat.util No nasty surprises. Should be no functional impact.
ee4e1b736c Clean up debug a bit while troubleshooting
f90beddc2d Generics changes for o.a.t.util.modeler These changes identified a bunch of issues, the most serious of which was the loadDescriptors() method that sometimes returned List<ObjectName> and sometimes List<ManagedBean>. Some callers expected this, some didn't. There are comments in the code identifying this as an issue. The fix I applied aligns with some commented out code that may have been part of an intended fix. There are still some deprecated methods that need to be cleaned up. With these changes Tomcat starts without error and JConsole shows all the mbeans I expect to see. There is plenty of further clean-up required here but I'll do that separately after the generics.
da24c55da1 Need to make sure configBase exists. WAR deployment has this check. DIR deployment needs it too.
043285221d socket properties NPE fixes
a0596cd140 Remove references to admin and balancer webapps and an unused task
cb883bcc98 Add first stab in letting interceptors have dynamic attributes
106a65fe97 Add timeout test
5c1b3e1150 Update changelog to show all changes in trunk that have not been proposed for 6.0.x If any backports for 6.0.x fail to achieve 3 +1s, need to include change in this file.
d8d8e22989 Revert accidental changes in r718133
cccaa44c9e Far faster than I was expecting - the diff is complete. Remove the temp tracking file.
c93510e260 Port sendfile fix from 6.0.x to trunk
5f7bca5cf7 el was simple. jasper will take longer
eb1ca5dcc6 Remove pointless brackets
44573332a8 o.a.coyote review complete
36fe779715 o.a.catalina review complete
dd603891f4 Fix comment typos
7080204dae Document that shutdown address is configurable. Add note re how to disable this completely.
6cce346057 Fix test case
e9c2864a71 make sure we clean up
fce8b94091 Make sure it compiles with JDK1.5, this is one of the times you wish you had preprocessor statements
10032eec9a Added an interceptor that keeps track of statements, and if they are not closed, then they will be closed automatically
d7bdcfe50b A few more simple dirs completed.
3c0f377e58 Sync docs in trunk with 6.0.x
dc4bb75f0d Add jfclere's cookie test fixes to trunk. Merge of r633793.
1df766c3bb And another easy one
a9b0e60c4a Another easy one. I'll have to start /java at some point ;)
893247a6bc /conf was quick too
116d2a486d /bin was quick :)
328ee13746 Update diff status
24d36edaa5 Sync BUILDING.txt
534f6a1eac Remove unused file.
378cf62a1e Remove the tomcat 6 parts of the change log
2aee97a276 Merge r613809 from 6.0.x FarmWarDeployer can only be configured as host sub-element
17100ab7c4 Add temp file to track diff status
d8fadc9a62 Update KEYS with changes from 6.0.x (Remy updated his key)
54e286a6aa Only apply state once, so if the connection state interceptor is not applied, then we need to do it in the pool Add abstract interceptor to handle statement wrappers and creation, to be used later when we do a clean up and performance interceptor
a644cc1102 If we know we are closing the connection, don't drain input. This way uploading a 100GB file doesn't tie up the thread if the servlet has rejected it.
68b4b7120c fix spacing issues
fa535b2c28 A disconnect should not throw an error
e39da460dd forgot to save file before checkin
1a7f398bf2 use atomic counters
c1c172dc19 initialize root cause of an exception
3630e8cb6c Do not throw attribute value. Patch provided by Tomaz Cerar cerar at parsek.com
233da7c73c When throwing Non-serializable exception, mark which argument was non-serializable to help tracing the cause when developing. Needs localization to other local properties files.
9ba4ea6803 increment build number and control it from build file at this point
2406076f67 Added helper script to sign releases
3be19c7083 Add a change log to the module
b1ad92f20d fix for calling close multiple times
8e31f71f24 Fix connection state, make it smarter and faster.
c53574c38b Updated documentation and added wrappers for toString and added an example
a1c1f9bc88 Fix socket properties usage so that we can decide if we want to accept the default value or if we want to use a preset value
f8cfb6e25b oops
c73523a0c5 Move the bayeux to a separate module
39232096c8 Remove out of date file from trunk
92554e521a Last bit of my ego goes away
6e854d4cc9 Added test case to test two concurrent datasources, fixed the flag to turn on the sweeper
f8e3aa1bf6 Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=42707 I debated adding the addContainerListener() meethod to JMX. I'll leave it a little while for people to comment on this (or anything else) before I propose this one for 6.0.x.
6943a40a61 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42747 I've tested this with all the combinations I could think of and ensured that the order of the redploy resources is consistent. The summary of changes is: - context.xml takes effect on first deploy rather than next restart - context.xml from DIR is now copied to conf/<eng>/<host> in the same manner as context.xml from WAR I also fixed a couple of edge cases I spotted and changed a few local variables to make the code easier to understand.
c2c54f3481 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42673 Correctly handle includes with multi-level contexts Patch provided by Peter Jodeleit
26c2c0c7bf Fix NPE to use Http11NioProtocol handler with default parameters! # example: <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"         maxThreads="150" minSpareThreads="4"/> <Connector executor="tomcatThreadPool"                port="8080" protocol="org.apache.coyote.http11.Http11NioProtocol"                connectionTimeout="20000"                redirectPort="8443" />
7dbd95a69b FIX possible NPE as Engine level configuration, as context dosen't exists!
15dabe558f This belongs to r711934. Property version nww gets calculated, so remove it from build.properties and add the version.suffix instead.
6d2c8aa455 Allow binding as user to directory instead of anonymous or fixed user/password access. Useful especially in an AD setup.
f7ec1159ab Move curUserPattern from a global variable to a method variable.
8695bd86ff Whitespace cleanup and two new debug messages.
6b6f0e6660 Modify build script to generate a distribution
91d58b61f0 Using @-patterns in the non-docs files and ant filters to replace the major version and also major.minor.
64bb0d80d6 Improve documentation
c5946ced1d Now make the classes checking session idleness use thisAccessedTime. This is not for invalidation, only for displaying idle times and making persistance decisions.
f0356156e2 Now expose thisAccessedTime via the session interface and ManagerBase, so we can use it from outside the session.
1af57056c1 This one gets inherited from StandardSession.
4b7150877a Give thisAccessedTime and lastAccessedTime for sessions a clear semantics:
ef2139a879 Whitespace and indentation cleanup.
113247d730 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46011 Make Principal accessible (if set) via Subject.getSubject(AccessController.getContext()) when processing filters. Based on a patch provided by tsveg1
f034c3106b Add ability to recursively search for roles to JNDIRealm. That way nested groups work.
1130f855b7 Preparation before introducing recursive group resolution - add a little generics - add a little logging - add a new utility function getDistinguishedName()   replacing some inline code. It will be used   again in the next commit.
702beed323 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46121 Add note about resources clash and using namespaces to resolve it.
53a69b7ff7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46047 Include jar in path for dependencies if they are in a JAR Patch provided by Cédric Mailleux
584cc4d0c4 Setting svn:keywords (Author Date Id Revision) and svn:eol-style (native) for the jdbc-pool module.
fff36b33b7 Remove the invoker servlet and all references for security reasons. This will not be proposed for backport to 6.0.x
bbf55dca1b As per Remy's review comment, make sure we continue to reset the writer/stream flags before forwarding to a custom error page.
28c511d9e2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41861 Change service name from "Apache Tomcat" to "Apache Tomcat 6". Full version number is still present in the description.
da84fa1cd8 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42409 The spec says reset the buffer, therefore use the resetBuffer() method. This makes custom and standard error handling consistent.
9b392e7e3b Lots of typos. Make text consistent (Tomcat, MBean etc). Remove the section on JDK 1.4 and MX4J since TC6 can't run on a 1.4 JVM.
1954ade2f3 Ignore tmp file created during build
33a7fd8132 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46051 The PrintWriter interface requires that the line separator is platform dependant. Not that this makes much sense for a web application but there is a spec so we shoud stick to it.
0c2f545e0d Path is required for a deploy
30bc2b01bc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46125 Change the exception if the headers are too big to force a 400 status code rather than the current 200
080e76abf7 Remove used connector params from doc example
b1716890d7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46105 Correctly set URI encoding when replaying request after FORM auth
323693182c Add asynchronous log handling, feature not yet complete. Need to figure out when to stop the logger thread (possible when there are no loggers) and also make sure the thread sleep/wakeup is bullet proof
48ed977d47 r703017 broke SSL with the JIO connector on Windows (and possibly other platforms). The problem was that some settings don't make sense for an SSL socket so rather than ignoring them a SocketExcpetion is thrown. With this patch, only attributes set by the user are passed to the socket and if setting the attribute throws an exception it is logged as an error.
1dd284b717 added doc around new flag
1d44c98a05 Added in a fairness test to showcase the FairBlockingQueue
8f4e974f0e Fix the performance issue, don't count down until the lock has been released, this allows for much more concurrency
ec88e36f1b add test target
2bd43fe4c0 stupid eclipse
317dbc4b71 Adjusted the timeout for abandoned, its in seconds
937fc697c4 Added a different fairness option, since ArrayBlockingQueue with fair=true is really bad for performance
b7d121fc8b move over documentation to the module
3aebf7a980 when the DB is down, don't wait and try over and over again, simply return the failure
cc4dba9c3f Make the polling fairness configurable
7cca43afb5 throw an exception instead of timeout when we fail to reconnect
30d107497b Improve validation ordering, when a connection has been acquired, but validation failed, don't let the thread go back into polling mode, instead try to reconnect it.
268bf5e79d Remove references to DefaultContext from code
6d7861fb44 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46106 Remove references to DefaultContext from docs
86111d68fe Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46067 Correct some typos.
d84fbcf1be Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46075 Don't automatically create the ByteArrayOutputStream with the full threshold - we probably won't need it in most cases.
846e377bd1 Improvements to connection handling
e0314e9a70 Expose deferAccept for APR HTTP connector. I did consider adding this to the AJP connector as well but since this is to work around a buggy client and we control the client in the AJP case, I couldn't see a need for it. Patch provided by Michael Leinartas.
f2539646be Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46085 Hard to reproduce thread safety issue with session expiration.
58dc1f2a74 Added couple more tests
61f58b47b5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=46096 Allow for running under a security manager when processing annotations.
b456065da7 Log max threads message at info rather than warn
82052bfb02 Add warning messages to APR and NIO endpoint to match change to JIO.
cddc15be23 Apply Remy's alternative fix for the String comparison bugs found by Find Bugs. Note FB still complains but it is a false positive.
618492e655 Previous commit undid some of the fixes for bug 45906. Correct that error.
1f8eacc1eb added correct stuff to the classpath
1d8b7ef05a check in eclipse files
5de2a55fb1 move over to an independent module
06b6cb869e Apply Remy's patch for 45735 and align trunk with 6.0.x.
878db0cfd8 Revert 680710 - no interst in porting this to 6.0.x
3135a6943c During a read or write timeout, we were cancelling the main key, this is fine for regular IO, but for Comet IO, this will cause events to stop since we remove the socket from the main selector
5c65a95934 simple connection pool contribution - currently built using ant -f extras.xml conpool until we have a way to release it as a module, coming soon
7bbfcc6e60 Set the default thread count to 200
894ed844a6 fix thread boundaries by adding a queue to the pool
56c0103982 Correct default setting according to documentation
acb56beb1b fancier now
e074398fa1 improve the stock ticker example
5859ca15a7 work on the bayeux samples
4b07a727e9 if replicated context starts without clustering enabled, then the map is not swapped, and we get class cast exception upon shutdown
9657875af3 Default JNDI name for annotation lookup should be based on the class where the annotation was found which isn't always the class of the instance being created. Reported as part of the follow-up to https://issues.apache.org/bugzilla/show_bug.cgi?id=45285 Based on a patch for 6.0.x provided by Florent BENOIT.
2bb532f106 Fix generics warnings
239be28124 Fix the remaining EL / TCK issues. With this patch the EL TCK tests pass and my test cases for bugs 42565, 44994, 45015, 45451, 45427, 45511 and some additional tests for edge cases all pass.
83c5615b27 Update docs: clarify context.xml copying and multi-level contexts, remove reference to default context
4f725e470d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45977 Trivial comment clean up. No plans to backport this.
0ad5101aa6 update changelog
affffe6dbd Expose all socket settings available for the JIO connector, buffer size can make large differences, but they are hidden Make settings consistent with those for the NIO connector, so switching between Java connectors is seamless
d35170f0e7 properly cleanup socket object, since we have the ability to chache Http11Processor objects the processor must remove its reference to the socket, since sockets contain buffers (especially SSL sockets) and it could be considered a semi mem leak
878c24f79f Better fix for 45636
7b83cc1b6e Revert patch - it caused a regression. Correct patch to follow.
5c19e3420a Fix comment typo
b140a81d92 EG confirmed that attribute values should be fully escaped, including any EL. Note this does not fix bug 45451.
91be5ea41c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45951 Based on jfclere's patch
0338293f98 Handle nested contexts when foo#bar.xml exists Bug reported on users list
fcc0ebb128 Add support for full client-cert chains to AJP
2581018344 Fix regression in previous fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=43656 Patch provided by Nils Eckert.
38c4df09b7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45940 typo user->username
19067e8697 Better fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=45403 With this patch, the allowLinking flag applies to all web application resources. It is very slightly slower. On my machine with allowLinking=false, the change to line 899 increases the time from ~7 microseconds to create the file to ~70 microseconds to create and validate the file. As far as I can tell, this change is only going to affect context start times. If directory listings are enabled in the default servlet, they will also be slightly slower but they were horribly slow to start with.
838b1e5f8b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45933 Don't use parser from web-app for tld files
3942ffc27f Revert this patch whilst I figure out why it breaks class loading.
30449d7798 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45403 When listing the resources for a collection, don't include invalid resources, particularly linked resources when allowLinking=false
5d2b9f8943 Update javadoc. Add a todo reminder.
56f4583994 Move JmxRemote to extras. Fix Tomcat hang on shutdown. Improve logging. Update the docs.
786d17fa65 Fix some issues discovered when using this with PuTTY.
aa857464b2 Correct valve name in javadoc
8f9eb82fcc Fix some more Find Bugs nags in the CGIServlet. Minor functional changes.
8a3a0a45ca Code clean up. Use generics. Remove used code and a couple of other Find Bugs issues.
3388beb384 Remove the deprecated DateTool and some other (all bar one) deprecated methods that depended on it. Update SSI and ServerCookie to use local formats in a thread safe way.
b52e2ee0dc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45906 Improve ResourceAttributes ETag handling. Patch provided by Chris Hubick
3a2ce964af Fix date format issue reported by Find Bugs.
0e8b762e17 Remove unused code reported by Find Bugs / Eclipse. No functional change.
7a994de3f8 Fix string comp bugs reported by Find Bugs
7b81d35e01 Fix cast error reported by Find Bugs
1d1c9842b2 Fix signed/unsigned conversion reported by Find Bugs
240514fff8 Fix HTML decoding bug reported by Find Bugs
dff5f973ef Fix minor memory leak found by find bugs.
eed5cda998 Fix serialisation issues reported by find bugs
b6849820dc Add a new listener that enables the JMX ports to be fixed. This makes using jconsole etc through a firewall / SSH tunnel etc. a lot easier. As a bonus, the config docs include all the current listeners as well.
b8335d9a51 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45851 Correct NPE when cluster is defined at engine level Ensure that only 1 thread writes the replicated WAR to disk and that the messages containing the WAR are processed in the correct order.
23fb19642e Code clean up in o.a.c.h.deploy No functional change
6df0f5e15b Allow the maximum allowed size of a resource that is cached to be configured. The default of cacheMaxSize/20 gave too high a value for large caches.
eb54f4eea6 Partial fix for 45878. If we are happy with this approach for the spec JARs, extend it to the remaining Tomcat JARs.
f50f47a593 Update default year
4ea1c62aa0 Add NOTICE file to uninstall section.
4b9a57c46e Use lastest tc-native version.
b72d843cce Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45879 Move the NOTICE file to the install dir
aef2f36470 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45852 Add special handling a for charset that Java uses a non-default name for
40e2de7251 Add new LockOut Realm plus docs
f15aa8f0ae Now containers can have multiple realms, need to make sure we don't get duplicate names for the realms in jmx.
ecc0e9e0a1 There is no admin app in tc6.
0624fa721e Improve Active Directory compatibility of the JNDIRealm.
527a9e439c Add an optional and configurable default role to the JNDIRealm. This comes handy, if you only want to authenticate the users, but have a security constraint with a role in the app.
267644cea7 Port r486217, which was applied to connectors, but has never been applied to 6.0 and trunk.
7057d392a2 Add Mark's proposed fix for BZ 45026: mod_jk + httpd 2.x fails with a null status message.
0d739c1623 Correct wrong "No role found" realm debug logging, even if a role was found.
e8eb91a69a More Spanish translations
2433e4cb7d Update auto generated files as a result of ELParser.jjt change I have not re-instated the AL2 header in the auto-generated files. On reflection I don't think it makes sense for auto-generated files and the file they are generated from has the AL2 header. It also makes re-generating the files simpler.
4d9cbf77b5 Add explicit lookaheads where they could be ambiguity. This resolves some TCK failures with the fix for 42565.
728181e6d5 Fix ClassCastException when we try to cast a
f3e14b6653 Use generics to improve type safetyness.
a9f6c56d8b Tab police and trailing whitespace deletion for package a.o.el (except for generated java files).
996594a0c2 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45419 Set the Accept-Ranges header on content served from the DefaultServlet. This can be disabled via configuration if required.
f59c01b9ab Add generics to default servlet and fix other Eclipse warnings. No functional change.
67a1352b41 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45427 Yet another EL bug. Correct paring of quoted stings.
445a961627 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45441 Filters for INCLUDE/FORWARD need to be matched against servletPath+pathinfo
e0d359ad50 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45823 Log '-' rather than null when request headers are not present Based on a patch by Per Landberg
e9593c27bb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45447 Updated Spanish translations. Patch provided by Jesus Marin.
2f0a7667be Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45451 Testing for this threw up all sorts of other failures around use of \${...} These should all now be fixed. The two pass parsing means we can do away with the previous 'replace with unused unicode character' trick.
be481c1950 Code cleanup. Fix indents. Removed deprecated code. Fixed generics warnings.
6512071952 Fix broken links reported on users list.
304938b97c Improve previous fix to handle WAR deployment
b41abb2781 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45785 Ignore directories named xxx.jar in WEB-INF/lib
4cd9842964 Some clean up in o.a.c.util Use generics, remove unused code, fix various Eclipse warnings.
c0a1579c92 Add missing executor element in NIO docs
0c1eddfc43 Add HttpOnly support to session cookies. It is enabled by default and can be disabled at via manager configuration. Based on a patch by Jim Manico.
670f556130 Log a warning if we create the maximum number of threads
54054f3cbf Fix copy and paste error
2a641107cd Include fix for 43117 in trunk
a178afc8c2 Correct access check
f64f7472ed Handle session suffix rewrite with parallel requests from same client
c323aa02e3 clarify steps
a0c41e7100 delete not used sample
d42521299e Merging from sandbox: the casts are redundant for now, but in a future commit RequestInfo won't directly depend on JMX ( this is the only dep between base coyote/tomcat-lite and JMX ). Tomcat-lite still uses JMX, but optionally. Also exposing the endpoint, for easier programmatic config.
9d6cb64d0f Correct log name. Add warning about user name uniqueness.
11ebe2df27 Reduce log statement to 1 line using more precise info, in the expected case and only log the detailed info in the unexpected case.
d67a177dfb Add a new combined Realm that can be used to try authenticating against multiple realms.
8469ce79bd Fix typos in javadoc
7c44a923b3 Fix line duplication in previous commit r691675.
fb7c3c92fa Enhance http://svn.apache.org/viewvc?rev=646543&view=rev Don't drop the error silently. Instead use the root logger already initialized for the system class loader to write out a warning. Backport to TC 5.5 will need a couple of casts because of the lack of generics and the use of HashMaps.
dde8d9b94b a fully working demo, had to set the content type for the new version of the dojo toolkit to properly parse the json data, otherwise it thinks it is xml
471a1e6ffe update json library version to the latest
e4775f6b6b Working on the new dojo toolkit to get it to work properly
1755d6f64e Dojo toolkit should be downloaded and not included in SVN
fafa7cb014 update notice file
1a99f0fe24 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45618 Make sure the selector is closed. Almost certain not to be an issue in any real deployment but still - technically - a bug.
19a3a69271 Build the samples classes too
e435e07be4 add back in the lost license header
a8fe162ee3 update with bayeux impl
c46164121a Added in Bayeux implementation, as per https://issues.apache.org/bugzilla/show_bug.cgi?id=45413 to build, ant download ant ant -f extras.xml bayeux
8cd3bb972b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45628 Jars that declare no deps should return that deps are satisfied
bfecb04e00 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45666 Patch provided by Tom Wadzinski
ec0770e281 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45648 Note ELParser.java is auto-generated
610de79964 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45691 Make temporary variable name generation safe when multiple compilations are running in parallel
1cef039b4e Tabs -> 8 spaces. No functional change
36cfaf9b98 Fix typo
10c7f4e250 Fix wrong default in doc.
f5115534ac Fix for PR#45074
ddf76aa1da Fix for PR#44809
40ae3111ac Remove recycle of B2CConverter when used for URI conversion.
7d307796a0 JAVA part of the #43327 fix.
926395356d There is no admin app in TC6
5e2d23ff27 Update patch for 45528
069b170377 Remove unnecessary casts. Reported by Jens Kapitza in https://issues.apache.org/bugzilla/show_bug.cgi?id=45655
d0bb944a91 Improved fix for 45528 (invalid SSL config). It is a variation on the previous patch that: - does the check earlier - uses an unbound socket so there is no possibility of a client connection - uses the String manager for the error message Note: I gave up on the alterntaive javax.crypto.Cipher suggestion as the cipher names are different and there is no easy conversion.
833098511d Revert the previous fix. Filip has suggested an alternative approach that should address the various objections. New patch will follow in the next few days.
e926fc2adc Let the user know why errorReportValveClass was not loaded. Since it could be ClassNotFound, invalid class version, (or other)
5319e877ac Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45608 Use AtomicInteger for countAllocated to prevent race conditions.
1b6974bf4f Correct SSL docs as to the list of ciphers used by default. Add note about export grade ciphers. Add note (already in TC4) about cipher naming.
cf921cba0e Fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=45528. Test the SSL socket before returning it to make sure the specified certificate will work with the specified ciphers.
01ab0182e9 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=41407 Add support for CLIENT-CERT authentication to JAAS realm.
f8751cc27e Fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=45576 Get the JAASRealm working with DIGEST authentication.
524cbfbf27 Modify JAASMemoryLoginModule so it conforms to the contract with the JAASRealm regarding the representation of roles.
9a44e65b9d Fix doc typo
95e3a8954a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45585 using a suggestion from Ian Ward Comfort
e06b2d32e3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45591 - NPE on start-up failure in some cases
edffe57f88 When a JSP file is deleted, return a 404 for the next request rather than serving the next request as if the file still existed and then returning 404s for the second and subsequent requests.
7633cd70dc Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45532 Doc typo
9a408e2c79 Remove some unused code.
e591f24a5e The surprisingly small update to the auto generate code to go with the update to the jjtree file
45fd535d23 Needed to look ahead one more token to differentiate between a function call and an identifier.
79255e4251 Update auto-generated code after recent jjt changes.
ebe023bffb Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42565 This patch:  - limits the regexp for namespace to what is in the spec  - removes the namespace token since the maximal munch rule means that there is a risk the second and third parts of a ternary expression would, incorrectly, be interpreted as a fucntion call.  - modifies the lookahead for function to be more explicit about what to look for My set of weird and wonderful test cases (mixing ternary, fucntion and empty) now all work. Updated generated files will follow.
a11b020df3 Revert fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=42565 since it caused https://issues.apache.org/bugzilla/show_bug.cgi?id=45511 A better fix for 42565 will follow
a63699fb2c Fix 45509 - typos
9989b25947 Port http://svn.apache.org/viewvc?rev=678137&view=rev (additional normalization check) to trunk
a628f19797 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45453 Add yet more synchronisation to JDBCRealm. Based on a patch provided by Santtu Hyrkk.
90a4e2c468 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45459 Provide info on possible cause of exception.
cce314f631 Fix error in JAAS realm doc reported on users list.
ebf99e3b60 This was discussed a month ago - didn't hear any objections. It uses the 'platform' mbean server instead of a new one if none was explicitely created. This allows using jconsole without any flags - without the change it would only show platform mbeans, now it has tomcat mbeans as well.
cc8ede92a3 Grammar + typos: Fix PR#45422
50fb9824d7 Remove pre-loading of inner class that was removed as part of r605000.
8e011bd550 Fix bug 42727. Handle request lines that are exact multiples of 4096 in length. Patch provided by Will Pugh.
0b205ac4fc Add a non-config starter for tomcat. All you need is the classpath including tomcat and the servlets - no config file. There is a requirement for a temp directory - the spec requires that webapps are provided with one I believe. It is possible to remove this or do it lazily or have some default in /tmp, if anyone wants to.
47d206fdd0 first chunk - make sure END gets called properly, if the event was closed second chunk - if the POST body is x-www-form-urlencoded, request.getAvailable() returns 0 for IdentityInputFilter so we still need to invoke READ event if there is a body, and it hasn't been processes by the servlet
f772cad3a5 As Remy pointed out, this really should be in the finally block.
9324b3cac2 Revert changes as root cause of issue appears to be strangeness in my build environment.
bd5e749d13 Use tomcat native from ASF repository instead downloading at install time from tomcat.heanet.ie
e8beb1a1a7 Previous patch didn't go far enough. No need to pre-load StandardWrapper.
9e583c6828 Startup fails with security enabled
6ec2a90f7a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42722 Possible NPE in CGIServlet.java Patch provided by Nils Hammar
157a96d709 Auto-generated changes as a result of http://svn.apache.org/viewvc?rev=675726&view=rev
be31deba28 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42565 el ternary expression without space before colon now works Patch provided by Lucas Galfaso This is just the jjt patch. The resulting changes to the generated code will follow.
b9c5e84f44 Go back to the original patch. The better one didn't pan out. Sorry for the noise.
dd75da92b7 Revert previous patch prior to applying a better one
b0e8e28ebd Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42678 Only ignore docBase it it really is a subdir of appBase Patch provided by juergen
9070db0b61 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45285 Should look for annotations all the way up the class hierarchy
c8e1b4f6ea Fix bug 45323. Add note that context.xml files can only contain a single Context.
c1edb74e96 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45332 Specify the correct encoding (the current windows code page) rather than assuming UTF-8 when creating tomcat-users.xml
ce221902ab Port windows installer changes from 6.0.x to trunk
6ef91a393b Add in startup options to the cluster channel. Document the multicast recovery options
44de7f8e2d Fix 45310, 45308 and a couple of additional typos. Also use OpenSSL consistently and fix a very long line.
53e0f97187 Extract the query string before we try to normalise the URI
bfdbee503c Make filtering of /r and /n in headers consistent for all connectors. Make handling of 404s consistent across components. Provide option to include custom status message in headers. SRV.5.3 suggests custom messages are intended for the body of the response, not the status line.
b735964085 Fix for bug 45317, document and properly output the session timeout time
f969725dc4 typo: 45309
95338ddfd5 Add some extra info on keystore type.
92332b8ad8 port fix for BZ 36155 from the JK Connector
f14d3784c4 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45277 Correct typo
15585f797a Fix for part 3 of https://issues.apache.org/bugzilla/show_bug.cgi?id=43683 This isn't perfect but it narrows the window for the race condition significantly. A perfect fix would require syncing most (all?) of allocate() which is on the critical path.
975f9ee387 doco update for fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=45272
c25c3844f6 work around for IE not being RFC compliant, IE doesn't like quotes around the path value, even though a slash is considered a header delimiter and must be quoted, fix for bug https://issues.apache.org/bugzilla/show_bug.cgi?id=45272
f0257a0b1d update changelog
3cb861fd3a fix for bug 45279, close multicast socket on close
1b02375ea2 Provide an option to disable the fix for 45015 that raised an error if attributes were not correctly quoted.
7c6ad605a7 Use localhost instead of 127.0.0.1
60a95be638 Additional check related to bug 45195.
d77eb6b031 Apply Filip's better patch for https://issues.apache.org/bugzilla/show_bug.cgi?id=45212 Map.entrySet() should return entries, not values
f7965cf75b Revert previous fix after veto.
42ca3a5cd7 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45212 Map.entrySet() should return entries, not values
92246c8080 Another fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=43683 There was a short period where the context didn't appear in the mapper that resulted in some more 404s.
6c0d2783dc Fix bug 45195. NPE when calling getAttribute(null). The spec is unclear but this is a regression from 5.0.x
18b2e3e96f update changelog
1791e645b3 prevent NPE during shutdown where the logger has been shutdown and delayed resources still trying to log java.lang.NullPointerException 	at org.apache.juli.FileHandler.publish(FileHandler.java:136)
1fca0fa3c8 Make forced coercion of null and "" to zero optional. It is enabled by default, as per the spec. Patch by Nils Eckert.
1a24b2fa7d Add an additional layer of protection in case app fails to protect against an XSS. Copied filter code to jasper module so no new dependency is created.
0c825a858b Add a new valve that works-around the broken MS WedDAV client.
5f00d434c8 Fix potential XSS in host-manager. This is CVE-2008-1947.
67b69ffb19 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45101 Format dates for header value from DirContextURLConnection using HTTP format. Patch provided by Chris Hubick.
b91b774cdd Additional fix for https://issues.apache.org/bugzilla/show_bug.cgi?id=43683 If the context is reloaded, the classloader will have changed so need to reset it
8414a6b4fa Revert changes for 42747 whilst I work on a better fix.
286b321acf Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42747. Actually fixes a number of related bugs:  - For a new WAR, use META-INF/context.xml for first initiation rather than copying it then using it on next start  - For a new dir, use META-INF/context.xml for first initiation  - For a new dir, copy any META-INF/context.xml to $CATALINA_BASE/[engine]/[host]/contextPath.xml
925b3362af Note: This patch is on the critical path. Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42750 Making parsing of the request line tolerant of multiple SP and/or HT rather than requiring single SP characters.
4b7d9bd825 Additional patch from https://issues.apache.org/bugzilla/show_bug.cgi?id=43094 Make SSL providers configurable. Based on a patch by Bruno Harbulot.
2ce75fd9f7 Code clean-up. No functional change.
ac74072f5d Fix some Eclipse warnings in the examples webapp.
f756d799f6 Fix as many Eclipse warnings as I can in the unit tests. Add some missing svn properties
1df8686b37 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44994 Correct BNF grammar so  ${0 lt a ? 1 lt a ? "many": "one": "none"} does not throw an exception The patch is bigger than I would like due to the code generation tools used
52b9950915 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=45015 You can't use an unescaped quote in an attribute value if you have quoted the value using that quote character
05072c34d9 Fix NPE reported on the dev list. The other toUpperCase() calls should be safe since the String will be non-null when the method is called.
e098c7e750 Improved fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44968 as a single patch Provide more information when keystore load fails
b485d0e6ff Revert previous 3 commits to create clean patch for 6.0.x
147773eed9 update docs
7a7ecccf7f fix broken build
64c109d7e1 Improve logging messages associated with previous commit in response to Filip's veto
225c5a0890 tab police
e78a88689a save a few cpu cycles to avoid exceptions being thrown when a key is invalid
4d07644d06 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44968 Provide more information when keystore load fails
a0d230abf5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44986 Convert to upper case before comparing encoding names
c1e0589598 Code clean-up. Remove unused code, parameters, etc.
4f8b7eb1ed Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44988 Use Java 5 syntax to start debugger. Patch provided by Cédrik Lime.
cfb1913a1d Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42934 Trigger contextInitialized() before sessionDidActivate() TCK tests all pass but I want to give this a little longer in trunk before proposing it for 6.0.x
13b377bb17 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=42943 Make sure the nested element is inside a <jsp:text> element
6b7e7f5547 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44955 Use correct location for endorsed dir.
9aa18e7e10 Clean-up. Remove old stuff that has just been commented out rather than deleted.
2affea3b8c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44943 Reduce copy/paste issues caused by different engine names.
97fb456cfd Code clean-up. Remove unused method.
090a14ac97 Code clean up - remove unnecessary casts.
26be2638f4 Fix bugs https://issues.apache.org/bugzilla/show_bug.cgi?id=43013 and https://issues.apache.org/bugzilla/show_bug.cgi?id=44021 Add support to manger and deployer for wars and dirs that use # to denote multi-level contexts.
f69510c5e3 Fix various Eclipse warnings. Generics, unused code, etc No functional change.
83e49059ed Fix typo in recently added dbcp check so you can build a release on a 1.5 JDK
7c7ce79135 Not sure if I got the process right - the 2 classes I want to submit can be found on www.apache.org/~costin. I don't think there is anything tricky about them - except the fact that it adds another option for tomcat startup.
bb9d53e8a1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43080 and https://issues.apache.org/bugzilla/show_bug.cgi?id=43079 Move warning to StandardContext so a) we can check all url-patterns and b) we associate the message with the context.
fb13bfc087 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43094 Support any keystoreType that doesn't need a file.
ad44c5b853 Fix bug 43117. Setting an empty workDir can delete all of CATALINA_HOME. Patch provided by Takayuki Kaneko.
6683c839fe A final bit of code clean up. Actually no functional change.
00ded3dab4 Fix various Eclipse warnings. Generics, unused code, etc No functional change.
f71690f8c6 Add Remy's NPE fix to trunk.
b693dd9041 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43191 No way to turn off compression for some file types. Based on a patch by Len Popp
21e1f2760c Code clean up. Remove unused methods, unnecessary casts/code, fix generics warnings etc reported by Eclipse. No functional change.
a2a069a382 Since not beeing able to build with JDK1.6 is so annoying - and commons-dbcp doesn't support jdk1.6 in the first place: - let the compile work with jdk1.6, minus dbcp - add a small warning at the end.
e1b80267a1 Match build.xml - exclude webservices, missing deps Not sure why it's checked in - if 'download' doesn't get the deps and build.xml doesn't build it.
6dbdf8bea3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43150 # in installation path stops Tomcat starting
64cbe8176a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43333 Correct sendfile docs.
1f2ceff1c0 Fix bug 43343. Correctly handle the case where a request arrives for a session we are in the middle of persisting.
3cc7140542 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43142 If someone is daft enough to name their directory xxx.war, don't assume it is a war file.
5b0555cd90 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43366 Provide backwards compatibility for sessions command
7faf64dad5 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44877 Prevent collisions in tag pool names
d7a1a4e260 Further minor clean-up of unused/unnecessary code after I made Eclipse even more pedantic.
7f1ee21668 Add some missing control checks.
b5d278da42 Code clean up o.a.t.util.net. Generics and unused code.
8efb752d0d Code cleanup. o.a.t.util.res No functional change
2c63af2d86 Reduce signoff error message to DEBUG, since it is harmless if mod_jk has hung up the phone
9695437e3e Fix bug https://issues.apache.org/bugzilla/show_bug.cgi?id=43425 Annotations not spec compliant. Patch provided by Dain Sundstrom.
e695de6ed0 Better fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43617 Correctly handle quotes in attribute values for tag(x) files.
750f04e80e Revert previous patch. It didn't cover all cases.
dece9396b1 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43578 Tomcat doesn't start in linux if CATALINA_BASE contains a space Patch provided by Ray Sauers
e5f03241b5 Fix compiler warnings for o.a.c.deploy.* Note using generics would have highlighted bug 43470
972ae2700a Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43470 Based on a changes provided by Lucas Galfaso
c46a62a3e1 Add missing access check.
b15d6af32b Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=43617 Correctly handle quotes in attribute values for tag(x) files.
745f54f8ef Generics changes for o.a.t.util.res No fucntional change
b630f0856c Generics changes for o.a.t.util.threads No fucntional change
c032a9aac0 notify user of the actual error and add a todo behavior for buffer copying
06f4dfc243 new idea
7227ac4e71 Remy's better fix for 43683.
7c8bce4964 Revert previous patch to fix obvious potential NPE as pointed out by Remy.
46c3391e5c Fix bug 31257. Quote endorsed dirs if they contain a space.
184218f13d Fix bug 29936. In some circumstances, Tomcat would use the parser from a webapp to parse web.xml and possibly context.xml files.
11f84ef01a Add license and props.
cb63f713b4 More fixes for bug 43656 so new test case passes.
4d08e1c581 Add test case for bug 43656. Based on a patch from Konstantin Kolinko.
845e45a9ad Fix bug 43656. coerceToType() modified some values. Patch provided by Nils Eckert.
36881afe28 Remove unused code. No functional change.
6a1edab590 Patch for bug 43683. It could be more efficient if wrapper.started was visible but that would have made the patch quite invasive.
80660f3a5c update changelog
91cf84bf64 make the alwaysSend flag public, so that we can set it through config
620d3699da update changelog
46dc282637 fix override of methods from standardsession
9c70b75e6d Align realm config doc and realm howto doc..
a0a902c576 Fix some links so they work even if the ROOT app is renamed. Minor clean-up.
91c097fdae Remove second index page. It wasn't 100% in sync with the html one and I don't see why we need two.
b38cc95ca3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44380 Don't bother scanning non-file URLs for TLDs. Patch provided by Florent BENOIT
3d2068c4f3 Code clean up. Java5 and remove unused code. No functional change.
3798ba0768 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44389 Make nested class static so it doesn't hold a reference to the ApplciationContext instance.
64ffc2e6b4 Fix bug44391. Handling of escaped characters was incorrect.
18d8e74e21 Fix for garbage test in bug 44494. Patch provided by Suzuki Yuichiro.
373639c29e Re-instate Rainer's code that fixes the 44494 test case for read with maxHttpHeaderSize > 8192.
56a8b5a100 Fix bug 44392. HTML entities not resolved in SSI.
54ac0907ea Java 5 clean up. No functional change.
02ef3db424 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44408 Avoid bottleneck by calling the synchronized method only once. Patch provided by Robert Andersson.
b6b9900e85 Fix bug 44428. Make sure m is not null to prevent NPE.
2b21c4182c Clean up type checking code. Patch provided by Konstantin Kolinko.
f5ca61ee2a Fix bug 44785. Correct deafult maxThreads for AJP connector.
c8795b2c30 Additional permission needed to read JDK logging config.
5d9e7ae957 Handle case where we don't have permission to read context specific configuration.
8c82020a60 Better patch for 44766. I still can't see why the original code listed the classes individually.
964972f991 Revert previous fix as it needs correcting.
94aec8233d This fixes 44766 but I can't see why the code was written as originally coded. Any light much appreciated. I'll give it a couple of days and then, assuming there are no objections, propose it for 6.0.x.
ba892dec05 All of the issues I was seeing with mark/reset were due to states that resulted in a call to CharChunk.flushBuffer(). I tried many different ways to fix it but by far the simplest was this patch that just increases the size of the CharChunk internal buffer when creating the mark sufficiently that flushBuffer() is never called. With this patch I can't break mark/reset with bug 44494's test case in single or multibyte mode.
3c227d02fe Remy's resizing fix from bug 44494
b7cb300766 Submitted by Ruediger Pluem. PR#44595
30d6245b9a Fix for bug https://issues.apache.org/bugzilla/show_bug.cgi The ObjectInputStream.resolveProxyClass uses some funky native code base to retrieve what class loader to use, and it doesn't return the correct one. So we have to mimic the behavior in that class but use our class loaders instead
493845c37c Implement asynchronous callbacks for CometEvent.close and CometEvent.setTimeout to avoid connections with very long timeouts getting stuck CometProcessor implements servlet interface, or the code will fail deployment if no keepalive, close the connection after comet transaction is complete
5e6306ee8c Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44759 Need source to generate javadocs Patch provided by Stephen Bannasch.
36ef448759 doco update for the latest change
4547af2dc2 fix sendfile, incorrect if else statements
a0550b77fc Better fix for bug 44715. Document use of secret for AJP connector.
81f7c4e377 Undo last commit - need to rework wording.
831eaddc1d Fix bug 44715. Document use of secret for AJP connector.
a126522aeb Apply Remy's patch for 44494 for multi-byte character data.
2b7f21ac10 Remove unused code. No functional change.
c4be69d03a Tab police. Tabs -> 8 spaces. No functional change.
df00bb7637 https://issues.apache.org/bugzilla/show_bug.cgi?id=44529 No roles (deny all) trumps no auth-constraint (allow all)
59ee85f6ed Remove hack for getting env since JDK >= 1.5 provide a suitable method. Fixes issue with CGI, env and vista.
270fa1d451 Fix bug 44673. Throw IOE if stream is closed and a call is made to any read(), ready(), mark(), reset(), or skip() method as per javadocs for Reader.
1ce13dbbbd Code clean-up. Remove unused code. Fix generics related warnings. No functional change.
a99f847d22 Apply the patch for BZ44494 that was applied to 6.0.x
c29127c861 Revert original proposal for BZ44494 since an alternative patch was committed to 6.0.x
4770b7179a Fix bug 44541 - document packetSize for the AJP connector.
de24435c8c Revert change from some work in progress that snuck in as part of an unrelated commit
46b65c7eee SavedRequest is the only one using T_STR instead T_BYTES. converting to T_BYTES allows to use utf8 encoded querystring with parameters and form based authentication.
1852e0b1d4 Add missing public on constructor. Otherwise when using form based authentication: +++ java.lang.NoClassDefFoundError: org/apache/tomcat/util/http/NamesEnumerator         at org.apache.tomcat.util.http.MimeHeaders.names(MimeHeaders.java:201)         at org.apache.catalina.connector.Request.getHeaderNames(Request.java:1873)         at org.apache.catalina.authenticator.FormAuthenticator.saveRequest(FormAuthenticator.java:479) +++
d248f10c43 Fix bug 44611 https://issues.apache.org/bugzilla/show_bug.cgi?id=44611 DirContextURLConnection: 1) Does not implement the getHeaderFields() method 2) It's implementation of getHeaderField(String name) is case sensitive. 3) It returns an empty string "", rather than null, for header values which don't exist. Patch provided by Chris Hubick.
11b2f098c1 Fix BZ 44620 https://issues.apache.org/bugzilla/show_bug.cgi?id=44620 Move the code that handles writing more than the output buffer can accept in a single write to the method that does the writing. This then protects all calls to addToBB() from the issue described in BZ 44620 and does not require the socket.appWriteBufSize to be >= maxHttpHeaderSize
f8151cbb21 Use Rainer's improved patch for bug 44633
5da4824549 Clean-up unused import
0af300a60b Fix bug 44633. Tell use which class failed to load due to wrong version number.
c599a78af3 Fix https://issues.apache.org/bugzilla/show_bug.cgi?id=44646 The problem was wider than the issue described in the bug report. The session listener and the valve are different objects so the connection list wasn't visible to the session listener. I couldn't see an easy way to make them the same object so I used two lists - one for the valve (stored in the valve) and one for the session (stored in the session). This valve now works for a simple comet app.
e681165fdf maxActive setting for unlimited changed in commons-pool > 1.2
06a652e0d6 No longer need to rename jars for CGI or SSI.
7e738f9f42 There is no admin app in 6.x
28d83d24c4 Only allow version switching on the "value" of the cookie, for the rest, just quote like we did in the past. this becomes the most backwards compatible with old behavior
3f35287be9 Typo.
6a9e69184b Add SSLRandomSeed documentation.
8645c80af0 Fix bug 44558. Include address in bind exception message.
1624acde87 Use localised string having gone to the bother of obtaining it.
7ac13515b8 Fix bug 44562. HEAD requests fail with rd.include(). Patch provided by David Jencks.
77287d7338 Tabs -> 8 spaces and general clean-up of white space. No functional change.
ae165c2a94 update changelog
d9102c3ddc don't quote the path for v0 cookies, some browsers understand quote for the value, but not the path
7d3b59f5d7 update changelog
db25a950e5 Revert back to original patch proposed for UTF8 parsing. This also fixes the regression for 6.0.16 and 5.5.26 (and possibly 4.1.37) mentioned in http://issues.apache.org/bugzilla/show_bug.cgi?id=44494
08a03ac5c1 add rev number
6e81ab7f12 update to support <rev> attribute
357f74b07a small doco update with the addition on the new features
6a1d4f5e6c no need to sync, the javadoc says it's thread safe
a301650646 Use the same name on the static variable for servlet compliance
9876f0b5a1 correct the example URLs since the example webapp has been modified
3abeae1042 more test changes
24202027dc add in some more checks
1f6123aac4 correct project name
61747c2db3 Revert r616563 which was a fix for bug 43878 that has now been marked as WONTFIX.
fc45ec9864 Doc improvements:   Tomcat 5       -> Tomcat 6   $CATALINA_HOME -> $CATALINA_BASE   /server/lib    -> /lib   /common/lib    -> /lib
615cf502b5 As per http://marc.info/?l=tomcat-dev&m=120303263525849&w=2, remove status page and point to wiki.
e0d753c412 source jars for maven repo
b9816fe72b two proposals
2598f4b7af modify test code to report more info avoid concurrency during closedown
abe7ab89b1 Add buffer sizes to the UDP sockets
3202c3d9b5 more UDP impl
7deab93916 more UDP code
4f0a990a53 Starting to add in UDP support, still need to rethink how the sender is going to work
0809c61d83 implement setter of secure and UDP ports
10838a5d24 Add support to carry a UDP port in the broadcast, also add in versioning support (last two bytes) so that we can move the protocol forward
846a34053c one more feature
85a60c0078 Add a file to track possible 6.2 features so I can refer to it from the wiki.
140da1904b Fix ArrayIndexOutOfBoundsException reported on users list. Patch provided by Charles R Caldarale.
5f0dd955ca Add STRICT compliance flag to impact cookie value handling to provide backwards compatibility Add STRICT complanice flag to impact ServletContext.getResource(AsStream) to be backwards compatible
d331abb291 fix NPE java.lang.NullPointerException at org.apache.catalina.session.ManagerBase.processExpires(ManagerBase.java:682)         at org.apache.catalina.session.ManagerBase.backgroundProcess(ManagerBase.java:667)         at org.apache.catalina.core.ContainerBase.backgroundProcess(ContainerBase.java:1316)         at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1601)         at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)         at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.processChildren(ContainerBase.java:1610)         at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1590)         at java.lang.Thread.run(Thread.java:619)
a77383ad38 As pointed out on the users list, lib is relative to catalina home, not base
1d43f7a3f4 some more ideas
6c591a1816 Allow to run the shutdown on another IP that localhost.
73f8370285 Only add the listener once (to prevent the dup message from accidently appearing)
59ef257f82 improvements to tribes
0132e2cfb9 remove not needed synchronization
35670a6c4d ExtendedAccessLogValve cs-uri not print empty querystring
6bba82285b Corrected use of Channel.getMembers() in cluster Added debug hints to warning messages based on what may be wrong
34d1ca1214 added demo on how to use the payload
15d9df7ed0 Add a page to the config docs detailing the various system properties that are available.
992239a4c0 Remove synchronization on the DeltaRequest object, and let the object that manages the delta request (session/manager) to handle the locking properly, using the session lock There is a case with a non sticky load balancer where using synchronized and a lock (essentially two locks) can end up in a dead lock
d70dc9b253 Fix for bug 43741. Correctly handle dependencies for tag files in JARs.
c6d94b7b2d check if there is more room, in case limit(x) has been called
b0b74ec269 http://issues.apache.org/bugzilla/show_bug.cgi?id=44337 Dir listing crashes if no readme-file present
1d52b3ef31 I meant the reverse
87280d01cc Tabs to 8 spaces. No functional change.
4a66385f1b Fix defect 43701
16467db8c7 Revert fix for 43741. Aim for better fix that handles tag files in JARs.
a4ccd638d4 Fix bug 44282. Do call to getClassLoader() in a privileged block.
916ef68686 Remove TLS from Eclipse as well
439d59b843 Remove JSSE dependency from SSL abstraction.
2e346767ee The NIO connector is hard-coded to use the JSSE SSL implementation so just use it directly. This patch allows the JSSE dependency in the SSL abstraction to be removed (this will be in a later patch).
ab7d974625 Remove the old TLS code from Tomcat 6.
9b602b90c4 Tab police - no functional change.
4beff0de4f Better fix for 43878. If we aren't re-loading, use a single class loader for JSPs and tag files to reduce perm gen space usage
1d53fe25e2 Fix bug 43741. Tag files in JARs were getting compiled once for every JSP that used them. Patch provided by Anthony Berglas.
d162f27511 Tab police. No function change
57d5c168d1 Revert attempt to fix 43878 since patch is obviously wrong.
66c28c30ce Correct subversion properties of some items: - remove executable from *.java, *.dtd, *.xsd and *.jsp   Some of those had executable set. - add executable to *.bar and *.exe   Some of those had executable not set. - set eol-style to native for *.java and *.xml   Some of those had no eol-style set - set mime-type to image/x-icon for *.ico   One file had no eol-style set - add mime-type application/rtf to an rtf file - switch mime-type to application/java-archive for *.jar - set mime-type to application/xml-dtd for *.dtd - correct mime-type to image/jpeg for two *.jpg files
919004127b Add entries for expire command on ManagerServlet to manager web.xml. Otherwise it will only work in the HTMLManager, although it's implemented for the Manager servlet to.
7d3708c64c add the ability to set timeout during any EVENT, not just begin
ab5183ef02 bring back comet timeout
b2991d3422 Log a warning if a duplicate listener is ignored. Result of bug 44268.
0f7e040893 Set correct author of the patch, Sorry!
eb1249e1cd Update JNDI docs to refer to context elements rather than server.xml for configuration of resources.
65a4c4b039 FIX: WatchedResource does not work if app is outside "webapps"
060193ce76 Fix bug 44223. Use all the trust store system properties.
bdc43645d8 Fix warnings. No functional change.
b37f8052ad Fix "Restricted listeners property file not found" message fix
2d09aa2d07 Fix ManagerServlet.exipreSession throws Exceptions as iterate longer session lists at production servers.
25211b7bf7 Add getLastAccessedTimestamp and getCreationTimestamp for remote JMX Access.
d3b341e0fc Update: native to 1.1.12; commons-pool to 1.4; locations for commons downloads.
43d03012b2 Fix typo.
796be24f01 Add missing change from previous commit
e0f4b55993 Undo accidental commit.
8e99a3feae Fix 43315. Display value rather than key.
c1bce46343 Fix bug 43468. Prevent NPE.
6139720d67 Fix bug 43173. Correct location for logging.properties.
d381684667 One more place where a commons-logging-api.jar reference can be removed now extras repackages the source.
a65e659168 Fix odd statement.
1c3cdfab1b Propose Correct StandardManager.sessionCounter after reload!
510615544e Set correct sessionCounter after reload sessions! Fix two indent lines.
65434dd107 update changelog
2df0c4dca1 Add in the ability to turn off reverse DNS lookups for membership on a global scale. alot of system aren't configured for this, so simple debugging or warn messages that try to print the name, cause timeouts
ab2899866b Add the extras step otherwise it won't build a release.
76297fdd41 Update to available libraries
0ba306bf2c Fix a problem with the installer. File /r lib was selecting the jar files in src/webapps/examples/WEB-INF/lib. There may have been other issues too. Make all uses of File /r more explicit as to the files that are being referred to.
7d8963170e Update Eclipse classpath to latest versions, add test code and use standard Ant variable.
3d0cc89a91 Library updates. Update to latest versions:   - commons logging 1.1.1 (needed fixes to build script to work with non 1.1 version)   - nsis 2.34
a175109e6c Revert previous accidental commit.
20110799d6 Fix bug 43344. Correct typo. Patch provided by Tim Nowaczyk.
d128630d6a fix regression for bug 11117 while maintaining the no need to proceed and block for comet connections that handle chunked input
5053427fc1 Clean up build scripts. Patch provided by Paul Shemansky.
926b58df25 Fix bug 43743. Correctly handle nest tag files packaged in a jar.
b2864fa351 reformat, no change, so that the upcoming changes and corrections of mbean files can be easily read
8861849e5c start the cluster JMX impl
d61ec15181 minor fixes
46ef8c93f5 Include 6.0.x parameter processing fix in trunk.
28fefbb48d Tabs -> 8 spaces
bebba3aa39 No functional change. Remove unused code. Lines <= 80 chars
1390f305ea Fix path
89ea8b5718 Fix possible NPE when no ROOT application is deployed in fix for bug 43839.
121c8a84e7 Improve fix for 43840 with better error handling, a better variable name and a bit of other clean-up.
b6c8a05de3 Fix bug 43758. Return empty string rather than null to prevent the NPEs that happen otherwise.
250f88b34b Fix bug 43775. Don't change line endings for binary files.
f89c3645fa Fix bug 43800. Make clearer relationship between APR and native in docs, error messages and the installer.
fd4771e5eb Align docs for Jasper options. Put in alphabetical order, add some missing ones, remove an unused one and address feedback provided on users list.
f54c5bcd6c If we are reloading the context, we must get rid of the old instance manager, it uses final fields, so we can't issue it a new class loader to the old instance
6e3f8f09e1 Update props
9f26399e88 Add some notes for Tomcat 7.
82db569474 Add a missing check
5c32d39c24 Implement a fix for bug 43840 along with a rudimentary test case.
b78615bc58 Add missing package declaration
e2a905f20d Fix bug 43868. MBean methods getInvoke and getSetter were broken.
313f12e28e Fix bug 43878. When development mode isn't being used, use a single JasperLoader. The main benefit is a reduction in the use of perm gen space when there are many JSPs all using the same few tags since the tags are loaded once rather than once per JSP.
161025b23d Tab police.
6a408e8695 http://issues.apache.org/bugzilla/show_bug.cgi?id=43285 Missing EL Coercion causes argument type mismatch
4bd54ad3fa http://issues.apache.org/bugzilla/show_bug.cgi?id=42503 ServletContext.getResourceAsStream returns stale data
f606af35e3 FAQ links to wiki use the xslt task instead of style task
1ec2cdbc03 Fix bug 43914. Location headers must be encoded. Patch provided by Ivan Todoroski.
4b14e7cc13 Fix for bug 43839. When cookie based session tracking has been disabled, URL based session tracking would fail due to the presence of a session cookie from a parent context. Based on a patch by Yuan Qingyun.
da220b04c8 Tab police
3578b17b3a Fix bug 43909. Make sure locale maps to wrapped ELContext. Patch provided by Tuomas Kiviaho.
ef76b38383 Fix bug 43944. Use a message that exists.
1b349838ae Fix bug 44088. Expire button didn't work. Patch by Ben Short.
e393b0e612 Fix 44084 with a patch provided by Noah Levitt. I also made a few additional fixes to line lengths etc.
629db716a7 Tab police - a minor infraction ;)
2f4ded344f Fix CVE-2007-5342. Limit JULI privs to just those required to prevent per web-app configurations having too many privs.
8258abcbbb Fix bug 43236. Reset the usingWriter and associated flags when the response is reset.
c5dd7d0fd8 Fix bug 43241. Patch provided by John Kew.
a7fde77599 Add note to docs about use of privileged flag and consequent changes in parent class loader.
305c95af62 port new annotation logic from previous trunk
9ca339ee47 Better patch based on Filip's comments
1f81445c27 Fix bug 44041. A small sync is required to prevent attempts to load the same class twice.
ccc1cd8b1c Don't load the entropy but sets the file the entropy is collected from.
4db6a00af6 Allow to specify a random device. SSLRandomSeed="/dev/random" SSLRandomSeed="/dev/urandom" SSLRandomSeed="builtin" (Default). The native already exists.
26444df9e5 43993 - mime mapping for WS-Policy Patch by Fabian Ritzmann
44df2cf326 http://code.google.com/p/google-highly-open-participation-asf/issues/detail?id=23
21d7fc341f This files were originally committed (in TC5.5.x) by a Sun employee (Remy) with Sun's permission and is therefore therefore licensed to the ASF under a CLA. As such, the restrictive header can be removed. See the following legal-discuss thread that went into this in much more detail: URL: http://mail-archives.apache.org/mod_mbox/www-legal-discuss/200707.mbox/browser Thread: SUN PROPRIETARY/CONFIDENTIAL code in myfaces
0bf98d4b09 BZ  43530
9173863218 Fix bug 43594. Use setenv from CATALINA_BASE (if set) in preference to the one in CATALINA_HOME. Patch provided by Shaddy Baddah.
834fd352da Fix bug 43611. Provide an error message if user tries to upload a war for a context defined in server.xml rather than failing silently.
a2161f6b7c Fix bug 43622. Don't overwrite the min compression size set by the compression attribute with the default.
3444168011 Fix bug 43757. Rather than use string matching to work out the line in the JSP with the error, use the SMAP info and the knowledge that for a scriptlet there is a one to one line mapping.
c89dca2d74 Fix bug 43957. Service.bat doesn't configure logging correctly. Patch provided by  Richard Fearn.
a6662f165f Fix bug 43706. Copy/move should return 201 if successful. Based on a patch by Panagiotis Astithas.
39e2574671 add get/set for properties
3c765e7959 Remove Sun notice that should never have been included in the original commit.
6fa84873d4 Remove conditional headers from the re-played request.
6778a49b8b Fix bug 43887. Include exception in the log message.
01df74afe7 Update WebDAV javadocs as a result of bug 43893
e496755568 Fix properties
d3a01039b3 Code cleanup. Fix warnings in webdav servlet. No functional change.
fc1d56b0c7 Include Fix for bug 43702 in trunk. Inner class files have unnecessarily long names.
1ac6800c4d Include CGI include fix in trunk
810ea61ec5 Fix BZ 43846 http://issues.apache.org/bugzilla/show_bug.cgi?id=43846 and port improvements from sandbox
0e10c0a6cb Fix comet handling in case BEGIN event calls CometEvent.close
3ec90f5803 Correct JDT location
33d7c16d0e Add cookie patch to trunk to keep it up to date
f953df8ce5 Better patch for BZ 43675 in response to Remy's -1 to previous patch
67619cea56 Resolve licensing issue with these files by replacing them with AL2 licensed ones from Geronimo. I didn't svn copy these files as I wanted to retain their history. The contents came from geronimo/specs/tags/geronimo-jsp_2.1_spec-1.0/src/main/schema/
e2c414e603 Really remove status this time
e31a7c65a3 Remove the STATUS file, add a PROPOSALS.txt file
a1d5a24868 Create C-T-R development branch
e5c1782d7a change vote, still couldn't get the tests through
65d450aacc add my vote
40c044c694 Add vote on cookie patch
97af98efcc 2nd Patch includes the first, so combine them
5be42cc646 Add another proposal.
9a2d59df65 Cast my vote.
58ac6c8a66 Added proposed fix for version number fix
51aedf0700 Propose fix for 43675.
dfc21d67c8 Propose fix for 43702.
8224a07309 Add fix for CGI bug reported on users list
09d62b42db Fix better readable!
c2cc9f9dd6 Commit the accepted proposal to prevent CLOSE_WAIT sockets.
c400aaf2d2 Commit the accept proposal to improve JAVA_HOME detection.
0ecd0bf9b8 Add the tests of the cookies.
b68075d013 document changes
c459f75008 Note to self, you can't copy and paste from 5.5 to 6.0
a65d593224 removing committed patches from STATUS
ae517bea30 fix possible DoS condition when using the experimental NIO/AJP connector
7b93f57333 Continue to give Remy a headache by fixing the problem where when the outer most wrapper is a ServetRequest/ResponseWrapper, but not a HttpServletRequest/ResponseWrapper would cause an NPE.
cd93610f02 Remaining fix for NIO connector
d24860cb91 Cast some votes - reviewed and tested
1509fb4381 add my votes
7f6cdd6e1e some votes
2ff48fe509 added in proposal
f1aeb76685 - Some votes, after getting a headache reviewing a patch.
f7cc581575 vote
4e507a9303 votes
a666ac682b Add a fix for sockets in CLOSE_WAIT state.
0c91d7f4a0 Add in MD5 fix
ab7b037e23 Improve patch for WebDAV issue.
2e21a654a5 - Vote.
dd5444129a It also improve the fix for 37284.
32218c62e3 Propose a better patch for IcedTea support.
580b488ecb Add the Cookies tests patch.
33e8d944da Add vote
4cbea0a46c Propose fix to BZ 43668
96d1b53a63 cast votes
efc6f154a5 Propose forward port of NIO/AJP bug
527696ebfb Add improved fix for webdav vulnerability
0f69c9b275 Make unescaping the exact reverse of escaping. Code clean up.
ee8247ca13 Final proposed patch before tag
7d993a6bdc Added NIO connector to server.xml parser warnings
17cbaf862e +1
18dfed7fe6 - Propose a shell script update v2 (but it's better to ignore it, JF told me he would do something better   later).
3caeba395a update changelog
e491b0cb28 update status file
081a982190 Add a ANT script that can sign and publish to the central ASF maven repo
aeffeb5ffb Change my vote after patch revision
56302f4d9a Cast a vote.
bcc0420c9b MD5 proposed fix as the old files look kind of ugly with the unexpanded variable in there
e02e3e72e5 Add in voted on fixes
a00aa144ef Added vote, and corrected mvn.properties.default (added back AL2 license to property file)
c876438e79 Add further cookies patch Add votes
3db17b0346 Add my comments on STATUS
e00b43b835 Proposed enhancement to the maven ant script
ef12ceeebd proposed bug fix
b6190c926c - Update to JDT 3.3 (really, this time).
901292cf9d Fix CVE-2007-5461.
558a6f3a9f add my vote
83ef753ffb proposed fix
97ca5c3204 add my vote
80adb9cb95 proposed bug fix
c032122069 Fix property setter for keystore type
2c0b6451e2 add my vote
37bfce1f86 - Propose a shell script update.
161ed21c45 +1  a few patches
3eec84e0c0 added votes and new proposed fixes
707c76d120 - Propose fix for the JDT update.
7314f81370 - Commit patches which have been in the status for some time: * Fix explicit flush before response commit in the org.apache.jk AJP connector.   http://svn.apache.org/viewvc?view=rev&revision=580815
4675d60ca0 webdav vote
ed1c3c311a Propose fix for webdav vulnerability Vote on the patches I could review quickly
0fc9e8211f proposed bug fix from L. Galfaso
9565cfe356 update
2916e464b2 - Clarify stop patch (inline, it's very small).
c90f9875e5 - The modification was a bit hard to understand for me, but does not change the behavior for the APR   connectors.
1412504d42 missing mbean definition
9df0827fb6 - Vote.
47e0a68631 Proposal for a generic way of setting attributes, letting the components decide if a warning should be issued or not by implementing 'boolean setProperty' instead of 'void setProperty'. The old way, 'void setProperty' is still backwards compatible, and its behavior has not changed.
16464d6ec7 - 43479: Memory leak cleaning up sendfile connections (submitted by the bug reporter). - 42925: No timeout for sendfile (fix TODO item that had been forgotten).
c567c797d9 Remove a wrong and probably missleading part so a sentence.
b44a372189 - Vote.
96332b0ed5 +1 proposals
605b394d07 add change request: call StandardServer stopAwait
d1fabd60df Update jdt.loc current reference at build.properties.default is gone!
9614713cdf vote +1 to new fixes
92cb2c0977 - 42925: Another minor patch.
be25e850f4 set replace props and eol-style
e24ac6bde0 Very usefull patch!
568a7f5052 - Propose r580815 for review.
099325a85d update changelog and status
556298f595 fix request processing stats
7c55155a86 - Cookie parser update. - Submitted by John Kew, with an update to the initialization   of the boolean array (hopefully easier to read and modify).
93d0981be2 Cast a vote.
e424932cb8 Add my vote
0ce19e27e8 add my vote to cookie patch
df51ecb5ee Patch proposal for request info data
4eb57a4955 Add the test part move remy's patch to people.apache.org and cast my vote.
9e19e26068 - Patch update.
2562cb6707 Try to arrange the  proposal. And cast a vote.
c2f9891946 - Add status file.
73b5e41aba bug 43453: ClassCastException at  org.apache.catalina.core.StandardContext.findStatusPage(int)
4b17634ed0 bug 41797: CNFE/NPE thrown from function mapper when externalizing Patch by Tuomas Kiviaho- tuomas.kiviahos at ikis fi (submit part2 of the patch as seem in comment #3)
4461a96d8b bug 41797: CNFE/NPE thrown from function mapper when externalizing Patch by Tuomas Kiviaho- tuomas.kiviahos at ikis fi
5aed2f5498 bz http://issues.apache.org/bugzilla/show_bug.cgi?id=43435
403794cca6 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@576565 13f79535-47bb-0310-9956-ffa450edef68
fcd7d08009 undo 575332 (alias support) due to 2 vetos
bd07e2d640 SRV 6.2.5 says supporting for '*' as the servlet-name in filter-mapping.     <filter-mapping>         <filter-name>SampleFilter</filter-name>         <servlet-name>*</servlet-name>     </filter-mapping>
28da14176c Backport from earlier fix http://issues.apache.org/bugzilla/show_bug.cgi?id=43356
a6929e4e31  Handle more then one system property replacement at file logging.properties.
6cd27ebfc2 add cookieDomain description!
fe56bc3aed Fix porting typo!
2d348c5271 Improve large-file support (more then 4 Gb) at all AccessLogValves, backport from 5.5.25.
63886810e4 Optimized JDBCAccessLogValve combined pattern request attribute access.
6eb1f5229a Improve large-file support (more then 4 Gb) at all AccessLogValves, backport from 5.5.25.
9e8d76ad5b Support logging of current thread name at AccessLogValve (ex. add %I to your pattern).
af221086d4 Support logging of all response header values at AccessLogValve (ex. add %{Set-Cookie}o to your pattern) and ExtendedAccessLogValve (ex. add x-O(Set-Cookie) to your pattern)
4aa093eba2 Bug 42831
93136d1814 BZ 43057 - Trivail doc fix
022bf2a2f3 Allow for Aliases at the resource level.
14a8044a61 More clarification about Contexts, path and docBase as a result of http://marc.info/?l=tomcat-user&m=118945359807000&w=2.
872420c87c Take account of bug 39013. Not sure if it is valid but there is a warning about it in the context docs.
f1ac657fa2 Fix typo
1916b0cdf4 Made session createTime accessible for all SessionManager via JMX - Backport from 5.5.x
dd27d68ee3 Clarify appBase - docBase relationship
96558d3238 Improve fix for 33774 by adding check for alternative exception to the remaining point where it could be seen.
4dd22a5af4 Port improved fix for bug 30949 to TC6.
732d2f617e Forward porting Reader fixes from 5.5.x
cb95a1f200 Forward porting Reader fixes from 5.5.x
034a29c41e Update cipher key list with Sun's new ones in Java 6
9ef3973605 Commons moved to TLP
7155b61701 Remove the explicit reference to the source form of sub-components as the licenses apply to binary forms as well.
f20eb7d685 - Typo.
6491b5e5d7 - Small changelog update.
1b22762217 As per http://marc.info/?l=tomcat-dev&m=118848624422496&w=2, correct the license text for these files.
a80a6dd9a7 Fix bug 43175. Typos in servlet XSD files. Patch provided by Takayuki Kaneko.
9c37a0110a Fix bug 43216: Set correct StandardSession#accessCount as StandardSession.ACTIVITY_CHECK is true.
3d781d2e37 Fix big 43215: Thanks Takayuki to report it -:)
16ada677e4 - Add back arbitrary attributes due to SSL socket factory configuration. Unfortunately, it seems only the APR connector   can have validation since the set of attributes is fully known.
2937eedf57 Fix typo: Can't init wsdl Service as Naming Context
8a4f432e82 backport from trunk, correct solution is to expand the buffer, but that can lead to overly large buffers, we want the the size the developers specified for predictability
c87791c3b2 Added support for when the buffers are sized very similarly
019ba6cada backport from trunk
f7c5157a43 Log deserialization errors as error log channellistener errors as warnings
7342cadd1e Added license header
a8d329a90b Added example on how you can name nodes with existing system
2d258457cd remove non needed methods, somehow they cause an itch, so lets get rid of the itch
b0c9a398fe 42466 globalresources.xml has a wrong link patch from       Takayoshi Kimura takayoshi at  gmails doooot com
be1e80b3d0 42466 globalresources.xml has a wrong link patch from   	 Takayoshi Kimura takayoshi at  gmails doooot com
8c03bc9ff5 43155 remove commons-logging-api.jar since it ain't there
237f531eac 43155 remove commons-logging-api.jar since it ain't there
1e9c064094 42569 Small grammar correction on default Tomcat index.html page
e3fdb66e1d 42569 Small grammar correction on default Tomcat index.html page
ad0eae0b3d BZ - 20068 Patch by Wendy Smoak wsmoak at apache org
d672365cbe BZ - 20068 Patch by Wendy Smoak wsmoak at apache org
19e01d8f00 Update changelog
ebdeb7809a Fix the B2C converter. Sometimes data comes in incomplete chunks, and we have to check to see if we have available data, otherwise, when we return -1, the underlying InputStreamReader actually returns 1, and we get garbage in the output data. I will discuss this on the dev list, since it affects all tomcat versions, at that time I will also provide a test case showing what can happen. Please comment on this fix, if there is something alarming
fc81553010 Documented the virtual webapp loader
ad79b142ea Extend the virtual loader a bit further, allowing developers to specify a class-path using the MANIFEST.MF file in the WAR file. I can't see that it would break the spec, and Websphere does it.
13577775f8 improved upon the existing virtualwebapploader, new feature: can configure the path separator new feature: can create a local repository for runtime new feature: jar files are added as addJar to prevent locking of files
31eb7e0384 Add log.isXXXEnabled
54b0ab3402 Extract boolean recoveryEnabled correct.
4804be7b8a Set correct socket transfer buffer size
decf14261d required a little bit more touchup
a409acd292 Fix NPE if no classpath is set
7ac21f93a8 Added in the ability to name classloaders in Tomcat
e5991a9ccd back port from trunk, recovery options and retain membership
3405c078ca Enable configuration of all properties, including the recovery turn/on/off
3201c0a971 don't reset the membership during a recovery, otherwise we lose all info on the surrounding members
f880bc99b0 merge back from trunk
0b4931a772 Added in a recovery service to the membership layer. if the network card gets disabled or something similar happens, it tries to recover the service
462cda09f0 - Fix recycling glitch. I prefer using nextRequest although it's a bit slower, since it's identical to regular request   processing.
accbcecb97 backport from trunk
7d70d594d5 Set the interval in a distributed env, patch by Takayuki Kaneko
0023fdab32 backport from trunk
d87b4ef1cd filters are not properly recycled if the request was a Comet
1e1c483fbe backport
bc52eb30a5 Additional methods for JMX info
3433bfaa33 Add license header back in removed in previous commit.
3b196f6513 Fix bug 43102. Patch by Ben Hatton.
e8ad5f9857 - Experiment with reporting warnings for unmatched elements and attributes, based on Bill's ideas. - The NIO HTTP protocol handler does not seem very reporting friendly at the moment. - The change should be rather safe, if it causes problems that cannot be fixed easily I will revert it.
89bc591b1c protect against a NPE when a member disappears
5892633ef0 backport from trunk
9379f7c23e Added in backup manager
564347efe9 Fix NPE in the map, add accessors to stats information
361993fe8f Fix the comet recycle sync issue, will think of another solution some other time, for now this solves the problem
58d9f42021 backport
191bb97b51 oops, no one was supposed to know that I still debug with System.out
ba544005b3 backport from trunk rev 564727
02a40f971c fix state synchronization problems
15abe28efd backport from trunk, prevent premature session expiration
c0c4d61135 Make sure when a session becomes primary that its timeout value is reset, otherwise we can have unexpected session expirations
248a29b265 backport from trunk http://issues.apache.org/bugzilla/show_bug.cgi?id=43053
b8ba19a1e2 must set the primary in all locations
edebe0b9d1 more fixes, same bz http://issues.apache.org/bugzilla/show_bug.cgi?id=43053
7f07947410 make the backup node become the primary so that we can still expire sessions http://issues.apache.org/bugzilla/show_bug.cgi?id=43053
a6c49769c0 If there is no primary node, then let the expiration time apply to the backup node
9ebcc51de1 remove proxies without primary or backups, only backup expiration handling left
50ce1d5139 if primary member disappears, remove the entry in the hashmap
d4f7827841 Publish primary node information as well
26d84db7b5 remove throwing of exceptions, handle everything inside the JMX helper
de685def46 remove not used fields
b0a773718f Setup framework for cluster JMX operations
48159b9d40 Fix typos. Play with wording. Add note about license for wsdl4j.jar
b3ef938d68 forward port from 6.0
1d3ec5252f - Update changelog.
7ffaf873c8 - As suggested by a couple people, start accepting after starting everything else, to avoid running into non   initialized fields.
b9cbbb5151 back port from trunk, bz http://issues.apache.org/bugzilla/show_bug.cgi?id=42530
cccdf40576 Don't send out if there are no members
29551a72ff Don't send the message if there are no members in the cluster
1602b8524d Line endings
ee43b5bd11 forward port from markt bug fixes in 6.0.x branch
38e7124318 Improve poller timeout handling to not waste cycles
2621ea1cf3 Improve upon poller timeout handling, to not waste cycles running the timeout setting too often same fix as 6.0.x
0b15c93a1e Add eol-style native
2bd3502c5f Add eol-style native
af14986277 Add eol-style native to the maven files
c96115e3fa Add license to another file I missed.
ce3e76fdeb Add license to a file I missed.
abe33d255b Add missing licence header to all files in webapps. Again, need to check commit message
95ff55c421 Add missing licence header to all files in res
b4c5bdcde9 Update to 2.0b licence header
2fee5acd05 Add missing licence header to remaining files in java/org/apache Everything compiles without error but I need to check the commit message to make sure it hasn't done anything crazy.
b34afd99e7 Add missing licence header to all files in java/org/apache/jasper
cd8db30e45 Add missing licence header to all files in java/org/apache/el Everything compiles without error but I need to check the commit message to make sure it hasn't done anything crazy.
78a39267df Add missing licence header to all files in java/org/apache/coyote
2eab9fdc75 Add missing licence header to all files in java/org/apache/catalina Everything compiles without error but I need to check the commit message to make sure it hasn't done anything crazy.
8da52747c6 Add xml declaration
e23d28b0b2 Replace this file with the AL2 licensed Tomcat 5.5.x versions.
1fd85f0978 Replace these files with the AL2 licensed Tomcat 5.5.x versions. Includes mime-type update that wasn't in 2.4 xsd
84236ceb0a Replace these files with the AL2 licensed Tomcat 5.5.x versions.
20aee33ff9 Fix results of running the license checking tool for java/javax/mail directory
6d191037cd Fix results of running the license checking tool for conf directory
843f790f15 Fix results of running the license checking tool for bin directory
2ba95f7af3 Fix results of running the license checking tool. Some of these are border line, but better to have the license present than not.
c8eed7972e Correct Tomcat version
54ff82d1c5 Remove code testing for bug 37326 showed was not required.
2cce4af189 Port fix for 37326. Ensure missing includes resources cause errors rather than being silently ignored.
44e36eaae5 Port fix for bug 42944. + should only decoded to space in query strings.
a546262f1b Update JavaDoc information
783dc90c26 Forward port from 6.0
34e698c714 Add a simple one-line formatter.
40cb6db02b forward port from 6.0
7afc2dbceb patch provided by Alexander Maas, fix timeout setting on a replicated session
8b17e7e202 Fix bug 42979. Update sample.war to include recent security fixes. Ported from TC5.
7277754237 Fix WebDAV for MS clients. Fix error message when there is no request content Ported from TC5
8aa247eb34 Port fix for 39212. Possible NPE and redundant code.
663ddc6cf8 Added missing attribute to the docs
6f210e6baa BZ 42951: Port r454193 (BZ 36976) from TC 5.5.x: Don't use CATALINA_OPTS when stopping Tomcat.
39be2cadd1 BZ 42951: Port r454193 (BZ 36976) from TC 5.5.x: Don't use CATALINA_OPTS when stopping Tomcat.
f7591b486d missing import
78485ff2b1 upsync from 6.0 http://svn.apache.org/viewvc?view=rev&rev=557454 http://svn.apache.org/viewvc?view=rev&rev=557467
cb8f84acc9 up sync from 6.0 http://svn.apache.org/viewvc?view=rev&rev=556453 http://svn.apache.org/viewvc?view=rev&rev=556489 http://svn.apache.org/viewvc?view=rev&rev=556767
f7445921e3 up sync from 6.0 http://svn.apache.org/viewvc?view=rev&rev=555310
f0e76d2304 up sync from 6.0 http://svn.apache.org/viewvc?view=rev&rev=554814 http://svn.apache.org/viewvc?view=rev&rev=555304
b8ac932783 sync up from 6.0 http://svn.apache.org/viewvc?view=rev&rev=553716 http://svn.apache.org/viewvc?view=rev&rev=554109
2c6ad22854  syncing up from 6.0
265cc465a1 synch from 6.0
e9f1b47642 forward port from 6.0
c7a15b9887 - Fix classcast exceptions if Comet is used and there's a filter (I forgot to commit this patch).
aac77091e8 forward port from 6.0
12e9be2caa complete the bug fix
ef93f84def This Valve is to extra the SSL informations from additional headers When using Apache httpd as proxy they are added by mod_headers and the following directives: RequestHeader set SSL_CLIENT_CERT "%{SSL_CLIENT_CERT}s" RequestHeader set SSL_CIPHER "%{SSL_CIPHER}s" RequestHeader set SSL_SESSION_ID "%{SSL_SESSION_ID}s" RequestHeader set SSL_CIPHER_USEKEYSIZE "%{SSL_CIPHER_USEKEYSIZE}s"
78d1cf1c2f BZ 42937, forward port from 6.0
2af6488711 BZ 42937 use the correct index
805357866a Make cookie handling conform to RFC2965. Don't treat the single quote character as special.
5202986c8f Fix compiler warnings. Filter output.
813e7ee893 Clarify that the manager app is already installed. Remove adding entry to server.xml as an installation option.
f201950a5a Fix reload problem that only affected ROOT.xml. Ported from 5.5.x
02351a7581 Remove references to adding stuff to server.xml and cross-reference the context docs instead.
59ec6629a0 Correct j.u.l log levels in JULI docs.
9b258bf0a4 Correct j.u.l log levels in JULI docs.
48a300e6ae Use Constants.SESSION_PARAMETER_NAME instead "jsessionid".
13c212193e Use Globals.SESSION_PARAMETER_NAME instead "jsessionid".
4d65197060 Fix typo
ee0ef53cb1 fix for bz 42840 http://issues.apache.org/bugzilla/show_bug.cgi?id=42840
e6c35d9284 Fix BZ 42840 http://issues.apache.org/bugzilla/show_bug.cgi?id=42840
7a6e9b21a6 Separate sequence increment from getter in ThreadPool to avoid misleading increments during monitoring via JMX.
bfe23ce0c4 Separate sequence increment from getter in ThreadPool to avoid misleading increments during monitoring via JMX.
5bdbb330d3 Remove invalid attribute "encoding" of MBean MemoryUserDatabase, which lead to errors in the manager webapp JMXProxy output.
1df4d0ee8e Undo unintetional commit from r554562. Will come next as separate commit.
915f582cf0 Remove invalid attribute "encoding" of MBean MemoryUserDatabase, which lead to errors in the manager webapp JMXProxy output.
dcb600fd94 Don't write error on System.out, use log() instead.
b637894404 Don't write error on System.out, use log() instead.
1de403d2e2 BZ 39813: Correct handling of new line characters in JMX attributes. Patch provided by R Bramley. Ported from tc5.5.x r415029.
4904623c66 BZ 39813: Correct handling of new line characters in JMX attributes. Patch provided by R Bramley. Ported from tc5.5.x r415029.
283f4ade0b Fix typo.
a4faa0ed03 Remove old util class that is no longer used.
561941256a o.a.t.util.http Tabs -> 8 spaces Fix compiler warnings No functional change
a0d1ce103a Escape the " in the cookie value.
7db95169f3 Arrange the handling of cookies values.
b9a978792b BZ 42803
6a8c50223d Fix BZ 42803
3457d7ce53 Force closure of connections upon a server shutdown
71c58b90f8 - Changelog update.
a6ea14d2e9 Bugzilla 42753 Same fix as 6.0 branch
fd6f550826 - Fix a lost reference problem when using Comet with a security manager.
6693a6e8cb try setting equalness to false, see if we can do better
ec61b986f9 Same fix as for 6.0 branch, invoke error if the read did not empty the buffer
58746806fa - If bytes are not read, send an error event (otherwise, fields referring to the connection could remain).
4e219ff529 porting AJP large-file support from 5.5
f232171deb porting AJP large-file support from 5.5
85e94f63aa Tabs -> 8 spaces Fix compiler warnings
ba25bfbf0d Port fix for bug 41722. role-link in web.xml should be optional.
6c6ad833be Close streams as noted in bug 42314.
53add24c46 Port fix for bug 42547. Fix NPE when a ResourceLink tries to override an env-entry.
428b4716f4 Remove default host which is no longer used.
e46822264f - Fix API. Submitted by Bill Burke.
5b65cf4328 Port fix bug 42643. Prevent creation of duplicate function mapper variables. Fix various compiler warnings.
e1f14dbe31 fix formatting for latest added example
15a736bd9f Added in AJAX with delayed response example
1f0293e412 minor correction
6271d5e02c Porting large-file support for the AJP Connectors from 5.5
a3ba5062e0 Fix XSS issues in snoop.jsp. This is CVE-2007-2449. Some of these are harder (impossible?) to exploit than others but doing all of them means there won't be another XSS issue to patch later. I also made a similar change for a couple of other JSPs that are in the harder/impossible? to exploit category.
4b447e78c5 Ignore local build properties
bcb9ed822f Porting large-file support for the AJP Connectors from 5.5
1bc3bcb284 Fix XSS issue in Manager and Host Manager. This is CVE-2007-2450.
147b83ccaf added simple example code snippets to comet usage
9191a18624 simplify API a bit based on feedback
85d386f7a3 fix for BZ 42650 http://issues.apache.org/bugzilla/show_bug.cgi?id=42650
46bda081df fix for BZ 42650 http://issues.apache.org/bugzilla/show_bug.cgi?id=42650
e79edcdcf7 fix for BZ 42648 http://issues.apache.org/bugzilla/show_bug.cgi?id=42648
beebd80430 Fix for BZ 42648 http://issues.apache.org/bugzilla/show_bug.cgi?id=42648
6d7b58b66b Add generation of html versions of source files for the examples webapp.
327964d395 oops, didn't mean to relax the close method
e1bec14942 Added some doco
024d61a87e Look for tools.jar in right place.
7a235aff13 minor optimization to the blocking selector
b3396c0369 Cancel the blocking key only, no need to cancel anything else here
1dbffc3a91 added debug statement instead of swallowing
1176cadc9c straightened out buffer handling
2fe78b3322 notes, still need some work on the write to socket
850da31663 Simplified the API, no need for the IOExceptions Updated documentation, added in some notes about life cycle, more source code examples to come
5accb17571 Fix old reference to Jakarta.
6d2a325154 Port fix for 33774. Retry on ServiceUnavailableException
a84cde3d9b Fix compiler warnings in o.a.c.realm
050d9ed705 Fix compiler warnings
0114b2d041 Port fix for bug 42497. Include ETag header on 304 response as per RFC2616. Patch provided by Len Popp.
b37ec503a0 added cleanup code
12360f259e Thread safe handling of dealing with async writes and non blocking writes, needed to separate it into a poller for incoming events and one poller for outgoing data Not thread safe for multiple async servlet threads writing at the same time, up to the comet developer to set it straight
6e07f1f7ea Forward port of BZ 42509 and BZ 42515
089609a6f3 Fix signatures BZ 42509 BZ 42515 Submitted by Paul McMahan
71eccb355a - 42559: I did not make equivalent modifications (the isCommitted method was not invoked on the facade).
077867c74d remove not used, at least until I've figured out the concurrency issue around the read/write
bc12d3903b restore original interest ops
9ca0f82d94 consolidate the usage of the NioChannel buffers
aeb96d4940 rearrange
c83d8ec5ae 1. Timeouts are now per connection, not using fixed timeouts anywhere. by default the connection gets the timeout defined in server.xml 2. Implemented all Comet operations, including the ability to have none 3. Implemented CometEvent.isReadable and isWriteable    isAvailable - means data is available to the servlet    isReadable - means there is data from the socket also checks the socket, by doing a read, in a non blocking fashion to verify this to be true    isWriteable - the last write attempted on this socket was 0, hence we are probably blocking 4. simplified CometEvent.register/unregister, they are now just one call and no syncs 5. After each event, the connection is registered with the same operations it had before 6. CoyoteAdapter respects when the servlet doesn't want to be notified of the READ event, hence it doesn't invoke it automatically 7. Let me know if MutableBoolean and MutableInteger should be elsewhere(in terms of package), they are used since ActionHook doesn't have a return value and also valuable in the output buffers since SSL writing is two steps, one through the engine and the other to the socket I'm pretty happy with how isReadable,isWriteable works, they are completly non blocking and very accurate True non blocking in the buffers and filters seems like a major surgery, still holding off on that. Need to fix the NioBlockingSelector as it is almost impossible to make the poller interest declaration thread safe
0d7bfe68c3 return the amount of bytes written
8aabc1ffb2 add brackets to clarify what were trying to do
f35ad0237e implement CALLBACK and WRITE events
a7a1c2fe86 simplify register and poller interest for comet, all can be done in one call
e32e38be7c Port fix for bug 39425. Add additional permission required for precompiled JSPs.
577d63ee24 no need to sync here, the poller will dispatch for handling anyway
f95d20357d setup default operation
3fe02e657f When using a comet connection, register the requested operations instead of the default read
a0cc7351f3 added in some comments
e7e87b2b7a question mark has to be a global variable
30ad3a7c24 implement non blocking reading of the request line
e903340fa3 The protocol class will register the socket with the poller for another read event
7d7653cb06 Remove the non blocking handling of the request, doesn't work well with the new non thread local processor handling
68d130fcbe Make the new way of handling processors work with the ability to read headers in a non blocking way
96f6fcdd6e implement comet operation notification
1c6e3866d3 only notify the poller if it is done async, otherwise we don't need to, it will be done at the end of the request
bc29ca0ae7 Blocking and non blocking is the only configuration option right now, no need for the NO_IO option, as it can be controlled using the register/unregister options
a7656b13e7 simplify isreadable and iswriteable
35cc1aba67 adopted changes
2f185b3df1 Add the additional SocketStatus event types, its up to the connector implementation to send the correct one. Currently the functionality is backwards compatible as OPEN changed to OPEN_READ
05b286fb7e Added in the registration of comet interest operations Added in PollerInterest enumeration to satisfy different socket implementations and to decouple org.apache.tomcat from org.apache.catalina
71ee94f279 add in flags for readable or writeable
f23b99755b implement method callbacks
6188989f68 cleanup
229e3a093f set timeout can be called any time, at least for now
406e50853e configure can be called as long as we are on a tomcat thread, not in the begin stage
969a8da892 remove usage of timeout attribute
464a81464d Implement setTimeout using an Action instead of an attribute
384a53e741 update to test cases, no change really
73ca8f0d9b CometProcessor should extend servlet, as they have the regular servlet lifecycle
9e44e4de71 - Switch from AnnotationProcessor to InstanceManager. - Submitted by David Jecks, with some modifications: package names, addition of an extra method to allow   injecting already instantiated objects, and a system property in Jasper (to specify to use the instance manager   to create tag instances).
41d01208ae - Redo findSessions which was outdated (42530 claims concurrency problems that I can't reproduce).
73daf70813 - Typo.
90319d6ab3 Porting fix to allow for a forward/include to call getAttributeNames on the Request in a sandbox
4c7def8f6f Add in support to check if the current thread is a Tomcat 'worker' thread or not, that way we can decide if the invokations are appropriate or not
0ffda38dec Automatically detect CPU and 64-bit JVM version. This allows to install the proper service wrapper for the JVM and CPU used.
9699966159 Add windows service binaries to the .zip distribution. The rule can be excluded by defining exclude.service.binaries in build.properties file. Service binaries included are for all platforms WIN32 and WIN64.
188cc2802e - Revert the API changes in the 6.0.x branch.
536bff44e2 - NPE check (when using JMX, if I remember correctly).
23c6dbb698 Correction Bug 42436 patch from Paul McMahan
0ea4c7cb5b Port fix for bug 39875. Fix genrics compiler warnings.
5e188bcc7a Port fix for bug 42438. Duplicate temp variable was created. Patch provided by Brian Lenz.
d1a4ee07d7 added some docs around the maven stuff
af811f8c70 Added in dbcp and cleanup for signatures, as signing fails when the file already exists
5984a69afe Added in build package using Maven ANT tasks and that signs our JARs with GPG as well. Almost there
38c4edd687 Added domain membership test
b102fee6fd update docs
c45e3561ec update docs
7638a3fcc0 Correction Bug 42436 patch from Paul McMahan
69f00cc0ba forward port
e1cab26ec4 Fix demo
056e09e4ba - Create a new branch for HEAD development, to be   branched later to https://svn.apache.org/repos/asf/tomcat/tcX.Y.x/trunk.
e16d483ced no need to pre initialize these values
bc307ebe1a add non block support
5a9dc8e5d8 add block/no block flag to flushing the SSL buffer
a125e40da2 lock in the right place
1d2a65215f Only lock when incrementing the counter on sending messages, can be further optimized to have a lock per member
e8fbf5b954 minor change
16f114715e remove locking from memberAdded and memberDisappeared, as it can lock with sending messages
704b0a0fd2 Correct fix for removal of first read timeout, we are always using soTimeout, both for write and for read
7a64e33c98 Shave a couple of ms off of the time :)
787bacb087 Always reset the MB when doing getBytes
7ea6c2e3c0 JNDIRealm does not catch NullPointerException for Sun's LDAP provider
33c9949d67 Fix BZ 42459: Manager webap table format error for stopped and undeployed webapps.
776736fe57 bug 42444: prevent NPE Patch provided by Nils Hammar (funkman)
59ef801965 Hups, Http11NioProcessor need FirstReadTimeout at strange way.. Sorry!
a01f578a46 Remove unused local variable step
7624460a3b Remove unsused firstReadTimeout attribute Set correct default pollerThreadCount
c9772ad6c1 Add selectorTimeout default and a lot of value formatings.
7959d3da07 left overs
5cbdf8ee89 minor optimizations
1190c62297 Add locks instead of synchronized statements to avoid issues between receiving and sending
480edc538e Added in a unit test for ordering messages
695455b6aa Avoid concurrent mod exception, remove from the iterator instead
44407d639b Make sure to respect the option flag, otherwise you must order everything
a175efac26 Fix bug 42401. Provide better JRE/JDK information.
eeef44428f Update context info
3508c9cf5d Added in actions for the new Comet methods
e26410c405 added in unregister
202aa57756 Add in getters Also change name from pluralis to CometOperation
162800ef49 feedback incorporated
1a255a1fe6 Use "%r" and single quotes.
783b9e014c oops, forgot these
0867277b1d New proposed API calls for Comet
0c7b82c76a Separate out read vs write latches, simplify implementation, avoid concurrency issues and prepare for new comet strategies
6e0f8724e3 bad link : s/tomcat-docs/docs/
607b06e2c1 volatile should ensure double locking to work properly
86c4b9f77d Fix binaries by using /D_UNICODE for library as well.
cba9ace775 Update fixed binaries that will do a thread dump on stdout redirected file even if the log level is < INFO
d9cfcc01c2 Arrange the default value of pattern.
637acc524d Fix bug 42361. Handle multi-part forms when saving request during FORM auth. Patch provided by Peter Runge.
5253834a3d Fix generics related warnings in o.a.c.authenticator package
b69a283827 mimic APR behavior and do stuff according to document, TIMEOUT should not close the connection
79a237bc87 - Avoid casting (no functional change).
edae922762 Set correct soLinger time
61dab219a5 set the correct so linger attribute
9829f2c3ba Fix direct connect, which apparently happens on Solaris
1ae7440d08 - Add back missing socketBuffer attribute.
8668d20fc5 Port updates for path usage limitations
5948870588 - Extras build update. - Year update.
1d735c35e0 - Use the main xml file for tasks. - Submitted by Daniel Santos.
ab07672828 - Changelog update.
04de9af6fc - Small javadoc update.
4c56b10e81 - Add some xsds to the constants.
aeb7692f92 - Use the better IOException type (any other exception is totally unexpected).
a9352556e8 - Remove the didRead flag (an error checking hack). - If there is a read event, do at least one read on the connector (the buffer is necessarily empty, otherwise   there would have been an error during the previous read event). - Side effect: EOFs can be reported using the END event, and exceptions can be reported as ERROR.
60f1d48592 Fix the bug in AprLifecycleListener, the value of SSLEngine is never transferred to the listener. Patch submitted by mturk
95460051b5 Ability to create a connector using a custom protocol specification for embedded. Fix for bug 42309
055779627d Same fix as for the APR processor, although wouldn't this flag be set on the "recycle" method
32055385e4 - Recycle the comet flag (pretty large glitch ...).
0d8318f239 - Fix paths. - Submitted by Frank McCown.
d48f5bee01 - Add a flag to work around the double start problem for embedded (the most usual problem is with contexts).
4a0472248d - 42308: nextRequest recycles the request.
31c0084d86 - Obvious typo in didRead. Ooops. Maybe Eclipse did that. - Return 1 for available when using a Comet read and no real read was done (actually, it could well be good enough   to only use didRead to get an "accurate" available() method, but it could probably be useful for blocking IO).
4a4304b1d7 - New read loop (much more conventional using the more accurate InputStream.available() method).
0b50d45a33 - Add socket to the poller after cleanup in the connection handler event method (possible memory leak).
c2d20a1e79 - Add code to check that at least one read is made that goes down to the connector for each read event. - It is an error to not read bytes as long as some are reported as available. - Generate a read event if bytes are available after processing the begin event (for API lawyers out there). - Not tested yet, sorry. In theory, previously working code shouldn't have to be modified at all.
3cafd07c62 - Add an explicit check for null (it's there in the facades ...).
9251fd085f Undo Pero's checkin, sorry Peter, just can't have it in there until the solution is more robust, although I don't think it will ever be implemented in association with memberships For now, senders that are no longer connected on the remote end, will be removed during the keepalive heartbeat
b3a3c25b4e - Add more accurate available() method, using a new action (still very cheap to invoke, and quite simple). - This is mostly useful for Comet, since it can be difficult to know for sure if reading is possible without   blocking if the beginning of the entity body was sent along with the request header in a single packet.
3d4eac8330 Remove call to remove clear connections upon a member disappeared event, this call is exposed higher in the API and should be controlled by the application
db8ee63800 Remove senders as member disappeared..
708dff2c93 Add heartbeatBackgroundEnabled to enable channel heartbeat call. Don't forget to disable the GroupChannel heartbeat thread. Default is false.
6ad3ba85e0 Change the name to a more appropriate name
5a514caac8 remove unused flag!
879cf828a0 - Changelog update for 6.0.12.
3efeb100b5 - Session expiration and statistics tools. - Submitted by Rainer Jung.
f418f36f71 - Update for the timeout configuration.
7098f89132 Implement keep alive timeout logic
a0fe1dba3c fix heartbeat
8d125a05f1 Change latch behavior so that it can coexist with other IO events
1203ec657a - Remove fixme for the timeout hack. I think this timeout has a lot in common with the keep alive value in terms of   resource use, so the normal behavior seems good enough.
38c897ba98 Fix error handling when a single failure occurs
12cf4dd354 reset timeout counter upon registration
eca11ee679 - This error shouldn't happen, and it's out of the servlet, so it is not going to be possible to send another event.
f9ddabab48 - 42202: Fix a problem handling %xx encoded URLs (unfortunately, some are encoded - the webapp CL and the system CL -   and some are not - the URL CL).
edcfe4ce0b - Port Mark's patch.
2a217d0d71 add enabled attribute to support JMX enable/disable logging.
26bd054b88 move to correct release, sorry!
db133a51d9 Add toString method to better logging support.
6a3690e9d5 - Proposed refactoring of dispatcher logging (remove some "I can't use a debugger" style logging as well).
c597d7b169 - Fix license headers. - Submitted by Niall Pemberton.
a49326136a - Fix license headers. - Submitted by Niall Pemberton.
df9f3249a6 - Fix license headers. - Submitted by Niall Pemberton.
b41ca6f6fe - Fix license headers. - Submitted by Niall Pemberton.
96142718f7 Add Missing isInfoEnabled checks No functional change
ea2947f9f2 Remove unused field and at copyright!
ed5180c036 fix :-)
f90399994a Add Missing isInfoEnabled checks No functional change
29e37f4723 Add Missing isInfoEnabled checks No functional change
3f1ba131b6 - Add the comet valve (commented out).
20bd80a273 Complete fix for 41655.
508f513efb Fix bug 42071 - ISE on multiple UnavailableExceptions. Allow recovery after an UnavailableException
a6db9d782c - Remove some attributes.
8c17d2816c default is not javac but the JDT compiler (See doc).
ce4cd2ed7e Revert previous fix for 41869 and apply Remy's suggested fix.
9d0ec06186 Fix bug 41869. TagData.getAttribute() should return TagData.REQUEST_TIME_VALUE when the attribute value is an EL expression.
e9df6ace9b - Protect about possible issues calling toString in escapeXml(Object).
1915323682 - Code cleanup (less thread local manipulation). - Submitted by Arvind Srinivasan.
82e878b1cf - Merge changes to the other protocols, to fix leaking when using an executor (for java.io, not using a thread local   has no performance impact). - Harmonize properties between the 4 protocols.
a46cd1e7f9 - Add session browser capabilities in the manager. Let me know if it creates problems (I checked XSS to some extent to,   but please double check if you can). - Submitted by Cédrik Lime.
523433ef29 - Add session browser capabilities in the manager. Let me know if it creates problems (I checked XSS to some extent to,   but please double check if you can). - Submitted by Cédrik Lime.
c4a1bd9fe7 - Add session browser capabilities in the manager. Let me know if it creates problems (I checked XSS to some extent to,   but please double check if you can). - Submitted by Cédrik Lime.
add269fb43 - Fix links (42130).
011a4b3976 - Fix links (42130).
d79be7228f - Update path (part of 42130).
167b35cc98 - Update path (part of 42130).
494bd8d7a2 - Port changes from the NIO connector to the APR connector, to resolve memory leaking when using an executor (note:   when not using an executor, no memory leak could occur). - Discard thread local usage altogether, as my testing did not show a measurable performance difference. I don't know   if this would change when scaling up the number of CPUs (if anyone wants to test). - No size limit by default, since this is mechanically limited (amount of threads + open comet connections). - Harmonize code with the HTTP/1.1 connector.
dfd1416df9 Fix bug 41990. Add some new mime-type mappings.
77ba62e751 Fix bug 42025. Refer to correct regular expression implementation
7f66fc9db5 Update change log. Move post 6.0.11 change to correct section.
c3d2ce46de Fix bug 42039. Log a stack trace if a servlet throws an UnavailableException. Patch provided by Kawasima Kazuh Remove some unused code.
7fdf2ec756 Remove old, unused utility methods.
4cf171afa0 Fix bug 42119 using approach suggested by Leigh L Klotz Jr of using RequestUtil implementation.
75a5a08bdd remove comments
c590ebee31 remove duplicate code, cause of all my headaches
c4add4d948 Revert to revision 528735, something is broken and I'm losing my mind
056353c7b6 oops, didn't mean to make that into the prev commit
e120e8b9fc consolidate methods into one
0ce0a91bac apply the right exit condition
c7de17085b minor optimization, go directly to the poller, chances of another request being present at that very time is very slim
128ff0a8dd Minor optimizations
82424ca0c7 Smarter executor, only create threads if no threads are available
4bfb8f4fa1 Added a TCP ping for membership, to be used with static memberships and with the TCP failure detector
1c2f419814 remove redundant calls, easier to track usage
e93e4e4fa5 consolidate usage between executor runnables and worker threads
e228df9b3b Use the remaining for the byte buffer as the capacity is the total capacity and not the limit
3fd3fff062 prevent a timeout when a servlet write is issued, but not flushed
37b5f5be0a Prevent NPE on a key that was cancelled by the poller
851b1af3b5 if the flush is not guaranteed, then try again
bcf5aa009d This write has to be synchronized since comet can write to the buffer and cause a buffer overflow if more than one thread is writing
44cfafedaa - XML directive (most important commit ever !!).
2e5e7f8ead Since we can keep alive a HTTP connection, even after we have stopped using it as a comet, then we need to go back to the original timeout
8c35dba068 Updated with some useful info
2dbabee881 Fix the handling of the Http11NioProcessors when the thread pool can be shrinking and growing. So we are not associating the processor with a thread local, instead going directly to a pool of them
fa2b746371 - 42085: The handlers for the root logger are now added in addLogger when they are explicitly specified.
98f82483a6 Don't unmark the object as a comet, if we do, it will not call the cleanup for it
562834d92f Send back error code and Initialise jaxrpcmapping path
a275643e4f Add proxy user/pass to setproxy
1d90cce8c3 big oopsie, I know, right after the tag got created
2f1b7bd201 - Changelog update.
3d27771c08 Fix bug 42072. Don't call destroy() if init() fails. Patch provided by Kawasima Kazuh. Ported from TC5.5
6f146afad4 Add clean_depend use as Eclispe or DBCP package changed. remove commons collection dependency (remove at DBCP 1.2.2)
007b833097 Start preparing for non blocking writes, the underlying code has to have the ability if there is ever gonna be a need fix NPE
6d0d89bce7 Forward port from 5.5, expose what thread is currently executing a request to JMX
ce5cdc9718 - Update dbcp, pool, collections. - Update JDT.
b271b66e91 - Similar flag fix.
680968065a - Fix variable again.
77897611d2 - Fix variable.
e2b9163581 - Changelog update.
d7215221c1 - 41289: create configBase, since it is no longer created elsewhere. - Submitted by Shiva Kumar H R.
f601846fff - Simplify the test hello webapp. - Fix its build script.
2c4cec1f1f - Add the factories for ws. - Submitted by Fabien Carrion.
af4d7bcbe4 - Add the factories for ws. - Submitted by Fabien Carrion.
17e0f284ef - Add the factories for ws. - Submitted by Fabien Carrion.
d3f2cf603f - Oops.
f8062b3306 - Examples cleanup. - Submitted by Takayuki Kaneko and Markus Schönhaber.
021f5b57b6 - Polish.
52354b217d - Changelog update.
581edb2fbc fixed typo...
16082dd2de - Merge from javadoc.
d1150dcf5b - It should be possible for the event object to be closed asynchronously. In that case, I think an END event   should be sent to cleanup the pipeline.
8980bfd168 Fix #41973 by not initializing IPV6 if address is null. APR cannot listen both on IPV4 and IPV6 on some platforms (e.g BSD and Windows).
27928b33b7 Fix #41973 by not initializing IPV6 if address is null. APR cannot listen both on IPV4 and IPV6 on some platforms (e.g BSD and Windows).
488654736c - Fix javadocs (no return false anymore).
e532786a84 - If an exception is thrown processing an event which was not an error, the contract says an ERROR event   should be called.
387aab6a75 Document APR connector native changes.
06051fbada Use the tomcat-native-1.1.10 as recommended version. Note: 1.1.9 was broken for OpenSSL builds on some platforms. 1.1.8 will continue to work, although on some platforms there can be JVM crash if IPV6 is enabled and platform doesn't support IPV4 addresses on IPV6 sockets.
7ecdc28377 Use the tomcat-native-1.1.9 as recommended version.
6a84bd2a09 Add native as external instead maintaining duplicate code.
d9dbf6fc17 Remove native/connector
22c47be25f - Adjustments to error processing with Comet during the begin event (exceptions not causing error reports). - Fix a probable bug when security was enabled (Comet would most likely not work).
fd98776b4b - Default configuration updates.
91ead6dc27 - The poller now has good performance, so remove firstReadTimeout (the algorithm can still be retrieved from   svn if needed).
80a4cc05c8 - Tweak startup time a bit.
cb67a7baed - License header !
1ca8fda4fe - Skip BOM when reading a JSP.
32192bdb05 comment my last changes at AccessLogValves
9c2aecc6c6 Fix that pattern with subtokens ended, are print out subtoken Example cs(Host) date time cs-uri sc-status x-C(JSESSIONID) time-taken prints  'localhost:30014' 2007-03-27 10:02:47 /test/ 200 '336C8E8300402846604650DFCE9A6059.tomcat6' 0.001taken instead 'localhost:30014' 2007-03-27 10:02:47 /test/ 200 '336C8E8300402846604650DFCE9A6059.tomcat6' 0.001
bd3dfdb3e8 fix 41786
2049b789cb Fixed 41703
12d912d0fe fix 41682
dd47bb00a9 don't log io exception if the connector is not running
7a81790389 git-svn-id: https://svn.apache.org/repos/asf/tomcat/tc6.0.x/trunk@522773 13f79535-47bb-0310-9956-ffa450edef68
4f96d21ad7 fixes for http://issues.apache.org/bugzilla/show_bug.cgi?id=41166 although there is still work to be done, need to separate Tomcat attributes vs. application attributes
ef2dab0624 never return null
9ac21ce920 - CRLF inside a URL pattern is always invalid, AFAIK.
7fd4fa89ab Bugzilla 41675: add a couple of DEBUG-level logging statements to Http11Processor.java when sending error responses.
34fe5cffcc Bugzilla 41227: add a bit of DEBUG-level logging to JspC so users know what file is being compiled.
400d6847fe Bugzilla 40150: validate user and role classes in JAASRealm.  While I'm there, typify the relevant lists of class names so that JDK 5+ doesn't complain about unchecked operations in this class.
6c812a3882 Bugzilla 39540: add link to mod_proxy_ajp httpd config docs.
7ac69f8880 Implemented a one time parachute for java heap oom. Should give the system enough room to properly report the error and clear the caches. everything else will be up to the developer at that time
3208a3d86a Bugzilla 39883: add documentation warning about the use of antiResourceLocking on a webapp that's outside th Host's appBase.
11c5c51f63 set correct info message
670b04b8c7 add some missing attributes
3b9ad0d056 Forward exception to the parent class, so the user knows his configuration problem
47bc1d1e87 better error handling
e016106bf8 choke the log statement, not needed
39d690a7f8 big oopsie, forgot to do SSL for executor/socketprocessor
ac74ecbec9 Optimized sendfile a tiny bit. Instead of handing off to the poller, since we are already on a thread then try it first on, and if we are not done, then simply register with the poller
759a09f643 - Use fewer threads by default (it uses too much memory otherwise).
c9731160d7 moved bug notes to the release notes
5a0bfccb37 documented the useSendfile behavior for NIO
7c514d87df added in some useful release notes for users to be aware of.
af149ab2a3 Catch io exceptions and hide them unless debug is enabled
7cdb9c4027 Added in sendfile support for the NIO connector Currently the sending is done on the poller thread, could dispatch to the thread pool as well
c7c8bd6477 Fix NPE when using Executor
d2a1c2df5e same fix as for APR, always try to do a non blocking read for the 2nd request, busy threads return 0 with the executor
a041e4e477 - Expose executors in JMX (shouldn't hurt).
ba30dca179 - Fix problem with blocking reads for keepalive when using an executor (the number of busy threads is always 0).
f8978a3402 small comment added
cd8a68583d Use the 2.5 schema
6671933df6 Make sure that we don't need to use any locks or synchronized statements to get our executor to work properly. If the task gets executed, means that the threadpool just reached max threads when we were about to add this one in. a simple race condition that we can take care of easily
d846a35d1d Documented the Executor element
ae1af95630 Added in the Executor skeleton. the executor gets created in the service, so that the connectors can reference it. Feel free to hack away on improvements or yell at me if this is completely not what was intended and I will pull it out
39c6621d33 don't give the selector infinite time to shutdown
080659ec55 Make sure the connection always closes, no matter what
3405f118fb Added in support for calling CometEvent.END although the container itself doesn't support it yet.
133ceb42df forgot to document the other way to set the individual timeout
16acd311bf Update latest binaries with fix for DAEMON-34.
6f63513c4a Update latest binaries with fix for DAEMON-87.
9b5dac54d2 Update latest binaries
f3ad39cdf6 Update binaries to version 2.0.3.0
0c86453c14 added note about timeouts
d699cc748b fixed minor bug introduced recently
59edb12104 minor tweaks
a7586e1ea2 Being able to balance thread priorities for all kinds of threads
f1d775b92d Update latest binaries and add targets for amd64 and ia64 cpus.
68cbd50d66 Update host doc now directories in appBase without WEB-INF are auto-deployed.
afb4505aeb - When the platform does not support deferred accept, put accepted sockets in the poller (there's a performance penalty,   of course, but mostly visible for non keep alive connections).
652d5fab30 - Add logging to display APR capabilities on the platform.
d66e6511a2 Implemented the cache properly with its own attribute, removed one processor that is not needed
cb88459279 Implement the use of a useful executor, this executor will increase threads until it reaches max threads, then it starts queueing the connections. This yields in much better fairness.
4b78cb4e68 Use a thread pool executor by default. This makes tomcat a little bit slower, but it handles load distribution a lot better than the current thread pool
2685e19775 cleaned up code a little bit, still haven't figured out a good fairness algorithm
0951b801cc Added in the skeleton for fairness logic, currently the tests for fairness are coming out extremely fair, could it  be that the Selector.selectedKeys() sorts the keys properly? Anyway, to implement a scheduler, I can use the "fairness" numbers added in here. Won't do it until I deem it necessary.
8fd0a757b4 - Cleanup of the message that is displayed (forgot resource).
3287c3afcc - Cleanup of the message that is displayed.
2568681b31 - Remove try/catch usage for annotation processing in classic tags. The usage of the log method might have been   questionable as well.
2da11fa88d - Fix reporting of errors which do not correspond to a portion of the JSP source.
d881b41298 added fairness counter, using this counter, I will be able to make sure that connections are treated evenly in my next revision of the NioEndpoint. No point in having 20k connections if only half get love.
590b7bd1ad Added in the ASF main repository, need to figure out how to get .asc signatures attached to the jars as they get deployed
419f0f20c9 Took care of JMX error upon startup, component still not working, but at least its not spitting out ugly messages
7bdffbf255 just added some notes
1ef03f2bad foo2
455b6f8532 - 41790: close file stream.
58f2365d1c - Use the trim property and trim directive, which should be equivalent to Jasper's own attribute.
e4569e6fa6 Port fix for bug 41747. Correct minor error in ant script example for deploy.
6728bd919a - Minor optimization
e33b67a7e6 Port fix for bug 41752. Correct error message on exception in MemoryRealm. Patch provided by Ales Milan.
bde4e7e848 Code clean-up. No functional change.
4d3f6a8c74 Port partial fix for bug 41655. Update some of the translations and fix a few obvious typos.
9ac342840c Port fix for bug 41666. Correct handling of boundary conditions for If-Unmodified-Since and If-Modified-Since headers. Patch provided by Suzuki Yuichiro.
bf03f0f10b Port fix from TC5. As per RFC2616, requests with multiple content-length headers are invalid.
0bd693016d Tabs -> 8 spaces. No functional change.
5472c9f1fd fix gump complaint for xsl
c809d2fb9a Put change in right section.
01d38a5311 Port fix for bug 41739. Servlets with a load-on-startup value of zero should be loaded first.
376f612f77 - Add plumbing code for supporting web services references. - No factory implementations at this time. - Submitted by Fabien Carrion.
af6876bb39 By default dont use direct buffers, in a situation where a very large number of connections, direct buffers are much slower
cb63b1218a Sized the app buffers more appropriately
72a845d44e Add and correct documentation
9e7380b96b properties are getting stuck in the attributes list, and not making it down to the endpoint
6b5f56c47d More documentation, added acceptorThreadCount as a selection
1925969770 Use correct definition for servlet 2.5 xsd.
1f258787fe When a read or write times out, make sure the key is deregistered with the poller
a869f1a8bc Add in configuration options to control the application buffers associated with a NioChannel
65c882db77 - Remove sync + clone to be consistent.
dbe24997a5 - Remove sync + clone from InstanceSupport.
4197163185 Added in remainder of docs
900cf4fb42 Accept doesn't need a worker thread, the operations are non blocking
22fd679e70 Fixed latch behavior, still could be improved upon. In the next revision, I'll probably have the blocking read/write selector to use its own thread so that it doesn't content with the poller thread
afa3ee764d - (quick fix) findClassInternal may loop so the fancy syncing probably cannot work.
7fe3749c05 added in notes to myself about blocking the poller thread, that should be prohibited
977e3ebb20 Fix (may not be complete yet) to the memory leak in the NIO connector. The caches where holding references they aren't supposed to hold. Added in the ability to use the pollers selector (share a selector) instead of each thread using one from the selector pool. Selector pools can be very resource intensive.
9e53b887d5 - Refactoring of ExtendedAccessLogValve, which now extends AccessLogValve. - Submitted by Takayuki Kaneko.
8ba833433e Port fix bug 41608. Make log levels consistent.
49c8420cc3 set APR to have unlimited poll set
d932bd547e - Remove dead code. - Move the special purpose sys.out capture to an inner class of the Ant compiler.
01f2a37024 Added in documentation specific to the NIO connector and a small connector comparison chart
14dcdd1978 - Changelog update.
e386a58bb8 - Fix minor glitch, submitted by Anil Saldhana.
1735d7f550 - Add some options for handling URL chars.
820f6fba24 Port SCRIPT_NAME fix
373f9ac40f - Set of minor optimizations. - getServletContext is used often. - Submitted by Arvind Srinivasan.
4612c8ab90 - As suggested in 41578, experiment with a thread local pool, but in a simpler way (and with an upper bound).
066d217bf8 - Missing from patch.
e1c2e12e1b - Indent (sorry, the class was too hard to work with).
4b7c3259e7 - Set of minor optimizations. - Use getLength() less often. - Submitted by Arvind Srinivasan.
dbfe39dce7 - Set of minor optimizations. - Unify usage of the security manager flag. - Submitted by Arvind Srinivasan.
403799109c Don't add tools.jar if it is not existing.
cdfd9adcf3 Don add tools.jar if it doesn exist.
1a8c4922fc - 41558: Don't call synced method on every request, submitted by Arvind Srinivasan.
8b0d130abe - 41521: Support * for servlet-name, submitted by Paul McMahan.
26e8eec7e0 - Changelog update.
dfac8de2e6 - No functional change: deferred is always true when elExpression is true.
42a5b8b9d7 Complete previous patch.
4fcdec3dc7 Revert port of 39088 as per discussion on dev list.
fce171f559 Fix for bugzilla 41466 When using the NioChannel and SecureNioChannel its important to use the channels buffers
92c442ba12 minor change
0067f91d4e Update JspException to align with the JSP 2.1 spec. Update root cause finding to take advantage of being able to use getCause
40197c19ee Replace tabs with 8 spaces and tidy up the javadocs afterwards. No functional change.
54e894f77e Simplify code since ServletException now uses standard exception chaining.
87e0634c01 Correct change log. The infinite loop issue had already been resolved.
20f7a87433 Port fix bug 39088 that prevents infinite loops when an exception is thrown the returns itself for getRootCause(). Also port changes that enable the root cause to be found when the nesting is particularly extreme.
67fb3ca47d Fix paste error
2fe85b9284 Clean up unused imports for the tc6 source tree
232d286fca Code clean up in the examples. Removed unused imports and unused code.
723a370cca Add source for examples to Eclipse project
f06d41f967 Port fix bug 39572. Improvements to CompressionFilter provided by Eric Hedström. Also cleaned up unused imports and methods.
39fe247dd2 Port fix bug 41265 by removing the code that resets checkInterval values of zero to 300. If checkInterval is not specified it defaults to zero anyway and removing the code was easier than trying to explain in the documentation why the stated default could not be explicitly set.
c7f8e49475 Javadocs are no longer included by default and the pages are not pre-compiled.
815e19e5e3 Port fix bug 40526. Return support for JPDA_OPTS to catalina.bat and add a new option JPDA_SUSPEND. Patch provided by Kurt Roy.
2a94508e93 Update all webapps to use the servlet 2.5 xsd
dc33554f35 Port fix bug 40524. request.getAuthType() now returns CLIENT_CERT rather than CLIENT-CERT as per the spec. Now only web.xml, o.a.c.deploy.LoginConfig and Authenticators.properties use CLIENT-CERT.
11b9c92c5e Port fox for bug 41217. Set secure attribute on SSO cookie when cookie is created during a secure request. Patch provided by Chris Halstead.
3a6225ae28 Port fix for bug 41327. Show full URI for a 404.
5373f2cd51 Correct error messages. Should be context.xml not web.xml
c45690b02f - Tags have specific version numbers, so the regular getJspAttribute method shouldn't be used. Another benefit is   that it avoids parsing EL twice.
a74181e4b9 - isELEnabled may return true for a variety of reasons, so the actual value should be checked.
e45df5f4d4 - Port patch to return connector names.
27fea734e1 - Decrease logging level.
2257ea5050 - 37869: Refix getting certificates. - 40960: Throw a timeout exception when getting a timeout. - Submitted by Christophe Pierret.
0687022317 Added a short document about the Tomcat libraries in a maven repository. Modified the snapshot version for 6 to be 6.0.x-SNAPSHOT
2d6f280f0f Added release deployment
982966d61a - Changelog update.
c09eb086b9 - Simplify the code.
57e5ba2afb Fix typo
36eedabeaa - Same here.
50f2397183 - Revert change: the default version for the implicit taglib is 2.0.
0b76555934 set better defaults
cb6c252c98 Extras deployment
886a963550 Fix minor issues with logging doc reported by Erik Bertelsen
863719598f remove circular dependency as maven doesn't support it
708e63e5fa remove SCP executable property, its not used by the plugin anymore remove mistakenly checked in tmp file
e77ec206c0 read property files in order, not quote working on windows yet
dabcf16df6 fixed xml error
6e1cae7675 Tomcat's maven publish script
f622b8f869 - Use AccessLogValve. - Update docs with buffered field.
19b84d4529 - Add a new buffered field to allow flushing on each request, which should make the behavior equivalent to the   old AccessLogValve.
7f2b061699 - Replace AccessLogValve with the new fast one (since I don't think 3 valves doing the same thing are needed). - Remove FastCommon, which has the same optimizations. - Add a new buffered field to allow flushing on each request, which should make the behavior equivalent to the   old AccessLogValve.
f92b381e00 - New AccessLog valve impl, submitted by Takayuki Kaneko.
7f3b1e7c2b Completed clustering documentation to a state more understandable.
cbb5e358c9 put in a minor sleep
50cf0ff944 - More accurate validation of EL. Needs testing.
d5c2d036ac - Cleanup.
d8633d7dbd - Avoid NPE (quick fix).
8a92701368 Update on http://issues.apache.org/bugzilla/show_bug.cgi?id=41260
2fc968ba67 http://issues.apache.org/bugzilla/show_bug.cgi?id=41260 [Contribution] WebAppLoader and DirContext implementations for handling with expanded webapp during development
a1b1bed3ab http://issues.apache.org/bugzilla/show_bug.cgi?id=40820 Default JSP factory not initialized early enough
b2512d2c9c doh - missed a '
2e16163038 Formatting bug with javax/el/LocalStrings.properties http://issues.apache.org/bugzilla/show_bug.cgi?id=39409
515f2bc98d Add virtual hosting howto to TC6 docs (copied from TC5)
f1ad272fc0 Port RD thread safety patch from TC5
a2970721fa Port fix from TC5 to display the JSP source when a compilation error occurs
44849c3057 Port fix from TC5 for displaying JSP source after an exception in an included file
8c21684fca Port doc update for 41182 from TC5
30bb14228d add xml declaration to build.xml
fa5b1ad165 - Changelog update.
377c838137 - Modify the code so that it doesn't log client disconnects unless debug is on, and make behavior in front of   runtime exceptions more transparent. - Also, if failing to read or parse parameters doesn't throw an ISE, then a post too large shouldn't be an ISE. Or the   opposite should be done, but IMO this would be excessive logging.
efb55eeb40 - 37869: Also use the SSL_INFO_CLIENT_CERT field if the chain is empty. - Submitted by Grzegorz Grzybek.
2449afb650 Backport the current connectors trunk.
b0acc0dae0 Forgot to rotate by 90 degrees CCW.
e66e202b20 - Changelog update.
d43d9f435e - As decided, update version numbers.
75c7851510 - Ignore client aborts when flushing the buffer.
15d88a9c3d Make sure we use an unbounded thread pool until we have implemented some sort of rejection policy. No need to wake up the selector more than once, it is only serviced by one thread
58a4d06328 Implemented the use of an executor, tasks that aren't able to run quite yet, will be added to a pool of events, this pool of events is a zero GC (RxTaskPool) and is bounded.
fafa6adcf8 Name change in preparation of pluggable Executors and thread fairness
c297903aba refactor, name change, in preparation of having a pluggable Executor and more thread fairness on receiving data
3f70e463c5 Refactor, name change in preparation to swap in Executor, and to make increase thread fairness when receiving data
d70aac7fb3 Use a concurrent hashmap as a base class instead
07d7308921 More artwork
3fa841b028 Update installer picture with new Tomcat URL.
5a889aa3bc Make few comments on tcnative-1.dll. No functional change.
4d4db9bf34 Update the tomcat native version to current 1.1.8
5a827bdbf4 Change the loaded message.
5b825c66bd Log the loaded tomcat native version on startup.
752ca3a5bf remove not used methods
b7471a49dd Remove methods not needed by this interface. not used in any sub implementations
ff18e0b993 - readTimeout should behave how it does for the HTTP connector (this is an optimization), so add support for the   negative values.
b23b029b6d Port fix for bug 41051.
5f9c18d912 Port fix for bug 41074. Make jsp:plugin output XHTML compliant
54487663d5 Port fix for bug 40581. Add note about using symbolic links.
c6b3f71ea7 Port fix for 40585. Fix parametrised constructor so parameters have an effect
256d3f0d80 RFC2616 specifies 1*8ALPHA and ALPHA is a-z or A-Z, it does not include numbers
dcb902b2b1 - Based on Mark's patch. Ensure accept-language header conforms to RFC 2616 when accessed through   getLocale and friends, and ignore it if it doesn't.
51733055bc - Add SSLEnabled to the example config.
9344688c81 - Fix typo in policy file.
f4b9652764 - NSIS 2.22. - Changelog update.
5a2f4dc094 Fix LOGPATH index.
445a171b99 - Changelog update.
137b0b3711 - Add experimental clustered SSO code. - Submitted by Fabien Carrion.
f3b95cca31 That would create a trustedCertEntry but we need a keyEntry.
436b44adc3 - Add a html file in case the user goes to the wrong place in the examples. - Changelog update.
e854200c56 - Disable TLD cache for now until further refactoring, since I have found it was not consistent with Jasper. - Don't mutate keepAliveTimeout value in AprEndpoint.
07aa805ee0 - Add a flag to allow disabling the code which sets references to null when stopping a webapp.
a4c1b0b346 - Add 1.2 as well.
551617fcea - Update jar list in Jasper.
4e501664da Backport nonssl patches from tomcat-connectors/trunk
af58f95107 Update binaries with --ServiceUser/ServicePassword option.
b2a6bce248 - Add xsd for JSP 2.1.
514256e121 Bug 41089 and JSP.6.3.2 Table JSP.6-2 Attributes for the <jsp:root> standard action version (required) The version of the JSP specification used in this page. Valid values are "1.2", "2.0", and "2.1". It is a translation error if the container does not support the specified version.
89f106c001 - Irrelevant fix.
b55f2d865c - Use a separate method for checking primitives. I'll keep the check for now since I have the impression it's tested.
8cdb9c5fc9 - For consistency, add keepAliveTimeout to this protocol handler.
0c9fd04a96 - Experiment with using soTimeout as the keepAliveTimeout if it's not specified (this way, the configuration behavior   remains the same as before - by default).
4448de398b - Port back my fixes to this patch. - Correctly pass keepalive value to AprEndpoint. - Sendfile should use soTimeout (it's a request, not a keepalive). - Comet poller is also a request in progress so use soTimeout too (most likely it would need its own timeout value). - I will adjust the defaults further, as for example I think keepALiveTimeout should default to soTimeout if not set   (ie, if it's -1).
ebc973cdcd Oops. Forgot to commit this file
b0d601f297 Commit the voted keepAliveTimeout patch.
4a5b28da42 - Update JAR list for no-tld-scan.
de5c3b7090 - 41057: Caching large strings uses too much memory and is a bit pointless, so add an upper bound to the String length.
db2cef2f8c Avoid initializing APR for each connector. Also test the minimum version required.
eefda7a4ce Refactor AprLifecycleListener by putting the logic into separate methods. 1. Do not call terminate in case initialize failed 2. Call terminate if version is below required. 3. Do not initialize SSL if APR was not initialized.
82e9ed848a Fix example AprSLL. We have a new param SSLEnabled.
5caa209504 The header set by Tomcat are always in proper case. Skip creating additional lowercase String when getting AJP response index.
085042cb41 Compress outgoing response headers according to the AJP13 protocol specification.
1c675ba873 Port update to SSL docs to include PKCS11 that users have successfully used.
b70962fdbc Port fix bug 41008. Enable POST to be used with indexed queries. Patch provided by Chris Halstead.
37e186ecd2 - Changelog update (add the changes to the modeler, which I had forgotten about).
fa9f7673db - Made setString(null) do the same thing it used to do when recycle was called at the beginning of the method.
042f8118c8 Make the pool impl compile for JDK 1.5 by swapping out the enum keyword. Another fix is to simply put source="1.4" for the dbcp javac target. Let me know if you prefer one over the other.
f9efe9e3d0 Fix the logic of the checkSameObjects method. The method did not take into account that the lastServiceRequest/Response could be wrapped themselves.
195daaa361 Port relevant parts of fix for bug 40999.
606dd8e24b - I suppose I can remove the method then.
7517de8db0 Fix output stream to not use the converter in the buffer, but do a simple hard coded conversion. This makes the TCK test pass
dcfdcd2e1f revert fix until root cause has been found
63105d4fe3 TCK correction, depending on the sequence of the tests, the converter turns out to be null at certain times. Added in a check to create the converter even when getting the output stream.
45b245f69a Port fix for bug 38198. Improve context name aspect of host documentation.
cb2c6556ee Port fix for bug 40901. Encode directory listing output. Based on a patch by Chris Halstead.
600970211c Port fix for bug 40929. Update JavaDoc
e713e776e9 Port fix bug 40860. Additional logging if parameter processing fails.
1ced3e475e Tabs to 8 spaces.
a6d69627b0 Port fix for bug 37509.
be9d523b52 Port fix for bug 40844. Missing syncs.
cf014ba95c Fix Gump. Removing the new class (PoolUtil) that requires the other pool classes causes other failures. This fix isn't strictly necessary whilst we still use the current release but once we upgrade to the next release the build will fail.
ec31e33ae0 - Also filter the release notes that go in the docs.
f736ba74c8 - Port memory optimizations to the classic HTTP connector.
dcf086835b - Changelog update.
98cb71e7f2 - Sync the installer's config files. - Cosmetic fixes.
16192df552 Link to the manager howto.
d625b49c48 tomcat - s/5.5/6/ servlet spec s/2.3/2.4/ jsp verion s/2.0/2.1/
38778cb671 Added a 401 page to let the user know what file to change to gain access to the manager app in a stock install.
1697952c3e - Update version numbers. - Update Eclipse to 3.2.1.
6255f1ef26 add my new key
af6bb7a3a3 password property did not go through
010ac80792 Use tomcat-native 1.1.7
85a6c98a26 - Fix API.
be8de51954 Add version info to the build.
7ab23bf4d2 - Fix version number.
6ee3fd8312 Backport from tomcat-connectors. Fix coredump when the client socket is inside read/write operation (not closed), and the Tomcat is shutdown. The pool was destroyed twice in that case.
7dc95eb2cf Add version control flags like in 5.5
348a9b0acb - Some more polish.
e3df2fbcfc - Polish, as reported by Yoav.
3cbb0b7a8b - Update my key.
991cf96242 - Changelog update.
145a3bda9e - The page wasn't explicit enough about the requirements, I think.
f7ca96df28 - 40913: Fix the second test when an expression is used.
22d1ad7f25 Port fix for bug 34956. Enforce requirements of SRV.8.2 / SRV.14.2.5.1
6d274b4225 Port fix for bug 40817.
3c78f46025 Port fix bug 40823. Better context docs.
598f14dc8e Port fix bug 37439. Update engine docs with name uniqueness requirement.
79631bba45 Port fix bug 37458. Remove the possibility of some NPE and IAE issues. Note for Remy - you had some ideas to improve this patch.
4d3fffe709 - Expose the EL type through the Root node to be able to determine the EL type for JspAttribute.
9734c80789 - Remove an extra throwable. - Add a specific flag for recycling facades (when security is on, recycling will always be done, obviously).
5aa50cd463 - Add back jsvc in the build. I don't think commons-daemon needs any package renaming.
86b7457b16 - Fix a regression on classic EL expressions inside elements.
51c5030a8a - Add translation time type checks for String.
77ec01f3f6 - Redo the checkXmlAttributes method, as I could not sneak in the type checking for litterals that are passed to   methods (or values, right ?). Unfortunately, some translation time (rather than runtime) errors are needed for these.
6742cb8e2f - Indentation. - Fix a woops which led to ignoring the jsp config for the encoding. - Send an error for a 2.0 version for the 2.1 tag attributes.
7e55d59e7a - i18n handling fixes (according to what the spec authors think is what should be done, at least).
9dbc049a5a - Fix woops.
61556deecd - Check for some of the errors.
b8d2aed8c7 - For tag files, also put attributes in the wrapped jspContext.
f2b2119ee3 - Always call jspInit (some work in always done there, now).
d54d6f3c52 - Adjust the tests for deferred expressions evaluation.
0de513d970 - Better impl of JSP id consumer: actually this was implemented for regular custom tags, but not for simple tags.
03c120f704 - Add parsing of implicit.tld for tag files.
315694b534 - Taglibs have their own version number, so isExpression gets an adjustment allowing not checking for deferred   expressions.
aa3fabec78 - Add two allowed directives.
50e8a50ee7 after close has been called we are no longer a comet thingy
038c12ad14 cancel the keys
8f23fcc757 Fix some html smells
85defba50b Fixed null pointer exception on comet socket timeout
bc1a410c10 Fixed bug where OP interest is different for the first time the key is used, hence a key that never has been read would never timeout.
6b40b2d8ee Revert fix, suggestion was incorrect and can lead to memory leaks
d714dbfe02 If the key is null, channel is closed,not sure this is the correct fix, since the key potentially had an attachment this could lead to NIO mem leak, must track down how this happens
760db17f37 fix small html smells
de42c0242f There is no org.apache.catalina.Logger or setLogger anymore
b28fabef39 On explicit flush, create an empty (8 bytes) SEND_BODY_CHUNK message, that can be used by web server to flush the packet.
d2e23cbee2 - Implement the JspIdConsumer feature.
8834a477de - Some deferred expressions handling fixes.
1fd6c2fdff Cleaned up imports
3fc91b5d51 Ooops, forgot to pass in the double buffered channel to the selector pool for write and read operations
a32b5effd4 Make sure the socket buffer is not bigger than anticipated header size Reuse the key attachment objects properly
82e990b019 Reverted the removal of the "socket buffer", writing to a ByteBuffer is extremely slow, so it should only be done in chunks
b4cf474b81 - Also use the parent constructor here.
3ea791f10e - Refactor exception reporting using Throwable.getCause, since TC 6 does not have the restrictions for modifications   to the API implementation classes. - ServletException.getRootCause now calls getCause. - Also add some tweaks for robustness to cap recursion. - Let me know if I did it wrong.
b00d3c5fc2 Zero GC objects. everything gets cached.
e84e74ded8 Documented socket properties Added in the ability to cache bytebuffers based on number of channels or number of bytes Added in nonGC poller events to lower CPU usage during high traffic
523ee1b1c6 Code clean up, last pieces to make is a the KeyAttachment object and the Runnable used for addEvent to be non GC objects, as these events happen very frequently
cc9db74a8d Allow variable size of AJP message via packetSize=n in <Connector/>.
ebb9c521b5 don't cancel, only do that within the selector thread, as this is a synchronized call
c6773d8f25 Make the buffer pool configurable, still need to make it configurable based on size
5d0d995b01 adjust default properties
220bff6956 Add a socket properties class so that we can configure every single socket option, currently only on NIO. Remove redundant byte[] buffer in the NIO OutputBuffer, this avoids double copy from byte[] to byte[] to ByteBuffer Add in the ability to configure the selector pool, as this be dependent on JVM and OS settings
db5024a4f0 Correct props.
a2f4b3627e Correct props.
70b19adb45 Correct props.
74ae1efb56 Correct props.
84d5dfaff9 Correct props.
b258d6c2de Correct props.
8df2fb9fc8 Correct props.
a01fef3ec6 Correct props.
4426a9de8c Correct props.
b205ab6594 Correct props.
a8e6a4dca4 Correct props.
14e928b6f3 Fix properties.
d16e1db30b remy is right, lets not sacrifice performance to protect against bad servlet code
758a006237 Added in blocking logic to the NIO connector. This logic ensures that if there is a slow client, we will not be wasting CPU cycles doing endless spinning. Ideas for this implementation can be credited to the Tribes implementation where we have a pool of selectors, so that each sending thread uses its own selector and from Jeanfrancois Arcand's blog about wrapping a NIO channel in a blocking inputstream.
a7cb0c0cf6 added my pee stain :)
decf2088e5 fixed compiler warnings
668203d4df Add a packetSize option to match the option on the native side.
b30062a246 Port fix for 37070 to TC6 along with the changes to remove references to the DefaultContext.
0e360f39c2 Update license header in TC6 trunk to comply with: http://www.apache.org/legal/src-headers.html#headers
a6b138a03b - Fix logging API.
c166907d36 Port fix bug 39436. Correct MIME type for SVG.
89c878d97a Shame on me
dbe007a1f0 SSLEngine is an attribute of the APR lifecycle listener to initialize the native SSL layer once per VM. All HTTP connectors share an attribute called SSLEnabled with true/false values to turn on SSL at the socket level. The scheme and secure attributes simply override the request.getScheme and request.isSecure values.
08bd8789e8 - I did not fix activity check correctly last time.
ebb47b6b1f Implement non blocking read on HTTP requests.
bfb10f659c added new changes
bac352411c Implemented SSLEngine attribute on the Java HTTP connectors. This allows one to specify secure=true and scheme=https to prevent tomcat from redirecting when using a SSL accelerator in front of tomcat
32cf7af578 Add srclib build repository.
3da0d20eb2 Copy the tomcat-connector/jni/native to the native/connector.
9c6f1b7af9 - Fix NPE on isValid for an expired session when activity check is enabled.
9cb5aff441 Port fix 40723. Correct javadoc for JDBCAccessLogValve.
17eecdb631 Port fix bug 40771. Correct doRead method so Filters and Valves can read POST data. patch provided by Michael Dufel.
45b7d69438 - Also copy the policy file. - server.xml tweaks. - Remove the minimal server.xml, which isn't that helpful anymore.
509fabfa69 Fix NPE on session state transfer
d9ba113a3e Cleaned up server.xml, added in documentation references so that a user can navigate from an element in server.xml to the correct location in the online documentation.
ade8f2757e Fixed startup exception
4d63907511 - Update to the new packages.
4184d95334 - At the moment, I prefer version 1.1.3.
295e4e1ea9 - Small tweaks.
66210a9e79 - Add a !null as with the other servlets for the debug flag.
e65f7efbbc Make server.xml nice and pretty without including a giant blob about clustering
81e28adfef - Restructure a little.
d7d561d890 corrected defaults
8dc174d4a3 more updates, restructure a little bit
be449d8f04 oops, wrong manager as default
d89b744ef6 corrected default value
e1002b1083 more cleanup, need to add correct documentation
cf80d8cfa1 Fixed manager registration and how manager names are handled. Make sure the manager has a reference to its container before its registered
77e93af823 removed 5.5 from 6.0 changelog.xml
4a3a24caf7 - Thanks for adding in the other important features to the list. - Do we remove the 5.5 changelog or not ?
5837307091 - Code cleanup.
a1a6b8e583 - Fix deployer packaging (the tasks defs were not included).
177901a767 Made a larger autoBind property
1026dba18f - Add a draft release plan. Things should be expanded as needed, I probably forgot some things.
5f4c3549e7 - Tweaks.
09ea9f0833 - Various docs fixes.
4ff8cf6fc9 - Add a privileged filter list (I had forgotten about the SSI filter ...).
4366eae8e7 - Port patch.
ee143e237f Listener documentation
ed42cc3ede complete valve documentation
bcc7a9324f slow progress, but moving forward with documentation
083e206451 - Add a build script to build extras. - Update the logging documentation.
22494d3b5e - Packet must be ended before sending. - Fix off by one check bug in AjpMessage. - Fix recycling bug (setting streams to null when doing keepalive is not a good idea).
adf2f5e0cd more documentation for the manager element
fdd0be3216 Document more manager options, far from complete
5a1a8a7e24 finishing touches
e914a570dd Documented static members
98d6527b71 Support to add in static members and to have those parse data arrays in the server.xml file
b32543df8a Little more text
411d8c689c more interceptor doc, not yet complete, need to figure out if the digester works with setSomeProperty(byte[] data) when parsing XML
0b9186f968 Added in ack attribute
7fb3fc9b2e More documentation, this time for the sender
ce02754cb7 Documented all the receiver options
f3f45f9464 Cleaned up config
ee6e697ec9 Update documentation
c452fb1a85 Cleaned up setters to more consistent names with the rest of the code base
b416d4819b Updates to documentation,
32732d93d3 Fixes and improvements
9e473bad43 Added in documentation
fa9368ef5a Make sure that setIdInternal doesn't try to modify the hashmap
cbaf513954 Added in toString method
5ee499c417 Fix modification logic, still busted though
a7f55b1861 Corrected the use of the ACTIVITY_CHECK flag
57fe76dd53 - Also catch no class def found here, to fix usage of Ant/javac without the need to use the compilerClassName init param.
b1d624a3fc - Update packaging a bit.
8d56e2221c - Package rename the commons-logging impl that was in sandbox. - Thanks to the package renaming feature of IDEs, it's possible to revert that in 2 minutes :)
20dfd50108 Fixes to the clustering code, some changes in StandardSession broke func, this has been fixed. consolidated the use of a nested <Manager> element
75a9398c78 Must read web.xml before we create the manager, otherwise we don't know if we need a distributable manager or not.
d5298d5410 - Fix non deferred attributes evaluation. - Headache inducing patch submitted by Stan Silvert.
b18c29ed5e Port fix for bug 39724. Removing the only valve from a pipeline did not return the pipeline to its original state. Patched provided by David Gagnon.
2570c66afc - First pass at docs.
6f6a5e8524 - Doc updates.
d3f8ad36fd Port fix for bug 40528. Add missing messages.
1a5e6e7bd1 Port fix bug 29727. Changes to env-entry values should take effect on web-app reload.
bbb8fe17a4 Port patch for 40625.
9c5864b469 - Update the release notes.
1fe8ed8746 Started documenting the cluster configuration. On to the sub components
88ece71ffd Add in skeleton documentation for clustering, so that we can document in accordance to all the other elements in server.xml
f4e57b254f - Add back two reverted patches.
b91d384dca Update configurations options, this new feature allows a specific <Context> to overwrite what cluster manager is used by specifying a <Manager> element inside the context element and the cluster will be notified of it. This allows for a cleaner config, as the cluster does no longer have to forward all manager settings, and allows documentation to be much clearer on what settings are available.
ee87f21354 increased tolerance on the test
9cdd9a9f7a Revert Keep-Alive patch.
6e11029796 - Try/catch around the clear buffer, as if the writer was closed the original exception will not be displayed.
228bca1c73 - The keep alive value is actually in the endpoint.
19d047f94b - The addition of keepAliveTimeout is useless for the regular connector, as it already has two different timeouts as an   option. - Make it default to soTimeout in the other cases. - Sendfile should not use keepAliveTimeout, but soTimeout.
a94387b95b - Also watch conf/web.xml.
05317b0354 Introduce keepAliveTimeout to be able to separate the Keep-Alive and Socket timeout. The patch enables to have infinite socket timeouts while still having correct keep alive.
7ce1c9c3c3 - Add the new packetSize attribute.
ab32ae60d3 - Exception processing cleanup, as suggested by one guy in the past.
3443d94091 - Add building instructions.
f4e663c41a - Javadoc update.
c5ef6282a6 - Add a new init param for controlling display of source fragments.
8cf2b0adc9 - Take advantage of the compliance flag to add back forceful appending of the charset (for people who really wish to get   in trouble).
e69b89d73d - Add a periodic tick for Jasper (other servlets could use it). - Remove the dedicated thread that was used by each Jasper instance for checking for recompilation.
aeda410a3d - Include any classes which are in org.apache.
2ab3fc467f - No admin for now.
5dfbd43b81 - Use the interface rather than the type (which is apparently null here).
ede128c88a - Fix isReadOnly method. - Submitted by Stan Silvert.
f80133a1ea - Fix a design issue: when stop is run, the servlet will have been deallocated already (so only basic cleanup may be   done at this point).
325a09eaa9 - Support equals for strings. - Submitted by Stan Silvert.
20734bf835 - Correctly do the lookup in the request scope. - Submitted by Stan Silvert.
3ffeafcee2 - Default readOnly to false. - Submitted by Stan Silvert.
bf5afe04c3 - Experiment with stopping the manager a bit earlier.
a3f894b0c2 - Pass along a status code when there's an error. This allows sending the appropriate event to the servlet, and far   more flexible handling (for example, for timeouts, where the servlet gets to decide if the connection is done - or not).
6cd285d461 - Add a connection tracking valve for Comet, which I did not test, but should implement the general concept. - Next would be changing the Adapter.event to pass an int or an enum instead of the boolean to differentiate timeout,   disconnect errors, etc. I will try to check handling of the timeout, and treat it like a periodic event,   where the servlet has the opportunity to close the connection (by calling event.close) but may choose   to keep the connection open event if there was no client activity (in which case, the connection will timeout   again after the usual amount of time).
3b92cf0a96 - Import cleanup.
fda223a9a4 Port fix for bug 40518. Use correct message.
9dd8a239bf Port fix for bug 34399 - disable the undeploy option if the webapp has not been 'deployed' This occurs, for example, if the webapp is defined in server.xml
0a8242f595 - Port fix.
08962524a5 - Similar change.
62e73d0c27 - Remove apparently useless fields from the page context. - Attributes are now a HashMap, since the page context is a per request object.
33ef27b844 - Imports cleanup.
867d19e9cb - Ok, I'm not too sure about that one. - Reset properly the ELContext associated JspContext when dealing with tag files.
3b12cfe5e5 - Fix type.
e7599afc70 Grrrrr++.
d3fa001bcf Grrr.
3a345be287 - Fix spelling. - Fix getVersion method.
b584921292 - Pass the two new values to the PageInfo instance.
f0f100b6d8 - Add parsing of the two new elements for property groups.
0ea770e040 - When EL is ignored, restore '#' correctly in template text.
7107ffe9e5 - Fix cut & paste error. - Fix validation for the two new page directives. - I will next add support for the two new jsp-property-group elements.
501bb2d783 - For whatever reason, getValue is different, and must return null if the index given is totally bogus.
823101da17 port fix for bug 34509. Allow tag names to use full range of characters as defined by the spec.
8957262884 adjustment according to APR fix
7814423806 Completed author tags
4634d74c2c Fixed method name
d95763c0c0 - Add two missing license headers.
ce50cb8243 - Fix ArrayELResolver.coerce when using a String. - Some cleanups.
24cad37398 - Fix the mapping (?). - Copy some txt files to the right place.
4d47722dda - Redo Comet processing using events. - Add Valve.event (most regular valves do not do anything, but standard valves need to call the next pipeline). - Add a new Filter interface that filters can implement to intercept the events (I didn't test it yet).
ff4ff68a55 - Chat example using the new API.
6a2951123d - Fix oops when keeping alive a gracefully closed Comet connection.
b03d7122fd documentation for the groupcom module
2e619f5f13 added missing author tag
58f8dd1cc2 Added demos/simple use cases for the group com module
b55e9c23c1 Port fix for bug 33356 from TC5
d2637f1d5d - Always check the output folder when going in the compile method, to make sure it exists.
6947f7ebd2 - Fix makeOutputDir method. - Submitted by Scott Johnson.
0d09809df4 - Add the new CometEvent interface, as discussed. - Merge my comments from CometProcessor.
2d6d717033 Port fix for bug 31804 from TC5. Set the parent of unnested tags within a tag file to be the tag represented by the tag file.
7f82d2d565 - Port patch.
94df67a429 Port logic error fix from TC5.
5169aa86ba Adding in unit tests, yell at me if the location should be elsewhere
c368ce1a3c - More cleanup (incl small API tweaks, parametrization, etc). - Slash away most of BeanRepository. Most of it wasn't being used or did anything of value (other than doing tons of   lookups in Vectors). Weird. Did I miss something ?
54f29e8cad - Starting on a Jasper cleanup. - Make some classes extensible. - Add some options (like a compiler class name parameter). - Clean up exception processing. - Remove fields which are not used. - Externalize missing strings.
704d9fa4bd Require at least native 1.1.4 version
cfb76d490d Use native 1.1.4 version
2d5861b6d2 - Add support for String type.
f551c26810 Still prepping for cluster integration. To dos:  - documentation  - integrate test cases  - sample webapp
8c48bc7be6 - Add a master flag for compliance issues, for ease of use. - Add back session access on all requests.
c7f0f60de6 - Separate processing of exceptions from the servlet (so that IOE doesn't cause problems anymore: bug 38713). - Only Compiler will attempt to remove the files (before the compilation), otherwise multiple things can happen   in parallel. - Code cleanup (I suppose I'll have to do a big cleanup soon ...).
651c5cb8e5 A tiny change to allow the JspServlet to be implemented differently ( and in a different package )
9930eadc51 - API change for the constructor of Loader: if not specified, the loader will get the parent CL from the context,   avoiding the problems of ignoring the privileged flag in some cases as seen in bug 39704.
d79e61ef57 - Reset the elContext field after use. - Submitted by Scott Johnson and Stan Silvert.
a8a6aca428 - Since I was looking at the class ... use more modern collections.
ab6eb21384 - Patch submitted by Bill Burke (who thinks annotations should occur for JSPs) to do JSP annotation processing.
17aef9121d - Port patch so that getParentCL returns something consistent with the privileged flag.
d3db5371b8 - Fix a woops I saw while checking if the javadoc was correctly generated.
0142ac01eb - Fix major performance issue when building the dist, as javadoc needs more memory.
ad3d3b6775 - Use getInstance rather than create something with a different key. Submitted by Stan Silvert.
2d102b8fc9 - Adjust content length fix so that it does the same as for the HTTP connector.
a91b95efc9 Porting fix for BZ #40306
bba16653d1 First step in cluster integration
34f45b3705 Prepare for cluster integration
edc20fa71a - Add two lost Jasper patches (which were applied to the old Jasper/TC6 repository). - 38676 - 39803 (not sure if the fix is complete)
bcbfbe89fc - Add the Jasper listener in the config. - Fix (harmless) NPE when request processing doesn't proceed (ex: empty path).
7cebaf4bd0 - Fix version number.
e835468961 - Fix links. - Endorsed folder is now "endorsed".
ddad1fad1b - Also check the support attribute.
156775cc16 - Redo the class with a concurrent hash map (note: no idea at this point if it's going to be faster) and generics.
66d5f395e3 - Port docs updates.
cf2686e287 - Remove the bug number. - Add a temp folder in build.
a031d49fbf - Fix nearly all the servlet links.
826cb64e6e - Calling allocate for no reason was not a very good idea (adding an accessor instead for now, bleh). - Simplify the event method.
e56fee93d9 - Update the other connector.
5caad4c059 - Update to use two action code. - The attribute to advertise comet support remains for now. - No update to the comet interface at this time.
e6937d3ddc - Expose the closed flag.
0e2b6000ba - Build the examples classes.
f5ee6fabad - Note: the paths are not completely correct.
a420e18e35 Fixed the poller destroy method
3d3bb057f0 Make sure we don't fill up the cache after pause has been initated
1f7cc0ee78 fixed imports and removed not needed log message
77d61bfa37 Fixed close down, and degraded a message to debug
e6d99af12f SSL byte buffers are cached as well
0c5927bd77 Added in a cache for byte buffers
34bd7ef64c Fixed deadlock issue with thread pool Fixed error catches for a known JDK bug on windows #5076772 Added in the ability to have more than one poller, although performance actually gets worse Next steps: hand off setting socket options etc to the worker thread for faster acceptance of new socket
25522ad3e1 Tune the connector, next step is to add the ability to have more than one poller, this is achievable by simply having each poller have its own selector, exactly like it is done today
8acfd51448 Still some work needed on when to block and when to not block, SSL works well
f89d5ae7aa Fixed the socket flush, since NIO SSL uses dual sockets, we need to be considerate of when the data is actually sent on the OS buffer
ad54f5c066 support for full xml namespaces according to spec, (<IDENTITY> (<IDENTITY>|<DOT>|<MINUS>)*)
80320af61d - Fix the accept algorithm, that I had translated inaccurately in the new endpoints.
ba89b11a48 Fixed unwrap
8dcb2408b7 Correct close down, now the close can be limited to 2 files if it needs to change
f74febfe4c Added documentation about the NIO connector and clarified how the protocol attribute is read.
8d339d077f Added HTTPS support to the NIO connector. Works exactly like the Http11Protocol does, but uses JDK1.5 JSSE implementation.
f20929c267 - Use the classname as the servlet context attribute name for the annotation processor. - Fix init of the naming context used by the annotation processor. - Jasper will now use the annotation processor from the servlet context. - Remove the ignore annotation compile time parameter for Jasper, which was a temporary hack.
31f5bed0d0 - Cleanup the configuration (and fix the one used for the installer). - Tweak a bit the installer packaging.
2ea3e25d8e - Build the docs webapp. - Docs webapps fixes. - Small NSIS update to version 2.18.
3df0a0dfcc - Unfortunately, the JMX removal does not work (parent is null if used from JMX), so I'm reverting to using JMX for now.
86f55fb4f8 optimized imports
8d75547368 - Now use an interface and a pluggable mechanism for annotation processing. - I'm using the org.apache package due to the need to use this stuff in Jasper ...
a21cf7e982 - Use a single reference to the cache during lookup (the cache array could be concurrently replaced).
5af08d31e5 - Stop wrappers a bit earlier.
423b950886 - JSP 2.1 API fixes.
0f9844c5f2 Port of fix for bug 39592. Stop stack traces for HEAD requests.
e704bc8b1f - Experiment with using concurrent maps in places which may be concurrently accessed.
df639cb7dd Port fix for bug 40053. Correct app deployment doc with respect to shared lib and CATALINA_BASE.
8ed77be991 Port fix bug 39689. Allow same quoting for SSI attribute values as httpd.
c30afec80d Port partial fix for 34801
c7f1aec093 Remove old APR references
06260b0356 Make sure the key is valid before processing it
c2e6ded9af Dereference socket after its been used
9d78207fab Add eol-style property for non-common extensions that were not set by script.
f44092adfc Add missing executable properties. This time without lock/unlock.
f34f2f526b - Changes to session id parsing so that it is done (as well as ";" path parameter stripping) before   decoding, making it possible to %xx encode ";" in the URL. - This can probably be backported to 5.5.x.
eae54419c6 Phase 1: Setting eol and mime types @echo off if "%OS%" == "Windows_NT" setlocal
c705e291c2 Adjusted comment
c7389bdcda Comet connection handling. When the response.getWriter().close() method has been called, the comet connection is setup for closure instead of waiting for a timeout. This is necessary since the servlet could have set a long timeout. Also, improve on timeout checking. Only use the optimization for how frequently we need to check the keys if there has been no activity on the selector. During heavy activity, the optimization takes into effect.
0ff402cac0 Thumbs.db is not part of the servlet spec I suppose. Seems someone committed that from the Windows with folder image thumbnail cache.
510e33b712 Fixed chunked input filter to parse the header correctly. Performs strict parsing according to the RFC2616, so if the header is invalid it bails out.
b9b21507f2 - get/setProperty are used by IntrospectionUtils. Oops.
843789ce33 Add svn:eol-style:native. We'll probably need to do that for the entire repository.
0cf9b74e40 Add svn:eol-style:native
c94953af1c While this change made my linux box go faster, I could constantly crash my windows VM, so it will have to wait
9051683b68 Take advantage of Java 5 concurrent classes
8c86b5bc6c Optimize timeout handling, thanks to a suggestion from Jeanfrancois.Arcand@Sun.COM, although this does put a gap in the timeout check, even in those cases where there shouldn't be, ie, a socket can be closed immediately
dd7e5db5f6 Set a per connection timeout
cc4bd33fd1 Add optional comet timeout support
5d75d93219 - Comment out storeconfig for now. - Port patch. - Add logging.properties.
95afc9f28f - Add the set of scripts.
94400a237d - Add the set of scripts.
db8f5f389f Delete unused classes deprecated in TC5.
96f8cc2ce0 Port CGI parameter and POST fixes from TC5
ba9197592c The NIO connector uses only one poller, so the poller doesn't need to be comet or non comet. Instead the comet status is kept with the key/socket for future reference. This can enable us to end the comet request on the server side in the future, yet maintain the keep alive.
72a0280074 - Fix src packaging.
7f6d0018bb - More release scripts work. - Note: webapps are not built yet (I think I will give up on precompilation, though, since the   benefits are a bit small).
01a9b59984 40012 - Legacy EL Support not resolving variables correctly
2ce8dad75b Remove sendfile support, this is a native called, this will be a pure java connector
5940d89612 - Fix some obvious problems with the packaging.
16255284d6 since we are writing on a piggy back thread, better make it thread safe in case there are multiple backend threads writing (async or comet)
2ba5e6a9c5 Add open office mime-types. Port of fix for bug 39865 from TC5.
bfa41ea3e3 - Should improve handling of the root logger (sorry, I don't know who submitted this, it was a while   ago).
74609bd2ae - Add the base webapps and stuff, so they're there (not built yet).
d2786e2fce - Start work on a dist script (that I will keep separate to avoid having a bloated main script).
598e2d01af - Remove the spare threads attributes.
574ec61724 - If there is a security manager, the map should be reset (otherwise, references could be kept).
51133e745c - Update to JDT 3.2 (I think TC 5.5 should be updated too).
5638661fd2 - Redo the session activity check (which prevents expiring a session if there is an extremely   long request and a short timeout) as optional, and using an atomic integer.
10933885a4 - As redoing the encoders and decoders won't happen immediately, save some memory by cleaning the   cache when starting a Comet request (which is supposed to last for a while).
a554696ad5 Change the compiler to the lastest version.
3796f4a335 - Catch everything, as any unexpected exception would kill the server.
99492278e7 Dont do the not needed operations, if they are not needed. Performance is just a tad under java.io, which is expected as we need to poll, as opposed to constantly wait for data.
22702a97ea Two fixes, process timeouts last, no need to check a timeout on a valid read. hence we do it after we process the actual operations Throw an IO exception if we reach end of stream so that the sockets can get properly closed down Speed is the same for nio and io right now, nio seems just a tad faster without keep alives
2358bb7e5b Catch the cancelled key exceptions and act appropriately
bd8122700c Fix so that we don't do a busy read, instead we are properly doing a NIO poller wait This way, we can achieve blocking read, without wasting CPU cycles. Since we are using Java 5, I will be changing this implementation from using synchronized to using the Exchanger, this is also to avoid anyi locks that can happen. For example, in the current implementation the poller can call notify before we have had a chance to call wait
f035729514 must come up with a better sleep, this brings the nio connector up to the same speed as the io connector however, there is a risk for cpu contention on slow clients, fix will be coming
b85225634e Reverted last nights checkin, until I fix the line ending story, and this also makes the connector work again
bace5da45a Reverted checkin, we can use a fully qualified class name inside of the protocol
dbbcc3766f - Add new files.
3355e49ca4 Keep track of whether the socket is in use or not. The same can of course be done using key.interestOps() as a socket in use would not be returning OP_READ
1b97f8c3b0 Non blocking polling information. This implementation in pure Java NIO is almost a mimic of the APR implementation. It blocks on read and write, but has non blocking polling capabilities. Currently the read/write blocking is "busy" blocking, but I will see if I can simply configure blocking for the socket and if that would still allow the poller to work as expected. This makes it a suitable connector for comet style protocols and where APR is not desired or available.
d819f02faf - Fix annotation names.
1823a9e9dd Update the modeler with the sandbox version, using dynamic mbeans instead of model mbeans.
592b953ffc Add a quick comment.
7bccd08a7a Dead code, nobody seems to be using it.
69b2209da5 Direct calls instead of introspection via JMX
f9ae329864 Remove JMX warning message since java5 is required
f019587ce1 Revert, if Content-Length: <some large value> is an acceptable work around
ef69911cfe Fixed comet processing. The following bug was existing: When a comet request had begun, and the browser sent some more data, the Tomcat APR component was never reading the data from the socket and lead to two kinds of failures 1. The CometServlet.read returned false, cause no data was read, and the socket closed 2. If the CometServlet.read was overwritten and return true, the thread got stuck in a loop, forever hanging.
276e5acca8 Port fix for bug 39769. Remove the classloader switching from unload. It was removed from load some time ago. Patch provided by David Gagnon.
9149320003 Port fix for bug 39752 from 5.5.x.
7d5c25c613 Set line endings to native
f1911d8c5f - Add the manager classes and a package renamed fileupload. - I think there should be basic multipart handling in the core, although maybe the manager doesn't   belong here (so I would remove it later on).
7d015385ab - While it wouldn't be a completely bad idea to switch to an executor, the black box behavior of an   executor makes it a bit bad to be used with a default lame implementation, while the fancy   implementations are more "big server" ready with far more overhead and complexity.
7b870a495d - Create clustered managers with the Catalina CL set as the context CL (as classloading may occur). - Should fix 39699.
29b34d6fbb Add missing method to stop Gump from nagging
3b9739bcac - Remove usage of the CharChunk buffer (converters already use buffers). C2B converters could most   likely be optimized (since they should probably rely on the byte chunk that they are writing to).   This does not seem to reduce performance in a noticeable way, but I did not benchmark that much.
269eeac490 - With Comet support, it is necessary to optimize the amount of memory used by individual   processors. This removes most of the buffers that are being used, without reducing performance   in many cases. - Note: I'm not sure the algorithm in InternalAprInputBuffer.nextRequest, which is used when   pipelining, is correct. It also could use free space in the buffer more efficiently when trimming   it.
4ebbc070f4 - Add a brain dead executor. - Submitted by Vincenc Beltran Querol.
919e446848 - Port root webapp.
2f1af89468 - Add trivial exclude.
487f57db34 - I had some problems when shutting down pollers which had active connections in them. I can't   reproduce any problem anymore, unfortunately, but I think it was because there was a poll going   on while the sockets in the poller were being destroyed, which could then lead to these sockets   being destroyed again. So I'm adding code to wait until the poll call is done before doing the   poller stop.
f20cfff33f - Add examples webapp. - New chat example, which doesn't work properly yet (I suck at HTML). For some reason, it works with   a telnet, but not with a browser, which doesn't do any rendering until the whole page is received.
33772dbad8 - Some small comet fixes.
d8ee711000 - Fix some bugs with annotation support.
400e51ac3a Port the fix for MODELER-3 from [modeler] (minus some of the fluff :).
474d402a07 Port RMI fix from 5.5
9a18a49830 - Use getDeclaredMethods/Fields here.
ab25d957cc - Fix cut & paste bug, submitted by Stan Silvert.
30f072bdc0 - Some javadoc.
da3c892aad Suppress deprecation warnings on the implementation classes.
574ff58c8d AFAIK mod_jk2 is deprecated - and I doubt anyone is using this. If they do - can be reverted.
6c73b59019 Downgrade to DynamicMBeans in method signatures - there is no need to use Model here, the mbean server doesn't care.
1e8b770e99 - Add example read method. - Return value for read errors (as an option compared with throwing an exception). - Add some javadocs.
866474163a - Ok, it seems to work at least a little bit (hopefully, nobody tried it before this). Overall, the   changes are fairly limited. - In the end, I prefer adding a new method in Adapter, although it is easy to change back. - I'll try to add the examples webapp back, and add the obligatory chat servlet (so lame ...).
62d01f2c3c - Start work on comet support. Note: it doesn't work yet, I think (I didn't test), and most of this   is very preliminary. It is relatively straightforward, though.
4934e296c6 - Use Integer.valueOf. - Update restricted list a bit.
044183003d Use APR_UNSPEC for IPv6 and address=null. Backport from 5.5 branch.
356ca34668 Use APR_UNSPEC only if the provided address actually is the IPV6 address.
dcb32b15f1 - Use the ignore annotation flag. - It needs recompilation in case the value is changed. It could do without, but would need   additional code in the generated servlets (a field, read a servlet context param), so   it would generally be (even) more intrusive :(
7fc9baa3c7 - Pass the ignore annotation flag to Jasper.
ca0c56bd6a - Fix indentation. - jspDestroy didn't need any modification (the instances are tag handler instances, not tag   instances).
b7e3ab9d31 - Use separate build folders for the dependencies. - Update to Eclipse 3.2 (RC 2 right now).
a955206bfe Enable Annotation processing for Tags even when pooling is disabled.
97bf6bba5a - Injection should occur before the setters (BTW, since simple tags are not pooled, performance   will be bad; most likely some sort of caching is needed).
618c4d9614 - Add resource injection for tags (listeners are being handled in the servlet container).
4c7d6f18c4 - As suggested by Mladen, add a more robust mechanism for restricted servlets.
f22d65a36d - Change some locations.
514cd30b4b - Remove usage of TWA (otherwise, executor support cannot work).
6236c1dc82 - Port (not tested yet) the APR AJP code to java.io. I don't think it will be used in Tomcat unless   people configure it explicitly.
8c3e00a694 - Harmonize a bit more (the java.io HTTP 1.1 is the template: in the comments for the methods,   "*" means this method should be common to all protocols, and "HTTP" means the method should be   common to all HTTP protocols).
f625d7ccb9 - Experiment with an endpoint superclass (which will only hold common fields, though).
675917dfc1 - Remove JSP related resources.
64afe2cd01 - Update to descriptors.
ee8c92e62c Fix that StandardSession#getLastAccessedTime() uses correct exception message
3a5b29cbef - Refactor using the new java.io endpoint. Hopefully, I did not make any mistake. - I will now test a bit, and will attempt to extract superclasses (most likely BaseEndpoint,   BaseProtocol, BaseHttpProtocol).
e604ae1ae3 Clean up the default algorithm handling, now that JSSE 1.0 is no longer supported.
b7bd756e05 - Further sync the two endpoints.
533332d749 - Port Peter's patch which prevents double incrementation of the expiredSessions stats flag.
7c6944b1ee - Add compile.debug flag.
060c4e45c2 - Add support for using an Executor (the idea in that case is to define one executor for the whole   server, with an appropriate queue, etc). By default, I think it is good to continue using the   dumb stack, though.
2b1b754b25 - Add the refactored java.io endpoint that I talked about earlier.
5959268bd5 - Remove pre 1.5 compatibility code, which is not used anymore as the new APIs require and use   JDK 1.5+. I hope I didn't make any mistake merging the SSL code.
1b6fc179b8 - Remove leftover useless code.
4cbc1b5abb - Fix improper caching by checking the class definition.
093796afbd - Add a Jasper server listener to setup the JspFactory before any component related to a webapp is   started.
9ccc29c51c - Add annotation processor to Jasper too (tags need injection too).
36e10013eb And one more
da2d6a696d Fix typo
e029bbae4d - Port patches. - Change to session: it doesn't make sense to me that getAttribute is a good place to   synchronously make a check for session expiration (of course, with accessCount, this is   not going to happen anyway, but still).
a072883bc5 - Port patches. - verifyIfValid in Session.access seems useless.
a6bec0e60d - Add missing patch for 1.5 compatibility.
1146103c38 - Compatibility with Eclipse 3.2 (sort of, the flag doesn't mean the same thing, with the new one   doing some new unknown stuff).
e7f8e0684f - Switch to ArrayList. - private -> protected. - Use a marker constant for full range, because null indicates an error or no content.
2132ede379 - Add the usual download target (including building JDT and DBCP).
ec3d8efe30 - Update JAR packaging.
eed3e554ff - Add resource injection for all annotations that are supposed to be supported by the web tier.
d4ccf0fc34 - Update APIs and annotations.
f6e85aeecb - Improve the algorithm used when constructing classloaders, in particular to respect order. - Submitted by Rainer Jung.
ad2406feae - Add a few naming related cleanups.
0aabe84a11 Realized that the previous patch was too Gump-centric
9299195297 Restore the ability to build with the Mail Resources
4d00c5deeb - Add resource injection (note: most annotations are not supported, including web services,   JPA, EJB, etc), as well as PostCreate and PreDestroy. - If I understand the spec correctly, if using metadata-complete = true, then even PostCreate and   PreDestroy must be ignored. - Not tested yet (but it doesn't break when not using annotations). - Based on a patch submitted by Fabien Carrion.
efc3fe0900 - Add default value, submitted by Bill Barker.
10c7942700 - Add web.xml style annotations (run as, roles declarations, etc). - Note: commented out EJB and web services (similarly, the Persistence* annotations were not there). - Submitted by Fabien Carrion.
04588ed637 - I don't know if this field is legitimate or not, but it's used by the rest of the patch. I'll   check it.
dc178941d3 - Add annotations JAR.
4e45752f90 - Add "support" (note: not in NamingContextListener yet) for service-ref (after all, there's support   for all other elements, so ...). - Submitted by Fabien Carrion.
2271a3a2f3 - Add common annotations interfaces. - The latest docs seem to indicate that it's Declare*s*Roles.
c38b7baaa7 - Add support for multiple servlet and filter mappings. - Fix a bug I found by accident where application listeners are not reinitialized when reloading. - That's all folks, all the useful Servlet 2.5 features are done. Now the annotations ... (sigh) - Reuse the ignoreAnnotations field name from the patch submitted by Fabien Carrion.
4107ef876b - Update poweredby.
073e6b9b76 - Add new method (dummy).
45b5cb8738 - Add support for the new "*" special URL pattern for filters.
1c83d3ad6a - Slightly updated behavior for setCharEnc, and allow setting a session cookie from an included   resource in some cases.
f1e7d1820b - Add getContextPath.
ff8fd053b6 - Copy the XML descriptors.
5675009328 - Revert fix for 38113, which doesn't seem to be a bug, and appears to be causing regressions.
3d855ace74 - Standardize on the digester (which is apparently a bit faster than using DOM). This way, digester   now handles all XML parsing in Catalina.
d9c6580fca - Clean up a bit. - For some reason, trying to recycle a static digester doesn't improve performance.
28cdfe1049 - Move output so that Eclipse doesn't pollute the useful classes folder with his junk.
c028cc5dde - Remove modeler. - Fix CRLF.
e9ac952390 - Add missing patch (I didn't update from sources before merging).
550f6379d2 - Reduce the number of JARs. - Is it me, or are the JARs magically smaller ? There must be something related to JDK 1.5. - bootstrap.jar is really needed. - Import modeler. I think there are some serious possibilities to enhance XML processing,   as everything (or almost everything, as I don't think the modeler does at the moment)   goes through digester. - I suppose the webapps could be added now.
d3db3d941f - Fixes according to the directory structure.
ffda5ac7a6 - Clear obsolete content.
9dd2627118 - Add the usual set of JARs.
205db71fa2 A minimal set of files to debug and launch tomcat inside eclipse.
f65f474b1a Small fixes and adjustments to build.xml.
6d48eebb39 - Add building some JARs.
b0d89af956 Seems to be required as well, someone is looking for it.
b5708bd642 Add eclipse files
6731a27a55 Missing files. Not sure if that's the right version, I took it from servlet2.4.
fb19455f8b - Add missing patch.
a84fabcbc6 - Attempt to create a new repository according to the earlier thread. - No modules right now. - Dependencies on c-logging, c-modeler (which I think I will merge/simplify to util, as done with   digester earlier), Ant, JDT, PureTLS and JavaMail. Maybe it is possible to add dummy sources   for JavaMail to build without having to get the JAR, don't know about PureTLS. - Will require Java 5.
